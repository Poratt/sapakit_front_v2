Get-ChildItem -Path .\src, .\angular.json, .\package.json, .\tailwind.config.ts, .\tsconfig.json -Recurse -Include @("*.ts", "*.html", "*.css", "*.json") | ForEach-Object {
    "--- START OF FILE $($_.FullName.Replace($PWD.Path + '\', '')) ---"
    Get-Content $_.FullName -Raw
    "--- END OF FILE ---"
} | Out-File -FilePath "frontend_snapshot.txt" -Encoding utf8


--- START OF FILE src\app\assets\styles\materials.theme.css ---
html {
  /* COLOR SYSTEM VARIABLES */
  color-scheme: light;
  
  /* Primary palette variables */
  --mat-sys-primary: light-dark(var(--primary-400), var(--primary-100));
  --mat-sys-on-primary: light-dark(#ffffff, var(--primary-800));
  --mat-sys-primary-container: light-dark(var(--primary-50), var(--primary-700));
  --mat-sys-on-primary-container: light-dark(var(--primary-900), var(--primary-50));
  --mat-sys-inverse-primary: light-dark(var(--primary-100), var(--primary-400));
  --mat-sys-primary-fixed: light-dark(var(--primary-50), var(--primary-50));
  --mat-sys-primary-fixed-dim: light-dark(var(--primary-100), var(--primary-100));
  --mat-sys-on-primary-fixed: light-dark(var(--primary-900), var(--primary-900));
  --mat-sys-on-primary-fixed-variant: light-dark(var(--primary-700), var(--primary-700));

  /* Secondary palette variables */
  --mat-sys-secondary: light-dark(var(--secondary-500), var(--secondary-300));
  --mat-sys-on-secondary: light-dark(#ffffff, var(--secondary-800));
  --mat-sys-secondary-container: light-dark(var(--secondary-100), var(--secondary-400));
  --mat-sys-on-secondary-container: light-dark(var(--secondary-900), var(--secondary-100));
  --mat-sys-secondary-fixed: light-dark(var(--secondary-100), var(--secondary-100));
  --mat-sys-secondary-fixed-dim: light-dark(var(--secondary-300), var(--secondary-300));
  --mat-sys-on-secondary-fixed: light-dark(var(--secondary-900), var(--secondary-900));
  --mat-sys-on-secondary-fixed-variant: light-dark(var(--secondary-400), var(--secondary-400));

  /* Tertiary palette variables */
  --mat-sys-tertiary: light-dark(var(--grey-500), var(--grey-300));
  --mat-sys-on-tertiary: light-dark(#ffffff, var(--grey-800));
  --mat-sys-tertiary-container: light-dark(var(--grey-70), var(--grey-400));
  --mat-sys-on-tertiary-container: light-dark(var(--grey-900), var(--grey-70));
  --mat-sys-tertiary-fixed: light-dark(var(--grey-70), var(--grey-70));
  --mat-sys-tertiary-fixed-dim: light-dark(var(--grey-300), var(--grey-300));
  --mat-sys-on-tertiary-fixed: light-dark(var(--grey-900), var(--grey-900));
  --mat-sys-on-tertiary-fixed-variant: light-dark(var(--grey-400), var(--grey-400));

  /* Neutral palette variables */
  --mat-sys-background: light-dark(var(--grey-10), var(--grey-900));
  --mat-sys-on-background: light-dark(var(--grey-900), var(--grey-100));
  --mat-sys-surface: light-dark(var(--grey-10), var(--grey-900));
  --mat-sys-surface-dim: light-dark(var(--grey-100), var(--grey-900));
  --mat-sys-surface-bright: light-dark(var(--grey-10), var(--grey-700));
  --mat-sys-surface-container-lowest: light-dark(#ffffff, var(--grey-900));
  --mat-sys-surface-container: light-dark(var(--grey-50), var(--grey-800));
  --mat-sys-surface-container-high: light-dark(var(--grey-60), var(--grey-800));
  --mat-sys-surface-container-highest: light-dark(var(--grey-100), var(--grey-700));
  --mat-sys-on-surface: light-dark(var(--grey-900), var(--grey-100));
  --mat-sys-shadow: light-dark(#000000, #000000);
  --mat-sys-scrim: light-dark(#000000, #000000);
  --mat-sys-surface-tint: light-dark(var(--primary-400), var(--primary-100));
  --mat-sys-inverse-surface: light-dark(var(--grey-800), var(--grey-100));
  --mat-sys-inverse-on-surface: light-dark(var(--grey-40), var(--grey-800));
  --mat-sys-outline: light-dark(var(--grey-400), var(--grey-300));
  --mat-sys-outline-variant: light-dark(var(--grey-300), var(--grey-400));
  --mat-sys-neutral10: light-dark(var(--grey-900), var(--grey-900)); /* Variable used for the form field native select option text color */

  /* Error palette variables */
  --mat-sys-error: light-dark(var(--red-400), var(--red-200));
  --mat-sys-on-error: light-dark(#ffffff, var(--red-800));
  --mat-sys-error-container: light-dark(var(--red-100), var(--red-700));
  --mat-sys-on-error-container: light-dark(var(--red-900), var(--red-100));

  /* Neutral variant palette variables */
  --mat-sys-surface-variant: light-dark(var(--grey-70), var(--grey-400));
  --mat-sys-on-surface-variant: light-dark(var(--grey-400), var(--grey-300));
  --mat-sys-neutral-variant20: light-dark(var(--grey-800), var(--grey-800)); /* Variable used for the sidenav scrim (container background shadow when opened) */

  /* TYPOGRAPHY SYSTEM VARIABLES */

  /* Typography variables. Only used in the different typescale system variables. */
  /*--mat-sys-brand-font-family: Roboto;  The font-family to use for brand text. */
  /*--mat-sys-plain-font-family: Roboto;  The font-family to use for plain text. */
  --mat-sys-bold-font-weight: 700; /* The font-weight to use for bold text. */
  --mat-sys-medium-font-weight: 500; /* The font-weight to use for medium text. */
  --mat-sys-regular-font-weight: 400; /* The font-weight to use for regular text. */

  /* Typescale variables. */
  /* Warning: Risk of reduced fidelity from using the composite typography tokens (ex. --mat-sys-body-large) since
     tracking cannot be represented in the "font" property shorthand. Consider using the discrete properties instead. */
  --mat-sys-body-large: var(--mat-sys-body-large-weight) var(--mat-sys-body-large-size) / var(--mat-sys-body-large-line-height) var(--mat-sys-body-large-font);
  --mat-sys-body-large-font: var(--mat-sys-plain-font-family);
  --mat-sys-body-large-line-height: 1.5rem;
  --mat-sys-body-large-size: 1rem;
  --mat-sys-body-large-tracking: 0.031rem;
  --mat-sys-body-large-weight: var(--mat-sys-regular-font-weight);

  /* Body medium typescale */
  --mat-sys-body-medium: var(--mat-sys-body-medium-weight) var(--mat-sys-body-medium-size) / var(--mat-sys-body-medium-line-height) var(--mat-sys-body-medium-font);
  --mat-sys-body-medium-font: var(--mat-sys-plain-font-family);
  --mat-sys-body-medium-line-height: 1.25rem;
  --mat-sys-body-medium-size: 0.875rem;
  --mat-sys-body-medium-tracking: 0.016rem;
  --mat-sys-body-medium-weight: var(--mat-sys-regular-font-weight);

  /* Body small typescale */
  --mat-sys-body-small: var(--mat-sys-body-small-weight) var(--mat-sys-body-small-size) / var(--mat-sys-body-small-line-height) var(--mat-sys-body-small-font);
  --mat-sys-body-small-font: var(--mat-sys-plain-font-family);
  --mat-sys-body-small-line-height: 1rem;
  --mat-sys-body-small-size: 0.75rem;
  --mat-sys-body-small-tracking: 0.025rem;
  --mat-sys-body-small-weight: var(--mat-sys-regular-font-weight);

  /* Display large typescale */
  --mat-sys-display-large: var(--mat-sys-display-large-weight) var(--mat-sys-display-large-size) / var(--mat-sys-display-large-line-height) var(--mat-sys-display-large-font);
  --mat-sys-display-large-font: var(--mat-sys-brand-font-family);
  --mat-sys-display-large-line-height: 4rem;
  --mat-sys-display-large-size: 3.562rem;
  --mat-sys-display-large-tracking: -0.016rem;
  --mat-sys-display-large-weight: var(--mat-sys-regular-font-weight);

  /* Display medium typescale */
  --mat-sys-display-medium: var(--mat-sys-display-medium-weight) var(--mat-sys-display-medium-size) / var(--mat-sys-display-medium-line-height) var(--mat-sys-display-medium-font);
  --mat-sys-display-medium-font: var(--mat-sys-brand-font-family);
  --mat-sys-display-medium-line-height: 3.25rem;
  --mat-sys-display-medium-size: 2.812rem;
  --mat-sys-display-medium-tracking: 0;
  --mat-sys-display-medium-weight: var(--mat-sys-regular-font-weight);

  /* Display small typescale */
  --mat-sys-display-small: var(--mat-sys-display-small-weight) var(--mat-sys-display-small-size) / var(--mat-sys-display-small-line-height) var(--mat-sys-display-small-font);
  --mat-sys-display-small-font: var(--mat-sys-brand-font-family);
  --mat-sys-display-small-line-height: 2.75rem;
  --mat-sys-display-small-size: 2.25rem;
  --mat-sys-display-small-tracking: 0;
  --mat-sys-display-small-weight: var(--mat-sys-regular-font-weight);

  /* Headline large typescale */
  --mat-sys-headline-large: var(--mat-sys-headline-large-weight) var(--mat-sys-headline-large-size) / var(--mat-sys-headline-large-line-height) var(--mat-sys-headline-large-font);
  --mat-sys-headline-large-font: var(--mat-sys-brand-font-family);
  --mat-sys-headline-large-line-height: 2.5rem;
  --mat-sys-headline-large-size: 2rem;
  --mat-sys-headline-large-tracking: 0;
  --mat-sys-headline-large-weight: var(--mat-sys-regular-font-weight);

  /* Headline medium typescale */
  --mat-sys-headline-medium: var(--mat-sys-headline-medium-weight) var(--mat-sys-headline-medium-size) / var(--mat-sys-headline-medium-line-height) var(--mat-sys-headline-medium-font);
  --mat-sys-headline-medium-font: var(--mat-sys-brand-font-family);
  --mat-sys-headline-medium-line-height: 2.25rem;
  --mat-sys-headline-medium-size: 1.75rem;
  --mat-sys-headline-medium-tracking: 0;
  --mat-sys-headline-medium-weight: var(--mat-sys-regular-font-weight);

  /* Headline small typescale */
  --mat-sys-headline-small: var(--mat-sys-headline-small-weight) var(--mat-sys-headline-small-size) / var(--mat-sys-headline-small-line-height) var(--mat-sys-headline-small-font);
  --mat-sys-headline-small-font: var(--mat-sys-brand-font-family);
  --mat-sys-headline-small-line-height: 2rem;
  --mat-sys-headline-small-size: 1.5rem;
  --mat-sys-headline-small-tracking: 0;
  --mat-sys-headline-small-weight: var(--mat-sys-regular-font-weight);

  /* Label large typescale */
  --mat-sys-label-large: var(--mat-sys-label-large-weight) var(--mat-sys-label-large-size) / var(--mat-sys-label-large-line-height) var(--mat-sys-label-large-font);
  --mat-sys-label-large-font: var(--mat-sys-plain-font-family);
  --mat-sys-label-large-line-height: 1.25rem;
  --mat-sys-label-large-size: 0.875rem;
  --mat-sys-label-large-tracking: 0.006rem;
  --mat-sys-label-large-weight: var(--mat-sys-medium-font-weight);
  --mat-sys-label-large-weight-prominent: var(--mat-sys-bold-font-weight);

  /* Label medium typescale */
  --mat-sys-label-medium: var(--mat-sys-label-medium-weight) var(--mat-sys-label-medium-size) / var(--mat-sys-label-medium-line-height) var(--mat-sys-label-medium-font);
  --mat-sys-label-medium-font: var(--mat-sys-plain-font-family);
  --mat-sys-label-medium-line-height: 1rem;
  --mat-sys-label-medium-size: 0.75rem;
  --mat-sys-label-medium-tracking: 0.031rem;
  --mat-sys-label-medium-weight: var(--mat-sys-medium-font-weight);
  --mat-sys-label-medium-weight-prominent: var(--mat-sys-bold-font-weight);

  /* Label small typescale */
  --mat-sys-label-small: var(--mat-sys-label-small-weight) var(--mat-sys-label-small-size) / var(--mat-sys-label-small-line-height) var(--mat-sys-label-small-font);
  --mat-sys-label-small-font: var(--mat-sys-plain-font-family);
  --mat-sys-label-small-line-height: 1rem;
  --mat-sys-label-small-size: 0.688rem;
  --mat-sys-label-small-tracking: 0.031rem;
  --mat-sys-label-small-weight: var(--mat-sys-medium-font-weight);

  /* Title large typescale */
  --mat-sys-title-large: var(--mat-sys-title-large-weight) var(--mat-sys-title-large-size) / var(--mat-sys-title-large-line-height) var(--mat-sys-title-large-font);
  --mat-sys-title-large-font: var(--mat-sys-brand-font-family);
  --mat-sys-title-large-line-height: 1.75rem;
  --mat-sys-title-large-size: 1.375rem;
  --mat-sys-title-large-tracking: 0;
  --mat-sys-title-large-weight: var(--mat-sys-regular-font-weight);

  /* Title medium typescale */
  --mat-sys-title-medium: var(--mat-sys-title-medium-weight) var(--mat-sys-title-medium-size) / var(--mat-sys-title-medium-line-height) var(--mat-sys-title-medium-font);
  --mat-sys-title-medium-font: var(--mat-sys-plain-font-family);
  --mat-sys-title-medium-line-height: 1.5rem;
  --mat-sys-title-medium-size: 1rem;
  --mat-sys-title-medium-tracking: 0.009rem;
  --mat-sys-title-medium-weight: var(--mat-sys-medium-font-weight);

  /* Title small typescale */
  --mat-sys-title-small: var(--mat-sys-title-small-weight) var(--mat-sys-title-small-size) / var(--mat-sys-title-small-line-height) var(--mat-sys-title-small-font);
  --mat-sys-title-small-font: var(--mat-sys-plain-font-family);
  --mat-sys-title-small-line-height: 1.25rem;
  --mat-sys-title-small-size: 0.875rem;
  --mat-sys-title-small-tracking: 0.006rem;
  --mat-sys-title-small-weight: var(--mat-sys-medium-font-weight);

  /* ELEVATION SYSTEM VARIABLES */

  /* Box shadow colors. Only used in the elevation level system variables. */
  --mat-sys-umbra-color: color-mix(in srgb, var(--mat-sys-shadow), transparent 80%);
  --mat-sys-penumbra-color: color-mix(in srgb, var(--mat-sys-shadow), transparent 86%);
  --mat-sys-ambient-color: color-mix(in srgb, var(--mat-sys-shadow), transparent 88%);

  /* Elevation level system variables. These are used as the value for box-shadow CSS property. */
  --mat-sys-level0: 0px 0px 0px 0px var(--mat-sys-umbra-color), 0px 0px 0px 0px var(--mat-sys-penumbra-color), 0px 0px 0px 0px var(--mat-sys-ambient-color);
  --mat-sys-level1: 0px 2px 1px -1px var(--mat-sys-umbra-color), 0px 1px 1px 0px var(--mat-sys-penumbra-color), 0px 1px 3px 0px var(--mat-sys-ambient-color);
  --mat-sys-level2: 0px 3px 3px -2px var(--mat-sys-umbra-color), 0px 3px 4px 0px var(--mat-sys-penumbra-color), 0px 1px 8px 0px var(--mat-sys-ambient-color);
  --mat-sys-level3: 0px 3px 5px -1px var(--mat-sys-umbra-color), 0px 6px 10px 0px var(--mat-sys-penumbra-color), 0px 1px 18px 0px var(--mat-sys-ambient-color);
  --mat-sys-level4: 0px 5px 5px -3px var(--mat-sys-umbra-color), 0px 8px 10px 1px var(--mat-sys-penumbra-color), 0px 3px 14px 2px var(--mat-sys-ambient-color);
  --mat-sys-level5: 0px 7px 8px -4px var(--mat-sys-umbra-color), 0px 12px 17px 2px var(--mat-sys-penumbra-color), 0px 5px 22px 4px var(--mat-sys-ambient-color);

  /* SHAPE SYSTEM VARIABLES */
  --mat-sys-corner-extra-large: 28px;
  --mat-sys-corner-extra-large-top: 28px 28px 0 0;
  --mat-sys-corner-extra-small: 4px;
  --mat-sys-corner-extra-small-top: 4px 4px 0 0;
  --mat-sys-corner-full: 9999px;
  --mat-sys-corner-large: 16px;
  --mat-sys-corner-large-end: 0 16px 16px 0;
  --mat-sys-corner-large-start: 16px 0 0 16px;
  --mat-sys-corner-large-top: 16px 16px 0 0;
  --mat-sys-corner-medium: 12px;
  --mat-sys-corner-none: 0;
  --mat-sys-corner-small: 8px;

  /* STATE SYSTEM VARIABLES */
  --mat-sys-dragged-state-layer-opacity: 0.16;
  --mat-sys-focus-state-layer-opacity: 0.12;
  --mat-sys-hover-state-layer-opacity: 0.08;
  --mat-sys-pressed-state-layer-opacity: 0.12;
}





--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_buttons.css ---
button.primary,
button.empty,
button.danger {
	border: none;
	width: fit-content;
	height: fit-content;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 2px;
	border-radius: 6px;
	cursor: pointer;
	transition: all 0.2s ease-out;
	padding: 2px 4px;
	font-size: 14px;
	border: 1px solid transparent;
	outline: 2px solid transparent;
	outline-offset: 2px;
	white-space: nowrap;
	
	.material-symbols-rounded {
		transition: all 0.2s ease-out;
		font-size: 18px;
		padding-top: 2px;
	}
	
	&.float {
		box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.2705882353);
	}
	
	&.xs {
		padding: 2px 3px 2px 7px;
		gap: 2px;
		font-size: 11px;
		.material-symbols-rounded {
			font-size: 14px;
		}
	}
	
	&.sm {
		padding: 2px 4px 2px 10px;
		gap: 2px;
		font-size: 12px;
		.material-symbols-rounded {
			font-size: 16px;
		}
	}
	
	&.md {
		padding: 4px 8px 4px 12px;
		gap: 4px;
		font-size: 14px;
		.material-symbols-rounded {
			font-size: 18px;
		}
	}
	
	&.lg {
		padding: 6px 12px 6px 16px;
		gap: 6px;
		font-size: 16px;
		.material-symbols-rounded {
			font-size: 20px;
		}
	}
	
	&.xl {
		padding: 8px 16px 8px 20px;
		gap: 8px;
		font-size: 18px;
		.material-symbols-rounded {
			font-size: 22px;
		}
	}
	
	&.round-icon {
		height: 32px;
		width: 32px;
		border-radius: 100%;
		.material-symbols-rounded {
			font-size: 24px;
		}
	}
}

button.primary {
	background: var(--primary-100);
	
	&:hover {
		background: var(--primary-200);
		color: var(--primary-800);
		.material-symbols-rounded {
			color: var(--primary-800);
		}
	}
	
	&:active {
		background: var(--primary-300);
		color: var(--primary-800);
		.material-symbols-rounded {
			color: var(--primary-800);
		}
	}
	
	&:focus-visible {
		outline-color: var(--primary-500);
		background: var(--primary-150, var(--primary-200));
	}
}

button.danger {
	background: var(--red-50);
	/* border: 1px solid var(--red-200); */
	/* color: var(--red-800); */
	.material-symbols-rounded {
		/* color: var(--red-800); */
	}
	
	&:hover {
		background: var(--red-500);
		color: var(--red-50);
		.material-symbols-rounded {
			color: var(--red-50);
		}
	}
	
	&:active {
		background: var(--red-300);
		color: var(--red-50);
		.material-symbols-rounded {
			color: var(--red-50);
		}
	}
	
	&:focus-visible {
		outline-color: var(--red-500);
		background: var(--red-150, var(--red-200));
	}
}

button.empty {
	background: var(--grey-50);
	border: 1px solid var(--grey-100);
	
	&:hover {
		background: var(--grey-100);
		color: var(--grey-800);
		.material-symbols-rounded {
			color: var(--grey-800);
		}
	}
	
	&:active {
		background: var(--grey-200);
		color: var(--grey-800);
		.material-symbols-rounded {
			color: var(--grey-800);
		}
	}
	
	&:focus-visible {
		outline-color: var(--grey-500);
		background: var(--grey-75, var(--grey-100));
		border-color: var(--grey-300);
	}
}


.toggle-switch {
	display: flex;
	width: 120px;
	height: 24px;
	display: flex;
	justify-content: center;
	position: relative;
	border-radius: 20px;
	background: var(--red-100);
	border: 1px solid var(--grey-90);
	overflow: hidden;
	cursor: pointer;
	transition: all 0.3s ease;
	user-select: none;
	will-change: background-color;

	&::after {
		content: '';
		position: absolute;
		width: 52px;
		height: calc(100% - 5px);
		top: 3px;
		left: 3px;
		padding: 1px 4px;
		border-radius: 20px;
		transition:
			transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55),
			outline 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55),
			background 0.5s ease;
		z-index: 0;
		will-change: transform, background-color, scale;
		background: var(--red-300);
	}

	&.active::after {
		transform: translateX(58px);
		background: var(--green-300);
	}

	&:has(.inactive) {
		background-color: var(--red-100);
		.toggle-switch-text.inactive {
			color: var(--red-700);
		}
	}
	&:has(.active) {
		background-color: var(--green-100);
		.toggle-switch-text.active {
			color: var(--green-700);
		}
	}

	.toggle-switch-text {
		width: 60px;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 11px;
		font-weight: 400;
		color: var(--grey-600);
		z-index: 1;
		transition:
			color 0.3s ease 0.05s,
			font-weight 0.3s ease;
		pointer-events: auto;
		cursor: pointer;
		color: var(--grey-300);
	}

	input[type='checkbox'] {
		display: none;
	}
}

.custom-select-button {
	padding: 0.2rem 0.5rem;
	font-size: 0.7rem;
	display: flex;
	align-items: center;
	gap: 4px;
	transition: 0.2s ease-in-out all;
	border-radius: 4px;

	span.pi {
		font-size: 0.7rem;
		padding-top: 3px;
	}

	&:hover {
		background-color: var(--p-select-option-focus-background);
	}
}
/* 

.info-btn {
	color: var(--primary-500);
}

.edit-btn {
	color: var(--grey-600);
}

.delete-btn {
	color: var(--red-500);
}

button {
	cursor: pointer;
}

.icon-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 28px;
	height: 28px;
	border-radius: 50%;
	cursor: pointer;
	transition: all 0.2s ease-in-out;
	gap: 4px;

	.material-symbols-rounded {
		font-size: 20px;
	}

	&:hover {
		background-color: var(--grey-70);
	}

	&.xs {
		width: 16px;
		height: 16px;
		gap: 2px;

		.material-symbols-rounded {
			font-size: 12px;
		}
	}

	&.sm {
		width: 24px;
		height: 24px;
		gap: 3px;

		.material-symbols-rounded {
			font-size: 16px;
		}
	}

	&.md {
		width: 28px;
		height: 28px;
		gap: 4px;

		.material-symbols-rounded {
			font-size: 20px;
		}
	}

	&.lg {
		width: 36px;
		height: 36px;
		gap: 5px;

		.material-symbols-rounded {
			font-size: 24px;
		}
	}

	&.xl {
		width: 48px;
		height: 48px;
		gap: 6px;

		.material-symbols-rounded {
			font-size: 32px;
		}
	} */

/* 
.menu-item {
    margin: 12px auto;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(0, 0, 0, 0.6);
    font-size: 24px;
    font-variation-settings: 'FILL' 0, 'wght' 400;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 8px;

    &:hover {
        color: rgba(0, 0, 0, 0.9);
        background-color: rgba(0, 0, 0, 0.04);
    }

    &.active {
        color: var(--primary-400);
        background-color: var(--primary-50);
        animation: subtle-pop 0.3s ease forwards;
        font-variation-settings: 'FILL' 1, 'wght' 300;
        color: var(--primary-400);

        &::before {
            content: '';
            position: absolute;
            right: -12px;
            height: 75%;
            width: 3px;
            background: var(--primary-400);
            border-radius: 4px 0 0 4px;
        }
    }

    &.sm {
        margin: 0px auto;
        padding: 4px;

        &.active::before {
            right: 50%;
            transform: translateX(50%);
            top: -6px;
            height: 3px;
            width: 75%;
            background: var(--primary-400);
            border-radius: 0 0 4px 4px;
        }
    }
} */

--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_forms.css ---
.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    padding: 4px;


}

.flex-wrap-wrapper {
    display: flex;
    flex-wrap: wrap;
    min-width: 0;
    gap: 12px;
    width: 100%;
    min-height: 45px;
}

.flex-wrap-item {
    flex-grow: 1;
    min-width: 10px;
    width: 180px;
    position: relative;
    margin-bottom: 0.35rem;
    display: flex;
    flex-direction: column;

    &.half-width {
        width: calc(50% - 12px);
    }

    >input,
    >.p-select {
        width: 100%;
    }
}

/* .form-field {
    position: relative;
    margin-bottom: 0.35rem;
    display: flex;
    flex-direction: column;

    &.full-width {
        grid-column: span 2;
    }
} */

label {
    display: block;
    margin-bottom: 2px;
    font-weight: 500;
    color: var(--grey-800);
    font-size: 0.75rem;
}

.error-message {
    @starting-style {
        opacity: 0;
        width: 0;
    }

    overflow: hidden;
    white-space: nowrap;
    width: 100%;
    transition: 1s ease-in-out all;
    color: var(--red-500);
    font-size: 0.65rem;
    position: absolute;
    bottom: -16px;
    right: 4px;
}

.search-box {
    display: flex;
    align-items: center;
    background: var(--grey-10);
    padding: 0 0.5rem;
    border: 1px solid var(--grey-200);
    width: 100%;
    max-width: 250px;
    border-radius: 24px !important;
    &:focus-within,
    &:active{
        border-color: var(--primary-200) !important;
        box-shadow: 0 4px 12px var(--primary-50) !important;
        i {
            color: var(--primary-300);
            margin-left: 0.25rem;
            transform: rotateZ(90deg)
        }
    }
    
    i {
        transition: all 0.2s ease-in-out !important;
        color: var(--grey-500);
        margin-left: 0.25rem;
    }

    input {
        border: none;
        outline: none;
        background: transparent;
        width: 100%;
    }

    .p-inputtext {
        box-shadow: none !important;
        border: none !important;
        background: transparent !important;
    }
}






.p-inputnumber {
    /* Container styling */
    display: inline-flex;
    position: relative;
    font-family: inherit;
    height: 100%;
}

.p-inputnumber-input {
    /* Input field styling */
    border: 1px solid var(--grey-300);
    border-radius: 8px;
    padding: 0.6rem 0.8rem;
    text-align: center;
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 3rem;
    /* background: var(--white, #ffffff); */
    color: var(--grey-800);
    outline: none;
    position: relative;

    /* Modern focus state */
    &:focus {
        border-color: var(--primary-500);
        box-shadow: 0 0 0 2px rgba(var(--primary-500-rgb), 0.15);
    }

    /* Hover state */
    &:hover:not(:focus) {
        border-color: var(--grey-400);
    }

    .p-inputnumber-stacked.p-inputnumber-button-group {
        width: 100%;
    }

    .p-inputnumber-stacked.p-inputnumber-increment-button {
        position: absolute;
        left: 0;
    }

    .p-inputnumber-stacked.p-inputnumber-decrement-button {
        position: absolute;
        right: 0;
    }
}

.p-inputnumber-button {
    /* Button styling */
    background: var(--primary-50);
    border: 1px solid var(--primary-100);
    border-radius: 8px;
    color: var(--primary-700);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    margin: 0 0.25rem;
    cursor: pointer;
    transition: all 0.2s ease;

    /* Modern hover state */
    &:hover {
        background: var(--primary-100);
        color: var(--primary-800);
    }

    /* Active state with subtle feedback */
    &:active {
        transform: scale(0.92);
        background: var(--primary-200);
    }
}

/* Animation for value changes */
@keyframes subtle-pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(var(--primary-500-rgb), 0.3);
    }

    70% {
        box-shadow: 0 0 0 6px rgba(var(--primary-500-rgb), 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(var(--primary-500-rgb), 0);
    }
}

.p-inputnumber.ng-dirty .p-inputnumber-input {
    animation: subtle-pulse 0.5s ease;
}

/* Classic touch with subtle texture */
.p-inputnumber::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-image: linear-gradient(to bottom,
            rgba(255, 255, 255, 0.03),
            rgba(0, 0, 0, 0.02));
    border-radius: 8px;
    z-index: 1;
}
--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_loader.css ---
.loading-wave {
  width: 300px;
  height: 100px;
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.loading-bar {
  width: 20px;
  height: 10px;
  margin: 0 5px;
  background-color: #3498db;
  border-radius: 5px;
  animation: loading-wave-animation 1s ease-in-out infinite;
}

.loading-bar:nth-child(2) {
  animation-delay: 0.1s;
}

.loading-bar:nth-child(3) {
  animation-delay: 0.2s;
}

.loading-bar:nth-child(4) {
  animation-delay: 0.3s;
}

@keyframes loading-wave-animation {
  0% {
    height: 10px;
  }

  50% {
    height: 50px;
  }

  100% {
    height: 10px;
  }
}

/* .loader {
    width: 48px;
    height: 48px;
    border: 3px dotted var(--primary-600);
    border-style: solid solid dotted dotted;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    box-sizing: border-box;
    animation: rotation 2s linear infinite;
  }
  .loader::after {
    content: '';  
    box-sizing: border-box;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    margin: auto;
    border: 3px dotted var(--primary-400);
    border-style: solid solid dotted;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    animation: rotationBack 1s linear infinite;
    transform-origin: center center;
  }
      
  @keyframes rotation {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  } 
  @keyframes rotationBack {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(-360deg);
    }
  }  */
--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_menu.css ---
/* --xs: 576px;     --sm: 768px;    --md: 1000px;   --lg: 1200px;   --xl: 1400px;   */


/* Animated Burger Button  */
.menu-btn {
    @media (max-width: 1000px) {
        display: flex;
    }

    display: none;
    position: relative;
    width: 40px;
    height: 40px;
    transition: all 0.2s ease;
    cursor: pointer;
    z-index: 40;

    span {
        position: absolute;
        display: block;
        background: var(--grey-800);
        height: 2px;
        width: 22px;
        border-radius: 1px;
                transition: all 0.7s cubic-bezier(0.19, 1, 0.22, 1);
        will-change: transform, top, opacity;

        &:nth-child(1) {
            top: 12px;
        }

        &:nth-child(2) {
            top: 18px;
        }

        &:nth-child(3) {
            top: 25px
        }

    }

    &.opened {
        transform: translateX(8px);


        span {
            &:nth-child(1) {
                top: 18px;
                transform: rotate(45deg);
            }

            &:nth-child(2) {
                opacity: 0;
                transform: scaleX(0.5);
            }

            &:nth-child(3) {
                top: 18px;
                transform: rotate(-45deg);
            }
        }
    }
}



.menu-wrapper {
    height: calc(100vh - 80px);
    position: static;
    top: 80px;
    right: 0;
    z-index: 25;
    transition: width 0.2s cubic-bezier(0.25, 1, 0.5, 1);

    @media screen and (max-width: 1000px) {
        position: fixed;
        top: 0;
        height: 100vh;
        z-index: 30;
        overflow: hidden;
        transition:
            transform 0.2s cubic-bezier(0.25, 1, 0.5, 1),
            max-width 0.2s cubic-bezier(0.25, 1, 0.5, 1),
            opacity 0.2s cubic-bezier(0.25, 1, 0.5, 1);
        transform: translateX(100%);
        width: fit-content;
        border: none;
        box-shadow: -1px 0px 8px rgba(0, 0, 0, 0.2);
        background: var(--frame-bg);
        border: none;
        max-width: 0;
        opacity: 0;
        transform-origin: right center;

        &.active {
            transform: translateX(0);
            max-width: var(--menu-width);
            opacity: 1;
        }
    }
}

.menu-content {
    height: 100%;
    width: var(--menu-width);
    padding: 3px;
    background: var(--frame-bg);
    top: 0;
    overflow: hidden;
    z-index: 5;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: 2px;
    transition: all 0.2s ease;

    @media (max-width: 1000px) {
        background: transparent;
        border: none;
        padding-top: var(--header-height);
    }

    .menu-item,
    .submenu-item {
        position: relative;
        cursor: pointer;
        display: flex;
        align-items: center;
        border-radius: 4px;
        font-weight: 600;
        white-space: nowrap;
        width: 100%;
        transition: background 0.2s ease;

        .label {
            transform: translateX(0px);
        }

        .icon {
            padding-right: 3px;
        }

        .submenu-toggle {
            transform: scale(1);
            opacity: 1;
            transition: all 0.2s ease;
        }

        /* Side indicator */
        &::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 4px;
            width: 3.5px;
            height: 5px;
            border-radius: 48px;
            background: linear-gradient(135deg, var(--primary-50), var(--gray-50));
            transition: all 0.3s ease;
        }

        /* Normal hover state */
        &:hover:not(.separator):not(.active-link) {
            background: var(--grey-70);
            color: var(--primary-500) !important;
        }

        &:hover:not(.separator):not(.active-link) span {
            color: var(--primary-500);
        }

        /* Indicator on hover */
        &:hover::after {
            height: 5%;
            background: linear-gradient(135deg, var(--primary-200), var(--primary-700));
        }

        /* Indicator on active state */
        &:active::after {
            height: 25%;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
        }

        /* Active link state */
        &.active-link {
            background: var(--grey-30);
            transition: none;
            color: var(--primary-500) !important;
        }

        &.active-link span {
            color: var(--primary-600);
        }

        /* Indicator in active-link state */
        &.active-link::after {
            width: 3.5px;
            height: 75%;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            transition: all 0.4s ease;
        }

        /* Indicator in active-link + hover state */
        &.active-link:hover::after {
            height: 85%;
            background: linear-gradient(135deg, var(--primary-400), var(--primary-600));
        }

        
    }

    .menu-item {
        .label {
            font-size: 14px;
        }
    }

    .submenu-item {
        .label {
            font-size: 12px;
        }

        .icon {
            font-size: 18px;
        }
    }

    &.shrink {
        width: var(--menu-width-closed);

        .menu-item,
        .submenu-item {
            .label {
                opacity: 0;
                font-size: 1px;
                transform: translateX(-100%);
                max-width: 0;
                transition: all 0.2s ease, max-width 0.2s cubic-bezier(0.25, 1, 0.5, 1);
            }

            .icon {
                transform: scale(1.25);
                transition: all 0.2s ease;
            }


        }

        .submenu-item {
            transition: all 0.2s ease;

            .icon {
                transform: scale(1);
                transition: all 0.2s ease;
            }
        }

        .logo-wrapper .label {
            opacity: 0;
            font-size: 1px;
            transition: all 0.2s ease;
        }
    }
}


.rotatable {
    display: inline-block;
    transform: rotate(0deg);
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center center;

    &.flip {
        transform: rotate(180deg);
        transition: transform 0.2s ease-in;
    }
}




.menu-separator {
    height: 1.25px;
    width: 80%;
    margin: 4px auto;
    background: linear-gradient(90deg, #d4d4d8, #a1a1aa, #d4d4d8);
    border-radius: 6px;
    transition: background 0.2s ease;
}

.menu-content.shrink .menu-separator {
    width: 70% !important;
}




.logo-wrapper {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;

    .logo {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: contain;
    }

    .label {
        opacity: 1;
        transition: all 0.2s ease-in;
        text-align: center;
    }
}




.p-panelmenu {
    gap: 4px !important;
    background: transparent !important;

    .p-panelmenu-content {
        border-left: 1px solid var(--grey-100);
        border-right: 1px solid var(--grey-100);
        border-bottom: 1px solid var(--grey-100);
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
    }

    .p-panelmenu-panel {
        background: transparent;
        border: 1px solid transparent;
        padding: 0 !important;

        .p-panelmenu-header-active {
            background: var(--grey-70);

            span {
                color: var(--primary-500);
                transform: none;
                animation: none;
            }

            span.submenu-toggle {
                transform: rotateZ(180deg);
                transition: transform 0.2s ease-in;
                transform-origin: center center;
            }

        }
    }

    .p-panelmenu-header {
        .p-panelmenu-header-content {
            border: none;
            background: transparent;

        }
    }

    .p-panelmenu-submenu {
        animation: none;
        transition: none;

        .p-panelmenu-item {
            animation: none;
            transition: none;
            padding: 0;
            background: transparent;
            border: none;


            &,
            .p-panelmenu-item-content:hover:not(.p-disabled),
            &:hover:not(.p-disabled),
            .p-panelmenu-item-content {
                display: flex;
                width: 100%;
            }

            &:last-child {
                border-bottom-left-radius: 8px;
                border-bottom-right-radius: 8px;
            }
        }

        &:dir(rtl) {
            padding: 4px;
            gap: 3px;
            display: flex;
            flex-direction: column;
        }

    }

    .p-panelmenu-header-content {
        width: 100%;

        &:active,
        &:not(.p-disabled).p-panelmenu-header-content:hover {
            background: transparent;
        }

        .p-panelmenu-header-link {
            visibility: hidden;
            display: none;
        }
    }



}
--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_reset.css ---
@font-face {
	font-family: 'Fredoka';
	font-style: normal;
	font-weight: 300 700; /* Variable font weight */
	font-display: swap; /* Crucial for performance */
	src: url('../fonts/fredoka-v16-latin-regular.woff2') format('woff2');
}

/* Material Symbols */
@font-face {
	font-family: 'Material Symbols Rounded';
	font-style: normal;
	font-weight: 100 400;
	font-display: swap; /* Crucial for performance */
	src: url('../fonts/material-symbols-rounded-v258-latin-regular.woff2') format('woff2');
}

input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
	-webkit-box-shadow: 0 0 0 30px white inset !important;
	-webkit-text-fill-color: #000 !important;
	background-color: transparent !important;
	background-image: none !important;
	color: #000 !important;
}

html {
	height: 100%;
	scroll-behavior: smooth;

	font-size: 16px;
	margin: 0;
	padding: 0;
	font-family: 'Fredoka', sans-serif;
	font-weight: 400;
	font-style: normal;
	color: var(--text-color);
}

body {
	min-height: 100%;
	height: 100%;
	/* background-color: var(--grey-100); */
	/* overflow: hidden; */
}

.material-symbols-rounded {
	font-variation-settings: 'FILL' 0, 'wght' 200, 'GRAD' 0, 'opsz' 28;
}

a {
	cursor: pointer;
}

/* SCROLL BAR */
/* For WebKit browsers (e.g., Chrome, Safari) */
::-webkit-scrollbar {
	width: 4px;
	height: 4px;
	background: transparent !important;
}

::-webkit-scrollbar-thumb {
	border-radius: 40px;
	background: #d1d5db;
	/* background-color: var(--secondary-200); */
	cursor: pointer;

	&:hover {
		/* background: var(--secondary-500); */
		background: #1e293b;
	}
}

::-webkit-scrollbar-track {
	/* border: 1px solid var(--secondary-300); */
	border: #f1f1f1;
	border-radius: 28px;
	scrollbar-color: white;
	-ms-overflow-style: none;
	/* Hide scrollbar for IE and Edge */
	scrollbar-width: thin;
	/* Specify a scrollbar width for Firefox */
	scrollbar-color: white;
	/* Specify scrollbar color for Firefox */
}

/* Angular materials  */

/* Slide toggle */
.mat-mdc-slide-toggle {
	--mdc-switch-track-width: 42px;
	--mdc-switch-track-height: 22px;
	--mat-switch-with-icon-handle-size: 14px;
	--mat-switch-pressed-handle-size: 14px;
	--mat-switch-unselected-with-icon-handle-horizontal-margin: 0 4px;
	--mat-switch-unselected-pressed-handle-horizontal-margin: 0 4px;
	--mat-switch-selected-with-icon-handle-horizontal-margin: 0 24px;
	--mat-switch-selected-pressed-handle-horizontal-margin: 0 24px;
}

.mdc-switch--unselected .mdc-switch__icon,
.mdc-switch--selected .mdc-switch__icon {
	--mdc-switch-selected-icon-size: 12px;
	--mdc-switch-unselected-icon-size: 12px;
}

/* Tabs */
.mat-mdc-tab-group {
	&.sm {
		/* max-width: 400px; */
	}
	&.no-labels .mat-mdc-tab-header {
		display: none !important;
	}
}

/* mat-chip */
button.mdc-evolution-chip__action.mat-mdc-chip-action.mdc-evolution-chip__action--primary {
	width: 100%;
}

.mdc-evolution-chip__graphic {
	flex: unset !important;
}

.mat-mdc-chip-set .mdc-evolution-chip-set__chips {
	padding: 6px 4px;
	display: grid;
	grid-template-columns: repeat(7, minmax(0, 1fr));
	gap: 4px;
	margin-left: 0px !important;
	margin-right: 0px !important;
}

.mat-mdc-chip-set .mdc-evolution-chip {
	margin-left: 0px !important;
	margin-right: 0px !important;
	margin: 0 !important;
}

@media (max-width: 600px) {
	.mdc-evolution-chip__action.mat-mdc-chip-action.mdc-evolution-chip__action--primary {
		padding-left: 0;
	}

	.mat-mdc-standard-chip {
		height: fit-content !important;
	}

	.mdc-evolution-chip__action {
		flex-direction: column;
	}

	.mdc-evolution-chip__cell.mdc-evolution-chip__cell--primary {
		display: flex;
		align-items: center;
		justify-content: center;
	}
}

/* primeNG */
p-selectbutton.custom.sm .p-togglebutton-content {
	padding: clamp(2px, 2vw, 8px);
	.material-symbols-rounded {
		font-size: 18px;
	}
}
p-button.p-button-xs {
	span::before {
		font-size: 12px !important;
	}
	.p-button-icon-only {
		width: 28px !important;
		height: 28px !important;
	}
}
p-splitbutton {
	.p-button-outlined:not(:disabled):hover {
		background-color: transparent !important;
	}
	.p-button-sm {
		padding: 0 !important;
		font-size: 12px !important;
	}
	.p-button-sm .p-button-icon {
		width: 24px !important;
		font-size: 12px !important;
	}
	.p-button-label {
		font-size: 12px !important;
	}
	.p-iconwrapper {
		svg {
			display: none;
		}
		position: relative;
		&::after {
			content: '\e313';
			position: absolute;
			font-size: 14px;
			font-family: 'Material Symbols Rounded';
		}
	}
	.p-splitbutton-button.p-button-small.p-button-sm {
		padding: 4px 8px 4px 0px !important;
		gap: 0;
	}
}

p-tieredmenusub {
	span.p-tieredmenu-item-icon,
	span.p-tieredmenu-item-label {
		font-size: 12px !important;
	}
	a.p-tieredmenu-item-link {
		padding: 8px 12px !important;
	}
}

.p-tieredmenu {
	min-width: fit-content !important;
}

.p-button-danger {
	--p-button-danger-background: var(--red-50);
	--p-button-danger-color: var(--grey-800);
	--p-button-danger-border-color: transparent;
	--p-button-danger-hover-background: var(--red-500);
	--p-button-danger-hover-border-color: transparent;
}
.p-overlay-content {
	direction: rtl;
}

/* Dialog */
.p-dialog {
	direction: rtl;
	overflow: hidden;
	/* max-width: 450px; */

	.p-dialog-header {
		/* background: var(--primary-50); */
		
		color: var(--grey-800);
		padding: 12px 20px;
		.p-button-text.p-button-secondary {
			width: 32px !important;
			height: 32px !important;
		}
	}

	&.no-header {
		.p-dialog-header {
			padding: 0px;
		}
		.p-dialog-header-actions {
			display: none;
		}
	}

	&.bottom-overlay {
		position: relative;
	}
	.p-dialog-title {
		font-weight: 500;
		font-size: 17px;
		color: #334155;
	}

	.p-dialog-content {
		/* padding: 0 24px 24px !important; */
		/* color: var(--grey-800); */
	}

	.p-dialog-footer,
	.dialog-footer {
		padding: 1rem;
		/* border-top: 1px solid var(--grey-200); */
		display: flex;
		justify-content: flex-end;
		gap: 0.5rem;
	}

	@media (max-width: 576px) {
		.p-dialog-content {
			padding: 0 16px 16px !important;
		}

		.p-card-body {
			padding: 0.5rem;
		}

		.detail-item {
			gap: 0.5rem;

			.detail-icon {
				font-size: 1rem;
			}

			.detail-label,
			.detail-value {
				font-size: 0.8rem;
			}
		}
	}
}

.p-dialog {
	.p-dialog-content:has(app-order-dialog) {
		padding: 0 !important;
	}
}

.p-dialog.no-padding {
	.p-dialog-header,
	.p-dialog-content {
		padding: 0 !important;
	}
}

.dialog-header {
	white-space: nowrap;

}
/* button.p-button {
  display: flex;
  flex-direction: row-reverse;
} */

/* Input Fields */

textarea,
.p-inputtext,
.p-textarea,
.p-select,
.p-multiselect {
	border-radius: 24px !important;
	border: 1px solid var(--grey-200) !important;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03) !important;
	transition: all 0.2s ease-in-out !important;
	background: linear-gradient(0deg, var(--grey-50), white) !important;
	outline: none;
	/* padding: 6px 12px; */
	font-size: 12px !important;

	&::placeholder,
	.p-select-label.p-placeholder,
	.p-select-label {
		/* padding: 0 4px !important; */
		font-size: 12px !important;
		font-weight: 400 !important;
		letter-spacing: 0.2px !important;
	}

	&.sm {
		padding: 0 4px !important;
		font-size: 12px !important;
	}
	&:hover {
		border-color: var(--grey-300) !important;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06) !important;
	}

	&:focus,
	&:focus-within,
	&:active,
	&.p-select-open {
		border-color: var(--primary-200) !important;
		box-shadow: 0 4px 12px var(--primary-50) !important;
	}

	&:disabled {
		opacity: 0.7;
		background: var(--grey-40) !important;
		&:hover {
			border-color: var(--grey-200) !important;
			background: var(--grey-30) !important;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06) !important;
		}
	}

	p-selectitem {
		border-radius: 4px !important;
	}

	p-selectitem:last-child .p-select-option {
		border-radius: 4px 4px 8px 8px !important;
	}

	/* &.ng-invalid.ng-touched,
	&.ng-invalid.ng-touched.ng-dirty {
		border: 1px solid var(--red-300) !important;
		&:focus,
		&:focus-within,
		&:active,
		&.p-select-open {
			border: 1px solid var(--red-300) !important;
			box-shadow: 0 4px 12px var(--red-50) !important;
		}
		&::placeholder,
		.p-select-label.p-placeholder,
		.p-select-label {
			color: var(--red-400) !important;
		}
	} */
}

/* input.transparent {
	background: red !important;
	border: none !important;
	box-shadow: none !important;
	padding: 0 !important;
} */

/* Select */
.p-select {
	direction: rtl;
	background-color: var(--grey-20);
	border-radius: var(--border-radius);
	box-shadow: var(--box-shadow);
	padding: 0.5rem;
	height: 100%;
	align-items: center;
}

.p-select-option {
	direction: rtl;
	font-size: 14px;
}

/* Table */

.p-datatable th,
.p-datatable td {
	font-size: clamp(11px, 1.5vw, 13px);
}

.p-datatable {
	background: var(--grey-20);
	border-radius: var(--border-radius);
	overflow: hidden;
	box-shadow: var(--box-shadow);
}

.p-datatable th {
	background: var(--grey-60) !important;
	color: var(--grey-500);
	font-weight: 500;
	padding: 0.5rem;

	svg.p-icon.p-sortable-column-icon {
		height: 10px;
	}
}

.p-datatable td {
	padding: 0.5rem;
	border-bottom: 1px solid var(--grey-50);
	transition: 0.2s ease-in-out all;
	@media screen and (max-width: 768px) {
		justify-content: flex-start !important;
	}
}

.p-datatable tr:hover {
	background-color: var(--grey-20) !important;
	transition: all 0.3s ease;

	> td {
		color: var(--primary-700);
	}
}

.p-datatable tr:last-child td {
	border-bottom: none;
}

.p-datatable tr {
	transition: 0.2s ease-in-out;
	&:has(.delete-btn) {
		position: relative;

		&::after {
			transition: height 0.2s cubic-bezier(0.4, 0, 0.2, 1),
				background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			content: '';
			position: absolute;
			left: 6px;
			top: 50%;
			transform: translateY(-50%);
			height: 0%;
			width: 2px;
			background-color: var(--red-200);
			border-radius: 50px;
		}
	}

	&:has(.delete-btn:hover) {
		background-color: var(--red-50) !important;

		&::after {
			height: 55%;
			width: 2px;
			background-color: var(--red-500);
		}
	}
}

tr[ng-reflect-animation-trigger='rowExpansionTrigger'] {
	backface-visibility: hidden;
	perspective: 1000px;

	>td{
		background-color: green!important;
		border:1px solid  green!important;
	}
}

.expanded-table-content {
	box-shadow: none;
	border: 1px solid var(--grey-100);
	th {
		background-color: var(--grey-40) !important;
	}
	>td {
		padding: 0;
		background-color: green !important;
		border: 1px solid green !important;
	}
}

.item-to-delete {
	background-color: var(--red-100) !important;
	border: 1px solid var(--red-300) !important;
	border-radius: 12px !important;
	transition: all 0.2s ease-in-out;
	&::after {
		height: 55%;
		width: 2px;
		background-color: var(--red-500);
	}
}

.actions-cell {
	display: flex;
	align-items: center;
	justify-content: flex-end;
	gap: 4px;
}

.table-image {
	width: 40px;
	height: 40px;
	object-fit: cover;
	border-radius: 6px;
	border: 1px solid var(--grey-200);
}

.no-image {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	background-color: var(--grey-50);
	border-radius: 4px;
	color: var(--grey-400);
	font-size: 10px;
	padding: 2px;
	width: 32px;
	height: 32px;
	border-radius: 6px;

	i {
		font-size: 24px;
		/* margin-bottom: 2px; */
		opacity: 0.7;
	}

	span {
		line-height: 1;
	}
}

.p-inputtext {
	width: 100%;
}

/* Number Input  */
input.p-inputtext.p-inputnumber-input {
	position: relative !important;
	/* padding: 12px 4px !important; */
	border-radius: 20px;
}

.p-inputnumber-stacked {
	.p-inputnumber-button {
		position: absolute !important;
		top: 50%;
		transform: translateY(-50%);

		&:active,
		&:focus {
			transform: translateY(-50%) !important;
			outline: none;
		}

		&:hover {
			background: transparent;
		}
	}

	.p-inputnumber-button-group {
		position: static !important;

		.p-iconwrapper {
			visibility: hidden;
			display: none;
		}
	}

	.p-inputnumber-decrement-button,
	.p-inputnumber-increment-button {
		&::after {
			font-family: 'Material Symbols Rounded';
			font-size: 18px !important;
			color: var(--grey-600) !important;
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			transition: all 0.3s ease-in-out;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		&:hover::after {
			background-color: var(--grey-100);
		}
	}

	.p-inputnumber-increment-button {
		left: -1px;

		&::after {
			content: '\e145';
		}
	}

	.p-inputnumber-decrement-button {
		right: -1px;

		&::after {
			content: '\e15b';
		}
	}
}

/* Password input */
.p-password {
	width: 100%;

	.p-inputtext {
		width: 100%;
	}
}

textarea,
.p-inputtext,
.p-textarea,
.p-select,
.p-multiselect {
	border-radius: 24px !important;
	border: 1px solid var(--grey-200) !important;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03) !important;
	transition: all 0.2s ease-in-out !important;
	background: linear-gradient(0deg, var(--grey-50), white) !important;
	outline: none;
	/* padding: 6px 12px; */
	font-size: 12px !important;

	&::placeholder,
	.p-select-label.p-placeholder,
	.p-select-label {
		padding: 0 4px !important;
		font-size: 12px !important;
		font-weight: 400 !important;
		letter-spacing: 0.2px !important;
	}

	&.sm {
		padding: 0 4px !important;
		font-size: 12px !important;
	}
	&:hover {
		border-color: var(--grey-300) !important;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06) !important;
	}

	&:focus,
	&:focus-within,
	&:active,
	&.p-select-open {
		border-color: var(--primary-200) !important;
		box-shadow: 0 4px 12px var(--primary-50) !important;
	}

	p-selectitem {
		border-radius: 4px !important;
	}

	p-selectitem:last-child .p-select-option {
		border-radius: 4px 4px 8px 8px !important;
	}
}

/* Select(Dropdown) */
.p-select {
	.p-iconwrapper {
		display: none;
	}

	.p-select-dropdown::after {
		content: '\e313';
		font-family: 'Material Symbols Rounded';
		font-size: 20px !important;
		color: var(--grey-600) !important;
		position: absolute;
		top: 50%;
		left: 0.75rem;
		transform: translateY(-50%);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
	}

	&.p-select-open .p-select-dropdown::after {
		transform: translateY(calc(-50% - 1px)) rotate(180deg);
		color: var(--primary-500) !important;
	}
}

.p-multiselect {
	.p-multiselect-dropdown > .p-iconwrapper {
		display: none;
	}

	.p-multiselect-dropdown::after {
		content: '\e313';
		font-family: 'Material Symbols Rounded';
		font-size: 20px !important;
		color: var(--grey-600) !important;
		position: absolute;
		top: 50%;
		left: 0.75rem;
		transform: translateY(-50%);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
	}

	&.p-multiselect-open .p-multiselect-dropdown::after {
		transform: translateY(calc(-50% - 1px)) rotate(180deg);
		color: var(--primary-500) !important;
	}

	.p-inputtext {
		font-size: 13px;
		padding: 4px 8px;
		border-radius: 24px;

		&:hover {
			border-color: var(--grey-300) !important;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06) !important;
		}

		&:focus,
		&:active,
		&.p-select-open {
			border-color: var(--primary-200) !important;
			box-shadow: 0 4px 12px var(--primary-50) !important;
		}
	}
}

/* P-toast */
.p-toast {
	.p-toast-message {
		margin-bottom: 0.5rem;
		box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
		/* background: linear-gradient(145deg, #333333bb, #333333bb); */

		border-radius: 4px;
		overflow: hidden;
	}

	.p-toast-message-content {
		border-radius: 3px;

		.p-toast-message-text {
			gap: 0 !important;
		}
	}

	.p-toast-message-icon {
		font-size: 20px;
		margin-left: 0.75rem;
	}

	.p-toast-message-success {
		.p-toast-close-icon,
		.p-toast-message-icon,
		.p-toast-summary {
			color: var(--green-700);
		}

		.p-toast-message-content {
			border-left: 3px solid var(--green-400);
			background: linear-gradient(145deg, var(--green-100), var(--green-50));

			.p-toast-detail {
				color: var(--green-700);
			}
		}
	}

	.p-toast-message-error {
		.p-toast-close-icon,
		.p-toast-message-icon,
		.p-toast-summary {
			color: var(--red-700);
		}

		.p-toast-message-content {
			border-left: 3px solid var(--red-400);
			background: linear-gradient(145deg, var(--red-100), var(--red-50));

			.p-toast-detail {
				color: var(--red-700);
			}
		}
	}

	.p-toast-message-warn {
		.p-toast-close-icon,
		.p-toast-message-icon,
		.p-toast-summary {
			color: var(--yellow-700);
		}

		.p-toast-message-content {
			border-left: 3px solid var(--yellow-400);
			background: linear-gradient(145deg, var(--yellow-100), var(--yellow-50));
		}

		.p-toast-detail {
			color: var(--yellow-700);
		}
	}

	.p-toast-message-info {
		.p-toast-close-icon,
		.p-toast-message-icon,
		.p-toast-summary {
			color: var(--primary-700);
		}

		.p-toast-message-content {
			border-left: 3px solid var(--primary-400);
			background: linear-gradient(145deg, var(--primary-100), var(--primary-50));
		}

		.p-toast-detail {
			color: var(--primary-700);
		}
	}

	.p-toast-close-button {
		.p-icon {
			margin-top: 8px;
		}

		&:hover {
			background-color: rgba(255, 255, 255, 0.1);
			color: #ffffff;
		}

		&:focus {
			outline: none;
			box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
		}
	}
}

/* Base tooltip styling */
.p-tooltip .p-tooltip-text {
	direction: rtl;
	background-color: var(--grey-700);
	color: #ffffff;
	padding: 4px 8px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	font-family: 'Fredoka', sans-serif;
	border-radius: 4px;
	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
	animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
	from {
		opacity: 0;
		transform: translateY(-5px) scale(0.25);
	}

	to {
		opacity: 1;
		transform: translateY(0) scale(1);
	}
}

/* Warning tooltip variant */
.p-tooltip.warning .p-tooltip-text {
	background-color: var(--warning-400);
	color: #ffffff;
}

/* Reset default arrow colors */
.p-tooltip.p-tooltip-top .p-tooltip-arrow,
.p-tooltip.p-tooltip-bottom .p-tooltip-arrow,
.p-tooltip.p-tooltip-left .p-tooltip-arrow,
.p-tooltip.p-tooltip-right .p-tooltip-arrow {
	border-color: transparent;
}

/* Warning tooltip arrow */
.p-tooltip.warning.p-tooltip-top .p-tooltip-arrow,
.p-tooltip.warning.p-tooltip-bottom .p-tooltip-arrow,
.p-tooltip.warning.p-tooltip-left .p-tooltip-arrow,
.p-tooltip.warning.p-tooltip-right .p-tooltip-arrow {
	border-color: transparent;
}

/* in use ? */
div.p-tablist-tab-list,
p-tabpanels.p-tabpanels.p-component {
	background-color: transparent;
	background: transparent;
}

div.p-tablist-tab-list > .p-tablist-active-bar {
	background-color: var(--primary-500);
}

p-tab.p-tab {
	color: var(--grey-600);
}

p-tab.p-tab-active {
	color: var(--primary-500);
	border-color: var(--primary-300);
}

p-tab.p-tab:not(.p-tab-active):not(.p-disabled):hover {
	background-color: transparent;
	background: transparent;
}

.p-menu-item-content > a.p-menu-item-link {
	direction: rtl;
}

--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_responsive.css ---



/* Max-Width */
.hide-max-xs { display: block; }
@media (max-width: 576px) {
    .hide-max-xs { display: none; }
}
.show-max-xs { display: none; }
@media (max-width: 576px) {
    .show-max-xs { display: block; }
}

/* Max-Width sm */
.hide-max-sm { display: block; }
@media (max-width: 768px) {
    .hide-max-sm { display: none; }
}
.show-max-sm { display: none; }
@media (max-width: 768px) {
    .show-max-sm { display: block; }
}

/* Max-Width md */
.hide-max-md { display: block; }
@media (max-width: 992px) {
    .hide-max-md { display: none; }
}
.show-max-md { display: none; }
@media (max-width: 992px) {
    .show-max-md { display: block; }
}

/* Max-Width lg */
.hide-max-lg { display: block; }
@media (max-width: 1200px) {
    .hide-max-lg { display: none; }
}
.show-max-lg { display: none; }
@media (max-width: 1200px) {
    .show-max-lg { display: block; }
}

/* Max-Width xl */
.hide-max-xl { display: block; }
@media (max-width: 1400px) {
    .hide-max-xl { display: none; }
}
.show-max-xl { display: none; }
@media (max-width: 1400px) {
    .show-max-xl { display: block; }
}


/* Min-Width */
.hide-min-xs { display: none; }
@media (min-width: 576px) {
    .hide-min-xs { display: block; }
}
.show-min-xs { display: block; }
@media (min-width: 576px) {
    .show-min-xs { display: none; }
}

/* Min-Width sm */
.hide-min-sm { display: none; }
@media (min-width: 768px) {
    .hide-min-sm { display: block; }
}
.show-min-sm { display: block; }
@media (min-width: 768px) {
    .show-min-sm { display: none; }
}

/* Min-Width md */
.hide-min-md { display: none; }
@media (min-width: 992px) {
    .hide-min-md { display: block; }
}
.show-min-md { display: block; }
@media (min-width: 992px) {
    .show-min-md { display: none; }
}

/* Min-Width lg */
.hide-min-lg { display: none; }
@media (min-width: 1200px) {
    .hide-min-lg { display: block; }
}
.show-min-lg { display: block; }
@media (min-width: 1200px) {
    .show-min-lg { display: none; }
}

/* Min-Width xl */
.hide-min-xl { display: none; }
@media (min-width: 1400px) {
    .hide-min-xl { display: block; }
}
.show-min-xl { display: block; }
@media (min-width: 1400px) {
    .show-min-xl { display: none; }
}
--- END OF FILE ---
--- START OF FILE src\app\assets\styles\_variables.css ---
:root {
  --xs: 576px;
  --sm: 768px;
  --md: 1000px;
  --lg: 1200px;
  --xl: 1400px;

  --border-radius: 8px;
  --box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  --box-shadow-hover: 0 2px 12px rgba(0, 0, 0, 0.16);
  --box-shadow-active: 0 2px 12px rgba(0, 0, 0, 0.24);

  --header-height: 80px;
  --menu-width: 140px;
  --menu-width-closed: 56px;
  --page-height: calc(100vh - var(--header-height));
  --frame-bg: var(--grey-70);

  --primary-10: hsl(208 100% 99% / 1);
  --primary-20: hsl(208 100% 98% / 1);
  --primary-30: hsl(208 100% 97% / 1);
  --primary-40: hsl(208 100% 96% / 1);
  --primary-50: hsl(208 100% 95% / 1);
  --primary-60: hsl(208 100% 93% / 1);
  --primary-70: hsl(208 100% 91% / 1);
  --primary-80: hsl(208 100% 89% / 1);
  --primary-90: hsl(208 100% 87% / 1);
  --primary-100: hsl(208 100% 85% / 1);
  --primary-200: hsl(208 100% 75% / 1);
  --primary-300: hsl(208 100% 65% / 1);
  --primary-400: hsl(208 100% 55% / 1);
  --primary-500: #007ae6;
  --primary-600: hsl(208 100% 35% / 1);
  --primary-700: hsl(208 100% 25% / 1);
  --primary-800: hsl(208 100% 15% / 1);
  --primary-900: hsl(208 100% 5% / 1);

  --secondary-50: hsl(300deg 20% 99%);
  --secondary-80: hsl(300deg 20% 97%);
  --secondary-90: hsl(300deg 20% 96%);
  --secondary-100: hsl(300deg 20% 95%);
  --secondary-200: hsl(300deg 20% 85%);
  --secondary-300: hsl(300deg 20% 75%);
  --secondary-400: hsl(300, 20%, 65%);
  --secondary-500: #a375a3;
  --secondary-600: hsl(300deg 20% 45%);
  --secondary-700: hsl(300deg 20% 35%);
  --secondary-800: hsl(300deg 20% 25%);
  --secondary-900: hsl(300deg 20% 15%);


/* Light grey with subtle slate blue undertones */

--grey-10: hsl(210 8% 99% / 1);
--grey-20: hsl(210 8% 98% / 1);
--grey-30: hsl(210 7% 97% / 1);
--grey-40: hsl(210 7% 96% / 1);
--grey-50: hsl(210 6% 95% / 1);
--grey-60: hsl(210 6% 94% / 1);
--grey-70: hsl(210 6% 93% / 1);
--grey-80: hsl(210 5% 92% / 1);
--grey-90: hsl(210 5% 90% / 1);
--grey-100: hsl(210 6% 88% / 1);
--grey-200: hsl(215 8% 82% / 1);
--grey-300: hsl(215 10% 72% / 1);
--grey-400: hsl(215 12% 62% / 1);
--grey-500: hsl(215 14% 52% / 1);
--grey-600: hsl(215 16% 42% / 1);
--grey-700: hsl(215 18% 32% / 1);
--grey-800: hsl(215 20% 22% / 1);
--grey-900: hsl(215 22% 12% / 1);


  /* A slightly richer, more confident Red */
  --red-50: hsl(0, 84%, 97%);
  --red-100: hsl(0, 86%, 94%);
  --red-200: hsl(0, 88%, 88%);
  --red-300: hsl(0, 89%, 81%);
  --red-400: hsl(0, 90%, 72%);
  --red-500: hsl(0, 84%, 60%); /* Base color */
  --red-600: hsl(0, 72%, 51%);
  --red-700: hsl(0, 74%, 42%);
  --red-800: hsl(0, 63%, 35%);
  --red-900: hsl(0, 56%, 29%);

  /* A fresh, modern Green */
  --green-50: hsl(146, 75%, 96%);
  --green-100: hsl(145, 76%, 91%);
  --green-200: hsl(146, 70%, 81%);
  --green-300: hsl(146, 60%, 68%);
  --green-400: hsl(147, 48%, 54%);
  --green-500: hsl(147, 50%, 42%); /* Base color */
  --green-600: hsl(148, 56%, 33%);
  --green-700: hsl(148, 60%, 26%);
  --green-800: hsl(149, 62%, 21%);
  --green-900: hsl(150, 68%, 17%);

  /* A warmer, more golden Yellow/Amber */
  --yellow-50: hsl(45, 93%, 96%);
  --yellow-100: hsl(46, 95%, 89%);
  --yellow-200: hsl(45, 94%, 78%);
  --yellow-300: hsl(45, 93%, 65%);
  --yellow-400: hsl(43, 91%, 55%);
  --yellow-500: hsl(38, 92%, 50%); /* Base color */
  --yellow-600: hsl(33, 90%, 45%);
  --yellow-700: hsl(28, 86%, 37%);
  --yellow-800: hsl(25, 82%, 31%);
  --yellow-900: hsl(23, 75%, 26%);
}








/* widget colors */
/* --widget-bg: hsl(228.26deg 71% 95%);
--widget-bg-hover: hsl(228.26deg 71% 97%);
--widget-shadow: hsl(0deg 0% 80% / 0.6);
--widget-border: hsl(0deg 0% 80% / 0.2);
--widget-border-radius: 6px; */
--- END OF FILE ---
--- START OF FILE src\app\common\const\animations.ts ---
import {
	trigger,
	transition,
	style,
	animate,
	state,
	query,
	stagger,
	group,
} from '@angular/animations';

export const bgError = trigger('bgErrorChange', [
	state(
		'true',
		style({
			backgroundColor: '#fee2e2', // Set the background color when the boolean is true
		}),
	),
	state(
		'false',
		style({
			backgroundColor: 'transparent', // Set the background color when the boolean is false
		}),
	),
	transition('false <=> true', [animate('0.5s')]),
]);

export const ExpandDetailsRow = trigger('detailExpand', [
	state('collapsed', style({
		height: '0px',
		minHeight: '0',
		display: 'none'
	})),
	state('expanded', style({
		height: '*'
	})),
	transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)'))
]);
export const ExpandDetailsRowOnEnter = trigger('detailExpand', [
	transition(':enter', [
		style({ height: '0px', minHeight: '0' }),
		animate('500ms ease-in-out', style({ height: '*' })),
	]),
	transition(':leave', [animate('100ms', style({ height: '0px', minHeight: '0' }))]),
]);

export const fade = trigger('fade', [
	transition(':enter', [style({ opacity: 0 }), animate('500ms', style({ opacity: 1 }))]),
	transition(':leave', [animate('0ms', style({ opacity: 0 }))]),
]);

export const slideInTop = trigger('slideInTop', [
	transition(':enter', [
		style({ transform: 'translateY(-25%)', opacity: 0 }),
		animate('0.5s ease-out', style({ transform: 'translateY(0)', opacity: 1 })),
	]),
	transition(':leave', [
		animate('0.2s ease-in', style({ transform: 'translateY(-100%)', opacity: 0 })),
	]),
]);

export const slideInTop100 = trigger('slideInTop', [
	transition(':enter', [
		style({ transform: 'translateY(50%)', opacity: 0 }),
		animate('0.5s ease-out', style({ transform: 'translateY(100%)', opacity: 1 })),
	]),
	transition(':leave', [
		animate('0.2s ease-in', style({ transform: 'translateY(50%)', opacity: 0 })),
	]),
]);

export const slideUp = trigger('slideUp', [
	transition(':enter', [
		style({ transform: 'translateY(75%)', opacity: 0 }),
		animate('0.5s ease-out', style({ transform: 'translateY(120%)', opacity: 1 })),
	]),
	transition(':leave', [
		animate('0.2s ease-in', style({ transform: 'translateY(0)', opacity: 0 })),
	]),
]);

export const expandShrink = trigger('expandShrink', [
	state(
		'expand',
		style({
			maxHeight: '800px', // adjust the maxHeight as needed
			opacity: 1,
			overflow: 'auto',
		}),
	),
	state(
		'shrink',
		style({
			maxHeight: '0',
			opacity: 0,
			overflow: 'hidden',
		}),
	),
	transition('expand <=> shrink', [animate('0.3s ease-in-out')]),
]);

export const fadeInOut = trigger('fadeInOut', [
	transition(':enter', [style({ opacity: 0 }), animate('300ms ease-in', style({ opacity: 1 }))]),
	transition(':leave', [animate('200ms ease-out', style({ opacity: 0 }))]),
]);

export const fadeIn400 = trigger('fadeIn400', [
	state('void', style({ opacity: '0' })), // Initial state, above the viewport
	state('*', style({ opacity: '1' })), // Final state, within the viewport
	transition('void => *', animate('400ms cubic-bezier(0.10, 0.1, 0.27, 1.1)')), // Enter animation
	transition('* => void', animate('100ms ease-out')), // Exit animation
]);

export const fadeIn1000 = trigger('fadeIn1000', [
	state('void', style({ opacity: '0' })), // Initial state, above the viewport
	state('*', style({ opacity: '1' })), // Final state, within the viewport
	transition('void => *', animate('1000ms ease-in')), // Enter animation
	transition('* => void', animate('1000ms ease-out')), // Exit animation
]);

export const fadeOut200 = trigger('fadeOut200', [
	// transition(':enter', [
	//   style({ opacity: 0 }),
	//   animate('200ms cubic-bezier(0.10, 0.1, 0.27, 1.1)', style({ opacity: '1' }))
	// ]),
	transition(
		':leave',
		animate('200ms cubic-bezier(0.10, 0.1, 0.27, 1.1)', style({ opacity: '0' })),
	), // Exit animation
]);

export const popupAnimation = trigger('popupAnimation', [
	state('void', style({ opacity: '0.1', scale: 0, left: '50%', top: '25%' })),
	state('*', style({ opacity: '1', scale: 1 })),
	transition('void => *', animate('500ms cubic-bezier(0.10, 1.1, 0.27, 1.1)')),
	transition('* => void', animate('5000ms cubic-bezier(0.10, 1.1, 0.27, 1.1)')),
]);

export const opacityAndScale = trigger('opacityAndScale', [
	state('void', style({ opacity: '0', scale: 0.1 })), // Initial state, above the viewport
	state('*', style({ opacity: '1', scale: 1 })), // Final state, within the viewport
	transition('void => *', animate('300ms ease-in')), // Enter animation
	transition('* => void', animate('300ms ease-out')), // Exit animation
]);

export const slideTopToBottomAnimation = trigger('slideTopToBottom', [
	state(
		'void',
		style({
			transform: 'translateY(-50%)',

			opacity: 0,
		}),
	), // Initial state, above the viewport
	state(
		'*',
		style({
			transform: 'translateY(0)',

			opacity: 1,
		}),
	), // Final state, within the viewport
	transition('void => *', animate('300ms ease-in')), // Enter animation
	transition('* => void', animate('300ms ease-out')), // Exit animation
]);

export const slideBottomToTopAnimation = trigger('slideBottomToTop', [
	state('void', style({ transform: 'translateY(100%)', scale: '0' })), // Initial state, above the viewport
	state('*', style({ transform: 'translateY(0)', scale: '1' })), // Final state, within the viewport
	transition('void => *', animate('500ms ease-in')), // Enter animation
	transition('* => void', animate('500ms ease-out')), // Exit animation
]);

export const slideRightToLeftAnimation = trigger('slideRightToLeft', [
	state('void', style({ transform: 'translateX(100%)' })), // Initial state, to the right of the viewport
	state('*', style({ transform: 'translateX(0)' })), // Final state, within the viewport
	transition('void => *', animate('500ms ease-in')), // Enter animation (from right to left)
	transition('* => void', animate('500ms ease-out')), // Exit animation (from left to right)
]);

export const slideLeftToRightAnimation = trigger('slideLeftToRight', [
	state('void', style({ transform: 'translateX(-50%)', opacity: 0 })),
	state('*', style({ transform: 'translateX(0%)', opacity: 1 })),
	transition('void => *', animate('400ms cubic-bezier(0.10, 0.1, 0.27, 1.1)')),
	transition('* => void', animate('400ms cubic-bezier(0.10, 0.1, 0.27, 1.1)')),
]);

export const slideRight = trigger('slideRight', [
	state('void', style({ transform: 'translateX(-300%)', opacity: 0 })), // Initial state, element is not in the DOM
	transition(':enter', [
		animate('1s ease-in-out', style({ transform: 'translateX(0)', opacity: 1 })), // Animation for entering the DOM
	]),
	transition('* => void', [
		// Animation for leaving the DOM
		animate('1s ease-in-out', style({ transform: 'translateY(-300%)', opacity: 0 })),
	]),
]);

export const slideDown = trigger('slideDown', [
	state('void', style({ transform: 'translateY(-60%)', opacity: 0 })), // Initial state, above the viewport
	state('*', style({ transform: 'translateY(0)', opacity: 100 })), // Final state, within the viewport
	transition('void => *', animate('200ms ease-in')), // Enter animation
	transition('* => void', animate('200ms ease-out')), // Exit animation
]);

export const slideDownAndScale60 = trigger('slideDownAndScale60', [
	state('void', style({ transform: 'translateY(0%)', scale: 0.1 })), // Initial state, above the viewport
	state('*', style({ transform: 'translateY(60%)', scale: 1 })), // Final state, within the viewport
	transition('void => *', animate('500ms ease-in')), // Enter animation
	transition('* => void', animate('500ms ease-out')), // Exit animation
]);

export const expandCollapse = trigger('expandCollapse', [
	state(
		'open',
		style({
			height: '*',
			opacity: 1,
		}),
	),
	state(
		'closed',
		style({
			height: '0px',
			opacity: 0,
			overflow: 'hidden',
		}),
	),
	transition('closed => open', [
		style({
			height: '0px',
			opacity: 0,
			overflow: 'hidden',
		}),
		query(
			'.submenu-item',
			[
				style({
					opacity: 0,
					transform: 'translateY(-10px)',
					visibility: 'hidden',
				}),
			],
			{ optional: true },
		),
		group([
			animate(
				'300ms ease-in-out',
				style({
					height: '*',
					opacity: 1,
				}),
			),
			query(
				'.submenu-item',
				[
					style({ visibility: 'visible' }),
					stagger(120, [
						animate(
							'300ms 300ms ease-out',
							style({
								opacity: 1,
								transform: 'translateY(0)',
							}),
						),
					]),
				],
				{ optional: true },
			),
		]),
	]),
	transition('open => closed', [
		style({ overflow: 'hidden' }),
		query(
			'.submenu-item',
			[
				stagger(100, [
					animate(
						'100ms ease-in',
						style({
							opacity: 0,
							transform: 'translateY(-10px)',
						}),
					),
				]),
			],
			{ optional: true },
		),
		animate(
			'100ms ease-in-out',
			style({
				height: '0px',
				opacity: 0,
			}),
		),
	]),
]);

export const staggerMenuItems = trigger('staggerMenuItems', [
	transition('* => *', [
		query(
			':enter',
			[
				style({ opacity: 0, transform: 'translateX(-20px)' }),
				stagger(70, [
					animate(
						'300ms ease-out',
						style({
							opacity: 1,
							transform: 'translateX(0)',
						}),
					),
				]),
			],
			{ optional: true },
		),
	]),
]);

export const crossFade = trigger('crossFade', [
	transition(':enter', [style({ opacity: 0 }), animate('300ms ease-out', style({ opacity: 1 }))]),
	transition(':leave', [animate('200ms ease-in', style({ opacity: 0 }))]),
	// מעבר בין מצבים אחיאים
	transition('* => *', [
		style({ position: 'relative' }),
		query(
			':enter, :leave',
			[
				style({
					position: 'absolute',
					top: 0,
					left: 0,
					width: '100%',
				}),
			],
			{ optional: true },
		),
		query(':enter', [style({ opacity: 0 })], { optional: true }),
		query(':leave', [style({ opacity: 1 })], { optional: true }),
		group([
			query(':leave', [animate('200ms ease-out', style({ opacity: 0 }))], {
				optional: true,
			}),
			query(':enter', [animate('300ms ease-in', style({ opacity: 1 }))], {
				optional: true,
			}),
		]),
	]),
]);

--- END OF FILE ---
--- START OF FILE src\app\common\const\banks.ts ---
export const banks: string[] = [
	'בנק דיסקונט', // 11
	'בנק יהב', // 4
	'בנק ירושלים', // 54
	'בנק לאומי', // 10
	'בנק מזרחי טפחות', // 20
	'בנק מרכנתיל', // 17
	'בנק פועלים', // 12
	'בנק הדואר', // 9
	'בנק אגוד לישראל', // 13
];

--- END OF FILE ---
--- START OF FILE src\app\common\const\chart-config.ts ---
export const GreenChart = 'hsl(142.56deg 71% 65%)';
export const RedChart = 'hsl(0deg 71% 65%)';
export const GrayChart = '#E0E0E0';
export const BlueChart = 'hsl(208deg 100% 35%)';

export const LightChartColors = [
  'hsl(190, 70%, 75%)',   // Light Teal
  'hsl(280, 60%, 85%)',   // Light Purple
  'hsl(60, 75%, 80%)',    // Light Yellow
  'hsl(160, 65%, 75%)',   // Light Green-Blue
  'hsl(330, 70%, 85%)',   // Light Pink
  'hsl(220, 65%, 80%)',   // Light Blue
  'hsl(100, 60%, 85%)',   // Light Yellow-Green
  'hsl(350, 65%, 80%)',   // Light Red-Pink
  'hsl(25, 85%, 80%)',    // Light Orange
  'hsl(120, 55%, 75%)'    // Light Green
];

export const ChartColors = {
  backgroundColor: [GreenChart, RedChart],
  pieDonutColors: LightChartColors

  //   hoverBackgroundColor: ['#4CAF50', '#F44336'],
  //   borderColor: ['rgba(75, 192, 192, 0.2)', 'rgba(255, 99, 132, 0.2)'],
  //   hoverBorderColor: ['rgba(75, 192, 192, 1)', 'rgba(255, 99, 132, 1)'],
};

export const ChartViewSettings = {
  hoverOffset: 20,
  borderWidth: 0.5,
  borderJoinStyle: 'round',
  hoverBorderColor: 'transparent',
}

export const BaseChartAnimation = {
  duration: 1500,
  easing: 'easeOutBounce',
  delay: 200,
  animateScale: true,
};

export const ChartDoughnutAnimation = {
  animateRotate: true,
  ...BaseChartAnimation,
};

export const ChartBarAnimation = {
  animateRotate: false,
  ...BaseChartAnimation,
};

export const ChartLineAnimation = {
  tension: 0.4, // "Curve" effect for the line chart (makes the line smoother)
  ...BaseChartAnimation,
};

export const TooltipChart = {
  enabled: true,
  backgroundColor: 'rgba(255, 255, 255, 0.8)',
  titleColor: '#333',
  font: { // Changed from titleFont to font
    family: "'Heebo', sans-serif",
    size: 14,
    weight: 'bold',
  },
  bodyColor: '#666',
  bodyFont: { // Kept bodyFont as it is a valid property for body text
    family: "'Heebo', sans-serif",
    size: 12,
    
  },

  boxWidth: 6,
  boxHeight: 6,

  borderColor: 'rgba(0, 0, 0, 0.1)',
  borderWidth: 1,
  padding: 10,
  cornerRadius: 6,
  displayColors: true,
  usePointStyle: true,
  rtl: true,

};

export const ChartDefaultSettings = {
  responsive: true,
  maintainAspectRatio: false,
  aspectRatio: 0.8,

  interaction: {
    mode: 'index',
    intersect: false,
  },
  hover: {
    mode: 'nearest',
    intersect: true,
  },
  scales: {
    y: {
      beginAtZero: true,
      grid: {
        color: 'rgba(0,0,0,0.05)',
        drawBorder: false
      },
      ticks: {
        color: '#666',
        font: {
          size: 12
        }
      }
    },
    x: {
      grid: {
        display: true
      },
      ticks: {
        color: '#666',
        font: {
          size: 12
        }
      }
    }
  },

  elements: {
    line: {
      tension: 0.4,
      borderWidth: 1
    },
    point: {
      radius: 2,
      hoverRadius: 4,

      backgroundColor: 'rgb(36, 127, 225)',
      borderColor: 'white',
      borderWidth: 1
    }
  },
  layout: {
    padding: {
      top: 10,
      right: 10,
      bottom: 80,
      left: 0
    }
  },


  devicePixelRatio: window.devicePixelRatio || 1,
  locale: 'he-IL',
};




export function createLinearGradient(
  chart: any,
  colorTop: string,
  colorBottom: string
): CanvasGradient | string {
  const ctx = chart?.ctx;
  const area = chart?.chartArea;

  if (!ctx || !area) {
    // fallback if chart is not ready yet
    return colorTop;
  }

  const gradient = ctx.createLinearGradient(0, area.top, 0, area.bottom);
  gradient.addColorStop(0, colorTop);
  gradient.addColorStop(1, colorBottom);

  return gradient;
}


// export const ChartColorSets = {
//     incomeVsExpense: {
//       backgroundColor: [GreenChart, RedChart],
//       hoverBackgroundColor: ['#4CAF50', '#F44336'],
//       borderColor: ['rgba(75, 192, 192, 0.2)', 'rgba(255, 99, 132, 0.2)'],
//       hoverBorderColor: ['rgba(75, 192, 192, 1)', 'rgba(255, 99, 132, 1)'],
//     },
//     balanceChart: {
//       backgroundColor: [BlueChart, GrayChart],
//       hoverBackgroundColor: ['#1976D2', '#BDBDBD'],
//       borderColor: ['rgba(33, 150, 243, 0.2)', 'rgba(158, 158, 158, 0.2)'],
//       hoverBorderColor: ['rgba(33, 150, 243, 1)', 'rgba(158, 158, 158, 1)'],
//     }
//   };

--- END OF FILE ---
--- START OF FILE src\app\common\const\custom-validators.ts ---
import {
	AbstractControl,
	FormArray,
	FormControl,
	FormGroup,
	ValidationErrors,
	ValidatorFn,
	Validators,
} from '@angular/forms';

// export function markFormGroupTouched(formGroup: FormGroup) {
//   Object.values(formGroup.controls).forEach(control => {
//     control.markAsTouched();

//     if (!control.valid) {
//       console.log('invlid control: ', control, 'errors: ', control.errors, 'formGroup: ', formGroup);
//     }

//     if (control instanceof FormGroup) {
//       markFormGroupTouched(control);
//     }
//     else if (control instanceof FormArray) {
//       control.controls.forEach(c => {
//         if (c instanceof FormGroup) {
//           markFormGroupTouched(c);
//         }
//       });
//     }
//   });
// }

export function markFormGroupTouched(formGroup: FormGroup | FormArray) {
	if (!formGroup) return;

	Object.values(formGroup.controls).forEach((control) => {
		if (!control) return;

		if (control instanceof FormControl) {
			control.markAsTouched();
		} else if (control instanceof FormGroup || control instanceof FormArray) {
			markFormGroupTouched(control);
		}
	});
	formGroup.markAsTouched();
}

export const AcceptedFileTypes = [
	'image/*',
	'.doc',
	'.docx',
	'application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document',
	'.csv',
	'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
	'application/vnd.ms-excel',
	'.pdf',
];

export function noWhitespaceValidator(control: FormControl) {
	const isWhitespace = (control.value || '').trim().length === 0;
	const isValid = !isWhitespace;
	return isValid ? null : { whitespace: true };
}

export function passwordValidator(control: AbstractControl): ValidationErrors | null {
	const password = control.value;
	const hasSmallLetter = /[a-z]/.test(password);
	const hasCapitalLetter = /[A-Z]/.test(password);
	const hasNumber = /\d/.test(password);
	if (!hasSmallLetter || !hasCapitalLetter || !hasNumber) {
		return { weakPassword: true };
	}
	return null;
}

export function detailedPasswordValidator(): ValidatorFn {
	return (control: AbstractControl): ValidationErrors | null => {
		const value = control.value || '';

		// בדוק את כל החוקים
		const hasUpperCase = /[A-Z]/.test(value);
		const hasLowerCase = /[a-z]/.test(value);
		const hasNumeric = /[0-9]/.test(value);
		const isLongEnough = value.length >= 8;

		// צור אובייקט שגיאות
		const errors: ValidationErrors = {};
		if (!hasUpperCase) errors['noUpperCase'] = true;
		if (!hasLowerCase) errors['noLowerCase'] = true;
		if (!hasNumeric) errors['noNumeric'] = true;
		if (!isLongEnough) errors['minLength'] = true; // אפשר להשתמש בזה במקום ב-minLength המובנה

		// החזר את האובייקט רק אם יש בו שגיאות
		return Object.keys(errors).length > 0 ? errors : null;
	};
}

export const phoneValidator: ValidatorFn = Validators.pattern('^0[0-9]{8,9}$');
// export const landLineValidator: ValidatorFn = Validators.pattern('^0[0-9]{8}$');
export const mobileValidator: ValidatorFn = Validators.pattern('^0[0-9]{9}$');
// export const israeliMobileValidator: ValidatorFn = Validators.pattern('^0?(5[024])(-)?[0-9]{7}$');
// export const phoneValidator: ValidatorFn = Validators.pattern('[[0][0-9]{9}]*');
export const israeliMobileValidator: ValidatorFn = Validators.pattern('^0?(5[024])(-)?[0-9]{7}$');
export const englishOnlyValidator: ValidatorFn = Validators.pattern('[a-zA-z0-9]*');
export const urlValidator: ValidatorFn = Validators.pattern('^(http|https)://[^ "]+$');
export const emailValidator: ValidatorFn = Validators.pattern(
	'^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$',
); // Validators.pattern('^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$');
export const noHebrewValidator: ValidatorFn = Validators.pattern('^[^א-ת]*$');
// export const hebrewCharacterValidator: ValidatorFn = Validators.pattern('[\u0590-\u05FF]');

export function dateRangeValidator(minKeys: string[], maxKeys?: string[]): ValidatorFn {
	return (control: AbstractControl): ValidationErrors | null => {
		const formGroup = control.parent;
		if (!formGroup) return null;

		const controlDate = control.value;

		// Check min dates
		if (minKeys && minKeys.length) {
			let minError = null;
			minKeys.forEach((minKey) => {
				const minDate = formGroup.get(minKey)?.value;

				if (minDate && controlDate && new Date(controlDate) < new Date(minDate)) {
					minError = {
						dateRange: {
							message: `הזן תאריך גדול מ${FormControlLabels[minKey as keyof typeof FormControlLabels]}`,
						},
					};
				}
			});
			if (minError) return minError;
		}

		// Check max dates
		if (maxKeys && maxKeys.length) {
			let maxError = null;
			maxKeys.forEach((maxKey) => {
				let maxDate;
				if (maxKey === 'today') {
					maxDate = new Date();
					maxDate.setHours(0, 0, 0, 0);
				} else {
					maxDate = formGroup.get(maxKey)?.value;
				}

				if (maxDate && controlDate && new Date(controlDate) > new Date(maxDate)) {
					const message =
						maxKey === 'today'
							? 'הזן תאריך קטן מהיום'
							: `הזן תאריך קטן מ${FormControlLabels[maxKey as keyof typeof FormControlLabels]}`;
					maxError = { dateRange: { message } };
				}
			});
			if (maxError) return maxError;
		}

		return null;
	};
}

export const FormControlLabels = {
	// apartment form
	contractStartDate: 'ת.תחילת תוקף',
	contractEndDate: 'ת.סיום חוזה',
	evacuationDate: 'ת. פינוי',

	//apartmentPayment
	startPeriod: 'תחילת תקופה',

	// worker form
	today: 'היום',
	birthDate: 'ת.לידה',
	entranceDate: 'ת.כניסה',
	lastEntranceDate: 'ת.כניסה קודם',
	exitDate: 'ת.יציאה',
	lastExitDate: 'ת.יציאה קודם',
	escapeDate: 'ת.בריחה',
	startWorkDate: 'ת.תחילת עבודה',
	endWorkDate: 'ת.סיום עבודה',
	resignNoticeDate: 'ת.הודעת פיטורין',
	resignationDate: 'ת.פיטורין',
	passportExpiryDate: 'ת.תוקף דרכון',
	visaIssueDate: 'ת.הוצאת ויזה',
	visaExpiryDate: 'ת.תפוגת ויזה',

	// generalWorkerForm
	plannedReturnDateForInterVisa: 'ת.חזרה',
	plannedLeaveDateForInterVisa: 'ת.יציאה',
	// contractStartDate: 'ת.תחילת חוזה',

	// additionalDetailsForm
	performedAtDate: 'ת.ביצוע',
	// healthForm
	insuranceStartDate: 'ת.תחילת ביטוח',
	insuranceCardValidFromDate: 'תחילת תוקף כרטיס',
};

export function conditionalRequiredValidator(config: ConditionalRequiredConfig): ValidatorFn {
	return (control: AbstractControl): ValidationErrors | null => {
		const group = control as FormGroup;
		const dependentFieldValue = group.get(config.dependentField)?.value;

		config.fieldsToValidate.forEach((fieldName) => {
			const field = group.get(fieldName);
			if (dependentFieldValue) {
				field?.setValidators([Validators.required]);
			} else {
				field?.clearValidators();
			}
			field?.updateValueAndValidity({ onlySelf: true });
		});

		return null;
	};
}

interface ConditionalRequiredConfig {
	dependentField: string;
	fieldsToValidate: string[];
}

--- END OF FILE ---
--- START OF FILE src\app\common\const\dialog-config.ts ---
export const DialogConfig = {
	width: '100%',
	// height: 'fit-content',
	modal: true,
	draggable: true,
	// resizable: true,
	closable: true,
	dismissableMask: true,
	appendTo: 'body',
	// מאפייני נגישות
	a11yCloseLabel: 'סגור',
	focusOnShow: true,
	autofocus: true,
	
	closeOnEscape: true,
	baseZIndex: 1000,
	showHeader: true,

	// מיקום וגודל
	position: 'center',
	// contentStyle: { padding: '1.25rem' },

	// // התאמה לפי גודל מסך
	// breakpoints: {
	//   '960px': '75vw',
	//   '640px': '90vw'
	// },

	// התאמה אישית
	styleClass: 'p-dialog',
	// style: { boxShadow: '0 4px 8px rgba(0, 0, 0, 0.1)' },

	style: {
		'max-width': '400px',
		'min-width': '300px',
		
	},

	// אנימציה (תלוי בגרסה)
	// transitionOptions: '400ms cubic-bezier(0.25, 0.8, 0.25, 1)',
};


export const DialogConfigWide = {
	...DialogConfig,
	style: {
		'max-width': '800px',
		'min-width': '360px'
	},
}


export const ConfirmDialogConfig = {
	...DialogConfig,
	header: 'אישור',
	icon: 'pi pi-exclamation-triangle',
	acceptLabel: 'אישור',
	rejectLabel: 'ביטול',
	acceptIcon: 'pi pi-check',
	rejectIcon: 'pi pi-times',
	acceptButtonStyleClass: 'p-button-primary',
	rejectButtonStyleClass: 'p-button-secondary',
};

--- END OF FILE ---
--- START OF FILE src\app\common\const\form-modules.ts ---
import { FormArray, FormGroup, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatInputModule } from '@angular/material/input';
import { MatSelectModule } from '@angular/material/select';
import { MatPaginatorModule } from '@angular/material/paginator';
import { MatSortModule } from '@angular/material/sort';
import { MatTableModule } from '@angular/material/table';
import {
	DateAdapter,
	MAT_DATE_LOCALE,
	MatNativeDateModule,
	NativeDateAdapter,
	NativeDateModule,
} from '@angular/material/core';
import { MatDatepickerModule } from '@angular/material/datepicker';
// import { MAT_MOMENT_DATE_ADAPTER_OPTIONS } from "@angular/material-moment-adapter";
import { MatTooltipModule } from '@angular/material/tooltip';
import { MatCheckboxModule } from '@angular/material/checkbox';
import { MatRadioModule } from '@angular/material/radio';
import { MatSlideToggleModule } from '@angular/material/slide-toggle';
import { MatAutocompleteModule } from '@angular/material/autocomplete';
import { MatSliderModule } from '@angular/material/slider';
import { DragDropModule } from '@angular/cdk/drag-drop';

import { MatIconModule } from '@angular/material/icon';
import { MatMenuModule } from '@angular/material/menu';

export const FormModules = [
	FormsModule,
	ReactiveFormsModule,
	MatDatepickerModule,
	MatFormFieldModule,
	MatSelectModule,
	MatInputModule,
	MatTooltipModule,
	MatCheckboxModule,
	MatRadioModule,
	MatSliderModule,
	MatSlideToggleModule,
	MatAutocompleteModule,
	DragDropModule,
	MatIconModule,
	MatMenuModule,
];
export const TableModules = [MatTableModule, MatPaginatorModule, MatSortModule];
export const DatePickerModules = [MatDatepickerModule];

--- END OF FILE ---
--- START OF FILE src\app\common\const\messages.ts ---
const successMessages = 'הפעולה בוצעה בהצלחה';

--- END OF FILE ---
--- START OF FILE src\app\common\const\primeNg-modules.ts ---
import { ToggleButtonModule } from 'primeng/togglebutton';
import { DialogModule } from 'primeng/dialog';
import { TagModule } from 'primeng/tag';
import { InputNumberModule } from 'primeng/inputnumber';
import { SkeletonModule } from 'primeng/skeleton';
import { AccordionModule } from 'primeng/accordion';
import { PanelModule } from 'primeng/panel';
import { OverlayPanelModule } from 'primeng/overlaypanel';
import { MegaMenuModule } from 'primeng/megamenu';
import { TieredMenuModule } from 'primeng/tieredmenu';
import { DropdownModule } from 'primeng/dropdown';
import { MultiSelectModule } from 'primeng/multiselect';

import { MenubarModule } from 'primeng/menubar';
import { FieldsetModule } from 'primeng/fieldset';
import { ProgressBarModule } from 'primeng/progressbar';
import { TableModule } from 'primeng/table';

export const primeNgModules = [
	AccordionModule,
	DialogModule,
	FieldsetModule,
	InputNumberModule,
	MegaMenuModule,
	PanelModule,
	TableModule,
	SkeletonModule,
	ToggleButtonModule,
	TieredMenuModule,
	TagModule,
	MenubarModule,
	DropdownModule,
	OverlayPanelModule,
	ProgressBarModule,
	MultiSelectModule,
];

--- END OF FILE ---
--- START OF FILE src\app\common\directives\ResponsiveFont.directive.ts ---
import { Directive, ElementRef, Input, OnChanges } from '@angular/core';

@Directive({
  selector: '[appResponsiveFont]',
  standalone: true
})
export class ResponsiveFontDirective implements OnChanges {
  @Input() appResponsiveFont!: string;

  constructor(private el: ElementRef) { }

  ngOnChanges() {
    if (this.appResponsiveFont) {
      this.updateFontSize();
    }


  }
private updateFontSize() {
    const length = this.appResponsiveFont.length;
    const element = this.el.nativeElement;

    // Calculate font size based on text length
    let fontSize = 12; // default (reduced from 13)

    if (length <= 15) fontSize = 12;        // reduced from 13
    else if (length <= 25) fontSize = 11;   // reduced from 12
    else if (length <= 35) fontSize = 10;   // reduced from 11
    else fontSize = 10;                     // reduced from 11

    element.style.fontSize = `${fontSize}px`;
    // element.style.fontWeight = length <= 15 ? '500' : '400';
}
}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\create-product.dto.ts ---
import { Status } from '../enums/status.enum';
import { Package } from '../enums/package';

// זה הכל! רק הגדרת הצורה של המידע.
export interface CreateProductDto {
  name: string;
  categoryId: number;
  supplierId: number;
  position: number;
  package: Package;
  cost?: number;
  status: Status;
  notes?: string;
  imageUrl?: string;
}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\order-by-supplier-date.dto.ts ---
export interface OrderBySupplierDateParams {
    supplierId: number;
    date: string;
}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\order-create.dto.ts ---
import { OrderStatus } from "../enums/order-status.enum";

export interface CreateOrderDto {
    id?: number;
    supplierId: number;
    date: string;
    status: OrderStatus; 
    notes?: string;
    products?: {
        productId: number;
        name: string;
        quantity: number;
        categoryId?: number;
        categoryName?: string
    }[];
}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\orders-by-range.dto.ts ---
export interface OrdersByRangeParams {
    supplierIds: number[];
    startDate: string;
    endDate: string;
}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\update-product.dto.ts ---
import { CreateProductDto } from './create-product.dto';

export type UpdateProductDto = Partial<CreateProductDto>;
--- END OF FILE ---
--- START OF FILE src\app\common\dto\user-create.dto.ts ---


export interface CreateUserDto {
	email: string;
	username: string;
	password: string;
	accountName: string;

}
--- END OF FILE ---
--- START OF FILE src\app\common\dto\user.dto.ts ---
import { Status } from "../enums/status.enum";
import { UserRole } from "../enums/userRole.enum";

export interface UserDto {
	id?: number;
	email: string;
	username: string;
	phone?: string;
	password: string;
	role: UserRole;
	image?: string;
	status?: Status;
}
--- END OF FILE ---
--- START OF FILE src\app\common\enums\order-schedule.enum.ts ---
import { EnumData } from '../models/enumData';

export enum OrderSchedule {
	Today = 1,
	Future,
	Historical, // הוספת ערך להזמנות היסטוריות
}

// הוספת נתוני enum עבור סטטוס הזמנה
export const OrderStatusData: EnumData[] = [
	{
		enumValue: 1,
		label: 'הזמנה חדשה',
		icon: 'pi pi-star',
		tailwind: 'bg-green-100 hover:bg-green-200',
	},
	{
		enumValue: 2,
		label: 'בתהליך',
		icon: 'pi pi-clock',
		tailwind: 'bg-yellow-100 hover:bg-yellow-200',
	},
	{
		enumValue: 3,
		label: 'הושלמה',
		icon: 'pi pi-check',
		tailwind: 'bg-blue-100 hover:bg-blue-200',
	},
	{
		enumValue: 4,
		label: 'בוטלה',
		icon: 'pi pi-times',
		tailwind: 'bg-red-100 hover:bg-red-200',
	},
];

// נתוני enum קיימים לסטטוס לוח שנה
export const OrderScheduleData: EnumData[] = [
	{
		enumValue: 1,
		label: 'הזמנה להיום',
		icon: 'pi pi-bell',
		tailwind: 'bg-blue-100 hover:bg-blue-200',
	},
	{
		enumValue: 2,
		label: 'הזמנה עתידית',
		icon: 'pi pi-clock',
		tailwind: 'bg-orange-100 hover:bg-orange-200',
	},
	{
		enumValue: 3,
		label: 'הזמנה היסטורית',
		icon: 'pi pi-history',
		tailwind: 'bg-gray-100 hover:bg-gray-200',
	},
];

--- END OF FILE ---
--- START OF FILE src\app\common\enums\order-status.enum.ts ---
import { EnumData } from '../models/enumData';

export enum OrderStatus {
  Empty = 1,
  Draft,
  Sent,
  Today,
  Future,
}

export const orderStatusData: EnumData[] = [
  {
    enumValue: OrderStatus.Empty,
    label: 'ריקה',
    // icon: 'pi pi-times-circle',
    icon: '',
    tailwind: 'bg-gradient-to-r from-blue-50 to-indigo-100 hover:from-blue-100 hover:to-indigo-200',
  },
  {
    enumValue: OrderStatus.Draft,
    label: 'טיוטה',
    icon: 'pi pi-file-edit',
    tailwind: 'bg-gradient-to-r from-amber-50 to-yellow-100 hover:from-amber-100 hover:to-yellow-200',
  },
  {
    enumValue: OrderStatus.Sent,
    label: 'נשלחה',
    icon: 'pi pi-check-circle',
    tailwind: 'bg-gradient-to-r from-emerald-50 to-green-100 hover:from-emerald-100 hover:to-green-200',
  },
  {
    enumValue: OrderStatus.Today,
    label: 'הזמנה להיום',
    icon: 'pi pi-bell',
    tailwind: 'bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200',
  },
  {
    enumValue: OrderStatus.Future,
    label: 'הזמנה עתידית',
    icon: 'pi pi-clock',
    tailwind: 'bg-gradient-to-r from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200',
  },
];




// import { EnumData } from '../models/enumData';

// export enum OrderStatus {
// 	New = 1,
// 	Draft, // טיוטה
// 	Sent, // נשלח
// }

// export const orderStatusData: EnumData[] = [
// 	{
// 		enumValue: OrderStatus.New,
// 		label: 'חדשה',
// 		icon: 'pi pi-plus-circle',
// 		tailwind:
// 			'bg-gradient-to-r from-blue-50 to-indigo-100 hover:from-blue-100 hover:to-indigo-200 ',
// 	},
// 	{
// 		enumValue: OrderStatus.Draft,
// 		label: 'טיוטה',
// 		tailwind:
// 			'bg-gradient-to-r from-amber-50 to-yellow-100 hover:from-amber-100 hover:to-yellow-200 ',
// 		icon: 'pi pi-file-edit',
// 	},
// 	{
// 		enumValue: OrderStatus.Sent,
// 		label: 'נשלחה',
// 		icon: 'pi pi-check-circle',
// 		tailwind:
// 			'bg-gradient-to-r from-emerald-50 to-green-100 hover:from-emerald-100 hover:to-green-200 ',
// 	},
// ];

// export enum OrderViewStatus {
//     Past = 1,    // היסטורית
//     Today,       // היום
//     Future,      // עתידית
// }

// export const orderViewStatusData: EnumData[] = [
//     {
//         enumValue: OrderViewStatus.Past,
//         label: 'הזמנה היסטורית',
//         icon: 'pi pi-history',
//         tailwind: 'bg-gray-100 hover:bg-gray-200'
//     },
//     {
//         enumValue: OrderViewStatus.Today,
//         label: 'הזמנה להיום',
//         icon: 'pi pi-calendar',
//         tailwind: 'bg-p-100 hover:bg-p-200'
//     },
//     {
//         enumValue: OrderViewStatus.Future,
//         label: 'הזמנה עתידית',
//         icon: 'pi pi-forward',
//         tailwind: 'bg-secondary-100 hover:bg-secondary-200'
//     }
// ];

--- END OF FILE ---
--- START OF FILE src\app\common\enums\order-type.ts ---
import { EnumData } from '../models/enumData';

export enum OrderType {
	ByDay = 1,
	ByDate,
}

export const orderTypeData: EnumData[] = [
	{
		enumValue: OrderType.ByDay,
		label: 'לפי ימים',
		icon: 'pi pi-calendar',
		tailwind:
			'bg-gradient-to-r from-purple-50 to-violet-100 hover:from-purple-100 hover:to-violet-200 border border-purple-200/50',
	},
	{
		enumValue: OrderType.ByDate,
		label: 'לפי תאריכים',
		icon: 'pi pi-calendar-plus',
		tailwind:
			'bg-gradient-to-r from-indigo-50 to-purple-100 hover:from-indigo-100 hover:to-purple-200 border border-indigo-200/50',
	},
];

--- END OF FILE ---
--- START OF FILE src\app\common\enums\package.ts ---
import { BaseModel } from '../models/base-model';
import { EnumData } from '../models/enumData';

export enum Package {
	Unit = 1, // יחידה
	Box, // ארגז
	Bag, // שקית
	Kilogram, // קילוגרם
	Carton, // קרטון
	Pack, // חבילה
}

export const PackageData: EnumData[] = [
	{
		enumValue: Package.Unit,
		label: 'יחידה',
		labelPlural: 'יחידות',
		icon: 'pi pi-box',
		tailwind:
		'bg-gradient-to-r from-purple-50 to-violet-100 hover:from-purple-100 hover:to-violet-200 border border-purple-200/50',
	},
	{
		enumValue: Package.Box,
		label: 'ארגז',
		labelPlural: 'ארגזים',
		icon: 'pi pi-briefcase',
		tailwind:
		'bg-gradient-to-r from-cyan-50 to-teal-100 hover:from-cyan-100 hover:to-teal-200 border border-cyan-200/50',
	},
	{
		labelPlural: 'שקיות',
		enumValue: Package.Bag,
		label: 'שקית',
		icon: 'pi pi-shopping-bag',
		tailwind:
		'bg-gradient-to-r from-yellow-50 to-amber-100 hover:from-yellow-100 hover:to-amber-200 border border-yellow-200/50',
	},
	{
		enumValue: Package.Kilogram,
		label: 'קילוגרם',
		labelPlural: 'קילוגרמים',
		icon: 'pi pi-tablet',
		tailwind:
			'bg-gradient-to-r from-emerald-50 to-green-100 hover:from-emerald-100 hover:to-green-200 border border-emerald-200/50',
		},
		{
			enumValue: Package.Carton,
			label: 'קרטון',
			labelPlural: 'קרטונים',
			icon: 'pi pi-box',
		tailwind:
		'bg-gradient-to-r from-blue-50 to-sky-100 hover:from-blue-100 hover:to-sky-200 border border-blue-200/50',
	},
	{
		enumValue: Package.Pack,
		label: 'חבילה',
		labelPlural: 'חבילות',
		icon: 'pi pi-package',
		tailwind:
			'bg-gradient-to-r from-orange-50 to-rose-100 hover:from-orange-100 hover:to-rose-200 border border-orange-200/50',
	},
];


--- END OF FILE ---
--- START OF FILE src\app\common\enums\reminderType.ts ---
import { EnumData } from '../models/enumData';

export enum ReminderType {
	EachTime = 1,
	UntilOrderDone,
}

export const reminderTypeData: EnumData[] = [
	{
		enumValue: ReminderType.EachTime,
		label: 'תזכורת לכל מועד', 
		tooltip: 'קבל תזכורת בכל יום הזמנה קבוע',
		icon: 'pi pi-bell',
		tailwind:
			'bg-gradient-to-r from-violet-50 to-purple-100 hover:from-violet-100 hover:to-purple-200 border border-violet-200/50',
	},
	{
		enumValue: ReminderType.UntilOrderDone,
		label: 'תזכורת שבועית חכמה', 
		tooltip: 'קבל תזכורת רק אם טרם הזמנת מהספק באותו שבוע',
		icon: 'pi pi-clock',
		tailwind:
			'bg-gradient-to-r from-cyan-50 to-emerald-100 hover:from-cyan-100 hover:to-emerald-200 border border-cyan-200/50',
	},
];
--- END OF FILE ---
--- START OF FILE src\app\common\enums\status.enum.ts ---
import { EnumData } from '../models/enumData';

export enum Status {
	Active = 1,
	Inactive,
}

export const statusData: EnumData[] = [
	{
		enumValue: Status.Active,
		label: 'פעיל',
		icon: 'pi pi-check-circle',
		tailwind:
			'bg-gradient-to-r from-green-50 to-emerald-100 hover:from-green-100 hover:to-emerald-200 border border-green-200/50',
	},
	{
		enumValue: Status.Inactive,
		label: 'לא פעיל',
		icon: 'pi pi-times-circle',
		tailwind:
			'bg-gradient-to-r from-rose-50 to-red-100 hover:from-rose-100 hover:to-red-200 border border-rose-200/50',
	},
];

--- END OF FILE ---
--- START OF FILE src\app\common\enums\userRole.enum.ts ---
import { EnumData } from '../models/enumData';

export enum UserRole {
	SysAdmin = 1,
	Admin,
	User,
}



export const userRoleData: EnumData[] = [
	{
		enumValue: UserRole.SysAdmin,
		label: 'Sys-Admin',
		icon: 'pi pi-shield',
		tailwind:
			'bg-gradient-to-r from-red-50 to-rose-100 hover:from-red-100 hover:to-rose-200 border border-red-200/50',
	},
	{
		enumValue: UserRole.Admin,
		label: 'מנהל',
		icon: 'pi pi-users',
		tailwind:
			'bg-gradient-to-r from-slate-50 to-gray-100 hover:from-slate-100 hover:to-gray-200 border border-slate-200/50',
	},
	{
		enumValue: UserRole.User,
		label: 'משתמש',
		icon: 'pi pi-user',
		tailwind:
			'bg-gradient-to-r from-blue-50 to-sky-100 hover:from-blue-100 hover:to-sky-200 border border-blue-200/50',
	},
];

--- END OF FILE ---
--- START OF FILE src\app\common\models\account.ts ---
import { User } from './user';

export interface Account {
	id: number;
	name: string;
	ownerId: number;
	owner?: User;
	users?: User[];
	createdAt: Date;
	updatedAt: Date;
}
--- END OF FILE ---
--- START OF FILE src\app\common\models\base-model.ts ---
import { Status } from '../enums/status.enum';

export interface BaseModel {
	id: number;
	// status?: Status;
	createdBy?: string;
	isDeleted?: boolean;
	createdAt: Date;
	updatedAt?: Date;
}

--- END OF FILE ---
--- START OF FILE src\app\common\models\category.ts ---
import { Status } from '../enums/status.enum';
import { BaseModel } from './base-model';

export interface Category extends BaseModel {
	name: string;
	status: Status;
	supplierId: number;
	position: number;
}

--- END OF FILE ---
--- START OF FILE src\app\common\models\enumData.ts ---
export interface EnumData {
	enumValue: number;
	label: string; // צורת יחיד
    labelPlural?: string; // ✅ צורת רבים (אופציונלי)
	icon?: string;
	tooltip?: string;
	tailwind?: string;
	className?: string;
}

--- END OF FILE ---
--- START OF FILE src\app\common\models\insight.ts ---
import { BaseModel } from "./base-model";

export enum InsightType {
    TRENDING_PRODUCTS = 'TRENDING_PRODUCTS',
    SUPPLIER_SPENDING = 'SUPPLIER_SPENDING',
    DORMANT_PRODUCTS = 'DORMANT_PRODUCTS',
    ORDER_NOTES = 'ORDER_NOTES',
    OVERALL_SUMMARY = 'OVERALL_SUMMARY',
    COST_CHANGE = 'COST_CHANGE'
}

// זהו המודל הראשי
export interface Insight  extends BaseModel{
    type: InsightType;
    emoji: string; 
    title: string;
    content: string;
    data: any; // אפשר להשאיר any, או להגדיר טיפוסים ספציפיים אם נרצה
    isRead: boolean;
}


--- END OF FILE ---
--- START OF FILE src\app\common\models\order.ts ---
import { OrderStatus } from '../enums/order-status.enum';
import { BaseModel } from './base-model';

export interface Order extends BaseModel {
	id: number;
	supplierId: number;
	date: string;
	status: OrderStatus;
	orderProducts?: OrderProductItem[] | null;
	supplierName?: string;
	notes?: string;
}

export interface OrderProductItem {
	id: number;
	productId: number;
	name: string;
	cost?: number;
	price?: number;
	quantity: number;
	categoryId?: number; // Added for category view
	categoryName?: string; // Added for category view
}

//     totalAmount: number;
//     status: OrderStatus;

//     orderDate?: string;
//     isDuplicateToday: boolean;
//     supplier: { id: number; name?: string };
//     user: { id: number };
//     comment?: string;
//     orderProducts: OrderProduct[];
//     isSelected?: boolean;
// }

// export interface OrderProduct {
//     id: number;
//     product: Product
//     quantity: number;

// }

// export interface Reminder {
//     text: string;
// }

--- END OF FILE ---
--- START OF FILE src\app\common\models\pageStates.ts ---
export enum PageStates {
	Loading = 1,
	Ready,
	Error,
	Empty,
}

--- END OF FILE ---
--- START OF FILE src\app\common\models\product.ts ---
import { Package } from '../enums/package';
import { Status } from '../enums/status.enum';
import { BaseModel } from './base-model';

export interface Product extends BaseModel {
	name: string;
	categoryId: number;
	categoryName: string;
	package: Package;
	cost: number;
	price: number;
	quantity: number | null;
	status: Status;
	supplierId: number;
	notes?: string;
	imageUrl?: string;
	position: number;
}

// export const mockProducts: Product[] = [
//     {
//         id: 1,
//         name: "Apple",
//         categoryId: 8,
//         supplierId: 4,
//         status: Status.Active,
//         createdAt: new Date("2025-01-01"),
//         updatedAt: new Date("2025-01-05"),
//     },
//     {
//         id: 7,
//         name: "Cereal",
//         categoryId: 18,
//         supplierId: 4,
//         status: Status.Active,
//         createdAt: new Date("2025-01-07"),
//         updatedAt: new Date("2025-01-11"),
//     },
//     {
//         id: 9,
//         name: "Milk",
//         categoryId: 18,
//         supplierId: 4,
//         status: Status.Active,
//         createdAt: new Date("2025-01-09"),
//         updatedAt: new Date("2025-01-13"),
//     },
//     {
//         id: 10,
//         name: "Cheese",
//         categoryId: 18,
//         supplierId: 4,
//         status: Status.Inactive,
//         createdAt: new Date("2025-01-10"),
//         updatedAt: new Date("2025-01-14"),
//     },
//     {
//         id: 11,
//         name: "Bread",
//         categoryId: 18,
//         supplierId: 5,
//         status: Status.Active,
//         createdAt: new Date("2025-01-12"),
//         updatedAt: new Date("2025-01-15"),
//     },
// ];

--- END OF FILE ---
--- START OF FILE src\app\common\models\serviceResultContainer.ts ---
export interface ServiceResultContainer<T> {
	success: boolean;
	message: string;
	result: T;
	error?: string[];
}

--- END OF FILE ---
--- START OF FILE src\app\common\models\statistics.ts ---
// export interface AllStatisticsDto {
// 	totalSuppliers: number;
// 	totalProducts: number;
// 	totalCategories: number;
// }

export interface DashboardStats {
    openOrders: number;
    dueToday: number;
    monthlyCost: number;
    prevMonthlyCost: number;
    costChangePercentage: number;
    activeSuppliers: number;
}
--- END OF FILE ---
--- START OF FILE src\app\common\models\supplier.ts ---
import { Order } from './order';
import { OrderType } from '../enums/order-type';
import { ReminderType } from '../enums/reminderType';
import { BaseModel } from './base-model';
import { Category } from './category';
import { Product } from './product';
import { Status } from '../enums/status.enum';

export interface Supplier extends BaseModel {
	name: string;
	status: Status;
	phone: string;
	orderType: OrderType;
	reminderType: ReminderType;
	orderDays: number[];
	orderDates: number[];
	email?: string;
	image?: string;
	categories?: Category[];
	orders?: Order[];
	products?: Product[];
}

// export const SUPPLIERS_MOCK = [
//     {
//         id: 1,
//         name: 'ספק ראשון',
//         phone: '0501234567',
//         orderType: OrderType.ByDay,
//         orderDays: [1, 3, 5],
//         orderDates: [],
//         reminderType: ReminderType.EachTime,
//     },
//     {
//         id: 2,
//         name: 'ספק שני',
//         phone: '0527654321',
//         orderType: OrderType.ByDate,
//         orderDays: [],
//         orderDates: [5, 10, 15],
//         reminderType: ReminderType.UntilOrderDone,
//     },
//     {
//         id: 3,
//         name: 'ספק שלישי',
//         phone: '0539876543',
//         orderType: OrderType.ByDay,
//         orderDays: [2, 4],
//         orderDates: [],
//         reminderType: ReminderType.EachTime,
//     },
//     {
//         id: 4,
//         name: 'ספק רביעי',
//         phone: '0543219876',
//         orderType: OrderType.ByDate,
//         orderDays: [],
//         orderDates: [1, 11, 21],
//         reminderType: ReminderType.UntilOrderDone,
//     },
//     {
//         id: 5,
//         name: 'ספק חמישי',
//         phone: '0556547890',
//         orderType: OrderType.ByDay,
//         orderDays: [6],
//         orderDates: [],
//         reminderType: ReminderType.EachTime,
//     },
// ];

--- END OF FILE ---
--- START OF FILE src\app\common\models\user.ts ---
import { Status } from '../enums/status.enum';
import { UserRole } from '../enums/userRole.enum';
import { Account } from './account';
import { BaseModel } from './base-model';

export interface User extends BaseModel {
	username: string;
	status: Status;
	email: string;
	password: string;
	role: UserRole;
	phone: string;
	image?: string;
	accountId: number;
	account?: Account;
}

// export interface UserForCreate {
// 	email: string;
// 	username: string;
// 	phone: string | null;
// 	password?: string;
// 	role: number;
// 	status: number;
// 	image: string | null;
// }

--- END OF FILE ---
--- START OF FILE src\app\common\utils\date.utils.ts ---
// src/app/utils/date.utils.ts

/**
 * Converts a YYYY-MM-DD string to a Date object representing the specified date 
 * at midnight (00:00:00) in the LOCAL timezone. This ensures no timezone shifting issues.
 * @param dateString A string in YYYY-MM-DD format (e.g., "2025-07-25")
 * @returns A Date object set to midnight of the specified date in local time
 * @throws Error if the date string is invalid
 */
export function parseDateStringAsLocal(dateString: string): Date {
  // Validate input format
  if (!/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
    throw new Error(`Invalid date string format: ${dateString}. Expected YYYY-MM-DD.`);
  }

  const [year, month, day] = dateString.split('-').map(Number);

  // Validate numeric values
  if (isNaN(year) || isNaN(month) || isNaN(day)) {
    throw new Error(`Invalid date components in: ${dateString}`);
  }

  // Create a Date object in local timezone
  const date = new Date(year, month - 1, day);

  // Verify the date is valid
  if (isNaN(date.getTime())) {
    throw new Error(`Invalid date created from: ${dateString}`);
  }

  return date;
}

/**
 * Formats a Date object to a YYYY-MM-DD string for consistent server communication
 * @param date A Date object
 * @returns A string in YYYY-MM-DD format (e.g., "2025-07-25")
 */
export function formatDateToYYYYMMDD(date: Date): string {
  if (!(date instanceof Date) || isNaN(date.getTime())) {
    throw new Error('Invalid Date object');
  }
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}
--- END OF FILE ---
--- START OF FILE src\app\components\admin\accounts\accounts.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\admin\accounts\accounts.component.html ---
<div class="p-responsive">
    @switch (pageState()) {
        @case(PageStates.Loading) { <app-loader></app-loader> }
        @case(PageStates.Error) {
            <div @fadeIn400 class="error-card-container">
                <div class="error-card">
                    <div class="error-icon-wrapper"><span class="material-symbols-rounded">cloud_off</span></div>
                    <h3 class="error-title">אופס, משהו השתבש</h3>
                    <button (click)="refreshData()" class="primary md retry-button">
                        <span class="material-symbols-rounded">refresh</span>
                        <span>נסה שוב</span>
                    </button>
                </div>
            </div>
        }
        @case(PageStates.Empty) {
            <div @fadeIn400 class="empty-state">
                <i class="pi pi-building"></i>
                <p>אין חשבונות במערכת</p>
            </div>
        }
        @case(PageStates.Ready) {
            <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
                <h1 class="main-title">ניהול חשבונות</h1>
                <div class="actions-bar">
                    <span class="search-box">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" placeholder="חיפוש חשבון או משתמש..." [(ngModel)]="searchQuery">
                    </span>
                </div>

				<p-table [value]="filteredAccounts()" dataKey="id" 
					[expandedRowKeys]="expandedRows" (onRowExpand)="onRowExpand($event)"
					(onRowCollapse)="onRowCollapse($event)">

					<ng-template #header>
						<tr>
							<th style="width: 3rem"></th>
							<th pSortableColumn="name">שם החשבון <p-sortIcon field="name"></p-sortIcon></th>
							<th pSortableColumn="owner">בעל החשבון <p-sortIcon field="owner"></p-sortIcon></th>
							<th pSortableColumn="users">מספר משתמשים <p-sortIcon field="users"></p-sortIcon></th>
							<th></th>
						</tr>
					</ng-template>

					<ng-template #body let-account let-expanded="expanded">
						<tr>
							<td>
								<button type="button" pButton pRipple [pRowToggler]="account" icon="pi pi-chevron-left"
									[pRowToggler]="account" size="small" [rounded]="true"
									class="rotatable-icon"
									[class.-rotate-90]="expanded"
									severity="secondary">
								</button>
							</td>
							<td>{{ account.name }}</td>
							<td>{{ account.owner?.username || account.owner?.email }}</td>
							<td><p-badge [value]="account.users?.length || 0"></p-badge></td>
							<td>
								<div class="actions-cell">
									<div class="actions-cell">
										<p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square"
											(click)="editAccount(account)" size="small" [rounded]="true"
											severity="secondary">
										</p-button>
										<p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash"
											(click)="confirmDelete(account)" size="small" [rounded]="true"
											severity="danger">
										</p-button>
									</div>
								</div>
							</td>
						</tr>
					</ng-template>
					
					<ng-template #expandedrow let-account>
						<tr @rowExpansionTrigger>
							<td colspan="5">
								<div>
									
									<p-table [value]="account.users" dataKey="id" styleClass="expanded-table-content">
										<ng-template #header>
											<tr>
												<th pSortableColumn="username">שם <p-sortIcon field="username"></p-sortIcon></th>
												<th pSortableColumn="email">אימייל <p-sortIcon field="email"></p-sortIcon></th>
												<th pSortableColumn="role">תפקיד <p-sortIcon field="role"></p-sortIcon></th>
												
												<th></th>
											</tr>
										</ng-template>
										<ng-template #body let-user>
											<tr>
												<td>{{ user.username }}</td>
												<td>{{ user.email }}</td>
												<td><app-badge [enumValue]="user.role" [dataArray]="userRoleData"></app-badge></td>
												<td>
													<div class="actions-cell">
														<p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square"
															(click)="editUser(user)" size="small" [rounded]="true" severity="secondary"></p-button>
														<p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash"
															(click)="confirmDelete(user)" size="small" [rounded]="true"
															severity="danger"></p-button>
													</div>
												</td>
											</tr>
										</ng-template>
									</p-table>
								</div>
							</td>
						</tr>
					</ng-template>

					<ng-template #emptymessage>
						<tr>
							<td colspan="5" class="text-center p-4">
								<div class="flex flex-col items-center gap-2 text-gray-500">
									<i class="pi pi-search-minus text-3xl"></i>
									<span>לא נמצאו חשבונות התואמים לחיפוש.</span>
								</div>
							</td>
						</tr>
					</ng-template>
				</p-table>
		
            </div>
        }
    }
    <p-confirmdialog header="אישור מחיקה" icon="pi pi-exclamation-triangle" acceptLabel="מחק" rejectLabel="ביטול" acceptButtonStyleClass="p-button-danger" rejectButtonStyleClass="p-button-text"></p-confirmdialog>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\admin\accounts\accounts.component.ts ---
import { Component, computed, inject, signal, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { TableModule, TableRowCollapseEvent, TableRowExpandEvent } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { FormsModule } from '@angular/forms';
import { ConfirmationService } from 'primeng/api';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { BadgeComponent } from '../../shared/badge/badge.component';
import { TooltipModule } from 'primeng/tooltip';
import { DialogService } from 'primeng/dynamicdialog';
import { LoaderComponent } from '../../shared/loader/loader.component';
import { NotificationService } from '../../../services/notification.service';
import { UserRole, userRoleData } from '../../../common/enums/userRole.enum';
import { DialogConfig } from '../../../common/const/dialog-config';
import { UserDialogComponent } from '../../dialogs/user-dialog/user-dialog.component';
import { fadeIn400 } from '../../../common/const/animations';
import { PageStates } from '../../../common/models/pageStates';
import { User } from '../../../common/models/user';
import { Account } from '../../../common/models/account';
import { BadgeModule } from 'primeng/badge';
import { ApiService } from '../../../services/api.service';
import { trigger, state, style, transition, animate, sequence } from '@angular/animations';
import { UserStore } from '../../../store/user.store';


@Component({
  selector: 'app-accounts',
  standalone: true,
  imports: [
    CommonModule, TableModule, ButtonModule, ConfirmDialogModule, InputTextModule,
    FormsModule, BadgeComponent, TooltipModule, LoaderComponent, BadgeModule
  ],
  templateUrl: './accounts.component.html',
  styleUrls: ['./accounts.component.css'],
  providers: [ConfirmationService, DialogService],
  animations: [fadeIn400, 
        trigger('rowExpansionTrigger', [
          transition(':enter', [
            style({
              height: '0px',
              opacity: 0,
              overflow: 'hidden',
              transform: 'scaleY(0.1) translateY(-10px)',
              transformOrigin: 'top center',
              filter: 'blur(1px)',
              willChange: 'transform, height, opacity'
            }),
            sequence([
              animate('200ms cubic-bezier(0.25, 0.8, 0.25, 1)', style({
                height: '*',
                transform: 'scaleY(0.8) translateY(-2px)',
                filter: 'blur(0.5px)'
              })),
              animate('150ms cubic-bezier(0.25, 0.46, 0.45, 0.94)', style({
                opacity: 1,
                transform: 'scaleY(1) translateY(0)',
                filter: 'blur(0px)'
              }))
            ])
          ]),
    
          transition(':leave', [
            animate('250ms cubic-bezier(0.4, 0.0, 0.6, 1)', style({
              height: '0px',
              opacity: 0,
              overflow: 'hidden',
              transform: 'scaleY(0.1) translateY(-5px)',
              filter: 'blur(1px)'
            }))
          ])
    
        ])
  ],
})

export class AccountsComponent implements OnInit {
  private readonly notificationService = inject(NotificationService);
  private readonly dialogService = inject(DialogService);
  private readonly apiService = inject(ApiService);
  private readonly userStore = inject(UserStore);

  readonly PageStates = PageStates;
  readonly pageState = signal(PageStates.Loading);
  readonly userRoleData = userRoleData;
  readonly searchQuery = signal('');

  readonly accounts = signal<Account[]>([]);
  expandedRows = {};

readonly filteredAccounts = computed(() => {
    const allAccounts = this.accounts();
    const query = this.searchQuery().toLowerCase();
    if (!query) return allAccounts;

    return allAccounts
        .map(account => {
            // צור עותק של החשבון כדי לא לשנות את המקור
            const filteredAccount = { ...account }; 
            
            // סנן את המשתמשים הפנימיים
            const matchingUsers = account.users?.filter(u => 
                u.username.toLowerCase().includes(query) || 
                u.email.toLowerCase().includes(query)
            );

            // עדכן את מערך המשתמשים בחשבון המסונן
            filteredAccount.users = matchingUsers;
            
            return filteredAccount;
        })
        .filter(account => 
            // השאר את החשבון רק אם הוא עצמו תואם לחיפוש, או שיש לו משתמשים תואמים
            account.name.toLowerCase().includes(query) || 
            (account.users && account.users.length > 0)
        );
});

  ngOnInit() {
    this.loadAccounts();
  }

  public refreshData(): void {
    this.loadAccounts();
  }

  private loadAccounts(): void {
    this.pageState.set(PageStates.Loading);
    this.apiService.getAllAccountsWithUsers().subscribe({
      next: (response) => {
        if (response.success && response.result) {
          this.accounts.set(response.result);
          this.pageState.set(response.result.length > 0 ? PageStates.Ready : PageStates.Empty);
        } else {
          this.pageState.set(PageStates.Error);
        }
      },
      error: () => this.pageState.set(PageStates.Error),
    });
  }

  public editUser(user: User): void {
    const ref = this.dialogService.open(UserDialogComponent, {
      ...DialogConfig,
      header: `עריכת משתמש | ${user.email}`,
      data: { user },
    });
    ref.onClose.subscribe((updatedUser: User | undefined) => {
      if (updatedUser) {
        this.loadAccounts(); // טען מחדש את כל החשבונות כדי לסנכרן
        this.notificationService.toast({ severity: 'success', detail: 'המשתמש עודכן בהצלחה' });
      }
    });
  }

  public confirmDelete(item: User | Account): void {
    const isAccount = 'users' in item;
    if (isAccount) {
      this.notificationService.confirm({
        header: 'מחיקת חשבון',
        message: `פעולה זו תמחק לצמיתות את החשבון "${item.name}" וכל הנתונים המשויכים אליו. האם אתה בטוח?`,
        icon: 'pi pi-exclamation-triangle',
      }).subscribe((accepted) => {
        if (accepted) this.deleteAccount(item as Account);
      });
    } else {
      const user = item as User;
      this.notificationService.confirm({
        header: 'מחיקת משתמש',
        message: `האם למחוק את המשתמש "${user.username}"?`,
        icon: 'pi pi-user-minus',
      }).subscribe((accepted) => {
        if (accepted) this.deleteUser(user);
      });
    }
  }

  private deleteAccount(account: Account): void {
    this.apiService.deleteAccount(account.id).subscribe({
      next: (response) => {
        if (response.success) {
          this.notificationService.toast({ severity: 'success', detail: response.message });
          this.accounts.update(current => current.filter(acc => acc.id !== account.id));
        } else {
          this.notificationService.toast({ severity: 'error', detail: response.message });
        }
      },
      error: (err) => {
        this.notificationService.toast({ severity: 'error', detail: err.error?.message || 'שגיאה במחיקת החשבון' });
      }
    });
  }
  
  private deleteUser(user: User): void {
    this.userStore.deleteUser(user.id);
    // אחרי מחיקה, רענן את הנתונים כדי שהשינוי יופיע
    // אפשר להוסיף delay קטן אם רוצים
    setTimeout(() => this.loadAccounts(), 100);
  }

  
	private loadAccountsForAdmin(): void {
		// ✅ ננהל את המצב ישירות כאן
		this.pageState.set(PageStates.Loading);
		this.apiService.getAllAccountsWithUsers().subscribe({
			next: (response) => {
				if (response.success && response.result) {
					this.accounts.set(response.result);
					if (response.result.length > 0) {
						this.pageState.set(PageStates.Ready);
					} else {
						this.pageState.set(PageStates.Empty);
					}
				} else {
					this.pageState.set(PageStates.Error);
				}
			},
			error: () => {
				this.pageState.set(PageStates.Error);
			},
		});
	}

	

	onRowExpand(event: TableRowExpandEvent) {
		console.log({ severity: 'info', summary: 'Product Expanded', detail: event.data.name, life: 3000 });
	}

	onRowCollapse(event: TableRowCollapseEvent) {
		console.log({ severity: 'success', summary: 'Product Collapsed', detail: event.data.name, life: 3000 });
	}

	editAccount(account: Account) {

	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\admin\admin-dashboard-component\admin-dashboard-component.component.css ---
@import '../../home/home.component.css';


.card-icon.icon-accounts {
    --gradient: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    --icon: '\e7ee'; /* business_center */
}

.card-icon.icon-users {
    --gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    --icon: '\e7f0'; /* groups */
}

.card-icon.icon-orders-admin {
    --gradient: linear-gradient(135deg, #f794a4 0%, #fdd6bd 100%);
    --icon: '\e8cc'; /* receipt_long */
}

.card-icon.icon-revenue {
    --gradient: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
    --icon: '\e941'; /* attach_money */
}
--- END OF FILE ---
--- START OF FILE src\app\components\admin\admin-dashboard-component\admin-dashboard-component.component.html ---
<div class="p-responsive">
    @switch (pageState()) {
        @case(PageStates.Loading) { <app-loader></app-loader> }
        @case(PageStates.Error) {
            <div @fadeIn400 class="error-card-container">
                <div class="error-card">
                    <div class="error-icon-wrapper"><span class="material-symbols-rounded">cloud_off</span></div>
                    <h3 class="error-title">אופס, משהו השתבש</h3>
                    <button (click)="loadKpis(true)" class="primary md retry-button">
                        <span class="material-symbols-rounded">refresh</span>
                        <span>נסה שוב</span>
                    </button>
                </div>
            </div>
        }
        @case(PageStates.Ready) {
            @if (kpis(); as kpiData) {
                <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
                    <h1 class="main-title">דאשבורד ניהול מערכת</h1>
                    
                    <div class="stats-grid">
                        <!-- Total Accounts Card -->
                        <div class="card-content">
                            <div class="flex gap-3 items-center">
                                <span class="card-icon icon-accounts"></span>
                                <p>סה"כ חשבונות</p>
                            </div>
                            <div class="card-info">
                                <count-up theme="gradient" [to]="kpiData.totalAccounts"></count-up>
                                <small class="card-explanation">
                                    <span class="material-symbols-rounded">add_business</span>
                                    {{ kpiData.newAccountsLast30Days }} חשבונות חדשים ב-30 הימים האחרונים
                                </small>
                            </div>
                        </div>

                        <!-- Total Users Card -->
                        <div class="card-content">
                            <div class="flex gap-3 items-center">
                                <span class="card-icon icon-users"></span>
                                <p>סה"כ משתמשים</p>
                            </div>
                            <div class="card-info">
                                <count-up theme="gradient" [to]="kpiData.totalUsers"></count-up>
                                <small class="card-explanation">
                                    <span class="material-symbols-rounded">group</span>
                                    כלל המשתמשים הרשומים במערכת
                                </small>
                            </div>
                        </div>
                        
                        <!-- Total Orders Card -->
                        <div class="card-content">
                            <div class="flex gap-3 items-center">
                                <span class="card-icon icon-orders-admin"></span>
                                <p>הזמנות (30 יום)</p>
                            </div>
                            <div class="card-info">
                                <count-up theme="gradient" [to]="kpiData.totalOrdersLast30Days"></count-up>
                                <small class="card-explanation">
                                    <span class="material-symbols-rounded">shopping_cart</span>
                                    סה"כ הזמנות שבוצעו בכל החשבונות
                                </small>
                            </div>
                        </div>

                        <!-- Placeholder Card -->
                        <div class="card-content">
                            <div class="flex gap-3 items-center">
                                <span class="card-icon icon-revenue"></span>
                                <p>הכנסות (עתידי)</p>
                            </div>
                            <div class="card-info">
                                <count-up theme="gradient" prefix="₪" [to]="0"></count-up>
                                <small class="card-explanation">
                                    <span class="material-symbols-rounded">trending_up</span>
                                    מדד להכנסות עתידיות מהמערכת
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    }
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\admin\admin-dashboard-component\admin-dashboard-component.component.ts ---
import { Component, computed, effect, inject, signal, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { PageStates } from '../../../common/models/pageStates';
import { fadeIn400 } from '../../../common/const/animations';
import { LoaderComponent } from '../../shared/loader/loader.component';
import { CountUpComponent } from '../../shared/count-up/count-up.component';
import { ApiService } from '../../../services/api.service';

export interface SystemKpis {
    totalAccounts: number;
    newAccountsLast30Days: number;
    totalUsers: number;
    totalOrdersLast30Days: number;
}

@Component({
  selector: 'app-admin-dashboard-component',
  standalone: true,
  imports: [CommonModule, LoaderComponent, CountUpComponent],
  templateUrl: './admin-dashboard-component.component.html',
  styleUrl: './admin-dashboard-component.component.css',
  animations: [fadeIn400]
})
export class AdminDashboardComponentComponent implements OnInit {
    private apiService = inject(ApiService);

    readonly PageStates = PageStates;
    pageState = signal<PageStates>(PageStates.Loading);
    kpis = signal<SystemKpis | null>(null);

    ngOnInit(): void {
        this.loadKpis();
    }

    loadKpis(force = false): void {
        this.pageState.set(PageStates.Loading);
        this.apiService.getSystemKpis().subscribe({ // נצטרך להוסיף את זה ל-ApiService
            next: (response) => {
                if (response.success && response.result) {
                    this.kpis.set(response.result);
                    this.pageState.set(PageStates.Ready);
                } else {
                    this.pageState.set(PageStates.Error);
                }
            },
            error: () => this.pageState.set(PageStates.Error)
        });
    }
}
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\advanced-calendar\advanced-calendar.component.css ---
.calendar-container {
	/* padding: 1rem; */
	border-radius: 12px;
	background: white;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
	.header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1rem;
	}

	.month {
		font-size: 1.125rem;
		font-weight: 500;
		color: #334155;
	}

	.calendar-grid-container {
		display: grid;
		grid-template-columns: repeat(7, minmax(0, 1fr));
		grid-auto-rows: min-content; /* גובה שורה גמיש לפי התוכן */
		column-gap: 1px;
		row-gap: 2px;
		position: relative; /* חיוני למיקום אירועי הספקים */
	}
}

/* --- Day Cell Styling --- */
.day-header {
	display: flex;
	flex-direction: column;
	text-align: center;
	border-radius: 8px;
	overflow: hidden;
	min-height: 20px;
	background-color: var(--grey-10);

	&.holiday {
		background-color: var(--secondary-50);
		border: 1px solid var(--secondary-200);
		box-shadow	: 0 0 12px 3px  var(--secondary-100);
	}

	&.today .day-date {
		background-color: #3b82f6;
		color: white;
	}

	.day-date {
		border-radius: 50%;
		width: 24px;
		height: 24px;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto;
		font-size: 0.875rem;
		color: #475569;
	}

	.day-letter {
		font-size: 0.75rem;
		color: #64748b;
		font-weight: 600;
		display: block;
		margin-bottom: 4px;
	}
}

.events {
	flex-grow: 1;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	gap: 4px;
	padding: 4px 2px;
}

.event {
	display: flex;
	align-items: center;
	justify-content: center;
	flex-wrap: wrap;
	padding: 6px 8px;
	border-radius: 10px;
	gap: clamp(2px, 0.6vw, 5px);
	font-size: clamp(10px, 0.6vw, 13px);
	font-weight: 500;
	white-space: wrap;
	overflow: hidden;
	text-overflow: ellipsis;

	.material-symbols-rounded.icon-sm {
		font-size: 16px;
	}

	&.jewish-date {
		background: var(--grey-20);
		color: var(--grey-600);
		font-weight: 500;
	}

	&.holiday {
		background: rgba(255, 59, 92, 0.1);
		color: #ff3b5c;
	}

	&.parasha {
		background: rgba(88, 86, 214, 0.1);
		color: #5856d6;
	}

	&.fast {
		background: rgba(255, 149, 0, 0.1);
		color: #ff9500;
	}

	&.shabbat-time {
		background: rgba(88, 86, 214, 0.05);
		color: #5856d6;
	}
}

/* Zmanim Box */
.zmanim {
	background: linear-gradient(135deg, #f8fafc, #f1f5f9);
	border-radius: 10px;
	padding: 0.75rem;
	border: 1px solid #e2e8f0;

	.zmanim-row {
		display: flex;
		justify-content: space-between;
		gap: 4px;
		align-items: center;

		@media (max-width: 800px) {
			flex-direction: column;
		}

		padding: 4px 0;
		font-size: clamp(10px, 0.5vw, 12px);
		color: #64748b;

		&:not(:last-child) {
			border-bottom: 1px solid rgba(226, 232, 240, 0.7);
		}

		.zmanim-label {
			display: flex;
			align-items: center;
			gap: 4px;
			font-weight: 500;
		}
		.material-symbols-rounded.icon-sm {
			font-size: 14px;
			color: #3b82f6;
		}
	}
}

/* --- Supplier Event Bars Styling --- */
.supplier-event {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: clamp(4px, 1vw, 8px);
	background-color: #f1f5f9;
	border: 1px solid #e2e8f0;
	border-radius: 6px;
	cursor: pointer;
	transition: all 0.2s ease;
	overflow: hidden;
	white-space: nowrap;
	font-size: clamp(10px, 0.75vw, 13px);
	color: #334155;
	grid-row-start: 2;
	@media (max-width: 600px) {
		justify-content: center;
	}

	&:hover:not(.supplier-event.missed) {
		transform: translateY(-2px);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		z-index: 10;
	}
	.supplier-name {
		font-weight: 500;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	
	/* Event states styling */
	.status-icon {
		@media (max-width: 600px) {
			display: none; /* Hide on small screens */
			
		}
	}
	&.empty {
		background-color: var(--grey-50);
		border-color: var(--grey-200);
		color: var(--grey-400);
		cursor: default;
		opacity: 0.8;
	}

	&.draft {
		background-color: var(--yellow-100);
		border-color: var(--yellow-300);
		color: var(--yellow-800);
	}

	&.sent {
		background-color: var(--green-100);
		border-color: var(--green-300);
		color: var(--green-800);
	}

	&.today {
		background-color: var(--primary-100);
		border-color: var(--primary-300);
		color: var(--primary-800);

		i {
			animation: ring 1.5s ease-in-out infinite;
		}
	}

	&.future {
		background-color: hsl(200, 50%, 95%); /* צבע תכלת עדין */
		border-color: hsl(200, 50%, 85%);
		color: hsl(200, 50%, 40%);
	}
}

@keyframes ring {
	0% {
		transform: rotate(0);
	}
	10% {
		transform: rotate(18deg);
	}
	20% {
		transform: rotate(-12deg);
	}
	30% {
		transform: rotate(8deg);
	}
	40% {
		transform: rotate(-4deg);
	}
	50% {
		transform: rotate(2deg);
	}
	60% {
		transform: rotate(0);
	}
	100% {
		transform: rotate(0);
	}
}

--- END OF FILE ---
--- START OF FILE src\app\components\calendar\advanced-calendar\advanced-calendar.component.html ---
<div class="calendar-container p-responsive">
	<!-- Header for Navigation -->
	<div class="header">
		<div class="flex gap-1">
			<p-button icon="pi pi-chevron-right" styleClass="p-button-sm" [rounded]="true" [text]="true"
				severity="secondary" (click)="prevWeek()">
			</p-button>
			<p-button icon="pi pi-stopwatch" styleClass="p-button-sm" [rounded]="true" [text]="true"
				severity="secondary" [pTooltip]="showHebrewCal() ? 'הסתר לוח שנה עיברי' :'הרחב לוח שנה עיברי'"
				(click)="toggleHebrewCal()">
			</p-button>
		</div>
		<h2 class="month">{{ monthDisplay() }}</h2>
		<div class="flex items-center justify-end gap-1">
			@if (displayedDays() | hasHoliday) {
			<div class="event holiday">
				<span class="material-symbols-rounded icon-sm">celebration</span>
				@for (part of (displayedDays() | findHoliday) | textSplit; track part) {
				<span>{{ part }}</span>
				}
			</div>
			}
			@if (!isCurrentWeek()) {
			<p-button icon="pi pi-calendar-clock" styleClass="p-button-sm" [rounded]="true" [text]="true"
				severity="secondary" (click)="goToToday()" pTooltip="חזור להיום">
			</p-button>
			}
			<p-button icon="pi pi-chevron-left" styleClass="p-button-sm" [rounded]="true" [text]="true"
				severity="secondary" (click)="nextWeek()">
			</p-button>
		</div>
	</div>

	<!-- Main Grid for Display -->
	<div class="calendar-grid-container" [style.grid-template-rows]="gridTemplateRowsStyle()">
		<!-- 1. Day Headers (Top Row) -->
		@for (day of displayedDays(); track day.fullDate) {
		<div class="day-header" [ngClass]="{
			'today' : day.isToday,
			'holiday': day.holiday && !day.fast && !day.shabbat || (day.holiday && day.shabbat),
			
		}">
			<span class="day-letter">{{ day.letter }}</span>
			<span class="day-date">{{ day.date }}</span>



			<div class="events expandable" [class.expanded]="showHebrewCal()">


				<div class="events">
					<div class="flex flex-col gap-1">
						@if (day.formatted) {
						<div class="event jewish-date">
							@for (part of day.formatted | textSplit; track part) {
							{{ part }}
							}
						</div>
						}
						@if (day.holiday && day.holiday !== day.fast) {
						<div class="event holiday">
							<span class="material-symbols-rounded icon-sm">celebration</span>
							@for (part of day.holiday | textSplit; track part) {
							<span>{{ part }}</span>
							}
						</div>
						}
						@if (day.fast) {
						<div class="event fast">
							<span class="material-symbols-rounded icon-sm">no_food</span>
							@for (part of day.fast | textSplit; track part) {
							<span>{{ part }}</span>
							}
						</div>
						}
						@if (day.parasha) {
						<div class="event parasha">
							<span class="material-symbols-rounded icon-sm">book</span>
							@for (part of day.parasha | textSplit; track part) {
							<span>{{ part }}</span>
							}
						</div>
						}
						@if (day.shabbat) {
						@if (day.shabbat.candleLighting) {
						<div class="event shabbat-time">
							<span class="material-symbols-rounded icon-sm">light</span>
							@for (part of ('כניסת שבת: ' + day.shabbat.candleLighting) | textSplit; track part) {
							<span>{{ part }}</span>
							}
						</div>
						}
						@if (day.shabbat.havdalah) {
						<div class="event shabbat-time">
							<span class="material-symbols-rounded icon-sm">event</span>
							@for (part of ('יציאת שבת: ' + day.shabbat.havdalah) | textSplit; track part) {
							<span>{{ part }}</span>
							}
						</div>
						}
						}
					</div>
				</div>

				<div class="zmanim">
					<div class="zmanim-row">
						<span class="material-symbols-rounded icon-sm">wb_twilight</span>
						<span class="zmanim-label">עלות השחר</span>
						<span>{{ day.zmanim.alotHashachar || 'לא זמין' }}</span>
					</div>
					<div class="zmanim-row">
						<span class="material-symbols-rounded icon-sm">wb_sunny</span>
						<span class="zmanim-label">זריחה</span>
						<span>{{ day.zmanim.sunrise || 'לא זמין' }}</span>
					</div>
					<div class="zmanim-row">
						<span class="material-symbols-rounded icon-sm">schedule</span>
						<span class="zmanim-label">חצות</span>
						<span>{{ day.zmanim.chatzot || 'לא זמין' }}</span>
					</div>
					<div class="zmanim-row">
						<span class="material-symbols-rounded icon-sm">backlight_high</span>
						<span class="zmanim-label">שקיעה</span>
						<span>{{ day.zmanim.sunset || 'לא זמין' }}</span>
					</div>
				</div>
			</div>


		</div>

		}

		<!-- 2. Event Bars placed on the grid -->
		@for (event of calendarEvents(); track event.id) {
		<div class="supplier-event"
			[style.grid-column]="(event.startDate.getDay() + 1) + ' / span ' + event.durationInDays"
			[style.grid-row]="event.row + 1" [ngClass]="event.displayState" (click)="openOrderDialog(event)"
			[pTooltip]="event.displayState == 'empty' ? '' : event.supplier.name" tooltipPosition="top">

			<span class="supplier-name">{{ event.supplier.name }}</span>

			<!-- <app-badge [enumValue]="event.status" [dataArray]="orderStatusData"
			[label]="event.status | orderStatusLabel">
		</app-badge> -->

			<!-- {{'status' + event.status}} -->


			@switch (event.displayState) {
			@case ('sent') { <i class="pi pi-check-circle status-icon sent-icon"></i> }
			@case ('draft') { <i class="pi pi-file-edit status-icon draft-icon"></i> }
			@case ('today') { <i class="pi pi-bell status-icon today-icon"></i> }
			@case ('future') { <i class="pi pi-clock status-icon future-icon"></i> }
			<!-- @case ('empty') { <i class="pi pi-times-circle status-icon empty-icon"></i> } -->
			@case ('empty') { }
			}
		</div>
		}
	</div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\advanced-calendar\advanced-calendar.component.ts ---
import { Component, computed, effect, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';
import { ButtonModule } from 'primeng/button';
import { TooltipModule } from 'primeng/tooltip';
import { DialogService, DynamicDialogModule } from 'primeng/dynamicdialog';
import { MessageService } from 'primeng/api';
import { SupplierStore } from '../../../store/supplier.store';
import { OrderStore } from '../../../store/order.store';

import { OrderStatus, orderStatusData } from '../../../common/enums/order-status.enum';
import { Status } from '../../../common/enums/status.enum';
import { ReminderType } from '../../../common/enums/reminderType';
import { OrderType } from '../../../common/enums/order-type';
import { OrderFlowService } from '../../../services/order-flow.service';
import { IEventInfo, JewishCalendarService } from '../../../services/jewish-calendar.service';
import { AuthStore } from '../../../store/auth.store';
import { UserRole } from '../../../common/enums/userRole.enum';
import { TextSplitPipe } from "../../../pipes/split.pipe";
import { HasHolidayPipe, FindHolidayPipe } from "../../../pipes/has-holiday.pipe";
import { Order } from '../../../common/models/order';
import { Supplier } from '../../../common/models/supplier';


export type EventDisplayState = 'future' | 'today' | 'empty' | 'sent' | 'draft';


export interface CalendarEvent {
  id: string;
  supplier: Supplier;
  startDate: Date;
  endDate: Date;
  durationInDays: number;
  status: OrderStatus | null; // <-- יכול להיות NULL
  displayState: EventDisplayState;
  row: number;
}

export interface DayDisplay {
  letter: string;
  date: number;
  fullDate: Date;
  isToday: boolean;

  formatted?: string;
  holiday?: string;
  parasha?: string;
  fast?: string;
  shabbat?: { candleLighting?: string; havdalah?: string };
  zmanim: { sunrise?: string; sunset?: string; chatzot?: string; alotHashachar?: string };
}

@Component({
  selector: 'app-advanced-calendar',
  standalone: true,
  imports: [CommonModule, RouterModule, ButtonModule, TooltipModule, DynamicDialogModule, TextSplitPipe, HasHolidayPipe, FindHolidayPipe],
  providers: [DialogService, MessageService],
  templateUrl: './advanced-calendar.component.html',
  styleUrl: './advanced-calendar.component.css'
})
export class AdvancedCalendarComponent {
  private readonly supplierStore = inject(SupplierStore);
  private readonly orderStore = inject(OrderStore);
  private readonly orderFlowService = inject(OrderFlowService);
  private jewishCalendarService = inject(JewishCalendarService);
  public currentDate = signal(new Date());
  public calendarEvents = signal<CalendarEvent[]>([]);
  private authStore = inject(AuthStore);

  public readonly todayTimestamp = new Date().setHours(0, 0, 0, 0);

  private readonly hebrewMonths = ['ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני', 'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'];
  private readonly dayLetters = ['א׳', 'ב׳', 'ג׳', 'ד׳', 'ה׳', 'ו׳', 'ש׳'];

  public OrderStatus = OrderStatus
  public readonly orderStatusData = orderStatusData;


  // Accessing the store's signals
  readonly userRole = this.authStore.userRole;



  public readonly viewPort = computed(() => {
    const center = new Date(this.currentDate());
    center.setHours(0, 0, 0, 0);
    const startDate = new Date(center);
    startDate.setDate(startDate.getDate() - startDate.getDay());
    const endDate = new Date(startDate);
    endDate.setDate(startDate.getDate() + 6);
    return { startDate, endDate };
  });



  public readonly displayedDays = computed<DayDisplay[]>(() => {
    const { startDate } = this.viewPort();
    const days: DayDisplay[] = [];
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    for (let i = 0; i < 7; i++) {
      const currentDate = new Date(startDate);
      currentDate.setDate(startDate.getDate() + i);

      const dayObj = this.jewishCalendarService.createDayObject(currentDate);

      const events = dayObj.events?.reduce(
        (acc, ev: IEventInfo) => {
          if (ev.categories.includes('holiday')) acc.holiday = ev.hebName;
          if (ev.categories.includes('parashat')) acc.parasha = ev.hebName.replace('פרשת ', '');
          if (ev.categories.includes('fast')) acc.fast = ev.hebName;
          return acc;
        },
        { holiday: '', parasha: '', fast: '' }
      ) ?? { holiday: '', parasha: '', fast: '' };

      const shabbat = (currentDate.getDay() === 5 || currentDate.getDay() === 6)
        ? {
          candleLighting: dayObj.zmanim.candleLighting?.time,
          havdalah: dayObj.zmanim.havdalah?.time,
        }
        : undefined;

      days.push({
        letter: this.dayLetters[currentDate.getDay()],
        date: currentDate.getDate(),
        fullDate: currentDate,
        isToday: currentDate.getTime() === today.getTime(),
        formatted: this.jewishCalendarService.getHebrewDate(currentDate.getFullYear(), currentDate.getMonth() + 1, currentDate.getDate()),
        holiday: events.holiday,
        parasha: events.parasha,
        fast: events.fast,
        shabbat,
        zmanim: {
          sunrise: dayObj.zmanim.sunrise?.time,
          sunset: dayObj.zmanim.sunset?.time,
          chatzot: dayObj.zmanim.chatzot?.time,
          alotHashachar: dayObj.zmanim.alotHaShachar?.time,
        },
      });
    }

    return days;
  });
  public readonly monthDisplay = computed(() => {
    const displayDate = this.viewPort().startDate;
    const year = displayDate.getFullYear();
    const month = this.hebrewMonths[displayDate.getMonth()];
    const endDate = new Date(displayDate);
    endDate.setDate(displayDate.getDate() + 6);
    if (displayDate.getMonth() !== endDate.getMonth()) {
      const endMonth = this.hebrewMonths[endDate.getMonth()];
      return `${month} - ${endMonth} ${year}`;
    }
    return `${month} ${year}`;
  });

  public readonly gridTemplateRowsStyle = computed(() => {
    const events = this.calendarEvents();
    if (events.length === 0) return 'auto';
    const maxRow = Math.max(0, ...events.map(e => e.row));
    return `auto repeat(${maxRow > 0 ? maxRow : 1}, 38px)`;
  });

  constructor() {
    this.currentDate.set(this.getStartOfWeek(new Date()));
    effect(() => {
      const { startDate, endDate } = this.viewPort();
      const suppliers = this.supplierStore.suppliers();
      if (suppliers.length > 0) {
        this.orderStore.loadOrdersByDateRange({
          supplierIds: suppliers.map(s => s.id),
          startDate: this.formatDate(startDate),
          endDate: this.formatDate(endDate),
        });
      }
    });
    effect(() => {
      const orders = this.orderStore.orders();
      const suppliers = this.supplierStore.suppliers();
      this.buildCalendarEvents(orders, suppliers);
    });
  }


  private buildCalendarEvents(orders: Order[], allSuppliers: Supplier[]): void {
    const { startDate, endDate } = this.viewPort();
    if (!allSuppliers || allSuppliers.length === 0) {
      this.calendarEvents.set([]);
      return;
    }

    const ordersMap = new Map<string, Order>(orders.map(o => [`${o.supplierId}-${o.date}`, o]));
    const activeSuppliers = allSuppliers.filter(s => !s.isDeleted && s.status === Status.Active);
    const finalEvents: CalendarEvent[] = [];
    const todayTimestamp = new Date().setHours(0, 0, 0, 0);

    for (const supplier of activeSuppliers) {
      let currentDate = new Date(startDate);
      while (currentDate <= endDate) {
        const dateStr = this.formatDate(currentDate);
        const orderOnDate = ordersMap.get(`${supplier.id}-${dateStr}`);
        const isScheduledDay = this.isOrderDay(supplier, currentDate);

        if (orderOnDate) {
          const displayState = orderOnDate.status === OrderStatus.Draft ? 'draft' : 'sent';
          finalEvents.push(this.createEvent(supplier, currentDate, currentDate, orderOnDate.status, displayState));

        } else if (isScheduledDay) {
          const currentTimestamp = currentDate.getTime();

          // --- לוגיקה חדשה לקביעת הסטטוס: empty, today, future ---
          let displayState: 'empty' | 'today' | 'future';
          if (currentTimestamp < todayTimestamp) {
            displayState = 'empty';
          } else if (currentTimestamp === todayTimestamp) {
            displayState = 'today';
          } else {
            displayState = 'future';
          }

          if (supplier.reminderType === ReminderType.UntilOrderDone) {
            const hasOrderInWeek = this.hasOrderInDateRange(supplier.id, startDate, endDate, ordersMap);

            if (!hasOrderInWeek) {
              const sequence = this.findFullSequence(supplier, startDate, endDate);
              if (sequence && sequence.start.getTime() === currentDate.getTime()) {
                // קבע את הסטטוס על בסיס הרצף כולו
                const sequenceDisplayState = sequence.isPast ? 'empty' : this.getSequenceState(sequence, todayTimestamp);
                finalEvents.push(this.createEvent(supplier, sequence.start, sequence.end, OrderStatus.Empty, sequenceDisplayState));
                currentDate = new Date(sequence.end);
              }
            }
          } else { // ReminderType.EachTime
            finalEvents.push(this.createEvent(supplier, currentDate, currentDate, OrderStatus.Empty, displayState));
          }
        }
        currentDate.setDate(currentDate.getDate() + 1);
      }
    }

    this.calendarEvents.set(this.layoutEventsWithRows(finalEvents));
  }

  // in advanced-calendar.component.ts

  private getSequenceState(sequence: { start: Date, end: Date }, todayTimestamp: number): 'today' | 'future' {
    const startTimestamp = sequence.start.getTime();
    const endTimestamp = sequence.end.getTime();

    // בדוק אם היום נמצא בין ההתחלה לסוף (כולל)
    if (todayTimestamp >= startTimestamp && todayTimestamp <= endTimestamp) {
      return 'today';
    }

    // אם לא, הרצף חייב להיות כולו בעתיד
    return 'future';
  }


  private findFullSequence(supplier: Supplier, weekStart: Date, weekEnd: Date): { start: Date, end: Date, isPast: boolean } | null {
    let firstDay: Date | null = null;
    let lastDay: Date | null = null;
    const todayTimestamp = new Date().setHours(0, 0, 0, 0);

    let currentDate = new Date(weekStart);
    while (currentDate <= weekEnd) {
      if (this.isOrderDay(supplier, currentDate)) {
        if (!firstDay) {
          firstDay = new Date(currentDate);
        }
        lastDay = new Date(currentDate);
      }
      currentDate.setDate(currentDate.getDate() + 1);
    }

    if (firstDay && lastDay) {
      // רצף נחשב "בעבר" אם כל כולו (כולל היום האחרון שלו) נמצא לפני היום
      const isPast = lastDay.getTime() < todayTimestamp;
      return { start: firstDay, end: lastDay, isPast: isPast };
    }

    return null;
  }

  private hasOrderInDateRange(supplierId: number, startDate: Date, endDate: Date, ordersMap: Map<string, Order>): boolean {
    let currentDate = new Date(startDate);
    while (currentDate <= endDate) {
      if (ordersMap.has(`${supplierId}-${this.formatDate(currentDate)}`)) {
        return true;
      }
      currentDate.setDate(currentDate.getDate() + 1);
    }
    return false;
  }

  private createEvent(supplier: Supplier, startDate: Date, endDate: Date, status: OrderStatus, displayState: CalendarEvent['displayState']): CalendarEvent {
    const duration = Math.round((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1;
    const uniqueId = `${supplier.id}-${startDate.getTime()}-${displayState}`;
    return { id: uniqueId, supplier, startDate: new Date(startDate), endDate: new Date(endDate), durationInDays: duration, status, displayState, row: 1 };
  }

  private layoutEventsWithRows(events: CalendarEvent[]): CalendarEvent[] {
    // 1. קבץ את כל האירועים לפי מזהה הספק
    const eventsBySupplier = new Map<number, CalendarEvent[]>();
    for (const event of events) {
        if (!eventsBySupplier.has(event.supplier.id)) {
            eventsBySupplier.set(event.supplier.id, []);
        }
        eventsBySupplier.get(event.supplier.id)!.push(event);
    }

    // 2. הפוך את המפה למערך וסדר את הספקים (למשל, לפי שם)
    const sortedSuppliersEvents = Array.from(eventsBySupplier.values())
        .sort((a, b) => a[0].supplier.name.localeCompare(b[0].supplier.name));

    // 3. הקצה לכל ספק שורה קבועה ועדכן את כל האירועים שלו
    const finalEvents: CalendarEvent[] = [];
    sortedSuppliersEvents.forEach((supplierEvents, index) => {
        const rowNumber = index + 1; // השורה מתחילה מ-1
        for (const event of supplierEvents) {
            event.row = rowNumber;
            finalEvents.push(event);
        }
    });

    return finalEvents;
}


  private isOrderDay(supplier: Supplier, date: Date): boolean {
    if (supplier.orderType === OrderType.ByDay) return supplier.orderDays?.includes(date.getDay()) ?? false;
    if (supplier.orderType === OrderType.ByDate) return supplier.orderDates?.includes(date.getDate()) ?? false;
    return false;
  }

  private getStartOfWeek(date: Date): Date {
    const newDate = new Date(date);
    newDate.setHours(0, 0, 0, 0);
    newDate.setDate(newDate.getDate() - newDate.getDay());
    return newDate;
  }

  private formatDate(date: Date): string {
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
  }

  // --- UI Actions ---
  public prevWeek(): void {
    const newDate = new Date(this.currentDate());
    newDate.setDate(newDate.getDate() - 7);
    this.currentDate.set(newDate);
  }

  public nextWeek(): void {
    const newDate = new Date(this.currentDate());
    newDate.setDate(newDate.getDate() + 7);
    this.currentDate.set(newDate);
  }

  public goToToday(): void {
    this.currentDate.set(this.getStartOfWeek(new Date()));
  }

  // in advanced-calendar.component.ts

  public openOrderDialog(event: CalendarEvent): void {
    console.log(this.userRole());
    
    if (event.displayState === 'empty' && this.userRole() === UserRole.User) {
      // this.notificationService.toast({
      //   severity: 'info', // שיניתי ל-info כי זו לא שגיאה, אלא הגבלת הרשאה
      //   summary: 'הרשאה נדרשת',
      //   detail: 'רק מנהלים יכולים לפתוח הזמנות עבר.',
      //   life: 3000
      // });
      return; // אם כן, צא מהפונקציה
    }

    const eventDate = new Date(event.startDate);
    eventDate.setHours(0, 0, 0, 0);

    const existingOrder = this.orderStore.orders().find(o =>
      o.supplierId === event.supplier.id && o.date === this.formatDate(eventDate)
    );

    const dateForDialog = event.displayState === 'today' ? new Date() : eventDate;
    dateForDialog.setHours(0, 0, 0, 0);

    this.orderFlowService.openOrderDialog({
      supplier: event.supplier,
      date: dateForDialog,
      existingOrder: existingOrder
    });
  }

  public isCurrentWeek(): boolean {
    const today = new Date();
    const currentViewDate = this.currentDate(); // השתמש בסיגנל ישירות

    // מצא את יום ראשון של השבוע הנוכחי
    const startOfCurrentWeek = new Date(today);
    startOfCurrentWeek.setDate(today.getDate() - today.getDay());
    startOfCurrentWeek.setHours(0, 0, 0, 0);

    // מצא את יום ראשון של השבוע המוצג בתצוגה
    const startOfDisplayedWeek = new Date(currentViewDate);
    startOfDisplayedWeek.setDate(currentViewDate.getDate() - currentViewDate.getDay());
    startOfDisplayedWeek.setHours(0, 0, 0, 0);

    // השווה את ה-timestamps של שני ימי הראשון
    return startOfCurrentWeek.getTime() === startOfDisplayedWeek.getTime();
  }


  showHebrewCal = signal<boolean>(false)
  public toggleHebrewCal() {
    this.showHebrewCal.update(value => value = !value)
  }



}
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\jewish-calendar\calendar-day.component.css ---
.container {
	max-width: 1200px;
	margin: 0 auto;
	padding: 20px;
}


/* View Mode Buttons */
.view-modes {
	display: flex;
	justify-content: center;
	gap: 4px;
	margin-bottom: 24px;
	background: rgb(255, 255, 255);
	backdrop-filter: blur(10px);
	border-radius: 16px;
	padding: 4px;
	width: fit-content;
	margin-left: auto;
	margin-right: auto;
}

.view-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 6px;
	padding: 10px 16px;
	border: none;
	border-radius: 12px;
	background: transparent;
	color: var(--grey-600);
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: all 0.3s ease;
}

.view-btn:hover {
	background: var(--primary-100);
	color: var(--primary-500);
}

.view-btn.active {
	background: var(--primary-200);
	color: var(--primary-700);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Navigation */
.navigation {
	display: flex;
	justify-content: center;
	align-items: center;
	gap: 16px;
	margin-bottom: 32px;
}

.nav-btn {
	display: flex;
	align-items: center;
	gap: 8px;
	padding: 12px 20px;
	border: none;
	border-radius: 12px;
	background: rgba(255, 255, 255, 0.9);
	color: #333;
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: all 0.3s ease;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.nav-btn:hover {
	background: white;
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.nav-btn.today {
	background: #007aff;
	color: white;
}

.nav-btn.today:hover {
	background: #0056cc;
}

/* Days Grid */
.days-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
	gap: 16px;
	max-width: 100%;
}

@media (min-width: 768px) {
	.days-grid {
		grid-template-columns: repeat(3, 1fr);
	}
}

@media (min-width: 1024px) {
	.days-grid.week-view {
		grid-template-columns: repeat(7, 1fr);
	}
}

/* Day Card */
.day-card {
	background: rgba(255, 255, 255, 0.95);
	backdrop-filter: blur(20px);
	border-radius: 20px;
	padding: 20px;
	box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
	transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	border: 1px solid rgba(255, 255, 255, 0.2);
}

.day-card:hover {
	transform: translateY(-4px);
	box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
}

.day-card.current {
	color: var(--primary-600);
	border: 2px solid rgba(255, 255, 255, 0.3);
}

.day-card.current .day-header h3,
.day-card.current .day-date {
	color: white;
	color: var(--primary-600);
}

/* Day Header */
.day-header {
	display: flex;
	align-items: center;
	gap: 12px;
	margin-bottom: 16px;
}

.day-letter {
	width: 40px;
	height: 40px;
	border-radius: 12px;
	background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
	display: flex;
	align-items: center;
	justify-content: center;
	color: white;
	font-weight: 600;
	font-size: 18px;
	box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

.day-card.current .day-letter {
	background: linear-gradient(135deg, #007aff 0%, #5856d6 100%);
	box-shadow: 0 4px 12px rgba(67, 98, 240, 0.664);
	backdrop-filter: blur(10px);
}

.day-header h3 {
	font-size: 18px;
	font-weight: 600;
	color: #333;
}

.day-date {
	font-size: 14px;
	color: #666;
	margin-bottom: 16px;
}

/* Events */
.events {
	margin-bottom: 16px;
}

.event {
	display: flex;
	align-items: center;
	gap: 8px;
	padding: 8px 12px;
	border-radius: 10px;
	margin-bottom: 6px;
	font-size: 13px;
	font-weight: 500;
}

.event.holiday {
	background: rgba(255, 59, 92, 0.1);
	color: #ff3b5c;
}

.event.parasha {
	background: rgba(88, 86, 214, 0.1);
	color: #5856d6;
}

.event.fast {
	background: rgba(255, 149, 0, 0.1);
	color: #ff9500;
}

.day-card.current .event {
	background: rgba(255, 255, 255, 0.15);
	color: white;
}

/* Shabbat Times */
.shabbat-times {
	background: rgba(88, 86, 214, 0.05);
	border-radius: 12px;
	padding: 12px;
	margin-bottom: 12px;
}

.day-card.current .shabbat-times {
	background: rgba(255, 255, 255, 0.1);
}

.shabbat-time {
	display: flex;
	align-items: center;
	gap: 8px;
	font-size: 12px;
	color: #5856d6;
	margin-bottom: 4px;
}

.day-card.current .shabbat-time {
	color: rgba(255, 255, 255, 0.9);
}

.shabbat-time:last-child {
	margin-bottom: 0;
}

/* Zmanim */
.zmanim {
	background: rgba(0, 0, 0, 0.03);
	border-radius: 12px;
	padding: 12px;
}

.day-card.current .zmanim {
	background: rgba(255, 255, 255, 0.1);
}

.zmanim-row {
	display: flex;
	justify-content: space-between;
	align-items: center;
	font-size: 11px;
	color: #666;
	margin-bottom: 4px;
	
	&:last-child {
		margin-bottom: 0;
	}
	
	.zmanim-label {
		display: flex;
		align-items: center;
		gap: 4px;
	}
}


/* Icons */
.icon {
	width: 16px;
	height: 16px;
	fill: currentColor;
}

.icon-sm {
	font-size: 14px;
}

/* Responsive */
@media (max-width: 768px) {
	.container {
		padding: 16px;
	}

	.days-grid {
		grid-template-columns: 1fr;
	}

	.view-modes {
		flex-wrap: wrap;
		gap: 8px;
	}

	.navigation {
		flex-wrap: wrap;
		gap: 8px;
	}
}

--- END OF FILE ---
--- START OF FILE src\app\components\calendar\jewish-calendar\calendar-day.component.html ---
<div class="container">

    <!-- View Mode Buttons -->
    <div class="view-modes" role="navigation" aria-label="בחירת מצב תצוגה">
        <button class="view-btn" [class.active]="viewMode() === ViewModeEnum.Auto" (click)="setViewMode(ViewModeEnum.Auto)" aria-label="תצוגה אוטומטית">
            <span class="material-symbols-rounded icon">check_circle</span>
            אוטומטי
        </button>
        <button class="view-btn" [class.active]="viewMode() === ViewModeEnum.Day" (click)="setViewMode(ViewModeEnum.Day)" aria-label="תצוגה יומית">
            <span class="material-symbols-rounded icon">today</span>
            יומית
        </button>
        <button class="view-btn" [class.active]="viewMode() === ViewModeEnum.Week" (click)="setViewMode(ViewModeEnum.Week)" aria-label="תצוגה שבועית">
            <span class="material-symbols-rounded icon">calendar_view_week</span>
            שבועית
        </button>
        <button class="view-btn" [class.active]="viewMode() === ViewModeEnum.Month" (click)="setViewMode(ViewModeEnum.Month)" aria-label="תצוגה חודשית">
            <span class="material-symbols-rounded icon">calendar_month</span>
            חודשית
        </button>
    </div>

    <!-- Navigation -->
    <div class="navigation" role="navigation" aria-label="ניווט תאריכים">
        <button class="nav-btn" (click)="prevDay()" aria-label="עבור ליום הקודם">
            <span class="material-symbols-rounded icon">chevron_right</span>
            יום קודם
        </button>
        @if (!isToday()) {
            <button class="nav-btn today" (click)="resetToToday()" aria-label="חזור לתאריך של היום">
                <span class="material-symbols-rounded icon">today</span>
                חזרה להיום
            </button>
        }
        <button class="nav-btn" (click)="nextDay()" aria-label="עבור ליום הבא">
            יום הבא
            <span class="material-symbols-rounded icon">chevron_left</span>
        </button>
    </div>

    <!-- Days Grid -->
    <div class="days-grid" [class.week-view]="viewMode() === ViewModeEnum.Week || (viewMode() === ViewModeEnum.Auto && screenSize() === ScreenSizeEnum.Desktop)">
        @for (day of displayedDays(); track day.date) {
            <div class="day-card" [class.current]="day.isCurrent" role="article" [attr.aria-label]="'תאריך ' + day.formatted">
                <div class="day-header">
                    <div class="day-letter">{{ day.letter }}</div>
                    <h3>יום {{ day.name }}</h3>
                </div>
                <div class="day-date">{{ day.date | date:'dd MMMM yyyy':'he-IL' }} • {{ day.formatted }}</div>
                
                <div class="events">
                    @if (day.holiday) {
                        <div class="event holiday">
                            <span class="material-symbols-rounded icon-sm">celebration</span>
                            {{ day.holiday }}
                        </div>
                    }
                    @if (day.parasha) {
                        <div class="event parasha">
                            <span class="material-symbols-rounded icon-sm">book</span>
                            {{ day.parasha.includes('שבת') ? day.parasha : 'פרשת ' + day.parasha }}
                        </div>
                    }
                    @if (day.fast) {
                        <div class="event fast">
                            <span class="material-symbols-rounded icon-sm">no_food</span>
                            {{ day.fast }}
                        </div>
                    }
                </div>

                @if (day.shabbat) {
                    <div class="shabbat-times">
                        @if (day.shabbat.candleLighting) {
                            <div class="shabbat-time">
                                <span class="material-symbols-rounded icon-sm">light</span>
                                כניסת שבת: {{ day.shabbat.candleLighting }}
                            </div>
                        }
                        @if (day.shabbat.havdalah) {
                            <div class="shabbat-time">
                                <span class="material-symbols-rounded icon-sm">event</span>
                                יציאת שבת: {{ day.shabbat.havdalah }}
                            </div>
                        }
                    </div>
                }

                <div class="zmanim">
                    <div class="zmanim-row">
                        <div class="zmanim-label">
                            <span class="material-symbols-rounded icon-sm">wb_twilight</span>
                            עלות השחר
                        </div>
                        <span>{{ day.zmanim.alotHashachar || 'לא זמין' }}</span>
                    </div>
                    <div class="zmanim-row">
                        <div class="zmanim-label">
                            <span class="material-symbols-rounded icon-sm">wb_sunny</span>
                            זריחה
                        </div>
                        <span>{{ day.zmanim.sunrise || 'לא זמין' }}</span>
                    </div>
                    <div class="zmanim-row">
                        <div class="zmanim-label">
                            <span class="material-symbols-rounded icon-sm">schedule</span>
                            חצות
                        </div>
                        <span>{{ day.zmanim.chatzot || 'לא זמין' }}</span>
                    </div>
                    <div class="zmanim-row">
                        <div class="zmanim-label">
                            <span class="material-symbols-rounded icon-sm">backlight_high</span>
                            שקיעה
                        </div>
                        <span>{{ day.zmanim.sunset || 'לא זמין' }}</span>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\jewish-calendar\calendar-day.component.ts ---
import { Component, signal, computed, OnInit, OnDestroy, inject } from '@angular/core';
import { CommonModule, DOCUMENT } from '@angular/common';
import { daysNames, IEventInfo, JewishCalendarService } from '../../../services/jewish-calendar.service';

export enum ScreenSizeEnum {
  Mobile = 'mobile',
  Tablet = 'tablet',
  Desktop = 'desktop'
}

export enum ViewModeEnum {
  Auto = 'auto',
  Day = 'day',
  Week = 'week',
  Month = 'month'
}

interface DisplayedDay {
  date: Date;
  letter: string;
  name: string;
  formatted: string;
  isCurrent: boolean;
  holiday?: string;
  parasha?: string;
  fast?: string;
  shabbat?: { candleLighting?: string; havdalah?: string };
  zmanim: { sunrise?: string; sunset?: string; chatzot?: string; alotHashachar?: string };
}

@Component({
  selector: 'app-calendar-day',
  standalone: true,
  templateUrl: './calendar-day.component.html',
  styleUrls: ['./calendar-day.component.css'],
  imports: [CommonModule]
})
export class CalendarDayComponent implements OnInit, OnDestroy {
  private document = inject(DOCUMENT);
  private jewishCalendarService = inject(JewishCalendarService);
  private resizeObserver: ResizeObserver | undefined;

  currentDate = signal(new Date());
  today = new Date();
  screenSize = signal<ScreenSizeEnum>(ScreenSizeEnum.Mobile);
  viewMode = signal<ViewModeEnum>(ViewModeEnum.Auto);
  ViewModeEnum = ViewModeEnum
  ScreenSizeEnum = ScreenSizeEnum

  displayedDays = computed(() => this.getDisplayedDays());
  dayOfWeek = computed(() => this.getHebrewDay(this.currentDate().getDay()).name);
  formattedDate = computed(() => this.jewishCalendarService.getHebrewDate(
    this.currentDate().getFullYear(),
    this.currentDate().getMonth() + 1,
    this.currentDate().getDate()
  ));
  isToday = computed(() => this.currentDate().toDateString() === this.today.toDateString());

  ngOnInit() {
    this.jewishCalendarService.generateEvents();
    this.updateScreenSize();
    if (typeof window !== 'undefined' && typeof ResizeObserver !== 'undefined') {
      this.resizeObserver = new ResizeObserver(() => this.updateScreenSize());
      this.resizeObserver.observe(this.document.body);
    }
  }

  ngOnDestroy() {
    if (this.resizeObserver) {
      this.resizeObserver.disconnect();
    }
  }

  prevDay() {
    this.updateDate(-1);
  }

  nextDay() {
    this.updateDate(1);
  }

  resetToToday() {
    this.currentDate.set(new Date());
  }

  setViewMode(mode: ViewModeEnum) {
    this.viewMode.set(mode);
  }

  private updateDate(offset: number) {
    const newDate = new Date(this.currentDate());
    newDate.setDate(newDate.getDate() + offset);
    this.currentDate.set(newDate);
  }

  private updateScreenSize() {
    if (typeof window === 'undefined') {
      this.screenSize.set(ScreenSizeEnum.Mobile);
      return;
    }

    const width = this.document.defaultView?.innerWidth ?? 0;
    if (width >= 1024) {
      this.screenSize.set(ScreenSizeEnum.Desktop);
    } else if (width >= 768) {
      this.screenSize.set(ScreenSizeEnum.Tablet);
    } else {
      this.screenSize.set(ScreenSizeEnum.Mobile);
    }
  }

  private getDaysToShow(): number {
    const mode = this.viewMode();
    if (mode === ViewModeEnum.Day) return 1;
    if (mode === ViewModeEnum.Week) return 7;
    if (mode === ViewModeEnum.Month) return 35;

    switch (this.screenSize()) {
      case ScreenSizeEnum.Desktop: return 7;
      case ScreenSizeEnum.Tablet: return 3;
      default: return 1;
    }
  }

  private getDisplayedDays(): DisplayedDay[] {
    const current = new Date(this.currentDate());
    const daysToShow = this.getDaysToShow();
    const days: DisplayedDay[] = [];
    const isMonthView = this.viewMode() === ViewModeEnum.Month;

    const startDate = isMonthView ? new Date(current.getFullYear(), current.getMonth(), 1) : new Date(current);
    const startOffset = isMonthView ? 0 : Math.floor((daysToShow - 1) / 2);
    if (!isMonthView) {
      startDate.setDate(current.getDate() - startOffset);
    }

    for (let i = 0; i < daysToShow; i++) {
      const date = new Date(startDate);
      date.setDate(startDate.getDate() + i);
      const dayInfo = this.getHebrewDay(date.getDay());
      const dayObj = this.jewishCalendarService.createDayObject(date);

      const events = dayObj.events?.reduce(
        (acc, ev: IEventInfo) => {
          if (ev.categories.includes('holiday')) acc.holiday = ev.hebName;
          if (ev.categories.includes('parashat')) acc.parasha = ev.hebName.replace('פרשת ', '');
          if (ev.categories.includes('fast')) acc.fast = ev.hebName;
          return acc;
        },
        { holiday: '', parasha: '', fast: '' }
      ) ?? { holiday: '', parasha: '', fast: '' };

      const shabbat = (date.getDay() === 5 || date.getDay() === 6)
        ? {
            candleLighting: dayObj.zmanim.candleLighting?.time,
            havdalah: dayObj.zmanim.havdalah?.time,
          }
        : undefined;

      days.push({
        date,
        letter: dayInfo.letter,
        name: dayInfo.name,
        formatted: this.jewishCalendarService.getHebrewDate(date.getFullYear(), date.getMonth() + 1, date.getDate()),
        isCurrent: date.toDateString() === this.currentDate().toDateString(),
        holiday: events.holiday,
        parasha: events.parasha,
        fast: events.fast,
        shabbat,
        zmanim: {
          sunrise: dayObj.zmanim.sunrise?.time,
          sunset: dayObj.zmanim.sunset?.time,
          chatzot: dayObj.zmanim.chatzot?.time,
          alotHashachar: dayObj.zmanim.alotHaShachar?.time,
        },
      });
    }

    return days;
  }

  private getHebrewDay(dayIndex: number): { letter: string; name: string } {
    const day = daysNames.find(d => d.index === dayIndex);
    return { letter: day?.letter ?? '', name: day?.he ?? '' };
  }
}
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\calendar.component.css ---
.calendar-container {
	padding: 8px 12px 12px;
	border-radius: 12px;
	overflow: hidden;
	box-shadow: var(--box-shadow);
	background: white;

	.header {
		display: grid;
		grid-template-columns: repeat(3, minmax(0, 1fr));
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
		margin-bottom: 1rem;

		.month {
			font-size: 1rem;
			font-weight: 500;
			color: var(--grey-900);
			text-align: center;
		}
	}

	.seven-days-preview {
		display: flex;
		gap: 6px;
		justify-content: space-between;
		padding: 12px 8px;
		margin-bottom: 16px;
		background: var(--grey-20);
		border-radius: 8px;
		border: 1px solid var(--grey-100);
		overflow-x: auto;

		.day-cube {
			flex: 1;
			min-width: 38px;
			height: 56px;
			background: white;
			border: 1px solid var(--grey-100);
			border-radius: 8px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.2s ease;
			padding: 4px 2px;
			position: relative;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);

			&:hover {
				background: var(--secondary-50);
				border-color: var(--secondary-200);
				transform: translateY(-1px);
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
			}

			&.today {
				background: var(--secondary-50);
				border-color: var(--secondary-800);
				box-shadow: 0 2px 8px rgba(142, 36, 170, 0.2);
				transform: translateY(-1px);

				&::before {
					content: '●';
					position: absolute;
					top: 3px;
					right: 4px;
					color: var(--secondary-600);
					font-size: 8px;
				}

				.day-letter,
				.day-date {
					color: var(--primary-600);
					font-weight: 600;
				}
			}

			&.selected {
				background: var(--secondary-100);
				border-color: var(--secondary-600);
				box-shadow: 0 3px 12px var(--secondary-200);

				.day-letter,
				.day-date {
					color: var(--primary-700);
					font-weight: 600;
				}
			}

			.day-letter {
				font-size: 10px;
				font-weight: 600;
				color: var(--primary-600);
				margin-bottom: 2px;
				line-height: 1;
			}

			.day-date {
				font-size: 12px;
				color: var(--grey-700);
				font-weight: 500;
				line-height: 1;
			}
		}
	}

	.day {
		border: 1px solid var(--grey-50);
		border-radius: var(--border-radius);
		/* box-shadow: var(--box-shadow); */
		box-shadow: rgba(17, 17, 26, 0.05) 0px 1px 0px, rgba(17, 17, 26, 0.1) 0px 0px 8px;
		min-height: 120px;
		display: flex;
		flex-direction: column;
		transition: all 0.2s ease;
		overflow: hidden;

		&:hover {
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
		}

		&:has(.today) {
			background-color: var(--secondary-50);
			border-radius: var(--border-radius);
			border: 1px solid var(--secondary-300);
		}

		.day-header.today {
			background-color: var(--secondary-100);
			position: relative;
			overflow: hidden;
			border-bottom: 1px solid var(--secondary-300);
			&::before {
				content: '\e8df';
				font-family: 'Material Symbols Rounded';
				position: absolute;
				top: 5px;
				right: 50%;

				display: flex;
				align-content: center;
				justify-content: center;
				transform: translateX(50%);

				transition: all 0.2s ease;
				color: var(--secondary-600);
				font-size: 18px;
			}

			.day-letter,
			.day-date {
				color: var(--primary-700);
				font-weight: 600;
			}
		}

		.day-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 8px 12px;
			border-bottom: 1px solid var(--grey-100);
			min-height: 32px;

			.day-letter {
				font-size: 0.8rem;
				font-weight: 600;
				color: var(--primary-600);
			}

			.day-date {
				font-size: 0.8rem;
				color: var(--grey-700);
			}
		}

		.day-content {
			flex: 1;
			display: flex;
			padding: 2px;

			.suppliers-list {
				width: 100%;
				display: flex;
				gap: 4px;
				padding: 4px;
				flex-direction: column;
				justify-self: flex-start;

				.supplier-item {
					cursor: pointer;
					min-height: 38px;
				}
			}
		}
		.no-suppliers {
			font-size: 0.75rem;
			color: var(--grey-400);
		}
	}
}

.supplier-item {
	display: flex;
	align-items: center;
	gap: 10px;
	font-size: 12px;
	border-radius: 4px;
	cursor: pointer;
	transition: all 0.3s ease;
	border: 1px solid var(--grey-100);
	background-color: var(--grey-20);
	position: relative;
	padding: 8px;
	overflow: hidden;
	min-height: 32px;

	&:hover {
		box-shadow: 0 1px 8px rgba(0, 0, 0, 0.15);
		border: 1px solid var(--primary-200);
	}

	.supplier-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: 2px;
	}

	.supplier-name {
		font-weight: 500;
		font-size: 12px;
		line-height: 1.2;
	}

	.order-status {
		font-size: 10px;
		padding-top: 1px;
		/* opacity: 0.8; */
	}

	&.missed-opportunity {
		opacity: 0.1;
		border: 1px dashed var(--grey-400)!important;
		cursor: default!important;
	}
}

/* Responsive adjustments for very small screens */
@media (max-width: 375px) {
	.calendar-container .seven-days-preview {
		.day-cube {
			min-width: 34px;
			height: 50px;

			.day-letter {
				font-size: 9px;
			}

			.day-date {
				font-size: 11px;
			}
		}

		gap: 4px;
		padding: 10px 6px;
	}
}





--- END OF FILE ---
--- START OF FILE src\app\components\calendar\calendar.component.html ---
<div class="calendar-container">
    <div class="header">
        <p-button icon="pi pi-chevron-right" styleClass="p-button-sm" [rounded]="true" [text]="true"
            severity="secondary" tooltipPosition="top" [pTooltip]="screenSize() === 'desktop' ? 'שבוע קודם' : ''"
            (click)="prevWeek()" [disabled]="isFetching()">
        </p-button>
        <h2 class="month">{{ monthDisplay() }}</h2>
        <div class="flex items-center justify-end gap-1">
            @if (!isCurrentWeek()) {
            <p-button icon="pi pi-calendar-clock" styleClass="p-button-sm" [rounded]="true" [text]="true"
                severity="secondary" tooltipPosition="top" pTooltip="חזור להיום" (click)="goToToday()">
            </p-button>
            }
            <p-button icon="pi pi-chevron-left" styleClass="p-button-sm" [rounded]="true" [text]="true"
                severity="secondary" tooltipPosition="top" [pTooltip]="screenSize() === 'desktop' ? 'שבוע הבא' : ''"
                (click)="nextWeek()" [disabled]="isFetching()">
            </p-button>

        </div>
    </div>

    @if(screenSize() == 'mobile' || screenSize() == 'tablet'){
    <div class="seven-days-preview">
        @for (day of sevenDaysPreview(); track day.fullDate.getTime()) {
        <div class="day-cube" [class.today]="day.isToday" [class.selected]="day.isSelected"
            (click)="onPreviewDayClick(day.fullDate)">
            <span class="day-letter">{{ day.letter }}</span>
            <span class="day-date">{{ day.date }}</span>
        </div>
        }
    </div>
    }

    <div class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-7 gap-1">
        @for (day of displayedDays(); track day.fullDate) {
        <div class="day" (click)="logDay(day)">
            <div class="day-header" [class.today]="day.isToday">
                <span class="day-letter">{{ day.letter }}</span>
                <span class="day-date">{{ day.date }}</span>
            </div>
            <div class="day-content">
                @if (day.suppliers.length > 0) {
                <div class="suppliers-list">
                    @for (data of day.suppliers; track data.supplier.id) {
                    @let missed = data.displayState == 'missed';
                    <div class="supplier-item" (click)="openOrderDialog(data, day.fullDate)"
                        [class.missed-opportunity]="missed">
                        <div class="flex w-full items-center justify-between">
                            <span class="supplier-name">{{data.supplier.name}}</span>
                            @if(data.orderStatus > 1){
                            <app-badge @fadeIn400 [enumValue]="data.orderStatus" [dataArray]="orderStatusData"
                                [label]="data.orderStatus | orderStatusLabel" [defaultIcon]="'pi pi-ticket'"
                                defaultBackground="bg-primary-100 hover:bg-primary-20">
                            </app-badge>
                            }
                        </div>
                    </div>
                    }

                </div>
                } @else {
                <span class="no-suppliers"></span>
                }
            </div>
        </div>
        }
    </div>


</div>
--- END OF FILE ---
--- START OF FILE src\app\components\calendar\calendar.component.ts ---
import { Component, effect, inject, signal, OnDestroy, OnInit, computed } from '@angular/core';
import { ButtonModule } from 'primeng/button';
import { DialogService, DynamicDialogModule } from 'primeng/dynamicdialog';
import { RouterModule } from '@angular/router';
import { Status } from '../../common/enums/status.enum';

import { BadgeComponent } from '../shared/badge/badge.component';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { OrderStatus, orderStatusData } from '../../common/enums/order-status.enum';
import { fadeIn400 } from '../../common/const/animations';
import { CommonModule, DOCUMENT } from '@angular/common';
import { OrderStatusPipe } from "../../pipes/orderStatus.pipe";
import { TooltipModule } from 'primeng/tooltip';
import { OrderStore } from '../../store/order.store';
import { SupplierStore } from '../../store/supplier.store';
import { OrderType } from '../../common/enums/order-type';
import { ReminderType } from '../../common/enums/reminderType';
import { OrderFlowService } from '../../services/order-flow.service';
import { Supplier } from '../../common/models/supplier';
import { Order } from '../../common/models/order';


export enum ScreenSizeEnum {
	Mobile = 'mobile',
	Tablet = 'tablet',
	Desktop = 'desktop'
}

const SCREEN_SIZE_BREAKPOINTS = {
	[ScreenSizeEnum.Mobile]: 0,
	[ScreenSizeEnum.Tablet]: 640,
	[ScreenSizeEnum.Desktop]: 1024,
};

interface DaySupplier {
	supplier: Supplier;
	orderStatus: OrderStatus;
	displayState: 'active' | 'missed';
}

interface Day {
	letter: string;
	date: number;
	fullDate: Date;
	suppliers: DaySupplier[];
	isToday: boolean;
}

interface PreviewDay {
	letter: string;
	date: number;
	fullDate: Date;
	isToday: boolean;
	isSelected: boolean;
}

@Component({
	selector: 'app-calendar',
	standalone: true,
	imports: [CommonModule, ButtonModule, DynamicDialogModule, RouterModule, BadgeComponent, ToastModule, OrderStatusPipe, TooltipModule],
	providers: [DialogService, MessageService],
	templateUrl: './calendar.component.html',
	styleUrl: './calendar.component.css',
	animations: [fadeIn400]
})
export class CalendarComponent implements OnInit, OnDestroy {
	private readonly orderStore = inject(OrderStore);
	private readonly supplierStore = inject(SupplierStore);

	private readonly orderFlowService = inject(OrderFlowService);
	private document = inject(DOCUMENT);

	public suppliers = this.supplierStore.suppliers;
	public orders = this.orderStore.orders;
	public isFetching = this.orderStore.isLoading;

	public OrderStatus = OrderStatus;
	public orderStatusData = orderStatusData;

	currentDate = signal(new Date());
	selectedPreviewDate = signal(new Date());
	allDays = signal<Map<number, Day>>(new Map());
	screenSize = signal<ScreenSizeEnum>(ScreenSizeEnum.Desktop);


	private hebrewMonths = ['ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני', 'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'];
	private dayLetters = ['א׳', 'ב׳', 'ג׳', 'ד׳', 'ה׳', 'ו׳', 'ש׳'];
	private resizeObserver?: ResizeObserver;

	readonly viewPort = computed(() => {
		const center = new Date(this.currentDate()); center.setHours(0, 0, 0, 0);
		const range = this.getDaysToShow();
		let startDate: Date;

		if (this.screenSize() === ScreenSizeEnum.Desktop) {
			// For desktop view, align to the start of the week (Sunday)
			startDate = new Date(center);
			const dayOfWeek = startDate.getDay(); // 0 for Sunday
			startDate.setDate(startDate.getDate() - dayOfWeek);
		} else {
			// For mobile/tablet, keep the centered logic
			const startOffset = Math.floor((range - 1) / 2);
			startDate = new Date(center);
			startDate.setDate(center.getDate() - startOffset);
		}

		const endDate = new Date(startDate);
		endDate.setDate(startDate.getDate() + range - 1);
		return { startDate, endDate };
	});

	readonly displayedDays = computed(() => {
		const { startDate, endDate } = this.viewPort();
		const daysMap = this.allDays();
		const displayArray: Day[] = [];
		const tempDate = new Date(startDate);
		while (tempDate <= endDate) {
			displayArray.push(daysMap.get(tempDate.getTime()) || this.createEmptyDay(new Date(tempDate)));
			tempDate.setDate(tempDate.getDate() + 1);
		}
		return displayArray;
	});

	readonly sevenDaysPreview = computed(() => {
		const center = new Date(this.selectedPreviewDate());
		center.setHours(0, 0, 0, 0);

		// Start from 3 days before center
		const startDate = new Date(center);
		startDate.setDate(center.getDate() - 3);

		const days: PreviewDay[] = [];
		const today = new Date();
		today.setHours(0, 0, 0, 0);

		for (let i = 0; i < 7; i++) {
			const dayDate = new Date(startDate);
			dayDate.setDate(startDate.getDate() + i);

			days.push({
				letter: this.dayLetters[dayDate.getDay()],
				date: dayDate.getDate(),
				fullDate: dayDate,
				isToday: dayDate.getTime() === today.getTime(),
				isSelected: dayDate.getTime() === this.selectedPreviewDate().getTime()
			});
		}

		return days;
	});

	readonly monthDisplay = computed(() => {
		const days = this.displayedDays();
		if (days.length === 0) return '';
		const displayDate = days[Math.floor(days.length / 2)].fullDate;
		return `${this.hebrewMonths[displayDate.getMonth()]} ${displayDate.getFullYear()}`;
	});

	constructor() {
		this.updateScreenSize();
		this.initializeDate();
		effect(() => {
			const { startDate, endDate } = this.viewPort();
			if (this.suppliers().length > 0 && startDate && endDate) {
				this.orderStore.loadOrdersByDateRange({
					supplierIds: this.suppliers().map(s => s.id),
					startDate: this.formatDate(startDate),
					endDate: this.formatDate(endDate),
				});
			}
		});
		effect(() => {
			const ordersFromStore = this.orders();
			const suppliersFromStore = this.suppliers();

			if (suppliersFromStore.length > 0) {
				this.buildCalendarDisplay(ordersFromStore, suppliersFromStore);
			}
		});
	}

	ngOnInit(): void {
		if (typeof window !== 'undefined') {
			this.resizeObserver = new ResizeObserver(() => this.updateScreenSize());
			this.resizeObserver.observe(this.document.body);
		}
	}

	ngOnDestroy(): void { this.resizeObserver?.disconnect(); }

	private initializeDate(): void {
		const today = new Date();
		today.setHours(0, 0, 0, 0);
		this.currentDate.set(today);
		this.selectedPreviewDate.set(today);
	}

	private updateScreenSize(): void {
		if (typeof window === 'undefined') return;
		const width = window.innerWidth;
		let newSize = ScreenSizeEnum.Mobile;
		if (width >= SCREEN_SIZE_BREAKPOINTS.desktop) newSize = ScreenSizeEnum.Desktop;
		else if (width >= SCREEN_SIZE_BREAKPOINTS.tablet) newSize = ScreenSizeEnum.Tablet;
		if (newSize !== this.screenSize()) this.screenSize.set(newSize);
	}

	private getDaysToShow(): number {
		switch (this.screenSize()) {
			case ScreenSizeEnum.Desktop: return 7;
			case ScreenSizeEnum.Tablet: return 3;
			default: return 1;
		}
	}


	private hasOrderInDateRange(
		supplierId: number,
		startDate: Date,
		endDate: Date,
		ordersMap: Map<string, Order>
	): boolean {
		let currentDate = new Date(startDate);
		while (currentDate <= endDate) {
			const orderKey = `${supplierId}-${this.formatDate(currentDate)}`;
			if (ordersMap.has(orderKey)) {
				return true;
			}
			currentDate.setDate(currentDate.getDate() + 1);
		}
		return false;
	}

	private buildCalendarDisplay(orders: Order[], allSuppliers: Supplier[]): void {
		const { startDate, endDate } = this.viewPort();
		if (!startDate || !endDate) return;

		const newDaysMap = new Map<number, Day>();
		const ordersMap = new Map<string, Order>(orders.map(o => [`${o.supplierId}-${o.date}`, o]));
		const activeSuppliers = allSuppliers.filter(s => !s.isDeleted && s.status === Status.Active);
		const todayTimestamp = new Date().setHours(0, 0, 0, 0);

		// שלב 1: צור מפה של ספקים שכבר הזמינו השבוע (רק לסוג 2)
		const suppliersWithOrderThisWeek = new Set<number>();
		for (const supplier of activeSuppliers) {
			if (supplier.reminderType === ReminderType.UntilOrderDone) {
				if (this.hasOrderInDateRange(supplier.id, startDate, endDate, ordersMap)) {
					suppliersWithOrderThisWeek.add(supplier.id);
				}
			}
		}

		// שלב 2: בנה את תצוגת הימים
		let tempDate = new Date(startDate);
		while (tempDate <= endDate) {
			const day = this.createEmptyDay(new Date(tempDate));

			day.suppliers = activeSuppliers
				.map(supplier => {
					const order = ordersMap.get(`${supplier.id}-${this.formatDate(day.fullDate)}`);
					const isScheduledDay = this.isOrderDay(supplier, day.fullDate);

					// תנאי 1: הצג תמיד אם יש הזמנה קיימת
					if (order) {
						return {
							supplier,
							orderStatus: order.status,
							displayState: 'active', // 'ordered' state is handled by the badge
						};
					}

					// תנאי 2: אם זה יום מתוזמן (ולא הזמנה קיימת)
					if (isScheduledDay) {
						const isPast = day.fullDate.getTime() < todayTimestamp;

						// עבור reminderType 2, הצג רק אם אין הזמנה קיימת בכלל השבוע
						if (supplier.reminderType === ReminderType.UntilOrderDone) {
							if (!suppliersWithOrderThisWeek.has(supplier.id)) {
								return {
									supplier,
									orderStatus: OrderStatus.Empty,
									displayState: isPast ? 'missed' : 'active',
								};
							}
						}
						// עבור reminderType 1, תמיד הצג
						else {
							return {
								supplier,
								orderStatus: OrderStatus.Empty,
								displayState: isPast ? 'missed' : 'active',
							};
						}
					}

					return null; // אם אף אחד מהתנאים לא התקיים
				})
				.filter((s): s is DaySupplier => s !== null);

			newDaysMap.set(day.fullDate.getTime(), day);
			tempDate.setDate(tempDate.getDate() + 1);
		}

		this.allDays.set(newDaysMap);
	}

	private createEmptyDay(date: Date): Day {
		const today = new Date(); today.setHours(0, 0, 0, 0);
		return {
			letter: this.dayLetters[date.getDay()], date: date.getDate(), fullDate: date,
			suppliers: [], isToday: date.getTime() === today.getTime(),
		};
	}

	onPreviewDayClick(date: Date): void {
		const newDate = new Date(date);
		newDate.setHours(0, 0, 0, 0);
		this.selectedPreviewDate.set(newDate);
		this.currentDate.set(newDate);
	}

	navigateByDays(offset: number) {
		const newDate = new Date(this.currentDate());
		newDate.setDate(newDate.getDate() + offset);
		this.currentDate.set(newDate);
		this.selectedPreviewDate.set(newDate); // Sync the preview date
	}

	goToToday() {
		const today = new Date();
		today.setHours(0, 0, 0, 0);
		this.currentDate.set(today);
		this.selectedPreviewDate.set(today);
	}

	prevWeek(): void { this.navigateByDays(-this.getDaysToShow()); }
	nextWeek(): void { this.navigateByDays(this.getDaysToShow()); }

	isCurrentWeek(): boolean {
		const today = new Date();
		today.setHours(0, 0, 0, 0);

		const currentRefDate = new Date(this.currentDate());
		currentRefDate.setHours(0, 0, 0, 0);

		if (this.screenSize() !== ScreenSizeEnum.Desktop) {
			// For mobile/tablet, the old logic is fine as it's centered on the day.
			return this.formatDate(today) === this.formatDate(currentRefDate);
		}

		// For desktop, check if today is in the same week (Sun-Sat) as the reference date.
		const todaySunday = new Date(today);
		todaySunday.setDate(today.getDate() - today.getDay());

		const currentSunday = new Date(currentRefDate);
		currentSunday.setDate(currentRefDate.getDate() - currentRefDate.getDay());

		return this.formatDate(todaySunday) === this.formatDate(currentSunday);
	}

	openOrderDialog(data: DaySupplier, date: Date): void {
		if (data.displayState === 'missed') {
			return;
		}

		const existingOrder = this.orders().find(o =>
			o.supplierId === data.supplier.id && o.date === this.formatDate(date)
		);

		this.orderFlowService.openOrderDialog({
			supplier: data.supplier,
			date: date,
			existingOrder: existingOrder
		});
	}



	private formatDate(date: Date): string {
		return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
	}


	private isOrderDay(supplier: Supplier, date: Date): boolean {
		if (supplier.orderType === OrderType.ByDay) {
			return supplier.orderDays?.includes(date.getDay()) || false;
		}
		else if (supplier.orderType === OrderType.ByDate) {
			return supplier.orderDates?.includes(date.getDate()) || false;
		}
		return false;
	}


	logDay(day: any) {
		console.log(this.suppliers());
		console.log(day);
	}

}
--- END OF FILE ---
--- START OF FILE src\app\components\dashboard\dashboard.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\dashboard\dashboard.component.html ---
<app-header></app-header>

<div class="page flex w-full">
    <!-- <div class="flex w-full h-full"> -->
        @if (isMobileMenuOpen()) {
        <div @fadeIn400 class="overlay" (click)="closeMenus()"></div>
        }

        <div class="menu-wrapper" [ngClass]="{'active': isMobileMenuOpen()}">
            <app-side-menu></app-side-menu>
        </div>
        <div class="page-container">
            <router-outlet class=""></router-outlet>
        </div>
    <!-- </div> -->
    
    
</div>

<!-- <p-toast position="bottom-left" ></p-toast>  -->
--- END OF FILE ---
--- START OF FILE src\app\components\dashboard\dashboard.component.ts ---
import { RouterOutlet } from '@angular/router';
import { Component, effect, inject } from '@angular/core';
import { SuppliersComponent } from '../suppliers/suppliers.component';
import { HeaderComponent } from '../shared/header/header.component';
import { SideMenuComponent } from '../shared/side-menu/side-menu.component';
import { CommonModule } from '@angular/common';
import { MenuService } from '../../services/menu.service';
import { fadeIn400 } from '../../common/const/animations';
// import { ToastModule } from 'primeng/toast';

@Component({
	selector: 'app-dashboard',
	imports: [RouterOutlet, CommonModule, HeaderComponent, SideMenuComponent],
	templateUrl: './dashboard.component.html',
	styleUrl: './dashboard.component.css',
	animations: [fadeIn400],
	providers: [],
})
export class DashboardComponent {
	private menuService = inject(MenuService);

	public isMobileMenuOpen = this.menuService.isMobileMenuOpen;
	public isUserPopoverOpen = this.menuService.isUserPopoverOpen;


	// constructor() {
	// 	effect(() => {
	// 		this.isMobileMenuOpen = this.menuService.isMobileMenuOpen;
	// 	});
	// }
	public toggleMobileMenu() {
		this.menuService.toggleMobileMenu();
	}

	closeMenus() {
		this.menuService.closeMobileMenu();
		this.menuService.closeUserPopover();
	}


	// log menu status onInit
	ngOnInit() {
		console.log(`isMobileMenuOpen: ${this.isMobileMenuOpen}`);
		
	}



	onReject() {}
}

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\category-dialog\category-dialog.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\category-dialog\category-dialog.component.html ---
<div class="category-management">
    <div class="flex items-center gap-2 py-3">

        <p-iconfield class="w-full">
            <input #inputRef pInputText [(ngModel)]="newCategoryName" [ngModelOptions]="{ standalone: true }" [autofocus]="editingCategoryId() ? true : false" placeholder="שם קטגוריה חדשה" class="w-full" pSize="small" id="newCategoryName" />
            @if(!newCategoryName()){}
            <p-inputicon class="pi pi-times cursor-pointer" (click)="cancelEdit()"/>
        </p-iconfield>
            <button (click)="!editingCategoryId() ? addCategory() : saveEditedCategory()" class="primary md">
            <span class="material-symbols-rounded">{{ !editingCategoryId() ? 'add' : 'save' }}</span>
            <span>{{ !editingCategoryId() ? 'הוספה' : 'שמירה' }}</span>
        </button>

    </div>
    <p-table [value]="categories()" size="small" [rowHover]="true" *ngIf="categories().length">
        <ng-template pTemplate="header" let-category>
            <tr>
                <th pSortableColumn="name">שם הקטגוריה
                    <p-sortIcon field="name"></p-sortIcon>
                </th>
                <th style="width: 100px;"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-category>
            <tr>
                <td>{{ category.name }}</td>
                <td>
                    <div class="actions-cell">
                        <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square"
                            (click)="editCategory(category)" size="small" [rounded]="true"
                            severity="secondary"></p-button>
                        <p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash" class="delete-btn"
                            (click)="confirmDelete(category)" size="small" [rounded]="true"
                            severity="danger"></p-button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\category-dialog\category-dialog.component.ts ---
import { Component, signal, inject, OnInit, ViewChild, ElementRef, ChangeDetectorRef } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TooltipModule } from 'primeng/tooltip';
import { NotificationService } from '../../../services/notification.service';
import { CategoryStore } from '../../../store/category.store';
import { ApiService } from '../../../services/api.service';
import { IconField } from 'primeng/iconfield';
import { InputIcon } from 'primeng/inputicon';
import { Category } from '../../../common/models/category';

@Component({
	selector: 'app-category-dialog',
	standalone: true,
	imports: [
		CommonModule,
		FormsModule,
		TableModule,
		ButtonModule,
		InputTextModule,
		TooltipModule,
		InputIcon, 
		IconField
	],
	templateUrl: './category-dialog.component.html',
	styleUrls: ['./category-dialog.component.css'],
	providers: [],
})
export class CategoryDialogComponent implements OnInit {
	// --- Injections ---
	private readonly store = inject(CategoryStore);
	private readonly config = inject(DynamicDialogConfig);
	private apiService = inject(ApiService);
	private readonly notificationService = inject(NotificationService);
	private readonly cdr = inject(ChangeDetectorRef);
	readonly ref = inject(DynamicDialogRef);

	// --- ViewChild ---
	@ViewChild('inputRef') inputRef?: ElementRef<HTMLInputElement>;

	// --- Signals ---
	readonly categories = this.store.categories;
	readonly isLoading = this.store.isLoading;
	newCategoryName = signal('');
	editingCategoryId = signal<number | null>(null);

	private readonly supplierId: number;

	constructor() {
		this.supplierId = this.config.data?.supplierId;
		if (!this.supplierId) {
			this.notificationService.toast({ severity: 'error', detail: 'מזהה ספק לא סופק' });
			this.ref.close();
		}
	}

	ngOnInit(): void {
		this.store.loadCategories(this.supplierId);
	}

	editCategory(category: Category): void {
		this.editingCategoryId.set(category.id);
		this.newCategoryName.set(category.name);
		this.focusInput();
	}

	cancelEdit(): void {
		this.editingCategoryId.set(null);
		this.newCategoryName.set('');
	}

	private focusInput(): void {
		this.cdr.detectChanges(); // ודא שה-DOM התעדכן והשדה 
		setTimeout(() => this.inputRef?.nativeElement.focus(), 0);
	}


	addCategory(): void { // נפריד בין הוספה לעדכון
		const name = this.newCategoryName().trim();
		if (!name) return;

		const payload: Partial<Category> = { name, supplierId: this.supplierId };

		this.apiService.createCategory(payload).subscribe(response => {
			if (response.success && response.result) {
				this.notificationService.toast({ severity: 'success', detail: 'קטגוריה נוספה' });
				// סגור את הדיאלוג והחזר את הקטגוריה החדשה
				this.ref.close(response.result);
			} else {
				this.notificationService.toast({ severity: 'error', detail: response.message });
			}
		});
	}

	saveEditedCategory(): void { // פונקציה נפרדת לעדכון
		const editingId = this.editingCategoryId();
		const name = this.newCategoryName().trim();
		if (!editingId || !name) return;

		const payload: Partial<Category> = { name, supplierId: this.supplierId };

		this.apiService.updateCategory(editingId, payload).subscribe(response => {
			if (response.success && response.result) {
				// רק עדכן את ה-store. אין צורך לסגור את הדיאלוג
				this.store.updateCategory(response.result);
				this.notificationService.toast({ severity: 'success', detail: 'קטגוריה עודכנה' });
				this.cancelEdit();
			} else {
				this.notificationService.toast({ severity: 'error', detail: response.message });
			}
		});
	}

	confirmDelete(category: Category): void {
		this.notificationService.confirm({
			message: `האם אתה בטוח שברצונך למחוק את הקטגוריה "${category.name}"?`,
			header: 'מחיקת קטגוריה',
		}).subscribe(accepted => {
			if (accepted) {
				this.store.deleteCategory(category.id);
			}
		});
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\confirmation-dialog\confirmation-dialog.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\confirmation-dialog\confirmation-dialog.component.html ---
<p>confirmation-dialog works!</p>

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\confirmation-dialog\confirmation-dialog.component.ts ---
import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ButtonModule } from 'primeng/button';
import { DynamicDialogConfig, DynamicDialogRef } from 'primeng/dynamicdialog';
import { MarkdownToHtmlPipe } from "../../../pipes/markdown-to-html.pipe";

export interface ConfirmationData {
  message: string;
  icon?: string;
  header?: string;
  title?: string;
  acceptLabel?: string;
  rejectLabel?: string;
  acceptButtonClass?: string;
  rejectButtonClass?: string;
}

@Component({
  selector: 'app-confirmation-dialog',
  standalone: true,
  imports: [CommonModule, ButtonModule, MarkdownToHtmlPipe],
  template: `
    <div class="confirmation-dialog no-header">
      <div class="dialog-header">
        <!-- <h3 class="header-title">{{ title }}</h3> -->
        <i [ngClass]="icon" class="header-icon"></i>
      </div>
            <p class="dialog-message" [innerHTML]="message | markdownToHtml"></p>
      <div class="dialog-actions">
        <button class="primary md" (click)="reject()">
          <span class="material-symbols-rounded">cancel</span>
          {{rejectLabel}}
        </button>
        <button class="danger md" (click)="accept()">
          <span class="material-symbols-rounded">delete</span>
          {{acceptLabel}}
        </button>
      </div>
    </div>
  `,
  styles: [`
    .confirmation-dialog {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.5rem;
      padding: 1rem;
    }
    .dialog-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }
    .header-icon {
      font-size: 3rem;
      color: var(--primary-500);
    }
    .header-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
    }
    .dialog-message {
      font-size: 1rem;
      color: var(--grey-700);
      line-height: 1.5;
      margin: 0;
    }
    .dialog-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      width: 100%;
    }
  `]
})
export class ConfirmationDialogComponent {
  private ref = inject(DynamicDialogRef);
  private config = inject(DynamicDialogConfig);

  message: string;
  icon: string;
  // header: string;
  title:string;
  acceptLabel: string;
  rejectLabel: string;
  acceptButtonClass: string;
  rejectButtonClass: string;

  constructor() {
    const data: ConfirmationData = this.config.data || {};
    this.message = data.message || 'האם אתה בטוח?';
    this.icon = data.icon || 'pi pi-exclamation-triangle';
    // this.header = data.header || 'אישור פעולה';
    this.title = data.title || 'אישור פעולה';
    this.acceptLabel = data.acceptLabel || 'אישור';
    this.rejectLabel = data.rejectLabel || 'ביטול';
    this.acceptButtonClass = data.acceptButtonClass || 'p-button-danger';
    this.rejectButtonClass = data.rejectButtonClass || 'p-button-text';
  }

  accept(): void {
    this.ref.close(true);
  }

  reject(): void {
    this.ref.close(false);
  }
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\order-dialog\order-dialog.component.css ---
@import './../../../assets/styles/_variables.css';

/* ---------------------------------- */
/*      General Layout & Structure    */
/* ---------------------------------- */

.dialog-content {
	max-height: 80vh;
	overflow-y: auto;
	/* padding: 8px 12px 12px; */
	margin: 0 0 px 0;
	/* margin: 0 0 0px 0; */
	&::after {
		content: '';
		position: absolute;
		bottom: 0;
		right: 0;
		width: calc(100% - 4px);
		height: 24px;
		background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, white 100%);
		backdrop-filter: blur(1px);
		pointer-events: none;
	}
	.fixed-header {
		display: flex;
		flex-direction: column;
		gap: 12px;
		position: sticky; 
		top: 0;
		width: 100%;
		background: linear-gradient(to bottom, white 0%, rgba(255, 255, 255, 0) 100%);
		background-color: rgba(255, 255, 255, 0.886);
		padding: 8px 8px 0;
		z-index: 2;
		backdrop-filter: blur(2px);
	}
}

.total-price {
	padding: 1px 8px;
	border-radius: 9999px;
	font-size: 12px;
	font-weight: 500;
	line-height: 1.25rem;
	background-color: var(--green-100);
	display: flex;
	gap: 4px;
	.number-wrapper {
		display: inline-flex;
		width: 74px;
		text-align: left;
		gap: 10px;
	}
}

.category-wrapper {
	background-color: var(--grey-10);
	border-radius: var(--border-radius);
	height: 100%;
	border: 1px solid var(--grey-30);
	padding: 2px;
}

.products-container {
	display: flex;
	flex-direction: column;
	gap: 4px;
	height: 100%;
}
.product-wrapper {
	border: 1px solid var(--grey-50);
	border-radius: var(--border-radius);
	background: var(--grey-50);
	display: flex;
	flex-direction: column;
	padding: 4px 0;
	gap: 4px;
	transition: all 0.1s ease-in-out;
	box-shadow: 0 1px 2px var(--grey-200);
	cursor: pointer;
	&:hover {
		background: var(--secondary-100);
		border-color: var(--secondary-200);
	}

	&.with-quantity {
		background: var(--secondary-200);
		border-color: var(--secondary-200);
		&:hover {
			transition: background 0.5s ease-in-out borderColor 0.5s ease-in-out;
			background: var(--secondary-200);
			border-color: var(--secondary-300);
		}
	}

	&.sent-order {
		cursor: default;
	}

	&.not-in-order {
		background: var(--grey-20);
		opacity: 0.5;
		border-color: var(--grey-60);
		&:hover {
			transition: background 0.5s ease-in-out borderColor 0.5s ease-in-out;
			background: var(--grey-30);
			border-color: var(--grey-90);
		}
	}

	.product-name-wrapper {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 4px;
		grid-column: span 2;
		transition: all 0.3s ease-in-out;
		transform: translateY(2px);
		&.no-quantity {
			transform: translateY(8px);

			.product-name {
				font-weight: 400;
				color: var(--grey-700);
			}
		}

		.product-name {
			font-size: 12px;
			/* font-weight: 500; */
			color: var(--grey-800);
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			display: flex;
			align-items: center;
			border-radius: 4px;
			padding: 0 1px;
			line-height: 12px;
		}
	}

	.product-quantity-price {
		/* flex items-center justify-center gap-4 opacity-0 */
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 12px;
		opacity: 100;
		transition: all 0.3s ease-in-out;
		background: rgba(255, 255, 255, 0.4);
		transform: translateY(0) scale(1);
		max-width: 80%;
		margin: 0 auto;
		border-radius: 12px;
		padding: 1px 4px;

		&.no-quantity {
			opacity: 0;
			transform: translateY(10px) scale(0.6);
			background: rgba(255, 255, 255, 0.1);
			color: transparent;
			pointer-events: none;
		}
	}
}

.total-cost {
	font-size: 10px;
	color: var(--grey-400);
	width: 100%;
	/* min-width: 80px; */
	text-align: left;
	display: flex;
	justify-content: flex-end;
	/* position: absolute;
	left: 12px;
	bottom: 4px; */
}

.form-field textarea {
	width: 100%;
	font-size: 0.9rem;
	resize: vertical;
	border: 1px solid var(--grey-300);
	border-radius: var(--border-radius);
	padding: 0.5rem;
}

/* ---------------------------------- */
/*      Quantity Buttons & Display    */
/* ---------------------------------- */

.quantity-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 2rem;
	height: 100%;
	border-radius: 9999px;
	user-select: none;
	-webkit-tap-highlight-color: transparent;
	transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	cursor: pointer;

	i.pi {
		font-size: 12px;
	}

	&:hover:not(:disabled) {
		border-color: var(--primary-300);
		transform: translateY(-1px);
	}
	&:active:not(:disabled) {
		transform: translateY(0);
	}
	&:disabled {
		cursor: default;
		opacity: 0.1;
	}
	&:focus-visible {
		outline: 2px solid #3b82f6;
		outline-offset: 2px;
	}
}

.quantity-number {
	font-size: 12px;
	width: 24px;
	height: 20px;
	padding: 2px 6px;
	display: flex;
	align-items: center;
	justify-content: center;
	border-radius: 10px;
	opacity: 0;
	scale: 0;
	transform: translateY(5px);
	background-color: transparent;

	transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

	&.with-value {
		opacity: 1;
		scale: 1;
		transform: translateY(0);
		background-color: var(--secondary-200);
		color: var(--text-primary);
		animation: bounceIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
	}
}

.total-order-cost {
	font-size: 12px;

	/* display: flex;
	align-items: center;
	justify-content: center; */
	text-align: center;
	gap: 2px;
	border-radius: 10px;
	width: 80px;
	opacity: 0;
	scale: 0;
	transform: translateY(5px);
	background-color: transparent;
	white-space: nowrap;

	&.with-value {
		opacity: 1;
		scale: 1;
		transform: translateY(0);
		color: var(--text-primary);
	}
}

@keyframes bounceIn {
	0% {
		opacity: 0;
		scale: 0;
		transform: translateY(10px);
	}
	60% {
		opacity: 1;
		scale: 1.5;
		transform: translateY(-1px);
	}
	100% {
		opacity: 1;
		scale: 1;
		transform: translateY(0);
	}
}

/* ---------------------------------- */
/*      Drag & Drop (CDK)             */
/* ---------------------------------- */

.cdk-drag:not(.cdk-drag-disabled) {
	cursor: grab;
}
.cdk-drag:not(.cdk-drag-disabled):active {
	cursor: grabbing;
}

.category-header {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	font-size: 13px;
	font-weight: 500;
	padding-inline: 4px;
	/* text-sm font-semibold mb-1  */
}

.handle-icon {
	color: var(--grey-500);
	font-size: 0.8rem;
}

.cdk-drag-animating {
	transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

.cdk-drag-preview {
	opacity: 0.9;
	box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
	border-radius: var(--border-radius);
	z-index: 1000;
	direction: rtl;
	overflow: hidden;
	border: 1px solid var(--primary-100);
	background-color: var(--primary-10);
}

.cdk-drag-placeholder {
	opacity: 0.3;
	background: var(--grey-100);
	border: 2px dashed var(--grey-300);
	border-radius: var(--border-radius);
}

.cdk-drag-dragging .category-wrapper,
.cdk-drag-dragging .product-wrapper {
	visibility: hidden;
}

.category-placeholder {
	min-height: 150px;
	background: var(--grey-50);
	border: 2px dashed var(--grey-300);
	border-radius: var(--border-radius);
	transition: all 0.3s ease-in-out;
	box-sizing: border-box;
}

.cdk-drop-list-dragging .category-placeholder {
	border-color: var(--primary-500);
	background: var(--primary-50);
}

.empty-category-placeholder {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 12px;
	height: 100%;
	border: 2px dashed var(--grey-200);
	border-radius: 8px;
	background: var(--grey-50);
	color: var(--grey-500);
	transition: all 0.3s ease-in-out;
}

.cdk-drop-list-receiving .empty-category-placeholder {
	border-color: var(--primary-500);
	background: var(--primary-50);
}

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\order-dialog\order-dialog.component.html ---
<div class="dialog-content no-padding" #dialogContent>
  <p-confirmDialog [style]="{width: '350px'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

  <div class="flex flex-col gap-2 w-full h-full min-h-52">
    @if (supplier && date) {
      <div class="fixed-header">
        <div class="flex flex-col">
          <div class="flex items-center justify-between gap-2 flex-wrap sm:flex-nowrap">
            <div class="flex items-center gap-1 order-1">
              <div class="flex items-center gap-1">
                @if (groupedProducts().length != 0 && pageState() !== PageStates().Loading) {
                  <p-button icon="pi pi-external-link pt-0.5" size="small" [rounded]="true" [text]="true" severity="secondary" tooltipPosition="top" [pTooltip]="'לדף הספק'" (click)="navigateToSupplier()"></p-button>
                }
                <span class="dialog-header">{{ supplier.name }} </span>
                @if (groupedProducts().length != 0 && pageState() !== PageStates().Loading) {
                  |<span class="text-xs"> {{ date | date: 'dd/MM/yyyy' }}</span>
                  @if (existingOrder?.status) {
                    | <app-badge [enumValue]="existingOrder ? existingOrder.status : orderStatus" [dataArray]="orderStatusData" [size]="'md'" class="status-badge"></app-badge>
                  }
                }
              </div>
            </div>

            <p-button class="order-2 sm:order-3" icon="pi pi-times" size="small" [rounded]="true" [text]="true" severity="secondary" tooltipPosition="top" [pTooltip]="'סגירה'" (click)="onClose()"></p-button>

            <div class="flex w-full justify-between items-center order-3 sm:order-2">
              <div class="flex gap-1 items-center">
                <p-toggleswitch class="flex scale-75" [(ngModel)]="dragAndDropEnable" (onChange)="dragAndDropEnable.set($event.checked)" [disabled]="!isAdmin()"/>
                <p-button pTooltip="הדבק הזמנה מלוח ההעתקה" tooltipPosition="top" icon="pi pi-clipboard" (click)="pasteFromClipboard()" size="small" [rounded]="true" severity="secondary" [disabled]="isDisabled()"></p-button>
              </div>

              <div class="flex items-center gap-2">
                @if (canUserDelete()) {
                  <p-button [pTooltip]="orderStatus === OrderStatus.Draft ? 'מחק טיוטה' : 'מחק הזמנה'" icon="pi pi-trash" (click)="confirmRemove()" size="small" [rounded]="true" severity="danger"></p-button>
                  <span class="divider"></span>
                }
                <p-splitButton 
                  label="מילוי אוטומטי" 
                  icon="pi pi-sparkles" 
                  (onClick)="fetchSuggestions('general')" 
                  [model]="suggestionItems()"
                  [disabled]="isSuggesting()"
                  size="small"
                  severity="secondary"
                  styleClass="p-button-sm p-button-outlined"
                  [disabled]="isDisabled()">
                </p-splitButton>
                <p-button pTooltip="אפס שינויים" icon="pi pi-undo" (click)="resetForm()" size="small" [rounded]="true" severity="secondary" [disabled]="!orderChanged()"></p-button>
                <p-button pTooltip="הדפס רשימה" icon="pi pi-print" (click)="printOrder()" size="small" [rounded]="true" severity="secondary" [disabled]="!orderHasProducts() && !notes().trim()"></p-button>
                <p-button pTooltip="שמור טיוטה" icon="pi pi-save" (click)="saveOrder()" size="small" [rounded]="true" severity="secondary" [disabled]="!orderChanged()"></p-button>
                <p-button 
                    [pTooltip]="orderHasProducts() || existingOrder?.status != OrderStatus.Sent ? 'שלח בווטסאפ' : ''" 
                    icon="pi pi-whatsapp" 
                    (click)="sendOrderViaWhatsApp()" 
                    size="small" 
                    [rounded]="true" 
                    severity="secondary" 
                    [disabled]="!orderHasProducts() && !notes().trim() || existingOrder?.status == OrderStatus.Sent">
                </p-button>
              </div>
            </div>
          </div>
          <div class="h-7 mt-1" >
            @if (orderHasProducts()) {
              <div class="flex justify-end">
                <span class="total-price">
                  <span class="pl-2">סך ההזמנה:</span>
                  <span class="number-wrapper">
                    <count-up [to]="getSelectedProductsTotalCost()" [decimals]="2" size="small"></count-up>
                    <span class="w-10">₪</span>
                  </span>
                </span>
              </div>
            }
          </div>
          <p class="text-grey-xs text-left">{{ isDisabled() ? 'ההזמנה נשלחה ואינה ניתנת לעריכה.' : ''}}</p>
        </div>
      </div>

      @switch (pageState()) {
        @case (PageStates().Loading) {
          <div class="flex justify-center items-center h-96">
            <app-loader></app-loader>
          </div>
        }
        @case (PageStates().Error) {
          <div @fadeIn400 class="error-card-container">
            <div class="error-card">
              <div class="error-icon-wrapper">
                <span class="material-symbols-rounded">cloud_off</span>
              </div>
              <h3 class="error-title">אופס, משהו השתבש</h3>
              <button class="primary md retry-button">
                <span class="material-symbols-rounded">refresh</span>
                <span>נסה שוב</span>
              </button>
            </div>
          </div>
        }
        @case (PageStates().Empty) {
          <div class="flex flex-col mx-auto items-center gap-4">
            <p class="text-gray-500 col-span-2 text-center">אין מוצרים זמינים עבור ספק זה.</p>
            <button class="primary sm" tooltipPosition="top" [pTooltip]="'לדף הספק'" (click)="navigateToSupplier()">
              <span class="material-symbols-rounded">open_in_new</span>
              לדף הספק
            </button>
          </div>
        }
        @case (PageStates().Ready) {
          <div class="grid grid-cols-2 px-4" cdkDropList cdkDropListGroup cdkDropListOrientation="mixed" [cdkDropListData]="groupedProducts()" (cdkDropListDropped)="dropCategory($event)">
            @for (group of groupedProducts(); track group.categoryName; let i = $index) {
              <div class="category-drag-container" cdkDrag [cdkDragDisabled]="!dragAndDropEnable()" (cdkDragMoved)="onDragMoved($event)">
                <div class="category-wrapper">
                  <h3 class="category-header" cdkDragHandle>
                    @if(dragAndDropEnable()){<i class="pi pi-arrows-alt handle-icon"></i>}
                    {{ group.categoryName }}
                  </h3>
                  <div class="products-container"
                    cdkDropList
                    [cdkDropListData]="group.products"
                    (cdkDropListDropped)="dropProduct($event)"
                    [id]="group.categoryName + i" 
                    [cdkDropListDisabled]="!dragAndDropEnable()">
                    @for (product of group.products; track product.id) {
                      <div class="product-wrapper" cdkDrag [cdkDragDisabled]="!dragAndDropEnable()" (cdkDragMoved)="onDragMoved($event)" (click)="incrementQuantity(product.id)" 
                      [ngClass]="{ 
                        'with-quantity': getProductQuantity(product.id) > 0, 
                        'not-in-order': isDisabled() && getProductQuantity(product.id) == 0,
                        'sent-order' : existingOrder?.status == OrderStatus.Sent
                        }"
                        >
                        <div class="grid grid-cols-4">
                          <button class="quantity-btn translate-y-3" [disabled]="!canDecrement(product.id)" (click)="onMinusClick($event, product.id)" type="button">
                            <i class="pi pi-minus" [class.opacity-40]="!canDecrement(product.id)"></i>
                          </button>
                          <div class="product-name-wrapper" [class.no-quantity]="getProductQuantity(product.id) == 0">
                            <span class="product-name">{{ product.name }}</span>
                          </div>
                          <div class="flex w-full items-center justify-end">
                            <button class="quantity-btn translate-y-3" [disabled]="!canIncrement(product.id)" type="button">
                              <i class="pi pi-plus"></i>
                            </button>
                          </div>
                        </div>
                        <div class="product-quantity-price" [class.no-quantity]="getProductQuantity(product.id) === 0">
                          <span class="text-secondary-600 text-[10px]">
                            {{ getProductQuantity(product.id) | pluralizePackage : product.package }}
                          </span>
                          <span class="text-secondary-600 text-[10px]">
                            {{ getProductTotalCost(product) | currency: 'ILS' }}
                          </span>
                        </div>
                      </div>
                    } @if (group.products.length === 0) {
                      <div class="empty-category-placeholder">
                        <i class="pi pi-box text-2xl"></i>
                        <p>אין מוצרים בקטגוריה</p>
                      </div>
                    }
                  </div>
                </div>
                <div *cdkDragPlaceholder class="product-placeholder"></div>
                <div *cdkDragPlaceholder class="category-placeholder"></div>
              </div>
            }
          </div>
        
          <div class="form-field px-6 mb-6">
            <label for="notes" class="form-label">הערות</label>
            <textarea id="notes" pTextarea [(ngModel)]="notes" rows="4" [style]="{ width: '100%' }" [disabled]="isDisabled()" [placeholder]="isDisabled() ? '' : 'הוסף הערות (אופציונלי)'"></textarea>
          </div>
          



        }
      }
    }
  </div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\order-dialog\order-dialog.component.ts ---
import { ChangeDetectionStrategy, Component, inject, signal, computed, ElementRef, ViewChild } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { ButtonModule } from 'primeng/button';
import { ImageModule } from 'primeng/image';
import { InputNumberModule } from 'primeng/inputnumber';
import { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';
import { TextareaModule } from 'primeng/textarea';
import { TableModule } from 'primeng/table';
import { CommonModule } from '@angular/common';
import { BadgeComponent } from '../../shared/badge/badge.component';
import { LoaderComponent } from '../../shared/loader/loader.component';
import { MessageModule } from 'primeng/message';
import { TooltipModule } from 'primeng/tooltip';
import { DragDropModule, CdkDragDrop, moveItemInArray, transferArrayItem, CdkDragMove } from '@angular/cdk/drag-drop';
import { map, tap } from 'rxjs/operators';
import { OrderStatus, orderStatusData } from '../../../common/enums/order-status.enum';
import { Package, PackageData } from '../../../common/enums/package';
import { ApiService } from '../../../services/api.service';
import { NotificationService } from '../../../services/notification.service';
import { Router } from '@angular/router';
import { ScrollService } from '../../../services/scroll.service';
import { CreateOrderDto } from '../../../common/dto/order-create.dto';
import { fadeIn400 } from '../../../common/const/animations';
import { CountUpComponent } from "../../shared/count-up/count-up.component";
import { ConfirmationService, MenuItem } from 'primeng/api';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { OrderPrintTemplate, PrintConfig, PrintService } from '../../../services/print.service';
import { AuthStore } from '../../../store/auth.store';
import { UserRole } from '../../../common/enums/userRole.enum';
import { ToggleSwitchModule } from 'primeng/toggleswitch';
import { WhatsAppService } from '../../../services/whatsapp.service';
import { SplitButtonModule } from 'primeng/splitbutton';
import { getHebrewDayName } from '../../../pipes/hebrewDay.pipe';
import { CategoryStore } from '../../../store/category.store';
import { SupplierStore } from '../../../store/supplier.store';
import { Order } from '../../../common/models/order';
import { PageStates } from '../../../common/models/pageStates';
import { Product } from '../../../common/models/product';
import { ServiceResultContainer } from '../../../common/models/serviceResultContainer';
import { Supplier } from '../../../common/models/supplier';
import { PluralizePackagePipe } from '../../../pipes/pluralize-package.pipe';




interface GroupedProducts {
  categoryName: string;
  products: Product[];
}

@Component({
  selector: 'app-order-dialog',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    ButtonModule,
    ImageModule,
    InputNumberModule,
    TextareaModule,
    TableModule,
    BadgeComponent,
    LoaderComponent,
    MessageModule,
    TooltipModule,
    DragDropModule,
    CountUpComponent,
    ConfirmDialogModule,
    ToggleSwitchModule,
    SplitButtonModule,
    PluralizePackagePipe
  ],
  providers: [ConfirmationService, PluralizePackagePipe],
  templateUrl: './order-dialog.component.html',
  styleUrls: ['./order-dialog.component.css'],
  changeDetection: ChangeDetectionStrategy.OnPush,
  animations: [fadeIn400]
})
export class OrderDialogComponent {
  // --- Stores ---
  private readonly categoryStore = inject(CategoryStore);
  private readonly supplierStore = inject(SupplierStore);
  private readonly authStore = inject(AuthStore);

  // Injections
  private ApiService = inject(ApiService);
  private ref = inject(DynamicDialogRef);
  private config = inject(DynamicDialogConfig);
  private notificationService = inject(NotificationService);
  private router = inject(Router);
  private scrollService = inject(ScrollService);
  private printService = inject(PrintService);
  private whatsAppService = inject(WhatsAppService);

  private pluralizePipe = inject(PluralizePackagePipe);

  UserRole = UserRole;
  readonly user = this.authStore.user;
  readonly isAdmin = computed(() => {
    return this.user()?.role == UserRole.Admin
  })
  // ViewChild
  @ViewChild('dialogContent', { static: false }) dialogContent!: ElementRef;

  // Signals and Properties
  PageStates = signal(PageStates);
  pageState = signal(PageStates.Loading);

  supplier: Supplier | null = this.config.data?.supplier || null;
  date: Date | null = this.config.data?.date || null;
  existingOrder: Order | null = this.config.data?.existingOrder || null;
  orderStatus: OrderStatus = this.existingOrder?.status || OrderStatus.Empty;
  packageData = PackageData;
  orderStatusData = orderStatusData;
  OrderStatus = OrderStatus;

  availableProducts = signal<Product[]>([]);
  orderProducts = signal<{ [productId: number]: number }>({});
  notes = signal<string>('');
  orderedAvailableProducts = signal<Product[]>([]);

  public suggestionItems = computed<MenuItem[]>(() => {
    const dayName = getHebrewDayName(this.date);

    return [
      {
        label: 'לפי 10 הזמנות אחרונות',
        icon: 'pi pi-history',
        command: () => this.fetchSuggestions('general')
      },
      {
        label: `לפי 10 ימי ${dayName} אחרונים`,
        icon: 'pi pi-calendar',
        command: () => this.fetchSuggestions('daySpecific')
      }
    ];
  });
  public isSuggesting = signal(false);

  private initialOrderProducts: { [productId: number]: number } = {};
  private initialNotes: string = '';

  // Computed Signals
  readonly groupedProducts = computed<GroupedProducts[]>(() => {
    const products = this.orderedAvailableProducts();
    const grouped: { [key: string]: Product[] } = {};

    products.forEach(product => {
      const categoryName = product.categoryName || 'ללא קטגוריה';
      if (!grouped[categoryName]) {
        grouped[categoryName] = [];
      }
      grouped[categoryName].push(product);
    });

    return Object.keys(grouped).map(categoryName => ({
      categoryName,
      products: grouped[categoryName],
    }));
  });

  readonly orderHasProducts = computed<boolean>(() => {
    return Object.values(this.orderProducts()).some(quantity => quantity > 0);
  });

  readonly orderChanged = computed<boolean>(() => {
    if (this.notes() !== this.initialNotes) {
      return true;
    }
    const currentProducts = this.orderProducts();
    const initialProducts = this.initialOrderProducts;
    const allProductIds = Object.keys(currentProducts);

    if (allProductIds.length !== Object.keys(initialProducts).length) {
      return true;
    }

    return allProductIds.some(id => currentProducts[+id] !== initialProducts[+id]);
  });

  readonly isDisabled = computed(() => !!(this.existingOrder && this.existingOrder.status === OrderStatus.Sent));

  readonly dragAndDropEnable = signal<boolean>(false);

  readonly canUserDelete = computed<boolean>(() => {
    const user = this.authStore.user();
    if (!this.existingOrder) return false; // Can't delete a non-existent order
    if (user?.role === UserRole.Admin) return true; // Admin can always delete
    return !this.isDisabled(); // Other users can only delete if not disabled (i.e., not sent)
  });


  ngOnInit() {
    this.getData();
  }

  ngOnDestroy() {
    this.scrollService.stopAutoScroll();
  }


// in order-dialog.component.ts

private getData() {
    if (!this.supplier?.id) {
        this.pageState.set(PageStates.Error);
        return;
    }

    this.pageState.set(PageStates.Loading);
    this.ApiService.getProductsBySupplier(this.supplier.id).pipe(
        // ✅ התיקון כאן: השתמש ב-tap במקום map
        tap((response: ServiceResultContainer<Product[]>) => {
            if (response.success && response.result) {
                // אם יש תוצאות, טפל בהן
                if (response.result.length > 0) {
                    this.availableProducts.set(response.result);

                    const products: { [productId: number]: number } = {};
                    response.result.forEach(product => {
                        products[product.id] =
                            this.existingOrder?.orderProducts?.find(p => p.productId === product.id)?.quantity || 0;
                    });

                    this.initialOrderProducts = { ...products };
                    this.initialNotes = this.existingOrder?.notes || '';

                    this.orderProducts.set(products);
                    this.notes.set(this.initialNotes);

                    this.orderedAvailableProducts.set(response.result);
                    this.pageState.set(PageStates.Ready);
                } else {
                    // ✅ אם יש הצלחה אבל התוצאה היא מערך ריק
                    this.pageState.set(PageStates.Empty);
                }
            } else {
                // ✅ אם ה-API החזיר success: false
                this.pageState.set(PageStates.Error);
            }
        })
    ).subscribe({
        // אנחנו יכולים להשאיר את בלוק ה-next ריק, כי tap כבר עשה את העבודה
        next: () => { /* Logic is now in tap */ },
        error: () => this.pageState.set(PageStates.Error),
    });
}


  resetForm(): void {
    this.orderProducts.set({ ...this.initialOrderProducts });
    this.notes.set(this.initialNotes);
    this.notificationService.toast({
      severity: 'info',
      summary: 'איפוס',
      detail: 'השינויים בוטלו.',
      life: 2000
    });
  }

  // Product Management
  // private getDisplayedProducts(): Product[] {
  //   if (this.existingOrder?.status === OrderStatus.Sent) {
  //     return this.orderedAvailableProducts().filter(product => this.orderProducts()[product.id] > 0);
  //   }
  //   return this.orderedAvailableProducts();
  // }

  updateProductQuantity(productId: number, quantity: number | null | undefined) {
    if (this.isDisabled()) return;
    this.orderProducts.update(products => ({ ...products, [productId]: quantity ?? 0 }));
  }

  incrementQuantity(productId: number): void {
    this.updateProductQuantity(productId, (this.orderProducts()[productId] || 0) + 1);
  }

  onMinusClick(event: Event, productId: number): void {
  event.stopPropagation(); // מונע את ה-bubbling של האירוע ל-product-wrapper
  this.decrementQuantity(productId);
}

  decrementQuantity(productId: number): void {
    const currentQuantity = this.orderProducts()[productId] || 0;
    if (currentQuantity > 0) {
      this.updateProductQuantity(productId, currentQuantity - 1);
    }
  }

  getProductQuantity(productId: number): number {
    return this.orderProducts()[productId] || 0;
  }

  canDecrement(productId: number): boolean {
    return !this.isDisabled() && this.getProductQuantity(productId) > 0;
  }

  canIncrement(productId: number): boolean {
    return !this.isDisabled();
  }

  // Cost Calculations
  getProductTotalCost(product: Product): number {
    return product.cost * this.getProductQuantity(product.id);
  }

  getSelectedProductsTotalCost(): number {
    return this.availableProducts().reduce((total, product) => total + this.getProductTotalCost(product), 0);
  }

  // Order Management
  private formatDate(date: Date): string {
    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
  }


  // in src/app/components/dialogs/order-dialog/order-dialog.component.ts

  saveOrder() {
    if (!this.supplier || !this.date) return;

    // --- START OF FIX ---
    // בניית רשימת מוצרים נקייה לשליחה
    const productsForPayload = [];
    const currentOrderProducts = this.orderProducts();
    const allAvailableProducts = this.availableProducts();

    for (const productId in currentOrderProducts) {
      // ודא שהמפתח שייך לאובייקט עצמו
      if (Object.prototype.hasOwnProperty.call(currentOrderProducts, productId)) {
        const quantity = currentOrderProducts[productId];

        // הוסף ל-payload רק אם הכמות גדולה מ-0
        if (quantity > 0) {
          const productDetails = allAvailableProducts.find(p => p.id === +productId);
          const costAsNumber = productDetails ? parseFloat(productDetails.cost as any) : 0;

          productsForPayload.push({
            productId: +productId,
            name: productDetails?.name || 'Unknown Product',
            quantity: quantity,
            cost: isNaN(costAsNumber) ? 0 : costAsNumber,
          });
        }
      }
    }
    // --- END OF FIX ---

    const hasProducts = productsForPayload.length > 0;
    const hasNotes = this.notes() && this.notes().trim().length > 0;

    if (hasProducts || hasNotes) {
      const orderPayload: CreateOrderDto = {
        id: this.existingOrder?.id,
        supplierId: this.supplier.id,
        date: this.formatDate(this.date),
        status: OrderStatus.Draft,
        notes: this.notes().trim() || undefined,
        products: productsForPayload // שימוש במערך הנקי שיצרנו
      };

      console.log('--- Sending CLEANED Order Payload ---');
      console.log(JSON.stringify(orderPayload, null, 2));

      this.ref.close(orderPayload);

    } else if (this.existingOrder) {
      this.confirmRemove();
    } else {
      this.closeDialog();
    }
  }

  confirmRemove(): void {
    if (!this.existingOrder) return;

    const message = `האם למחוק את ${this.orderStatus === OrderStatus.Draft ? 'טיוטת ההזמנה' : 'ההזמנה'}?\nלא ניתן לשחזר פעולה זו.`;

    this.notificationService.confirm({
      message: message,
      header: 'אישור מחיקה',
      icon: 'pi pi-exclamation-triangle',
      acceptLabel: 'כן, מחק',
      rejectLabel: 'בטל',
    }).subscribe((accepted) => {
      if (accepted) {
        this.removeDraft();
      }
    });
  }

  private removeDraft(): void {
    if (!this.existingOrder) return;
    this.ref.close({ delete: true, orderId: this.existingOrder.id });
  }


  async sendOrderViaWhatsApp(): Promise<void> {
    if (!this.supplier || !this.date) return;

    // יצירת payload והודעה נשארת זהה
    const productsForPayload = Object.entries(this.orderProducts())
      .filter(([_, quantity]) => quantity > 0)
      .map(([productId, quantity]) => {
        const product = this.availableProducts().find(p => p.id === +productId);

        return {
          productId: +productId,
          name: product?.name || 'Unknown',
          quantity,
          package: product?.package || Package.Unit,
          notes: product?.notes || '',
        };
      });

    if (productsForPayload.length === 0 && !(this.notes() && this.notes().trim())) {
      return;
    }

    const orderPayload: CreateOrderDto = {
      id: this.existingOrder?.id,
      supplierId: this.supplier.id,
      date: this.formatDate(this.date),
      status: OrderStatus.Sent,
      notes: this.notes().trim() || undefined,
      products: productsForPayload,
    };

    const messageBody = this.createOrderMessage(productsForPayload);
    try {
      const whatsAppResult = await this.whatsAppService.sendMessageWithFallback({
        phone: this.supplier.phone,
        message: messageBody,
        countryCode: '972'
      });

      this.ref.close({
        action: 'SEND_WHATSAPP',
        payload: orderPayload,
        whatsAppResult: whatsAppResult
      });

    } catch (error) {
      console.error('Error sending WhatsApp message:', error);
      // במקרה של שגיאה קריטית, סגור עם מצב שגיאה
      this.ref.close({
        action: 'SEND_WHATSAPP',
        payload: orderPayload,
        whatsAppResult: { success: false, method: 'failed' }
      });
    }
  }



  private createOrderMessage(products: { name: string; quantity: number; package: Package; notes?: string }[]): string {
    // Create the products list with each product formatted
    const productsList = products
      .map(p => {
        // Get formatted quantity and unit using pluralizePipe
        const quantityAndUnitText = this.pluralizePipe.transform(p.quantity, p.package);
        console.log(quantityAndUnitText);

        // Get package label from PackageData or fallback to 'יחידה'
        const packageLabel = PackageData.find(pd => pd.enumValue === p?.package)?.label || 'יחידה';
        console.log(packageLabel);

        // Format each product line
        return ` ${quantityAndUnitText} ${p.name}${p.notes ? ' - ' + p.notes : ''}`;
      })
      .join('\n');

    // Initialize message body with products list
    let messageBody = productsList;

    // Add notes if they exist and are not empty
    if (this.notes() && this.notes().trim()) {
      messageBody += `\n\nהערות: ${this.notes()}`;
    }

    // Check if messageBody is empty
    if (!messageBody.trim()) {
      console.warn('Warning: Attempting to send an empty message to WhatsApp');
      return '';
    }

    // Wrap the message with RTL Unicode control characters
    return `\u202B${messageBody}\u202C`;
  }

  fetchSuggestions(mode: 'general' | 'daySpecific'): void {
    if (!this.supplier || !this.date) return;

    this.isSuggesting.set(true);
    this.ApiService.getOrderSuggestions(this.supplier.id, this.date, mode).subscribe({
      next: (response) => {
        if (response.success && response.result) {
          if (response.result.length === 0) {
            this.notificationService.toast({ severity: 'info', summary: 'אין נתונים', detail: 'לא נמצאו הזמנות קודמות לחישוב ממוצע.' });
          } else {
            this.orderProducts.update(currentProducts => {
              const newProducts = { ...currentProducts };
              response.result.forEach(suggestion => {
                newProducts[suggestion.productId] = suggestion.averageQuantity;
              });
              return newProducts;
            });
            this.notificationService.toast({ severity: 'success', detail: 'הכמויות מולאו אוטומטית.' });
          }
        }
      },
      error: () => { /* טיפול בשגיאה */ },
      complete: () => this.isSuggesting.set(false),
    });
  }

  printOrder(): void {
    const orderData = {
      supplier: this.supplier,
      date: this.date,
      products: this.availableProducts()
        .filter(p => this.getProductQuantity(p.id) > 0)
        .map(p => ({
          id: p.id,
          name: p.name,
          quantity: this.getProductQuantity(p.id)
        })),
      notes: this.notes()
    };

    const config: PrintConfig = {
      title: `הזמנה - ${this.supplier?.name}`,
      direction: 'rtl'
    };

    this.printService.printWithTemplate(orderData, new OrderPrintTemplate(), config);
  }


  async pasteFromClipboard(): Promise<void> {
    if (this.isDisabled()) return;

    try {
      const text = await navigator.clipboard.readText();
      if (!text) {
        this.notificationService.toast({ severity: 'info', detail: 'לוח ההעתקה ריק.' });
        return;
      }

      const allProducts = this.availableProducts();
      // צור עותק שניתן לשנות
      const newQuantities: { [key: number]: number } = { ...this.orderProducts() };
      let itemsFound = 0;
      let unfoundLines: string[] = [];

      const lines = text.split('\n');

      for (const line of lines) {
        const trimmedLine = line.trim();
        if (!trimmedLine) continue;

        const numbers = trimmedLine.match(/\d+/g);
        const textPart = trimmedLine.replace(/\d+/g, '').trim();

        if (!textPart) continue;

        let bestMatch: Product | undefined = undefined;
        for (const product of allProducts) {
          if (textPart.toLowerCase().includes(product.name.toLowerCase())) {
            if (!bestMatch || product.name.length > bestMatch.name.length) {
              bestMatch = product;
            }
          }
        }

        if (bestMatch) {
          const quantity = numbers && numbers.length > 0 ? parseInt(numbers[0], 10) : 1;
          if (quantity > 0) {
            // כאן TypeScript יבין את ההקשר נכון
            newQuantities[bestMatch.id] = (newQuantities[bestMatch.id] || 0) + quantity;
            itemsFound++;
          }
        } else {
          unfoundLines.push(trimmedLine);
        }
      }

      if (itemsFound > 0) {
        this.orderProducts.set(newQuantities);
        let successMessage = `זוהו והוספו ${itemsFound} פריטים.`;
        if (unfoundLines.length > 0) {
          successMessage += ` (${unfoundLines.length} שורות לא זוהו)`;
          this.notificationService.toast({ severity: 'success', summary: 'ההדבקה הצליחה חלקית', detail: successMessage, life: 5000 });
        } else {
          this.notificationService.toast({ severity: 'success', detail: successMessage });
        }
      } else {
        this.notificationService.toast({ severity: 'warn', detail: 'לא זוהו מוצרים תואמים בטקסט שהודבק.' });
      }

    } catch (err) {
      console.error('Failed to read clipboard contents: ', err);
      this.notificationService.toast({ severity: 'error', detail: 'לא ניתן לגשת ללוח ההעתקה. בדוק הרשאות דפדפן.' });
    }
  }

  skipOrder(): void {
    this.notificationService.confirm({
      message: 'האם אתה בטוח שברצונך לדלג על הזמנה זו?.',
      header: 'אישור דילוג על הזמנה',
      icon: 'pi pi-forward',
      acceptLabel: 'כן, דלג',
      rejectLabel: 'בטל',
    }).subscribe((accepted) => {
      if (accepted) {
        if (!this.supplier || !this.date) return;

        // צור payload של הזמנה ריקה בסטטוס "נשלחה"
        const skipPayload: CreateOrderDto = {
          id: this.existingOrder?.id,
          supplierId: this.supplier.id,
          date: this.formatDate(this.date),
          status: OrderStatus.Empty, // <-- סטטוס "נשלחה"
          notes: 'הזמנה זו סומנה כ"נדלגה" על ידי המשתמש.',
          products: [] // ללא מוצרים
        };

        // סגור את הדיאלוג והחזר את ה-payload
        this.ref.close(skipPayload);
      }
    });
  }

  navigateToSupplier() {
    this.ref.close(null);
    if (this.supplier) this.router.navigate(['/suppliers', this.supplier.id]);
  }

  closeDialog() {
    this.ref.close(null);
  }

  onClose(): void {
    this.ref.close(null);
  }

  // Below methods are for drag & drop, no changes needed
  dropProduct(event: CdkDragDrop<Product[]>) {
    if (event.previousContainer === event.container) moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);
    else transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);
    this.updateProductsOrderFromGroups();
  }
  dropCategory(event: CdkDragDrop<GroupedProducts[]>) {
    const currentGroups = this.groupedProducts();
    moveItemInArray(currentGroups, event.previousIndex, event.currentIndex);
    this.updateProductsOrderFromGroups(currentGroups);
  }
  private updateProductsOrderFromGroups(groups: GroupedProducts[] | null = null) {
    const newOrderedProducts: Product[] = [];
    (groups || this.groupedProducts()).forEach(group => newOrderedProducts.push(...group.products));
    this.orderedAvailableProducts.set(newOrderedProducts);
  }
  onDragMoved(event: CdkDragMove) {
    this.scrollService.onDragMoved(event, this.dialogContent);
  }

}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\orders-list-dialog\orders-list-dialog.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\orders-list-dialog\orders-list-dialog.component.html ---
<div class="orders-list-container">
	@if (isLoading()) {
	<div class="p-4 text-center">טוען רשימת הזמנות...</div>
	} @else if (orders().length > 0) {
	<p-table [value]="orders()" [scrollable]="true" scrollHeight="400px" size="small">
		<ng-template pTemplate="header">
			<tr>
				<th>ספק</th>
				<th>תאריך</th>
				<th>סטטוס</th>
				<th></th>
			</tr>
		</ng-template>
		<ng-template pTemplate="body" let-order>
			<tr [class.virtual-order]="order.status === OrderStatus.Today">
				<td class="whitespace-nowrap">{{ order.supplierName }}</td>
				<td>{{ order.date | hebrewDate }}</td>
				<td>
					<app-badge [enumValue]="order.status" [dataArray]="orderStatusData"
						[label]="order.status | orderStatusLabel">
					</app-badge>
				</td>
				<td>
					<div class="actions-cell"  >
						<p-button
						[pTooltip]="order.id ? 'צפייה / עריכה' : 'צור הזמנה'"
						tooltipPosition="top"
						[icon]="order.id ? 'pi pi-pen-to-square' : 'pi pi-expand'"
						(click)="viewOrder(order)"
						size="small"
						[rounded]="true"
						severity="secondary"
						>
						</p-button>

					</div>
				</td>
			</tr>
		</ng-template>
	</p-table>
	}
	@else
	{
	<div class="empty-state">
		<i class="pi pi-check-circle text-2xl text-green-500"></i>
		<p>אין הזמנות מתאימות להצגה.</p>
	</div>
	}
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\orders-list-dialog\orders-list-dialog.component.ts ---
import { NotificationService } from '../../../services/notification.service';
import { Component, inject, computed, effect } from '@angular/core';
import { CommonModule } from '@angular/common';
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { DynamicDialogConfig, DynamicDialogRef } from 'primeng/dynamicdialog';
import { TooltipModule } from 'primeng/tooltip';
import { OrderStatus, orderStatusData } from '../../../common/enums/order-status.enum';
import { OrderStatusPipe } from '../../../pipes/orderStatus.pipe';
import { BadgeComponent } from '../../shared/badge/badge.component';
import { OrderStore } from '../../../store/order.store';
import { HebrewDatePipe } from "../../../pipes/hebrew-date.pipe";
import { Order } from '../../../common/models/order';

@Component({
  selector: 'app-orders-list-dialog',
  templateUrl: './orders-list-dialog.component.html',
  standalone: true,
  imports: [CommonModule, TableModule, ButtonModule, TooltipModule, BadgeComponent, OrderStatusPipe, HebrewDatePipe],
})
export class OrdersListDialogComponent {
  private ref = inject(DynamicDialogRef);
  private orderStore = inject(OrderStore);
  private notificationService = inject(NotificationService);
  private config = inject(DynamicDialogConfig);

  readonly OrderStatus = OrderStatus;
  readonly orderStatusData = orderStatusData;

  readonly isLoading = this.orderStore.isLoading;

  readonly orders = computed(() => {
    const status = this.config.data?.status;
    if (status === OrderStatus.Today) {
      console.log(this.orderStore.todayOrdersComputed());      
      return this.orderStore.todayOrdersComputed();
    }
    console.log(this.orderStore.draftOrdersList());
    
    return this.orderStore.draftOrdersList();
  });



constructor() {

  }

  ngOnInit(): void {
    const displayStatus = this.config.data?.status;

    if (displayStatus === OrderStatus.Draft) {
      this.orderStore.loadDraftOrders();
    }
    // For 'Today' orders, no specific load is needed as it's a computed signal.
  }

  ngOnDestroy(): void {
  }

  viewOrder(order: Order): void {
    if (!order.id) {
      this.ref.close({ action: 'create', data: order });
    } else {
      this.ref.close({ action: 'edit', data: order });
    }
  }
  editOrder(order: Order): void {
    if (!order.id) return;
    this.ref.close({ action: 'edit', data: order });
  }

  createOrder(virtualOrder: Order): void {
    this.ref.close({ action: 'create', data: virtualOrder });
  }

  confirmRemoveDraft(order: Order): void {
    if (!order.id) return;

    this.notificationService.confirm({
      message: 'האם למחוק את טיוטת ההזמנה?',
      header: 'אישור מחיקה',
      icon: 'pi pi-exclamation-triangle',
      acceptLabel: 'כן, מחק',
      rejectLabel: 'בטל',
    }).subscribe((accepted) => {
      if (accepted) {
        this.removeDraft(order);
      }
    });
  }

  removeDraft(order: Order): void {
    this.ref.close({ action: 'delete', data: order });
  }
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\product-dialog\product-dialog.component.css ---
/* .category-input-container {
    left: 0;
    right: 0;
  }
  
  .icon-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2rem;
    height: 2rem;
    transition: background-color 0.2s;
  }
  
  .category-item-actions {
    display: none;
  }
  
  .p-select-item:hover .category-item-actions {
    display: flex;
  }
  
  /* מתאים לכתיבה RTL */
  [dir="rtl"] .category-input-container {
    transform: translateX(100%);
  }
  
  [dir="rtl"] .category-input-container.translate-x-0 {
    transform: translateX(0);
  }
  
  [dir="rtl"] .category-input-container.-translate-x-full {
    transform: translateX(-100%);
  }
 

  
.category-management {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .category-actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .category-actions input {
    flex-grow: 1;
  }
  
  .p-datatable-sm .p-datatable-tbody > tr > td {
    padding: 0.5rem;
  }
  
  .p-button-icon {
    cursor: pointer;
    margin: 0 5px;
    color: #007bff;
  }
  
  .p-button-icon.pi-trash {
    color: #dc3545;
  }
  
  .p-button-icon:hover {
    opacity: 0.8;
  }
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\product-dialog\product-dialog.component.html ---
<form [formGroup]="productForm" (ngSubmit)="onSave()">
    <div class="flex flex-col gap-4">
        
        @if(f['id'].value !== 0){
            <div class="flex w-full justify-end">
                <div class="toggle-switch" [class.active]="f['status'].value === Status.Active" (click)="toggleStatus()">
                    <input type="checkbox" formControlName="status" class="absolute w-full" />
                    <label class="toggle-switch-text" [class.active]="f['status'].value === Status.Active">פעיל</label>
                    <label class="toggle-switch-text" [class.inactive]="f['status'].value === Status.Inactive">לא פעיל</label>
                </div>
            </div>
            }
            
        <div class="flex-wrap-wrapper">
            <div class="flex-wrap-item half-width">
                <label for="name">שם</label>
                <input pInputText id="name" formControlName="name" />
                @if (f['name'].touched && f['name'].hasError('required')) {
                <small class="error-message">יש להזין שם המוצר</small>
                }
            </div>
            <div class="flex-wrap-item half-width">
                <label for="categoryId">קטגוריה</label>
                <div class="flex items-center gap-2">
                    <p-select id="categoryId" formControlName="categoryId" [options]="categories()" optionLabel="name"
                        optionValue="id" styleClass="w-full" placeholder="בחר קטגוריה" [appendTo]="'body'">
                        <ng-template #header>
                            <div class="flex pt-1 px-1">
                                <button class="custom-select-button" (click)="openCategoryDialog()" aria-label="ניהול קטגוריות">
                                    <span class="pi pi-list"></span>
                                    {{categories().length ? 'ניהול קטגוריות' : 'הוסף קטגוריה'}}
                                </button>
                            </div>
                        </ng-template>
                        <ng-template #empty>
                            <div class="flex items-center justify-center gap-1">
                                <span class="material-symbols-rounded !text-base">report</span>
                                <span class="text-xs">טרם הוזנו קטגוריות</span>
                            </div>
                        </ng-template>
                    </p-select>
                </div>
                @if (f['categoryId'].touched && f['categoryId'].hasError('required')) {
                <small class="error-message">יש לבחור קטגוריה</small>
                }
            </div>
        </div>
        <div class="flex-wrap-wrapper">
                <label for="package">אריזה</label>
                <p-select id="package" formControlName="package" [options]="packageData" optionLabel="label"
                    optionValue="enumValue" styleClass="w-full"></p-select>
        </div>
        <div class="flex-wrap-wrapper">
            <div class="flex-wrap-item half-width">
                <label for="cost">מחיר קניה</label>
                <p-inputNumber id="cost" formControlName="cost" mode="currency" currency="ILS" locale="he-IL"
                    [min]="0" placeholder="0" [showButtons]="true"></p-inputNumber>
                @if (f['cost'].touched && f['cost'].hasError('min')) {
                <small class="error-message">המחיר חייב להיות 0 או יותר</small>
                }
            </div>
            <div class="flex-wrap-item half-width">
                <label for="price">מחיר מכירה</label>
                <p-inputNumber id="price" formControlName="price" mode="currency" currency="ILS" locale="he-IL"
                    [min]="0" placeholder="0" [showButtons]="true"></p-inputNumber>
                @if (f['price'].touched && f['price'].hasError('min')) {
                <small class="error-message">המחיר חייב להיות 0 או יותר</small>
                }
            </div>
        </div>
        <div class="">
            <label for="imageUrl">כתובת תמונה</label>
            <input pInputText id="imageUrl" formControlName="imageUrl" />
        </div>
        <div class="">
            <label for="notes">הערות</label>
            <textarea class="w-full !px-6 !py-4" pTextarea id="notes" formControlName="notes" rows="4"></textarea>
        </div>
    </div>
    <div class="dialog-footer">
        <button type="button" (click)="onCancel()" class="empty md">
                <span class="material-symbols-rounded">cancel</span>
                <span>ביטול</span>
            </button>
            <button type="submit" class="primary md">
                <span class="material-symbols-rounded">{{ f['id'].value == 0 ? 'add' : 'save' }}</span>
                <span>{{ f['id'].value == 0 ? 'הוסף' : 'שמור שינויים' }}</span>
            </button>
    </div>
</form>

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\product-dialog\product-dialog.component.ts ---
import { Component, inject, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators, AbstractControl } from '@angular/forms';
import { DynamicDialogRef, DynamicDialogConfig, DialogService } from 'primeng/dynamicdialog';

// PrimeNG Modules
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { InputNumberModule } from 'primeng/inputnumber';
import { TextareaModule } from 'primeng/textarea';
import { SelectButtonModule } from 'primeng/selectbutton';
import { TooltipModule } from 'primeng/tooltip';

// App Components
import { CategoryDialogComponent } from '../category-dialog/category-dialog.component';

// App Services & Stores
import { NotificationService } from '../../../services/notification.service';
import { ApiService } from '../../../services/api.service';
import { CategoryStore } from '../../../store/category.store';

// Models, Enums, Consts

import { Package, PackageData } from '../../../common/enums/package';
import { Status, statusData } from '../../../common/enums/status.enum';
import { DialogConfig } from '../../../common/const/dialog-config';
import { markFormGroupTouched } from '../../../common/const/custom-validators';
import { Category } from '../../../common/models/category';
import { Product } from '../../../common/models/product';

@Component({
	selector: 'app-product-dialog',
	standalone: true,
	templateUrl: './product-dialog.component.html',
	styleUrls: ['./product-dialog.component.css'],
	imports: [
		CommonModule,
		ReactiveFormsModule,
		ButtonModule,
		InputTextModule,
		SelectModule,
		InputNumberModule,
		TextareaModule,
		SelectButtonModule,
		TooltipModule,
	],
	providers: [DialogService],
})
export class ProductDialogComponent implements OnInit {
	// --- Injections ---
	private fb = inject(FormBuilder);
	private ref = inject(DynamicDialogRef);
	private config = inject(DynamicDialogConfig);
	private notificationService = inject(NotificationService);
	private apiService = inject(ApiService);
	private dialogService = inject(DialogService);
	private categoryStore = inject(CategoryStore);

	// --- Enums for Template ---
	readonly packageData = PackageData;
	readonly statusData = statusData;
	readonly Status = Status;

	// --- Signals ---
	readonly categories = this.categoryStore.categories;
	readonly isLoadingCategories = this.categoryStore.isLoading;

	// --- Properties ---
	private readonly supplierId: number;
	private readonly existingProduct?: Product = this.config.data?.product;
	private readonly allProducts: Product[] = this.config.data?.products || [];

	productForm: FormGroup = this.fb.group({
		id: [],
		name: ['', Validators.required],
		categoryId: [null, Validators.required],
		package: [Package.Unit],
		cost: [null, [Validators.min(0)]],
		price: [null, [Validators.min(0)]],
		status: [{ value: Status.Active, disabled: !this.existingProduct }], // נשבית ישירות כאן
		notes: [''],
		imageUrl: [''],
		position: [0],
	});

	get f() { return this.productForm.controls }
	constructor() {
		this.supplierId = this.config.data?.supplierId || this.existingProduct?.supplierId;
		if (!this.supplierId) {
			this.notificationService.toast({ severity: 'error', detail: 'מזהה ספק לא סופק.' });
			this.ref.close();
		}
	}

	ngOnInit(): void {
		this.categoryStore.loadCategories(this.supplierId);
		console.log(this.categories());

		if (this.existingProduct) {
			this.patchForm(this.existingProduct);
		} else {
			const initialCategoryId = this.config.data?.categoryId;
			if (initialCategoryId) {
				this.productForm.patchValue({ categoryId: initialCategoryId });
			}
		}
	}

	private patchForm(product: Product): void {
		this.productForm.patchValue({
			id: product.id || 0,
			name: product.name,
			categoryId: product.categoryId,
			package: product.package || Package.Unit,
			cost: product.cost ?? null,
			price: product.price ?? null,
			status: product.status,
			notes: product.notes || '',
			imageUrl: product.imageUrl || '',
			position: product.position ?? 0,
		});
	}

	toggleStatus(): void {
		const currentStatus = this.productForm.get('status')?.value;
		const newStatus = currentStatus === Status.Active ? Status.Inactive : Status.Active;
		this.productForm.get('status')?.setValue(newStatus);
	}

	openCategoryDialog(): void {
		const dialogRef = this.dialogService.open(CategoryDialogComponent, {
			...DialogConfig,
			header: 'ניהול קטגוריות',
			data: { supplierId: this.supplierId },
		});
		dialogRef.onClose.subscribe((newCategory: Category | undefined) => {
			if (newCategory) {
				// 1. הוסף את הקטגוריה החדשה ל-Store
				this.categoryStore.addCategory(newCategory);

				// 2. בחר את ה-ID שלה בטופס
				this.productForm.patchValue({ categoryId: newCategory.id });
			}
		});
	}


	// in product-dialog.component.ts

	onSave(): void {
		markFormGroupTouched(this.productForm);
		if (this.productForm.invalid) {
			this.notificationService.toast({ severity: 'error', detail: 'יש למלא את כל השדות המסומנים באדום' });
			return;
		}

		const formValue = this.productForm.getRawValue();
		const isEditMode = !!formValue.id;

		if (this.isNameTaken(formValue.name!, formValue.id)) {
			this.notificationService.toast({ severity: 'error', detail: 'קיים מוצר בשם זה' });
			return;
		}

		if (isEditMode) {
			// --- לוגיקה לעדכון ---
			const payload = {
				name: formValue.name,
				categoryId: formValue.categoryId,
				package: formValue.package,
				price: formValue.price,
				cost: formValue.cost,
				status: formValue.status,
				notes: formValue.notes,
				imageUrl: formValue.imageUrl,
				position: formValue.position,
			};
			this.apiService.updateProduct(formValue.id, payload).subscribe({
				next: this.handleApiResponse.bind(this),
				error: this.handleApiError.bind(this)
			});

		} else {
			// --- לוגיקה ליצירה ---
			const payload = {
				name: formValue.name,
				categoryId: formValue.categoryId,
				supplierId: this.supplierId,
				position: this.calculateNewPosition(formValue.categoryId),
				package: formValue.package,
				price: formValue.price,
				cost: formValue.cost,
				status: formValue.status,
				notes: formValue.notes,
				imageUrl: formValue.imageUrl
			};
			this.apiService.addProduct(payload).subscribe({
				next: this.handleApiResponse.bind(this),
				error: this.handleApiError.bind(this)
			});
		}
	}

	// --- פונקציות עזר לטיפול בתגובה ---
	private handleApiResponse(response: any): void {
		if (response.success && response.result) {
			const formValue = this.productForm.getRawValue();
			const resultProduct = {
				...response.result,
				categoryName: this.categories().find(c => c.id === formValue.categoryId)?.name || 'ללא קטגוריה',
			};
			this.notificationService.toast({ severity: 'success', detail: response.message });
			this.ref.close(resultProduct);
		} else {
			this.notificationService.toast({ severity: 'error', detail: response.message });
		}
	}

	private handleApiError(err: any): void {
		this.notificationService.toast({ severity: 'error', detail: err.error?.message });
	}
	private isNameTaken(name: string, currentId: number): boolean {
		return this.allProducts.some(p => p.name.toLowerCase() === name.toLowerCase() && p.id !== currentId);
	}

	private calculateNewPosition(categoryId: number | null): number {
		const productsInSameCategory = this.allProducts.filter(p => p.categoryId === categoryId);
		return productsInSameCategory.length;
	}

	onCancel(): void {
		this.ref.close(null);
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\supplier-dialog\supplier-dialog.component.css ---
.grid-7 {
	/* /* grid grid-cols-7 gap-2 p-2 min-h-44 */
	display: grid;
	grid-template-columns: repeat(7, minmax(0, 1fr));
	/* height: 200px; */
	transition: all 0.4s ease-in-out;
	place-items: center;
	row-gap: 8px;
	column-gap: 8px;
	overflow: hidden;
	padding: 8px 2px;
}

.soft-bg{
	padding: 8px;
	background-color: var(--grey-20);
	border-radius: 6px;
	overflow: hidden!important;
	max-width: 400px;
	transition: all 1s ease-in-out;
	
}


/* 
::ng-deep .mat-mdc-tab-body-content {
    visibility: visible;
    overflow: hidden!important;
} */

::ng-deep .sm .mat-mdc-tab .mdc-tab__text-label{
	font-size: 10px;
	gap: 8px
	
}
::ng-deep .sm .material-symbols-rounded{
	font-size: 18px!important;
}
::ng-deep .sm .mdc-tab__ripple{
	display: none!important;
}

::ng-deep .mat-tab-body-wrapper {
  transition: height 0.4s ease-in-out;
}

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\supplier-dialog\supplier-dialog.component.html ---
<form [formGroup]="supplierForm" (ngSubmit)="onSave()">
    <div class="flex flex-col gap-4">

        @if(id.value !== 0){
        <div class="flex w-full justify-end">
            <div class="toggle-switch" [class.active]="status.value === Status.Active" (click)="toggleStatus()">
                <input type="checkbox" formControlName="status" class="absolute w-full" />
                <label class="toggle-switch-text" [class.active]="status.value === Status.Active">פעיל</label>
                <label class="toggle-switch-text" [class.inactive]="status.value === Status.Inactive">לא פעיל</label>
            </div>
        </div>
        }



        <div class="flex-wrap-wrapper">
            <div class="flex-wrap-item">
                <label for="name">שם*</label>
                <input pInputText id="name" formControlName="name" />
                @if (name.touched && name.hasError('required')) {
                <small class="error-message">יש להזין שם הספק</small>
                }
            </div>
            <div class="flex-wrap-item">
                <label for="phone">טלפון*</label>
                <input pInputText id="phone" formControlName="phone" />
                @if (phone.touched && phone.hasError('required')) {
                <small class="error-message">יש להזין טלפון</small>
                }
                @if (phone.touched && phone.hasError('pattern')) {
                <small class="error-message">מספר טלפון לא תקין (10-12 ספרות)</small>
                }
            </div>
        </div>
        <div class="flex-wrap-wrapper">
            <div class="flex-wrap-item">
                <label for="email">אימייל</label>
                <input pInputText id="email" formControlName="email" />
                @if (email.touched && email.hasError('email')) {
                <small class="error-message">כתובת אימייל לא תקינה</small>
                }
            </div>
        </div>

        <div class="form-field relative ">
            <label>מועדי הזמנה*</label>
            <mat-tab-group dir="rtl" [selectedIndex]="selectedTabIndex" class="sm soft-bg" disableRipple="true"
                (selectedIndexChange)="onTabChange($event)">
                <mat-tab>
                    <ng-template mat-tab-label>
                        <span class="material-symbols-rounded">date_range</span>
                        לפי ימים
                    </ng-template>
                        <div class="flex gap-2 justify-end w-full p-2">
                            <button type="button" class="empty xs flex items-center gap-1"
                                (click)="toggleSelectAll('orderDays')">
                                <span class="material-symbols-rounded">{{ isAllSelected('orderDays') ? 'close' :
                                    'done_all' }}</span>
                                {{ isAllSelected('orderDays') ? 'נקה הכל' : 'בחר הכל' }}
                            </button>
                        </div>

                    <div class="grid-7" aria-label="בחירת ימים">
                        @for (option of daysOptions; track option.value) {
                        <button type="button" class="chip"
                            [ngClass]="{'chip-selected': isSelected('orderDays', option.value)}"
                            (click)="toggleSelection('orderDays', option.value)">
                            {{ option.short }}
                        </button>
                        }
                    </div>
                </mat-tab>

                <mat-tab>
                    <ng-template mat-tab-label>
                        <span class="material-symbols-rounded">calendar_month</span>
                        לפי תאריכים
                    </ng-template>
                    @if (orderDates.length >= 10) {
                    <div class="flex gap-2 justify-end w-full p-2">
                        <button type="button" class="empty xs" (click)="toggleSelectAll('orderDates')">
                        <span class="material-symbols-rounded">
                            {{ isAllSelected('orderDates') ? '' : 'close'  }}
                        </span>
                        {{ isAllSelected('orderDates') ? '' : 'נקה הכל'  }}
                        </button>
                    </div>
                    }

                    <div class="grid-7" aria-label="בחירת תאריכים">
                        @for (option of datesOptions; track option.value) {
                        <button type="button" class="chip" [ngClass]="{'chip-selected': isSelected('orderDates', option.value)}"
                            (click)="toggleSelection('orderDates', option.value)">
                            {{ option.label }}
                        </button>
                        }
                    </div>
                </mat-tab>

                
            </mat-tab-group>
            @if ((orderDays.touched || formSubmitted()) && supplierForm.hasError('minSelection') && orderType.value ===
            OrderTypes.ByDay) {
            <small class="error-message">יש לבחור לפחות יום אחד</small>
            }
            @if ((orderDates.touched || formSubmitted()) && supplierForm.hasError('minSelection') && orderType.value ===
            OrderTypes.ByDate) {
            <small class="error-message">יש לבחור לפחות תאריך אחד</small>
            }
        </div>



        <div @fadeIn400 class="form-field expandable" [ngClass]="{'expanded': shouldShowReminderType()}">
            <label for="reminderType">סוג תזכורת</label>
            <p-select id="reminderType" formControlName="reminderType" [options]="reminderTypeData" optionLabel="label"
                    optionValue="enumValue" appendTo="body" styleClass="w-full">
                    
                <!-- Template for selected item -->
                <ng-template let-item pTemplate="selectedItem">
                    <div class="flex gap-1 items-center" *ngIf="item">
                        <span [ngClass]="[item.icon, '!text-sm']"></span>
                        <span>{{ item.label }}</span>
                    </div>
                </ng-template>
                
                <!-- Template for dropdown items -->
                <ng-template let-item pTemplate="item">
                    <div class="flex flex-col">
                        <div class="flex gap-1 items-center">
                            <span [ngClass]="[item.icon, '!text-sm']"></span>
                            <span>{{ item.label }}</span>
                        </div>
                        <span class="text-grey-xs">{{item.tooltip}}</span>
                    </div>
                </ng-template>
            </p-select>
            @if (reminderType.touched && reminderType.hasError('required')) {
            <small class="error-message">יש להזין סוג תזכורת</small>
            }
        </div>
        <div class="dialog-footer">
            <button type="button" (click)="onCancel()" class="empty md">
                <span class="material-symbols-rounded">cancel</span>
                <span>ביטול</span>
            </button>
            <button type="submit" class="primary md">
                <span class="material-symbols-rounded">{{ id.value == 0 ? 'add' : 'save' }}</span>
                <span>{{ id.value == 0 ? 'הוסף' : 'שמור שינויים' }}</span>
            </button>
        </div>
    </div>
</form>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\supplier-dialog\supplier-dialog.component.ts ---
import { Component, inject, signal } from '@angular/core';
import {
	AbstractControl,
	FormArray,
	FormBuilder,
	FormGroup,
	ReactiveFormsModule,
	ValidationErrors,
	ValidatorFn,
	Validators,
} from '@angular/forms';
import { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { SelectButtonModule } from 'primeng/selectbutton';
import { ToastModule } from 'primeng/toast';
import { CommonModule } from '@angular/common';
import { Status, statusData } from '../../../common/enums/status.enum';
import { ReminderType, reminderTypeData } from '../../../common/enums/reminderType';
import { MatTabsModule } from '@angular/material/tabs';
import { fadeIn400 } from '../../../common/const/animations';
import { OrderType, orderTypeData } from '../../../common/enums/order-type';
import { markFormGroupTouched } from '../../../common/const/custom-validators';
import { NotificationService } from '../../../services/notification.service';
import { ApiService } from '../../../services/api.service';
import { ServiceResultContainer } from '../../../common/models/serviceResultContainer';
import { Supplier } from '../../../common/models/supplier';


export function orderSelectionValidator(): ValidatorFn {
	return (control: AbstractControl): ValidationErrors | null => {
		if (!(control instanceof FormGroup)) {
			return null;
		}
		const formGroup = control as FormGroup;
		const orderType = formGroup.get('orderType')?.value;
		const orderDays = formGroup.get('orderDays') as FormArray;
		const orderDates = formGroup.get('orderDates') as FormArray;
		if (orderType === OrderType.ByDay && orderDays.length === 0) {
			// console.log('Validation error: No days selected');
			return { minSelection: true };
		}
		if (orderType === OrderType.ByDate && orderDates.length === 0) {
			// console.log('Validation error: No dates selected');
			return { minSelection: true };
		}
		return null;
	};
}

@Component({
	selector: 'app-supplier-dialog',
	standalone: true,
	imports: [
		CommonModule,
		ReactiveFormsModule,
		ButtonModule,
		InputTextModule,
		SelectModule,
		SelectButtonModule,
		MatTabsModule,
		ToastModule,
	],
	templateUrl: './supplier-dialog.component.html',
	styleUrl: './supplier-dialog.component.css',
	animations: [fadeIn400,

	],
})
export class SupplierDialogComponent {
	private fb = inject(FormBuilder);
	private ref = inject(DynamicDialogRef);
	private config = inject(DynamicDialogConfig);
	private notificationService = inject(NotificationService);
	private apiService = inject(ApiService);

	statusData = statusData;
	Status = Status;
	OrderTypes = OrderType;
	orderTypeData = orderTypeData;
	reminderTypeData = reminderTypeData;

	formSubmitted = signal<boolean>(false);

	supplierForm: FormGroup = this.fb.group(
		{
			id: [],
			name: ['', Validators.required],
			status: [Status.Active, Validators.required],
			phone: ['', [Validators.required, Validators.pattern(/^\+?\d{10,12}$/)]],
			orderType: [OrderType.ByDay, Validators.required],
			orderDays: this.fb.array([]),
			orderDates: this.fb.array([]),
			reminderType: [ReminderType.EachTime, Validators.required],
			email: ['', [Validators.email]],
			image: [''],
		},
		{ validators: orderSelectionValidator() },
	);

	get id(): AbstractControl {
		return this.supplierForm.get('id') as AbstractControl<number>;
	}
	get name(): AbstractControl {
		return this.supplierForm.get('name') as AbstractControl<string>;
	}
	get status(): AbstractControl {
		return this.supplierForm.get('status') as AbstractControl<Status>;
	}
	get phone(): AbstractControl {
		return this.supplierForm.get('phone') as AbstractControl<string>;
	}
	get orderType(): AbstractControl {
		return this.supplierForm.get('orderType') as AbstractControl<OrderType>;
	}
	get orderDays(): FormArray {
		return this.supplierForm.get('orderDays') as FormArray;
	}
	get orderDates(): FormArray {
		return this.supplierForm.get('orderDates') as FormArray;
	}
	get reminderType(): AbstractControl {
		return this.supplierForm.get('reminderType') as AbstractControl<ReminderType>;
	}
	get email(): AbstractControl {
		return this.supplierForm.get('email') as AbstractControl<string | null>;
	}
	get image(): AbstractControl {
		return this.supplierForm.get('image') as AbstractControl<string | null>;
	}

	daysOptions = [
		{ label: 'ראשון', short: "א'", value: 0 },
		{ label: 'שני', short: "ב'", value: 1 },
		{ label: 'שלישי', short: "ג'", value: 2 },
		{ label: 'רביעי', short: "ד'", value: 3 },
		{ label: 'חמישי', short: "ה'", value: 4 },
		{ label: 'שישי', short: "ו'", value: 5 },
		{ label: 'שבת', short: "ש'", value: 6 },
	];

	datesOptions = Array.from({ length: 31 }, (_, i) => ({
		label: `${i + 1}`,
		value: i + 1,
	}));

	selectedTabIndex: number = 0;

	ngOnInit() {
		const supplier = this.config.data?.supplier;
		if (!supplier || supplier.id === 0) {
			this.status.disable();
		}

		if (supplier && supplier.id) {
			this.patchForm(supplier);
		}
	}

	patchForm(supplier: Supplier) {
		this.selectedTabIndex = supplier.orderType === OrderType.ByDay ? 0 : 1;
		const orderDaysArray = this.supplierForm.get('orderDays') as FormArray;
		(supplier.orderDays || []).forEach((day) => {
			orderDaysArray.push(this.fb.control(day));
		});

		const orderDatesArray = this.supplierForm.get('orderDates') as FormArray;
		(supplier.orderDates || []).forEach((date) => {
			orderDatesArray.push(this.fb.control(date));
		});

		this.supplierForm.patchValue({
			id: supplier.id,
			name: supplier.name,
			status: supplier.id ? supplier.status : Status.Active,
			phone: supplier.phone,
			orderType: supplier.orderType,
			reminderType: supplier.reminderType,
			email: supplier.email,
			image: supplier.image,
		});
	}

	onTabChange(activeTabIndex: number): void {
		this.selectedTabIndex = activeTabIndex;
		const orderType = activeTabIndex === 0 ? OrderType.ByDay : OrderType.ByDate;
		this.supplierForm.get('orderType')?.setValue(orderType);

		const arrayToClear = activeTabIndex === 0 ? this.orderDates : this.orderDays;
		arrayToClear.clear();

		this.orderDays.markAsPristine();
		this.orderDays.markAsUntouched();
		this.orderDates.markAsPristine();
		this.orderDates.markAsUntouched();
	}

	toggleSelection(arrayName: 'orderDays' | 'orderDates', value: number) {
		const formArray = this.supplierForm.get(arrayName) as FormArray;
		const index = formArray.value.indexOf(value);

		if (arrayName === 'orderDates') {
			if (index !== -1) {
				// כבר קיים – הסר אותו
				formArray.removeAt(index);
			} else {
				// לא קיים – אם יש כבר 5 תאריכים, הסר את הראשון
				if (formArray.length >= 5) {
					formArray.removeAt(0);
				}
				formArray.push(this.fb.control(value));
			}
		} else {
			// orderDays – רגיל
			if (index === -1) {
				formArray.push(this.fb.control(value));
			} else {
				formArray.removeAt(index);
			}
		}

		formArray.markAsDirty();
		formArray.markAsTouched();
		this.supplierForm.updateValueAndValidity();
	}



	isSelected(arrayName: 'orderDays' | 'orderDates', value: number): boolean {
		return (this.supplierForm.get(arrayName) as FormArray).value.includes(value);
	}

	shouldShowReminderType(): boolean {
		const daysLength = this.supplierForm.get('orderDays')?.value?.length || 0;
		const datesLength = this.supplierForm.get('orderDates')?.value?.length || 0;
		return daysLength > 1 || datesLength > 1;
	}

	onSave() {
		this.formSubmitted.set(true);
		markFormGroupTouched(this.supplierForm);
		this.orderDays.markAsTouched();
		this.orderDates.markAsTouched();
		this.orderDays.updateValueAndValidity();
		this.orderDates.updateValueAndValidity();
		if (this.supplierForm.invalid && this.formSubmitted()) {
			this.notificationService.toast({
				severity: 'error',
				detail: 'יש למלא את כל השדות המסומנים באדום',
			});
			return;
		}

		const formValue = this.supplierForm.getRawValue();
		const isEditMode = !!formValue.id;

		// 1. בנה payload נקי
		const payload = {
			name: formValue.name,
			phone: formValue.phone,
			email: formValue.email,
			status: formValue.status,
			orderType: formValue.orderType,
			orderDays: [...formValue.orderDays].sort((a, b) => a - b),
			orderDates: [...formValue.orderDates].sort((a, b) => a - b),
			reminderType: formValue.reminderType,
			image: formValue.image,
		};

		const suppliers = this.config.data?.suppliers || [];
		const isNameTaken = suppliers.some(
			(s: Supplier) => s.name === payload.name && s.id !== formValue.id
		);
		if (isNameTaken) {
			this.notificationService.toast({ severity: 'error', detail: 'שם הספק כבר קיים' });
			return;
		}

		const apiCall$ = isEditMode
			? this.apiService.updateSupplier(formValue.id, payload)
			: this.apiService.addSupplier(payload);

		apiCall$.subscribe({
			next: (response) => {
				if (response.success && response.result) {
					this.notificationService.toast({ severity: 'success', detail: response.message });
					this.ref.close(response.result); // החזר את הישות המעודכנת/החדשה
				} else {
					this.notificationService.toast({ severity: 'error', detail: response.message });
				}
			},
			error: (err) => {
				this.notificationService.toast({
					severity: 'error',
					detail: err.error?.message || 'אירעה שגיאה',
				});
			}
		});
	}

	isAllSelected(arrayName: 'orderDays' | 'orderDates'): boolean {
		const formArray = this.supplierForm.get(arrayName) as FormArray;
		const options = arrayName === 'orderDays' ? this.daysOptions : this.datesOptions;

		if (formArray.length === options.length) {
			const allValuesSelected = options.every((option) =>
				formArray.value.includes(option.value),
			);
			return allValuesSelected;
		}

		return false;
	}

	toggleSelectAll(arrayName: 'orderDays' | 'orderDates') {
		const formArray = this.supplierForm.get(arrayName) as FormArray;
		const options = arrayName === 'orderDays' ? this.daysOptions : this.datesOptions;

		if (this.isAllSelected(arrayName)) {
			formArray.clear();
		} else {
			formArray.clear();
			options.forEach((option) => {
				formArray.push(this.fb.control(option.value));
			});
		}

		formArray.markAsDirty();
		formArray.markAsTouched();
		this.supplierForm.updateValueAndValidity();
	}

	selectAll(arrayName: 'orderDays' | 'orderDates') {
		const formArray = this.supplierForm.get(arrayName) as FormArray;
		formArray.clear();

		const options = arrayName === 'orderDays' ? this.daysOptions : this.datesOptions;

		options.forEach((option) => {
			formArray.push(this.fb.control(option.value));
		});

		formArray.markAsDirty();
		formArray.markAsTouched();
		this.supplierForm.updateValueAndValidity();
	}

	/**
	 * מנקה את כל הבחירות במערך
	 * @param arrayName שם המערך (orderDays או orderDates)
	 */
	clearAll(arrayName: 'orderDays' | 'orderDates') {
		const formArray = this.supplierForm.get(arrayName) as FormArray;
		formArray.clear();
		formArray.markAsDirty();
		formArray.markAsTouched();
		this.supplierForm.updateValueAndValidity();
	}
	onCancel() {
		this.ref.close();
	}

	onToggleChange(event: Event): void {
		console.log(event);

		const isChecked = (event.target as HTMLInputElement).checked;
		this.status.setValue(isChecked ? Status.Active : Status.Inactive);
	}

	toggleStatus(): void {
		this.status.setValue(this.status.value == Status.Active ? Status.Inactive : Status.Active);
	}
}

--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\user-dialog\user-dialog.component.css ---
/* Styling for the password requirements list */
.password-rules {
  list-style-type: none;
  padding: 0 1rem;
  margin: 0;
  font-size: 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  li {
   display: flex;
   align-items: center;
   gap: 0.5rem;
   color: var(--grey-500); 
   transition: color 0.3s ease;
  }
  
  li .pi {
   font-size: 0.8rem;
   transition: color 0.3s ease;
   color: var(--red-400); 
  }
  
  
  li.valid span {
   color: var(--green-600); 
   text-decoration: line-through; 
  }
  
  li.valid .pi {
   color: var(--green-500); 
  }
  
}
:host {
  --p-password-strength-weak-background: linear-gradient(135deg, var(--red-500) 0%, var(--red-600) 50%, var(--red-700) 100%);
  --p-password-strength-medium-background: linear-gradient(135deg, var(--yellow-500) 0%, var(--yellow-600) 50%, var(--yellow-700) 100%);
  --p-password-strength-strong-background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 50%, var(--primary-700) 100%);
}

::ng-deep .p-password-meter-text{
  font-size: 12px;
  padding: 0;
  margin: auto0;
  
}


.image-upload-container {
    width: 100%;
    max-width: 240px;
    margin-top: 0.25rem;
    margin-bottom: 0.5rem;
    
    .image-dropzone {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
        border: 1px dashed var(--grey-300);
        border-radius: var(--border-radius);
        background-color: var(--grey-50);
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        position: relative;
        min-height: 100px;
        
        &:hover {
            border-color: var(--primary-300);
            background-color: var(--primary-50);
        }
        
        &.dragging-over {
            border-color: var(--primary-500);
            background-color: var(--primary-100);
            transform: scale(1.01);
        }
        
        .upload-icon {
            color: var(--grey-500);
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        .upload-text {
            color: var(--grey-600);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            text-align: center;
            font-weight: 500;
        }
        
        .upload-hint {
            color: var(--grey-400);
            font-size: 0.7rem;
            text-align: center;
            margin: 0.1rem 0;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
    }
    
    /* Loading state */
    .image-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100px;
        background-color: var(--grey-50);
        border-radius: var(--border-radius);
        border: 1px solid var(--grey-100);
    }
    
    /* Preview state */
    .image-preview-container {
        border-radius: var(--border-radius);
        overflow: hidden;
        background-color: var(--grey-20);
        border: 1px solid var(--grey-100);
        box-shadow: var(--box-shadow);
        transition: all 0.3s ease;
        
        .image-preview-wrapper {
            display: flex;
            flex-direction: column;
            position: relative;
            
            .image-preview {
                display: flex;
                flex-direction: column;
                padding: 0.5rem;
                
                .image {
                    width: 100%;
                    height: 120px;
                    object-fit: cover;
                    border-radius: calc(var(--border-radius) - 2px);
                    background-color: var(--grey-30);
                }
            }
            
            .preview-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem;
                background-color: var(--grey-50);
                border-top: 1px solid var(--grey-100);
                
                .file-details {
                    display: flex;
                    flex-direction: column;
                    
                    .file-name {
                        
                        font-weight: 500;
                        color: var(--grey-800);
                        margin-bottom: 0.1rem;
                        font-size: 0.7rem;
                        overflow: hidden;
                        text-overflow: ellipsis;
                        white-space: nowrap;
                        max-width: 150px;
                        direction: rtl;
                    }
                    
                    .file-size {
                        color: var(--grey-500);
                        font-size: 0.65rem;
                        direction: rtl;
                    }
                }
                
                .preview-actions {
                    display: flex;
                    
                    .remove-button {
                        padding: 0.25rem;
                        background-color: var(--red-100);
                        color: var(--red-600);
                        border: none;
                        border-radius: calc(var(--border-radius) - 2px);
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.2s;
                        width: 24px;
                        height: 24px;
                        
                        &:hover {
                            background-color: var(--red-200);
                        }
                    }
                }
            }
        }
    }
}

/* Animation */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in {
    animation: fadeIn 0.3s ease forwards;
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\user-dialog\user-dialog.component.html ---
<form [formGroup]="userForm" (ngSubmit)="onSave()">
    <div class="flex flex-col gap-4">
        @if(id.value !== 0){
        <div class="flex w-full justify-end">
            <div class="toggle-switch" [class.active]="status.value === Status.Active" (click)="toggleStatus()">
                <input type="checkbox" formControlName="status" class="absolute w-full" />
                <label class="toggle-switch-text" [class.active]="status.value === Status.Active">פעיל</label>
                <label class="toggle-switch-text" [class.inactive]="status.value === Status.Inactive">לא פעיל</label>
            </div>
        </div>
        }

        <div class="flex flex-col relative">
            <label for="email">אימייל*</label>
            <input pInputText id="email" formControlName="email" #emailRef />
            @if (email.touched && email.hasError('required')) {
            <small class="error-message">יש להזין כתובת אימייל</small>
            }
            @if (email.touched && email.hasError('email')) {
            <small class="error-message">כתובת אימייל לא תקינה</small>
            }
        </div>

        <div class="flex-wrap-wrapper">
            <div class="flex-wrap-item">
                <label for="username">שם*</label>
                <input pInputText id="username" formControlName="username" />
                @if (username.touched && username.hasError('required')) {
                <small class="error-message">יש להזין שם משתמש</small>
                }
            </div>

            @if (id.value === 0) {
            <div class="flex-wrap-item">
                <label for="password">סיסמה</label>
                <!-- ✅ Use the new password component -->
                <app-password-input
                    #passwordInputComp
                    inputId="password"
                    formControlName="password"
                    [minLength]="8"
                    [useCustomValidator]="true"
                    autocomplete="new-password">
                </app-password-input>
            </div>
            }
            
            <div class="flex-wrap-item">
                <label for="role">תפקיד*</label>
                <p-select id="role" formControlName="role" [options]="userRoleData" 
                    optionLabel="label" optionValue="enumValue" appendTo="body" styleClass="w-full">
        
                    <ng-template #selectedItem let-selectedOption>
                        <div class="flex items-center gap-2 text-xs" *ngIf="selectedOption">
                            <span class="" [ngClass]="selectedOption.icon"></span>
                            <span>{{ selectedOption.label }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-role #item>
                        <div class="flex items-center gap-2 text-xs">
                            <span class="" [ngClass]="role.icon"></span>
                            <span>{{ role.label }}</span>
                        </div>
                    </ng-template>
                </p-select>
                @if (role.touched && role.hasError('required')) {
                <small class="error-message">יש לבחור תפקיד</small>
                }
            </div>

            <div class="flex-wrap-item">
                <label for="phone">טלפון</label>
                <input pInputText id="phone" formControlName="phone" />
                @if (phone.touched && phone.hasError('pattern')) {
                <small class="error-message">מספר טלפון לא תקין (10-12 ספרות)</small>
                }
            </div>
        </div>

        <div class="flex w-full justify-between">
            <label for="image">תמונת פרופיל</label>
            <div class="image-upload-container">
                <!-- Drop Or Select image-->
                @if (!imagePreview() && !isImageLoading()) {
                <div class="image-dropzone fade-in" [class.dragging-over]="isDraggingOver()"
                    (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
                    <i class="pi pi-image upload-icon"></i>
                    <p class="upload-text">גרור תמונה לכאן או לחץ לבחירה</p>
                    <p class="upload-hint">PNG, JPG או GIF</p>
                    <p class="upload-hint">(עד 5MB)</p>
                    <input type="file" id="image" class="file-input" accept="image/*"
                        (change)="onImageUpload($event)" />
                </div>
                }

                <!-- Loader -->
                @if (isImageLoading()) {
                <div class="image-loading fade-in">
                    <p-progressSpinner strokeWidth="4" [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
                </div>
                }

                <!-- Preview -->
                @if (imagePreview() && !isImageLoading()) {
                <div class="image-preview-container fade-in">
                    <div class="image-preview-wrapper">
                        <div class="image-preview">
                            <img [src]="imagePreview()" alt="תמונת פרופיל" class="image" />
                        </div>
                        <div class="preview-info">
                            <div class="file-details">
                                <span class="file-name">{{ image.value?.name || 'תמונת פרופיל' }}</span>
                                <span class="file-size">{{ image.value ? formatSize(image.value.size) : '' }}</span>
                            </div>
                            <div class="preview-actions">
                                <button type="button" class="remove-button" (click)="onRemoveFile()">
                                    <i class="pi pi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>

        <div class="dialog-footer">
            <button type="button" (click)="onCancel()" class="empty md">
                <span class="material-symbols-rounded">cancel</span>
                <span>ביטול</span>
            </button>
            <button type="submit" class="primary md">
                <span class="material-symbols-rounded">{{ id.value == 0 ? 'add' : 'save' }}</span>
                <span>{{ id.value == 0 ? 'הוסף' : 'שמור שינויים' }}</span>
            </button>
        </div>
    </div>
</form>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\user-dialog\user-dialog.component.ts ---
import { Component, computed, effect, ElementRef, inject, signal, ViewChild } from '@angular/core';
import { AbstractControl, FormBuilder, FormGroup, ReactiveFormsModule, Validators, } from '@angular/forms';
import { Status, statusData } from '../../../common/enums/status.enum';
import { fadeIn400 } from '../../../common/const/animations';
import { detailedPasswordValidator, markFormGroupTouched } from '../../../common/const/custom-validators';
import { NotificationService } from '../../../services/notification.service';
import { ApiService } from '../../../services/api.service';
import { CommonModule } from '@angular/common';
import { UserRole, userRoleData } from '../../../common/enums/userRole.enum';
import { environment } from '../../../../environments/environment';
import { User } from '../../../common/models/user';
import { CreateUserDto } from '../../../common/dto/user-create.dto';
import { HttpErrorResponse } from '@angular/common/http';
import { AuthStore } from '../../../store/auth.store';

import { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { SelectButtonModule } from 'primeng/selectbutton';
import { ToastModule } from 'primeng/toast';
import { ProgressSpinnerModule } from 'primeng/progressspinner';
import { ToggleSwitchModule } from 'primeng/toggleswitch';
import { PasswordInputComponent } from '../../shared/password-input/password-input.component';

@Component({
	selector: 'app-user-dialog',
	templateUrl: './user-dialog.component.html',
	styleUrl: './user-dialog.component.css',
	animations: [fadeIn400],
	standalone: true,
	imports: [
		CommonModule,
		ReactiveFormsModule,
		ButtonModule,
		InputTextModule,
		SelectModule,
		SelectButtonModule,
		ToastModule,
		ProgressSpinnerModule,
		ToggleSwitchModule,
		PasswordInputComponent,
	],
})
export class UserDialogComponent {
	private fb = inject(FormBuilder);
	private ref = inject(DynamicDialogRef);
	private config = inject(DynamicDialogConfig);
	private notificationService = inject(NotificationService);
	private apiService = inject(ApiService);

	private readonly authStore = inject(AuthStore);

	readonly isCurrentUserAdmin = computed(() => this.authStore.user()?.role === UserRole.Admin);

	@ViewChild('emailRef') emailRef!: ElementRef;
	@ViewChild('passwordInputComp') passwordInputComp!: PasswordInputComponent; 

	statusData = statusData;
	Status = Status;
	userRoleData = userRoleData.slice(1);
	backendUrl = environment.apiUrl;

	imagePreview = signal<string | null>(null);
	isDraggingOver = signal<boolean>(false);
	isImageLoading = signal<boolean>(false);
	formSubmitted = signal<boolean>(false);
	public readonly passwordLength = signal(8);

	readonly isDisabled = computed(() => { return this.isCurrentUserAdmin() && this.id.value === 0; });

	constructor() {
		effect(() => {
			// const disabled = this.isDisabled();
			// if (disabled) {
			// 	this.role.disable();
			// } else {
			// 	this.role.enable();
			// }
			this.role.disable()
		});
	}

	userForm: FormGroup = this.fb.group({
		id: [0],
		username: ['', Validators.required],
		status: [Status.Active, Validators.required],
		phone: ['', Validators.pattern(/^\+?\d{10,12}$/)],
		email: ['', [Validators.required, Validators.email]],
		role: ['', Validators.required],
		password: ['', [Validators.required, detailedPasswordValidator()]],
		image: [null],
	});

	get id(): AbstractControl {
		return this.userForm.get('id') as AbstractControl<number>;
	}
	get username(): AbstractControl {
		return this.userForm.get('username') as AbstractControl<string>;
	}
	get status(): AbstractControl {
		return this.userForm.get('status') as AbstractControl<Status>;
	}
	get phone(): AbstractControl {
		return this.userForm.get('phone') as AbstractControl<string>;
	}
	get password(): AbstractControl {
		return this.userForm.get('password') as AbstractControl<string>;
	}
	get email(): AbstractControl {
		return this.userForm.get('email') as AbstractControl<string>;
	}
	get role(): AbstractControl {
		return this.userForm.get('role') as AbstractControl<UserRole>;
	}
	get image(): AbstractControl {
		return this.userForm.get('image') as AbstractControl<File | null>;
	}

	ngOnInit() {
		const userToEdit = this.config.data?.user;

		if (userToEdit) { 
			this.userForm.removeControl('password');
			this.patchForm(userToEdit);
		} 
		else { 
			this.status.disable();

			// ✅ התיקון הקריטי כאן
			if (this.isCurrentUserAdmin()) {
				// אם המשתמש המחובר הוא Admin, קבע את התפקיד כ-User ונטרל את השדה
				this.role.setValue(UserRole.User);
				this.role.disable();
			}
		}

		setTimeout(() => {
			if (this.emailRef) {
				this.emailRef.nativeElement.focus();
			}
		});
	}

	patchForm(user: User) {
		console.log(`userId: ${user.id}`);

		this.userForm.patchValue({
			id: user.id ?? 0,
			username: user.username,
			status: user.id ? user.status : Status.Active,
			phone: user.phone,
			email: user.email,
			role: user.role,
			image: null,
		});
		if (user.image && user.image !== '/Uploads/undefined') {
			console.log(user.image);
			this.imagePreview.set(this.getImageUrl(user.image));
		}
	}

	getImageUrl(image: string): string {
		if (!image) return '';
		if (image.startsWith('http')) return image;
		return `${this.backendUrl}${image}`;
	}

	onDragOver(event: DragEvent) {
		event.preventDefault();
		this.isDraggingOver.set(true);
	}

	onDragLeave(event: DragEvent) {
		event.preventDefault();
		this.isDraggingOver.set(false);
	}

	onDrop(event: DragEvent) {
		event.preventDefault();
		this.isDraggingOver.set(false);
		const file = event.dataTransfer?.files[0];
		if (file) {
			this.handleImageFile(file);
		}
	}

	onImageUpload(event: Event) {
		const input = event.target as HTMLInputElement;
		const file = input.files?.[0];
		if (file) {
			this.handleImageFile(file);
		}
	}

	private handleImageFile(file: File) {
		if (!file.type.startsWith('image/')) {
			this.notificationService.toast({
				severity: 'error',
				detail: 'נא להעלות קובץ תמונה (PNG, JPG, GIF)',
			});
			return;
		}
		if (file.size > 5000000) {
			this.notificationService.toast({
				severity: 'error',
				detail: 'גודל התמונה חייב להיות עד 5MB',
			});
			return;
		}
		this.isImageLoading.set(true);
		setTimeout(() => {
			this.image.setValue(file);
			const reader = new FileReader();
			reader.onload = () => {
				this.imagePreview.set(reader.result as string);
				this.isImageLoading.set(false);
			};
			reader.readAsDataURL(file);
		}, 500); // סימולציה קצרה לטעינה
	}

	onRemoveFile() {
		this.image.setValue(null);
		this.imagePreview.set(null);
	}

	formatSize(bytes: number): string {
		if (bytes === 0) return '0 B';
		const k = 1024;
		const sizes = ['B', 'KB', 'MB', 'GB'];
		const i = Math.floor(Math.log(bytes) / Math.log(k));
		return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
	}

	onSave(): void {
		this.formSubmitted.set(true);
		markFormGroupTouched(this.userForm);

		if (this.password && this.passwordInputComp) {
			this.passwordInputComp.markAsTouched();
		}
		
		if (this.userForm.invalid) {
			this.notificationService.toast({
				severity: 'error',
				detail: 'יש למלא את כל השדות המסומנים באדום',
			});
			return;
		}

		// 1. Build the FormData object
		const formData = this.createFormData();

		// 2. Determine if it's an update or a new registration
		if (this.id.value) {
			this.updateExistingUser(this.id.value, formData);
		} else {
			this.registerNewUser(formData);
		}
	}

	private createFormData(): FormData {
		const formData = new FormData();
		const formValue = this.userForm.getRawValue();;
		console.log(formValue);

		// Append core fields
		formData.append('email', formValue.email);
		formData.append('username', formValue.username);
		formData.append('role', formValue.role.toString());
		formData.append('status', formValue.status.toString());

		// Append optional fields only if they have a value
		if (formValue.phone) {
			formData.append('phone', formValue.phone);
		}
		if (formValue.password) {
			formData.append('password', formValue.password);
		}
		if (formValue.image instanceof File) {
			formData.append('image', formValue.image, formValue.image.name);
		}

		console.log("--- FormData Content ---");
		for (let [key, value] of formData.entries()) {
			console.log(`${key}:`, value);
		}
		console.log("------------------------");

		return formData;
	}

	private updateExistingUser(id: number, formData: FormData): void {
		this.apiService.updateUser(id, formData).subscribe({
			next: (response) => {
				if (response.success && response.result) {
					this.ref.close(response.result);
				} else {
					this.notificationService.toast({ severity: 'error', detail: response.message });
				}
			},
			error: (err: HttpErrorResponse) => {
				this.notificationService.toast({
					severity: 'error',
					detail: err.error?.message || 'שגיאה בעדכון המשתמש',
				});
			}
		});
	}

	private registerNewUser(formData: FormData): void {
		this.apiService.addUser(formData).subscribe({
			next: (response) => {
				if (response.success && response.result) {
					this.ref.close(response.result);
				} else {
					this.notificationService.toast({ severity: 'warn', detail: response.message || 'הפעולה לא הצליחה' });
				}
			},
			error: (err: HttpErrorResponse) => {
				this.notificationService.toast({
					severity: 'error',
					detail: err.error?.message || 'שגיאה לא צפויה אירעה'
				});
			}
		});
	}

	onCancel() {
		this.ref.close();
	}

	toggleStatus(): void {
		this.status.setValue(this.status.value === Status.Active ? Status.Inactive : Status.Active);
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\whatsapp-instruction-dialog\whatsapp-instruction-dialog.component.css ---
/* whatsapp-instruction.component.css */
@import '../../../assets/styles/_variables.css'; /* ייבוא משתני הצבעים של הפרויקט */

:host {
    direction: rtl;
}

.instruction-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 1rem;
}

.instruction-card {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    max-width: 420px;
    width: 100%;
    overflow: hidden;
    border: 1px solid var(--grey-100);
}

/* --- Header --- */
.instruction-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--grey-200);
}

.icon-wrapper {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.icon {
    font-size: 24px;
}

/* Header Colors by Method */
.header-whatsapp { background-color: var(--green-50); }
.header-whatsapp .icon-wrapper { background-color: var(--green-100); }
.header-whatsapp .whatsapp-icon { color: var(--green-600); }

.header-clipboard { background-color: var(--primary-50); }
.header-clipboard .icon-wrapper { background-color: var(--primary-100); }
.header-clipboard .clipboard-icon { color: var(--primary-600); }

.header-failed { background-color: var(--red-50); }
.header-failed .icon-wrapper { background-color: var(--red-100); }
.header-failed .error-icon { color: var(--red-600); }


.instruction-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--grey-800);
}

/* --- Content --- */
.instruction-content {
    padding: 24px 20px;
}

.main-instruction {
    font-size: 16px;
    color: var(--grey-700);
    margin-bottom: 20px;
}
.main-instruction.error-text {
    color: var(--red-700);
}
.main-instruction strong {
    font-weight: 600;
    color: var(--grey-900);
}

.secondary-text {
    font-size: 14px;
    color: var(--grey-500);
}

.steps {
    list-style: none;
    padding: 0;
    margin: 0;
}

.step {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}
.step:last-child {
    margin-bottom: 0;
}

.step-number {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: var(--grey-200);
    color: var(--grey-700);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
}

.step span {
    font-size: 14px;
    color: var(--grey-600);
}

/* --- Actions --- */
.instruction-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding: 0 20px 20px;
}
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\whatsapp-instruction-dialog\whatsapp-instruction-dialog.component.html ---
<!-- in whatsapp-instruction-dialog.component.html -->
<div class="instruction-card" @fadeIn>

	<!-- Header -->
	<div class="instruction-header" [ngClass]="'header-' + config.data.method">
		<div class="icon-wrapper">
			@switch (config.data.method) {
			@case ('whatsapp') { <i class="pi pi-whatsapp icon whatsapp-icon"></i> }
			@case ('clipboard') { <i class="pi pi-copy icon clipboard-icon"></i> }
			@case ('failed') { <i class="pi pi-times-circle icon error-icon"></i> }
			}
		</div>
		<h3 class="instruction-title">
			@switch (config.data.method) {
			@case ('whatsapp') { <span>WhatsApp נפתח</span> }
			@case ('clipboard') { <span>ההזמנה הועתקה</span> }
			@case ('failed') { <span>שגיאה בשליחה</span> }
			}
		</h3>
	</div>

	<!-- Content -->
	<div class="instruction-content">
		@switch (config.data.method) {
		@case ('whatsapp') {
		<p class="main-instruction">
			ההזמנה מוכנה לשליחה לספק <strong>{{config.data.supplierName || 'הספק'}}</strong>.
		</p>
		<ol class="steps">
			<li class="step">
				<span class="step-number">1</span>
				<span>בדוק את פרטי ההזמנה בחלון שנפתח.</span>
			</li>
			<li class="step">
				<span class="step-number">2</span>
				<span>לחץ על כפתור <strong>השליחה</strong> ב-WhatsApp.</span>
			</li>
		</ol>
		}
		@case ('clipboard') {
		<p class="main-instruction">
			לא הצלחנו לפתוח את WhatsApp, אז ההזמנה <strong>הועתקה ללוח</strong>.
		</p>
		<ol class="steps">
			<li class="step">
				<span class="step-number">1</span>
				<span>פתח את WhatsApp וחפש את <strong>{{config.data.supplierName || 'הספק'}}</strong>.</span>
			</li>
			<li class="step">
				<span class="step-number">2</span>
				<span>הדבק את ההודעה בשדה הטקסט ושלח.</span>
			</li>
		</ol>
		}
		@case ('failed') {
		<p class="main-instruction error-text">
			אירעה שגיאה ולא ניתן היה לפתוח את WhatsApp או להעתיק את ההודעה.
		</p>
		<p class="secondary-text">
			אנא נסה שוב, או פתח את האפליקציה באופן ידני.
		</p>
		}
		}
	</div>

	<!-- Actions -->
	<div class="instruction-actions">
		@if (config.data.method === 'failed') {
		<button (click)="onRetry()" class="empty md">
			<span class="material-symbols-rounded">refresh</span>
			<span>נסה שוב</span>
		</button>
		}
		<button (click)="onClose()" class="primary md">
			<span class="material-symbols-rounded">check</span>
			<span>הבנתי</span>
		</button>
	</div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\dialogs\whatsapp-instruction-dialog\whatsapp-instruction-dialog.component.ts ---
// in whatsapp-instruction-dialog.component.ts

import { Component, OnInit, inject } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { CommonModule } from '@angular/common';
import { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';

export interface InstructionConfig {
  supplierName?: string;
  method: 'whatsapp' | 'clipboard' | 'failed';
  autoHide?: boolean;
  autoHideDelay?: number;
}

@Component({
  selector: 'app-whatsapp-instruction-dialog',
  standalone: true, // ודא שהקומפוננטה היא standalone
  imports: [CommonModule],
  styleUrls: ['./whatsapp-instruction-dialog.component.css'],
  templateUrl: './whatsapp-instruction-dialog.component.html',
  animations: [
    // האנימציות של PrimeNG יטפלו בזה, אבל אפשר להשאיר אם יש אנימציות פנימיות
    trigger('fadeIn', [ 
      transition(':enter', [
        style({ opacity: 0, transform: 'translateY(-20px)' }),
        animate('300ms ease-out', style({ opacity: 1, transform: 'translateY(0)' }))
      ])
    ])
  ]
})
export class WhatsAppInstructionDialogComponent implements OnInit {
  // --- Injections for Dynamic Dialog ---
  private ref = inject(DynamicDialogRef);
  public config = inject(DynamicDialogConfig);
  
  // --- State ---
  public instructionConfig: InstructionConfig;
  private autoHideTimeout?: number;

  constructor() {
    // קבל את ה-config דרך ה-injector ולא דרך @Input
    this.instructionConfig = this.config.data || { method: 'failed' };
  }

  ngOnInit() {
    // הסתרה אוטומטית
    if (this.instructionConfig.autoHide && this.instructionConfig.method === 'whatsapp') {
      this.autoHideTimeout = window.setTimeout(() => {
        this.onClose();
      }, this.instructionConfig.autoHideDelay || 300);
    }
  }

  onClose() {
    if (this.autoHideTimeout) {
      clearTimeout(this.autoHideTimeout);
    }
    // סגור את הדיאלוג והחזר תוצאה 'close'
    this.ref.close('close');
  }

  onRetry() {
    // סגור את הדיאלוג והחזר תוצאה 'retry'
    this.ref.close('retry');
  }
}
--- END OF FILE ---
--- START OF FILE src\app\components\home\home.component.css ---
.stats-grid {
	display: grid;
	grid-template-columns: repeat(1, minmax(0, 1fr));
	gap: 12px;
	margin-top: 16px;
	@media (min-width: 600px) {
		grid-template-columns: repeat(2, minmax(0, 1fr));
	}

	@media (min-width: 1200px) {
		grid-template-columns: repeat(4, minmax(0, 1fr));
	}
}

.card-content {
	display: flex;
	flex-direction: column;
	/* align-items: center; */
	flex-grow: 1;
	gap: 12px;
	padding: 12px;
	position: relative;
	border-radius: calc(var(--border-radius) * 2);
	/* backdrop-filter: blur(10px); */
	box-shadow: var(--box-shadow);
	transition: all 0.3s ease;
	border: 1px solid var(--grey-50);
	min-width: calc(50% - 4px);
	background-color: white;

	.card-explanation {
		font-size: 12px;
		color: var(--grey-400);
		margin-top: 0.5rem;
		font-weight: 300;
		display: flex;
		align-items: center;
		gap: 4px;

		.material-symbols-rounded {
			font-size: 16px;

			@media (max-width: 600px) {
				font-size: 14px;
			}
		}

		@media (max-width: 600px) {
			font-size: 12px;
		}
	}

	&:hover {
		transform: translateY(-1px);
		box-shadow: var(--box-shadow-hover);

		& .card-icon {
			transform: translateY(-4px) scale(1.02) rotate(15deg);
		}
	}
	p {
		color: var(--grey-600);
		font-size: 1.1rem;
		font-weight: 500;

		@media (max-width: 600px) {
			font-size: 1rem;
		}
	}
	.card-info {
		flex: 1;
		text-align: center;
	}

	.card-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 50px;
		height: 50px;
		border-radius: 25px;
		background: white;
		position: relative;
		transition: all 0.3s ease;

		&::before {
			content: '';
			position: absolute;
			inset: -3px;
			border-radius: 28px;
			background: var(--gradient);
			z-index: -1;
			opacity: 0.1;
		}

		&::after {
			content: var(--icon);
			font-family: 'Material Symbols Rounded';
			font-size: 1.8rem;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			font-weight: 400;
		}

		&.icon-suppliers {
			--gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			--icon: '\e558';
		}

		&.icon-cost {
			--gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
			--icon: '\f3ee';
		}

		&.icon-today {
			--gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			--icon: '\e7f7';
		}

		&.icon-orders {
			--gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
			--icon: '\e745';
		}

		@media (max-width: 600px) {
			width: 40px;
			height: 40px;

			&::after {
				font-size: 1.5rem;
			}
		}
	}
}

/* Animation enter states */
.animate-enter {
	opacity: 0;
	transform: translateY(3rem) scale(0.8) rotateX(15deg);
	filter: blur(8px);
	transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);

	&.slide-in-from-bottom.fade-in.scale-in.rotate-in {
		opacity: 1;
		transform: translateY(0) scale(1) rotateX(0deg);
		filter: blur(0);
	}
}

/* Animation leave states */
.animate-leave {
	opacity: 1;
	transform: translateY(0) scale(1) rotateX(0deg);
	filter: blur(0);
	transition: all 0.6s cubic-bezier(0.55, 0.085, 0.68, 0.53);

	&.slide-out-to-top.fade-out.scale-out.rotate-out {
		opacity: 0;
		transform: translateY(-0.5rem) scale(0.9) rotateX(-10deg);
		filter: blur(4px);
	}
}

.comparison {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 0.25rem;
	font-size: 12px;
	padding: 2px;
	border-radius: var(--border-radius-sm);
	border-radius: 3px;
}
.comparison.positive {
	color: var(--red-600);
	background-color: var(--red-50);
}
.comparison.negative {
	color: var(--green-600);
	background-color: var(--green-50);
}
.comparison.neutral {
	color: var(--grey-500);
	background-color: var(--grey-50);
}
.comparison .material-symbols-rounded {
	font-size: 1rem;
}
.comparison .text {
	font-weight: 500;
}

--- END OF FILE ---
--- START OF FILE src\app\components\home\home.component.html ---
<div class="p-responsive">
  @switch (pageState()) {
  @case(PageStates.Loading) {
  <app-loader></app-loader>
  }

  @case(PageStates.Error) {
  <div @fadeIn400 class="error-card-container">
    <div class="error-card">
      <div class="error-icon-wrapper">
        <span class="material-symbols-rounded">cloud_off</span>
      </div>
      <h3 class="error-title">אופס, משהו השתבש</h3>
      <button (click)="refreshDashboard()" class="primary md retry-button">
        <span class="material-symbols-rounded">refresh</span>
        <span>נסה שוב</span>
      </button>
    </div>
  </div>
  }

  @case(PageStates.Ready) {
  <div @fadeIn400 class="flex flex-col gap-4">
    <!-- Calendar Component -->
    <!-- <app-calendar></app-calendar> -->
    <app-advanced-calendar></app-advanced-calendar>
    <!-- <app-calendar-day></app-calendar-day> -->


    @if (suppliers().length) {
    <!-- Main Statistics Section -->
    <div class="stats-grid">

      <!-- Due Today Card -->
      <div class="card-content" pAnimateOnScroll
        enterClass="animate-enter slide-in-from-bottom fade-in scale-in rotate-in"
        leaveClass="animate-leave slide-out-to-top fade-out scale-out rotate-out" [once]="true">
        <div class="flex gap-3 items-center">
          <span class="card-icon icon-today" aria-hidden="true"></span>
          <p>הזמנות להיום</p>
        </div>
        <div class="card-info">
          <count-up theme="gradient" [to]="stats().dueToday"></count-up>
          <div class="flex w-full justify-end mt-2">
            <button class="primary sm" (click)="showOrdersListDialog(OrderStatus.Today)">
              <span class="material-symbols-rounded">checkbook</span>
              הצג
            </button>
          </div>
          <small class="card-explanation">
            <span class="material-symbols-rounded">alarm</span>
            הזמנות שמתוכננות להתבצע היום
          </small>
        </div>
      </div>

      <!-- Open Orders Card -->
      <div class="card-content" pAnimateOnScroll
        enterClass="animate-enter slide-in-from-bottom fade-in scale-in rotate-in"
        leaveClass="animate-leave slide-out-to-top fade-out scale-out rotate-out" [once]="true">
        <div class="flex gap-3 items-center">
          <span class="card-icon icon-orders" aria-hidden="true"></span>
          <p>הזמנות טיוטה</p>
        </div>
        <div class="card-info">
          <count-up theme="gradient" [to]="stats().openOrders"></count-up>
          <div class="flex w-full justify-end mt-2">
            <button class="primary sm" (click)="showOrdersListDialog(OrderStatus.Draft)">
              <span class="material-symbols-rounded">checkbook</span>
              הצג
            </button>
          </div>
          <small class="card-explanation">
            <span class="material-symbols-rounded">info</span>
            מספר ההזמנות הפעילות שטרם הושלמו
          </small>
        </div>
      </div>

      <!-- Monthly Cost Card -->
      <div class="card-content">
        <div class="flex gap-3 items-center">
          <span class="card-icon icon-cost" aria-hidden="true"></span>
          <p>עלות כוללת (החודש)</p>
        </div>
        <div class="card-info">
          <div class="flex gap-1 w-full justify-center items-center flex-col">
            <count-up theme="gradient" prefix="₪" [to]="stats().monthlyCost"></count-up>
            @if (stats().costChangePercentage !== null) {
            <div class="comparison" [ngClass]="{
                  'positive': (stats().costChangePercentage) > 0,
                  'negative': (stats().costChangePercentage) < 0
                  }">
              <span class="material-symbols-rounded">
                {{ (stats().costChangePercentage) >= 0 ? 'arrow_upward' : 'arrow_downward' }}
              </span>
              <div class="flex flex-wrap justify-center text-center">
                <span class="percentage-value" dir="ltr">
                  <span>{{ stats().costChangePercentage | number: '1.0-1' }}</span>
                  <span>%</span>
                </span>
                <span class="text">מהחודש הקודם ({{ stats().prevMonthlyCost | currency:'ILS' }})</span>
              </div>
            </div>
            } @else {
            <div class="comparison neutral">
              <span>אין נתונים להשוואה</span>
            </div>
            }

          </div>


          <small class="card-explanation">
            <span class="material-symbols-rounded">money</span>
            סך כל ההוצאות על הזמנות בחודש הנוכחי
          </small>
        </div>
      </div>

      <!-- Active Suppliers Card -->
      <div class="card-content" pAnimateOnScroll
        enterClass="animate-enter slide-in-from-bottom fade-in scale-in rotate-in"
        leaveClass="animate-leave slide-out-to-top fade-out scale-out rotate-out" [once]="true">
        <div class="flex gap-3 items-center">
          <span class="card-icon icon-suppliers" aria-hidden="true"></span>
          <p>ספקים פעילים</p>
        </div>
        <div class="card-info">
          <count-up theme="gradient" [to]="activeSuppliers()"></count-up>
          <div class="flex w-full justify-end mt-2">
            <button class="primary sm" (click)="addSupplier()">
              <span class="material-symbols-rounded">add</span>
              הוסף ספק
            </button>
          </div>
          <small class="card-explanation">
            <span class="material-symbols-rounded">people</span>
            מספר הספקים עם פעילות נוכחית
          </small>
        </div>
      </div>



    </div>


    } @else {
    <!-- Empty State -->
    <div @fadeIn400 class="empty-state" role="region" aria-label="מצב ריק">
      <i class="pi pi-inbox" aria-hidden="true"></i>
      <p><strong>אין ספקים פעילים כרגע</strong></p>
      <p>התחל על ידי הוספת ספק חדש כדי לנהל מוצרים וקטגוריות</p>
      <p>זה יעזור לך לארגן את המלאי ולעקוב אחר ההזמנות</p>
      <button label="הוסף ספק חדש" class="primary md round" (click)="addSupplier()" ariaLabel="הוסף ספק חדש למערכת">
        <span class="material-symbols-rounded">add</span>
        הוסף ספק חדש
      </button>
    </div>
    }
  </div>
  }
  }
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\home\home.component.ts ---
import { OrderFlowService } from './../../services/order-flow.service';
import { Component, inject, signal, OnInit, computed, effect, untracked } from '@angular/core';
import { CommonModule } from '@angular/common';
import { CardModule } from 'primeng/card';
import { ButtonModule } from 'primeng/button';
import { TooltipModule } from 'primeng/tooltip';
import { MessageModule } from 'primeng/message';
import { AnimateOnScrollModule } from 'primeng/animateonscroll';
import { DialogService } from 'primeng/dynamicdialog';
import { LoaderComponent } from '../shared/loader/loader.component';
import { CountUpComponent } from "../shared/count-up/count-up.component";
import { SupplierDialogComponent } from '../dialogs/supplier-dialog/supplier-dialog.component';
import { OrdersListDialogComponent } from '../dialogs/orders-list-dialog/orders-list-dialog.component';
import { NotificationService } from '../../services/notification.service';
import { SupplierStore } from '../../store/supplier.store'

import { OrderStatus } from '../../common/enums/order-status.enum';
import { CreateOrderDto } from '../../common/dto/order-create.dto';
import { DialogConfig } from '../../common/const/dialog-config';
import { fadeIn400 } from '../../common/const/animations';
import { OrderStore } from '../../store/order.store';
import { StatsStore } from '../../store/stats.store';
import { AdvancedCalendarComponent } from "../calendar/advanced-calendar/advanced-calendar.component";
import { parseDateStringAsLocal } from '../../common/utils/date.utils';
import { Order } from '../../common/models/order';
import { PageStates } from '../../common/models/pageStates';
import { Supplier } from '../../common/models/supplier';

@Component({
	selector: 'app-home',
	standalone: true,
	imports: [CommonModule, CardModule, ButtonModule, TooltipModule, LoaderComponent, MessageModule,
		AnimateOnScrollModule, CountUpComponent, AdvancedCalendarComponent],
	providers: [DialogService],
	templateUrl: './home.component.html',
	styleUrls: ['./home.component.css'],
	animations: [fadeIn400],
})
export class HomeComponent {
	// --- Stores ---
	private readonly supplierStore = inject(SupplierStore);
	private readonly orderStore = inject(OrderStore);
	private readonly statsStore = inject(StatsStore);

	// --- Services ---
	private readonly notificationService = inject(NotificationService);
	private readonly dialogService = inject(DialogService);
	private readonly orderFlowService = inject(OrderFlowService);

	private readonly isInitialLoad = signal(true);

	// --- Data Signals ---
	readonly suppliers = this.supplierStore.suppliers;
	readonly stats = this.statsStore.stats;
	readonly activeSuppliers = this.supplierStore.activeSuppliers;
	readonly OrderStatus = OrderStatus;
	readonly PageStates = PageStates;
	readonly pageState = computed(() => {
		const isLoading = this.supplierStore.isLoading() || this.statsStore.isLoading();
		const hasError = this.supplierStore.error() || this.statsStore.error();
		const isInitial = this.isInitialLoad();

		if (isInitial && isLoading) return PageStates.Loading;
		if (isInitial && hasError) return PageStates.Error;

		return PageStates.Ready;
	});

	constructor() {
		this.supplierStore.loadSuppliers({});
		this.statsStore.loadStats({});

		// פשוט יותר - רק עוקב אחר השלמת הטעינה הראשונית
		effect(() => {
			const isLoading = this.supplierStore.isLoading() || this.statsStore.isLoading();

			if (this.isInitialLoad() && !isLoading) {
				this.isInitialLoad.set(false);
			}
		});
	}
	// --- User Actions ---
	addSupplier(): void {
		const ref = this.dialogService.open(SupplierDialogComponent, {
			
			...DialogConfig,
			header: 'הוספת ספק חדש',
			data: { suppliers: this.suppliers() },
		});

		ref.onClose.subscribe((newSupplier: Supplier | undefined) => {
			if (newSupplier) {
				this.supplierStore.addSupplier(newSupplier);
			}
		});
	}

	showOrdersListDialog(status: OrderStatus): void {
		
		const ref = this.dialogService.open(OrdersListDialogComponent, {
			...DialogConfig,
			header: status === OrderStatus.Draft ? 'הזמנות טיוטה | פתוחות' : 'הזמנות לביצוע היום',
			data: { status }
		});

		ref.onClose.subscribe((result: { action: 'edit' | 'delete' | 'create', data: Order } | undefined) => {
			if (!result) return;

			if (result.action === 'edit') {
				this.openOrderForEditing(result.data);
			} else if (result.action === 'delete') {
				this.handleRemoveDraft(result.data);
			} else if (result.action === 'create') {
				// טיפול ביצירת הזמנה חדשה מתזכורת
				const supplier = this.supplierStore.suppliersById()[result.data.supplierId];
				if (supplier) {
					this.orderFlowService.openOrderDialog({
						supplier: supplier,
						date: new Date(), // הזמנה חדשה היא תמיד להיום
						existingOrder: null
					});
				}
			}
		});
	}

	private openOrderForEditing(order: Order): void {
		const supplier = this.supplierStore.getSupplierById(order.supplierId);
		if (!supplier) {
			this.notificationService.toast({ severity: 'warn', detail: 'הספק המשויך להזמנה לא נמצא.' });
			return;
		}

		const correctDate = parseDateStringAsLocal(order.date);
		console.log('Parsed date:', correctDate); // For debugging
		console.log('Day:', correctDate.getDate(), 'Month:', correctDate.getMonth() + 1, 'Year:', correctDate.getFullYear());

		this.orderFlowService.openOrderDialog({
			supplier: supplier,
			date: correctDate,
			existingOrder: order,
		});
	}

	private handleRemoveDraft(orderToDelete: Order): void {
		const resetOrderPayload: CreateOrderDto = {
			id: orderToDelete.id,
			supplierId: orderToDelete.supplierId,
			date: orderToDelete.date.toString(),
			status: OrderStatus.Draft,
			products: []
		};

		this.orderStore.saveOrder(resetOrderPayload);

	}

	refreshDashboard(): void {
		console.log('------- Refreshing data ---------- ');

		this.supplierStore.loadSuppliers({ force: true });
		this.statsStore.loadStats({ force: true });
	}

}



--- END OF FILE ---
--- START OF FILE src\app\components\order-history\order-history.component.css ---
.actions-bar {
	display: flex;
	justify-content: space-between;
	align-items: center;
	gap: 1rem;
	width: 100%;

	.desktop-row {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 1rem;
		width: 100%;
	}
  
	.mobile-row {
		display: none;
		justify-content: center;
		align-items: center;
		width: 100%;
		/* padding-right: 26px; */
	}

	@media (max-width: 1200px) {
		.desktop-row .select-buttons-desktop {
			display: none;
		}
		
		.mobile-row {
			display: flex;
		}
	}
}

.supplier-select {
	display: flex;
	align-items: center;

	.p-select {
		min-width: 140px;
		border-radius: 6px;
		background: #fff;

		.p-select-label {
			padding: 0.5rem;
			font-size: 1rem;
		}
	}
}

.product-name {
	/* font-medium left-border max-w-20 */
	font-weight: 500;
	border-left: 1px solid var(--grey-100);
	width: 140px !important;
	min-width: 140px !important;
}

:host ::ng-deep .p-datatable .p-datatable-tbody > tr:last-child > td.product-name {
  border-left: 1px solid var(--grey-100) !important;
}


.today-column {
	background-color: #f8fafc;
	font-weight: 500;
	color: var(--primary-600) !important;
	border-left: 1px solid var(--primary-100) !important;
	border-right: 1px solid var(--primary-100) !important;
	background-color: var(--primary-30) !important;

	&.td {
		background-color: var(--primary-20) !important;
	}
}

:host ::ng-deep .left-border {
	border-left: 1px solid var(--grey-50);
}

.week-odd {
	background-color: var((--primary-50));
}

/* עיצוב רקע לשבועות זוגיים (בדרך כלל לבן, אבל מוגדר למקרה הצורך) */
.week-even {
	background-color: #ffffff;
}

/* ודא שההצללה חלה גם על תאי ה-header וגם על תאי ה-body */
:host ::ng-deep .p-datatable .p-datatable-thead > tr > th.week-odd,
:host ::ng-deep .p-datatable .p-datatable-tbody > tr > td.week-odd,
:host ::ng-deep .p-datatable .p-datatable-tfoot > tr > td.week-odd  {
	background-color: #f9fafb;
}

:host ::ng-deep .p-datatable .p-datatable-thead > tr > th.week-even,
:host ::ng-deep .p-datatable .p-datatable-tbody > tr > td.week-even,
:host ::ng-deep .p-datatable .p-datatable-tfoot > tr > td.week-even {
	background-color: #ffffff;
}
:host ::ng-deep .p-datatable .p-datatable-tfoot > tr > td {
	border-top: 1px solid var(--primary-200);
	color: var(--primary-700);
}

:host ::ng-deep .mat-mdc-tab-body-wrapper {
    height: 100%;
}
--- END OF FILE ---
--- START OF FILE src\app\components\order-history\order-history.component.html ---
<div class="p-responsive page-height">
  @switch (pageState()) {
  @case (PageStates().Loading) {
  <app-loader></app-loader>
  }
  @case (PageStates().Error) {
  <div @fadeIn400 class="error-card-container">
    <div class="error-card">
      <div class="error-icon-wrapper">
        <span class="material-symbols-rounded">cloud_off</span>
      </div>
      <h3 class="error-title">אופס, משהו השתבש</h3>
      <button (click)="refreshData()" class="primary md retry-button">
        <span class="material-symbols-rounded">refresh</span>
        <span>נסה שוב</span>
      </button>
    </div>
  </div>
  }
  @case(PageStates().Empty) {
    <div @fadeIn400 class="empty-state">
        <i class="pi pi-box"></i>
        <p>עדיין לא בוצעו הזמנות במערכת.</p>
        <!-- <p-button label="הוסף ספק ראשון" icon="pi pi-plus" (onClick)="addSupplier()"></p-button> -->
    </div>
    }
  @case (PageStates().Ready) {
  <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
    <div class="flex w-full items-center justify-between">
      <div class="flex gap-2 items-center">
        <i class="pi pi-history text-xl"></i>
        <span class="main-title">היסטורית הזמנות</span>
      </div>
      @if(isAdmin()){
        <p-button
          tooltipPosition="top"
          pTooltip="מחיקת כל ההזמנות של הספק"
          icon="pi pi-trash"
          (click)="deleteAllOrders(supplierId()!)"
          size="small"
          [rounded]="true"
          severity="danger"
          class="ml-2">
        </p-button>
        }
    </div>
    <div class="flex flex-col gap-2 h-full ">

      <div class="actions-bar">
        <div class="desktop-row">
          <span class="supplier-select">
            <p-select id="supplierId" [ngModel]="supplierId()" (ngModelChange)="supplierId.set($event)"
              [options]="suppliers()" optionLabel="name" optionValue="id" styleClass="w-full md:w-64"
              placeholder="בחר ספק" [appendTo]="'body'" [showClear]="true" [filter]="suppliers().length > 10">
            </p-select>
          </span>
          <div class="flex gap-2 items-center select-buttons-desktop">
            <p-selectButton class="custom sm" [options]="tabOptions" [ngModel]="selectedTab()"
              (ngModelChange)="selectedTab.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false"
              size="small">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="chartMetricOptions" [ngModel]="selectedChartMetric()"
              (ngModelChange)="selectedChartMetric.set($event)" optionLabel="label" optionValue="value"
              [allowEmpty]="false" size="small">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="viewPropsOptions" [ngModel]="viewProps()"
              (ngModelChange)="viewProps.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="viewModeOptions" [ngModel]="viewMode()"
              (ngModelChange)="viewMode.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
          </div>

          <div class="flex gap-0.5 items-center justify-center pb-1">
            <p-button icon="pi pi-chevron-right" class="p-button-xs" [rounded]="true" [text]="true" severity="secondary"
              tooltipPosition="top" [pTooltip]="viewMode() === 'weekly' ? 'שבוע קודם' : 'חודש קודם'"
              (onClick)="prevPeriod()" [disabled]="isFetching()">
            </p-button>
            <span class="text-xs pt-1 font-medium text-gray-600 whitespace-nowrap">
              {{ formatDisplayDate(startDate()) }} - {{ formatDisplayDate(endDate()) }}
            </span>
            <p-button icon="pi pi-chevron-left" class="p-button-xs" [rounded]="true" [text]="true" severity="secondary"
              tooltipPosition="top" [pTooltip]="viewMode() === 'weekly' ? 'שבוע הבא' : 'חודש הבא'"
              (onClick)="nextPeriod()" [disabled]="isFetching()">
            </p-button>
          </div>
        </div>
        <div class="mobile-row">
          <div class="flex gap-2 items-center select-buttons-mobile">
            <p-selectButton class="custom sm" [options]="tabOptions" [ngModel]="selectedTab()"
              (ngModelChange)="selectedTab.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false"
              size="small">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="chartMetricOptions" [ngModel]="selectedChartMetric()"
              (ngModelChange)="selectedChartMetric.set($event)" optionLabel="label" optionValue="value"
              [allowEmpty]="false" size="small">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="viewPropsOptions" [ngModel]="viewProps()"
              (ngModelChange)="viewProps.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
            <p-selectButton class="custom sm" [options]="viewModeOptions" [ngModel]="viewMode()"
              (ngModelChange)="viewMode.set($event)" optionLabel="label" optionValue="value" [allowEmpty]="false">
              <ng-template let-item pTemplate="item">
                <div class="flex flex-col  items-center gap-0.5">
                  <span class="material-symbols-rounded">{{ item.icon }}</span>
                  <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                </div>
              </ng-template>
            </p-selectButton>
          </div>
        </div>
      </div>

      <mat-tab-group dir="rtl" class="no-labels h-full " disableRipple="true"
        [selectedIndex]="selectedTab() === 'table' ? 0 : 1">
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="material-symbols-rounded">table</span>
            תצוגת טבלה
          </ng-template>
          <div class="p-2 h-full">
            @if (isFetching() && products().length === 0) {
            <app-loader></app-loader>
            }
            @else if (!supplierId() && suppliers().length > 0) {
            <div class="empty-state">
              <i class="pi pi-info-circle text-primary-500"></i>
              <p>אנא בחר ספק להצגת היסטוריה.</p>
            </div>
            }
            @else if (products().length === 0) {
            <div class="empty-state border border-dashed border-gray-300 rounded-md p-8">
              <i class="pi pi-search text-3xl text-gray-400"></i>
              <p class="text-lg text-gray-600 mt-2">אין הזמנות להצגה עבור התקופה והספק הנבחרים.</p>
              <p class="text-sm text-gray-500">נסה לשנות תאריכים או לבחור ספק אחר.</p>
              @if(isAdmin()){
                <div class="upload-section">
                
                  @if (isUploading()) {
                    <div class="loader-container">
                      <app-loader></app-loader>
                      <div class="flex flex-col">
                        <span class="upload-status-text">מעבד את הקובץ...</span>
                        <span class="upload-status-subtext">זה עשוי לקחת מספר שניות</span>
                      </div>
                    </div>
                  }

                  @if (!isUploading()) {
                    <div class="file-dropzone fade-in" 
                        [class.dragging-over]="isDraggingOver()"
                        (dragover)="onDragOver($event)"
                        (dragleave)="onDragLeave($event)" 
                        (drop)="onDrop($event, supplierId()!)">
                      
                      <i class="pi pi-database upload-icon"></i>
                      <p class="upload-text">גרור קובץ TXT לכאן או לחץ לבחירה</p>
                      <p class="upload-hint">לייבוא הזמנות היסטוריות</p>
                      
                      <input type="file" id="txt" class="file-input" accept=".txt" 
                            (change)="onFileSelect($event,supplierId()!)" />
                    </div>
                  }
                </div>
              }
            </div>
            }
            @else {
            <p-table [value]="products()" responsiveLayout="scroll" [scrollHeight]="scrollHeight()" size="small" class="min-h-80">
              <ng-template pTemplate="header">
                <tr>
                  <th class="product-name">מוצר</th>
                  @for (date of dates(); track date.date) {
                  <th [ngClass]="{
                            'today-column': date.isToday,
                            'week-odd': date.weekNumber % 2 !== 0,
                            'week-even': date.weekNumber % 2 === 0
                          }" class="text-center w-20">
                    <div class="flex gap-1 items-baseline ">
                      <p class="text-xs font-normal">{{ date.hebrewDay }}</p>
                      <p class="text-[10px]">{{ date.date | date : 'dd.MM' }}</p>
                    </div>
                  </th>
                  }
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product>
                <tr>
                  <td data-label="מוצר" class="product-name">{{ product.name }}</td>
                  @for (date of dates(); track date.date) {
                  <td [ngClass]="{
                            'today-column td': date.isToday,
                            'week-odd': date.weekNumber % 2 !== 0,
                            'week-even': date.weekNumber % 2 === 0
                          }" class="text-center text-responsive-sm whitespace-nowrap"
                    [attr.data-label]="date.date | date : 'dd.MM' + ' (' + date.hebrewDay + ')'">
                    {{ getTableCellValue(product, date) }}
                  </td>
                  }
                </tr>
              </ng-template>
              <ng-template pTemplate="footer">
                <tr>
                  <td class="product-name">סה"כ</td>
                  @for (date of dates(); track date.date) {
                  <td [ngClass]="{
                            'today-column td': date.isToday,
                            'week-odd': date.weekNumber % 2 !== 0,
                            'week-even': date.weekNumber % 2 === 0
                          }" class="text-center">{{ getTotalForDate(date) }}</td>
                  }
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td [attr.colspan]="(dates().length || 0) + 1" class="empty-message text-center py-4">
                    לא נמצאו פריטים בהזמנות עבור התקופה והספק הנבחרים.
                  </td>
                </tr>
              </ng-template>
            </p-table>
            }
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="material-symbols-rounded">bar_chart</span>
            תצוגת גרף
          </ng-template>
          <div class="p-2 h-full">
            @let data = chartData();
            @if (isFetching() && products().length === 0) {
            <app-loader></app-loader>
            }
            @else if (!supplierId() && suppliers().length > 0) {
            <div class="empty-state">
              <i class="pi pi-info-circle text-primary-500"></i>
              <p>אנא בחר ספק להצגת היסטוריה.</p>
            </div>
            }
            @else if (products().length === 0) {
            <div class="empty-state border border-dashed border-gray-300 rounded-md p-8">
              <i class="pi pi-search text-3xl text-gray-400"></i>
              <p class="text-lg text-gray-600 mt-2">אין הזמנות להצגה עבור התקופה והספק הנבחרים.</p>
              <p class="text-sm text-gray-500">נסה לשנות תאריכים או לבחור ספק אחר.</p>
            </div>
            }
            @else if (data) {
            <div class="card h-full ">
              <div class="flex justify-between items-start">
                <p-selectButton class="custom sm" [options]="splitChartOptions()" [ngModel]="splitChartByProp()"
                  (ngModelChange)="splitChartByProp.set($event)" optionLabel="label" optionValue="value"
                  [allowEmpty]="false">
                  <ng-template let-item pTemplate="item">
                    <div class="flex flex-col  items-center gap-0.5">
                      <span class="material-symbols-rounded text-xs">{{ item.icon }}</span>
                      <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                    </div>
                  </ng-template>
                </p-selectButton>
                <div class="flex flex-col items-end gap-2">
                  <p-selectButton class="custom sm" [options]="chartTypeOptionsComputed()"
                    [ngModel]="selectedChartType()" (ngModelChange)="onChartTypeChange($event)" optionLabel="label"
                    optionValue="value" optionDisabled="disabled" [allowEmpty]="false" size="small">
                    <ng-template let-item pTemplate="item">
                      <div class="flex flex-col  items-center gap-0.5" [class.opacity-50]="item.disabled"
                        [pTooltip]="item.tooltip" [tooltipPosition]="'top'" [showDelay]="300">
                        <span class="material-symbols-rounded">{{ item.icon }}</span>
                        <span class="text-[10px] leading-2 text-center">{{ item.label }}</span>
                      </div>
                    </ng-template>
                  </p-selectButton>
                  <div *ngIf="!isCurrentSelectionValid()"
                    class="flex items-center gap-1 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded-md">
                    <span class="material-symbols-rounded text-sm">info</span>
                    <span>עבר לגרף חלופי</span>
                  </div>
                </div>
              </div>
              <p-chart [type]="selectedChartType()" [data]="data" [options]="chartOptions()"></p-chart>
            </div>
            }
            @else {
            <div class="empty-state p-4 mt-4 text-sm">
              <i class="pi pi-chart-line text-gray-400"></i>
              <p>אין נתונים להצגה בגרף עבור בחירה זו.</p>
            </div>
            }
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
  }
  }
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\order-history\order-history.component.ts ---
import { Component, Input, signal, effect, inject, AfterViewInit, OnInit, computed, HostListener } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { SelectButtonModule } from 'primeng/selectbutton';
import { SelectModule } from 'primeng/select';
import { ChartModule } from 'primeng/chart';
import { OrderStatus } from '../../common/enums/order-status.enum';
import { CommonModule } from '@angular/common';
import { TooltipModule } from 'primeng/tooltip';

import { ApiService } from '../../services/api.service';
import { NotificationService } from '../../services/notification.service';
import { LoaderComponent } from '../shared/loader/loader.component';
import { fadeIn400 } from '../../common/const/animations';
import { HebrewDayPipe } from '../../pipes/hebrewDay.pipe';
import { MessageModule } from 'primeng/message';
import { formatDateToYYYYMMDD } from '../../common/utils/date.utils';
import { BaseChartAnimation, ChartDefaultSettings, LightChartColors, TooltipChart } from '../../common/const/chart-config';
import { SupplierStore } from '../../store/supplier.store';
import { MatTabsModule } from '@angular/material/tabs';
import { Category } from '../../common/models/category';
import { Order } from '../../common/models/order';
import { PageStates } from '../../common/models/pageStates';
import { Product } from '../../common/models/product';
import { AuthStore } from '../../store/auth.store';

// Interfaces
interface ProductSummary {
	productId?: number;
	categoryId?: number;
	categoryName?: string;
	name: string;
	cost?: number;
	price?: number;
	values: { [date: string]: number }; // Holds quantities or costs
}
interface DateDisplay {
	date: string; // YYYY-MM-DD
	formatted: string;
	hebrewDay: string;
	isToday: boolean;
	weekNumber: number;
	isPastOrToday: boolean;
}
type ChartType = 'line' | 'bar' | 'doughnut';
type ChartMetric = 'quantity' | 'cost' | 'price';

@Component({
	selector: 'app-order-history',
	standalone: true,
	providers: [HebrewDayPipe],
	templateUrl: './order-history.component.html',
	styleUrls: ['./order-history.component.css'],
	animations: [fadeIn400],
	imports: [
		CommonModule, FormsModule, TableModule, SelectModule, ButtonModule, SelectButtonModule,
		TooltipModule, LoaderComponent, ChartModule, MessageModule, MatTabsModule
	],
})
export class OrderHistoryComponent implements OnInit, AfterViewInit {
	private hebrewDayPipe = inject(HebrewDayPipe);
	private apiService = inject(ApiService);
	private notificationService = inject(NotificationService);

	private readonly supplierStore = inject(SupplierStore);
	private readonly authStore = inject(AuthStore);

	PageStates = signal(PageStates);
	pageState = signal(PageStates.Loading);
	isFetching = signal<boolean>(false);
	isViewInitialized = signal(false);
	readonly isAdmin = this.authStore.isAdmin;


	@Input() supplierId = signal<number | null>(null);
	viewMode = signal<'weekly' | 'monthly'>('monthly');
	viewModeOptions = [
		{ label: 'שבועי', value: 'weekly', icon: 'date_range' },
		{ label: 'חודשי', value: 'monthly', icon: 'calendar_month' },
	];
	viewProps = signal<'product' | 'category'>('product');
	viewPropsOptions = [
		{ label: 'מוצר', value: 'product', icon: 'package_2' },
		{ label: 'קטגוריה', value: 'category', icon: 'storefront' },
	];
	splitChartByProp = signal<boolean>(false);
	splitChartOptions = computed(() => {
		const currentViewPropsLabel = this.viewPropsOptions.find(el => el.value === this.viewProps())?.label || 'פריט';
		return [
			{ label: 'תצוגה כללית', value: false, icon: 'bar_chart' },
			{ label: `פיצול לפי ${currentViewPropsLabel}`, value: true, icon: 'donut_small' }
		];
	});
	selectedChartType = signal<ChartType>('line');
	chartTypeOptions = [
		{ label: 'קו', value: 'line', icon: 'show_chart' },
		{ label: 'עמודות', value: 'bar', icon: 'bar_chart' },
		{ label: 'עוגה', value: 'doughnut', icon: 'pie_chart' },
	];
	selectedChartMetric = signal<ChartMetric>('quantity');
	chartMetricOptions = [
		{ label: 'כמויות', value: 'quantity', icon: 'box', xAxis: 'תאריך', yAxis: 'כמות' },
		{ label: 'מחיר עלות', value: 'cost', icon: 'money_bag', xAxis: 'תאריך', yAxis: 'עלות (₪)' },
		{ label: 'מחיר מכירה', value: 'price', icon: 'point_of_sale', xAxis: 'תאריך', yAxis: 'עלות (₪)' },
	];
	selectedTab = signal<'table' | 'chart'>('table');
	tabOptions = [
		{ label: 'תצוגת טבלה', value: 'table', icon: 'table' },
		{ label: 'תצוגת גרף', value: 'chart', icon: 'bar_chart' },
	];


	startDate = signal<string>('');
	endDate = signal<string>('');
	public suppliers = this.supplierStore.suppliers;
	categories = signal<Category[]>([]);
	products = signal<ProductSummary[]>([]);
	private rawOrders = signal<Order[]>([]);
	dates = signal<DateDisplay[]>([]);
	supplierProducts = signal<Product[]>([]);

	chartData = signal<any>(null);
	chartOptions = signal<any>(null);
	private baseChartOptionsInternal: any = null;
	lastFetchedRange = signal<{ startDate: string; endDate: string } | null>(null);
	lastFetchedSupplierId = signal<number | null>(null);
	private fetchTimeout: ReturnType<typeof setTimeout> | null = null;


	windowHeight = signal(window.innerHeight);
	scrollHeight = computed(() => String(this.windowHeight() - 80 - 12 - 12 - 34 - 136 ) + 'px' );


	constructor() {

		window.addEventListener('resize', () => {
			this.windowHeight.set(window.innerHeight);
		});
		// Effect 1: Update date range when viewMode changes.
		effect(() => {
			this.viewMode();
			console.log(`EFFECT 1 (viewMode): View mode changed to -> ${this.viewMode()}`);
			this.setInitialDateRange();
		});

		// Effect 2: Schedule API fetch ONLY when supplier or date range change.
		effect(() => {
			const currentSupplierIdVal = this.supplierId();
			const currentStartDateVal = this.startDate();
			const currentEndDateVal = this.endDate();
			if (currentSupplierIdVal && currentStartDateVal && currentEndDateVal) {
				const lastRangeVal = this.lastFetchedRange();
				const lastSupplierVal = this.lastFetchedSupplierId();
				if (!this.isFetching() &&
					(!lastRangeVal || !lastSupplierVal ||
						lastRangeVal.startDate !== currentStartDateVal ||
						lastRangeVal.endDate !== currentEndDateVal ||
						lastSupplierVal !== currentSupplierIdVal)) {
					this.scheduleFetchOrders();
				}
			} else {
				this.rawOrders.set([]);
			}
		});

		effect(() => {
			const supplierId = this.supplierId();
			console.log(`EFFECT 2 (supplierProducts): Supplier ID is now -> ${supplierId}`);
			if (supplierId) {
				this.loadSupplierProducts(supplierId);
			} else {
				console.log('EFFECT 2: Resetting supplier products because no supplier is selected.');
				this.supplierProducts.set([]);
			}
		});

		// Effect 3: Re-process data when raw data, view type, or metric changes.
		effect(() => {
			const orders = this.rawOrders();
			this.viewProps();
			this.selectedChartMetric();
			this.processOrderDetails(orders);
		})

		// Effect 4: Update chart display when processed data or chart settings change.
		effect(() => {
			this.products();
			this.dates();
			this.selectedChartType();
			this.selectedChartMetric();
			this.splitChartByProp();
			if (this.isViewInitialized()) {
				this.updateChartData();
			}
		});

		// Effect 5: Update chart options (titles, scales) when chart type or metric changes.
		effect(() => {
			const type = this.selectedChartType();
			const metric = this.selectedChartMetric();
			if (this.baseChartOptionsInternal && this.isViewInitialized()) {
				this.updateDynamicChartOptions(type, metric);
			}
		});

		// Effect 6: Handle incompatible chart states.
		effect(() => {
			const isSplitView = this.splitChartByProp();
			const currentType = this.selectedChartType();

			// אם עברנו לפיצול ויש דונאטס - החלף אוטומטית לעמודות
			if (isSplitView && currentType === 'doughnut') {
				console.log('Auto-switching from doughnut to bar chart due to split view');
				this.selectedChartType.set('bar');

				// הצג הודעה ידידותית למשתמש
				this.notificationService.toast({
					severity: 'info',
					summary: 'הגרף שונה',
					detail: 'עבר לגרף עמודות - עוגת דונאטס זמינה רק בתצוגה כללית',
					life: 4000
				});
			}
		});

		effect(() => {
			const suppliersFromStore = this.supplierStore.suppliers();
			const isLoading = this.supplierStore.isLoading();
			const error = this.supplierStore.error();
			console.log(`EFFECT 7 (pageState): Triggered. isLoading: ${isLoading}, Suppliers: ${suppliersFromStore.length}, Error: ${error}`);

			if (isLoading) {
				this.pageState.set(PageStates.Loading);
				return;
			}
			if (error) {
				this.pageState.set(PageStates.Error);
				return;
			}
			if (suppliersFromStore.length > 0) {
				if (!this.supplierId() || !suppliersFromStore.some(s => s.id === this.supplierId())) {
					console.log('EFFECT 7: No supplier selected, setting the first one.');
					this.supplierId.set(suppliersFromStore[0].id);
				}
				this.pageState.set(PageStates.Ready);
			} else if (!isLoading) {
				this.pageState.set(PageStates.Empty);
			}
		});

		// אפקט חדש שיקרא לטעינת הזמנות
		effect(() => {
			const supplierId = this.supplierId();
			const startDate = this.startDate();
			const endDate = this.endDate();
			const productsLoaded = this.supplierProducts().length > 0;
			console.log(`EFFECT 8 (fetchOrders): Triggered. SupplierID: ${supplierId}, Start: ${startDate}, End: ${endDate}, Products Loaded: ${productsLoaded}`);

			// טען הזמנות רק אם יש ספק, טווח תאריכים, והכי חשוב - אחרי שמוצרי הספק נטענו!
			if (supplierId && startDate && endDate && productsLoaded) {
				this.scheduleFetchOrders();
			}
		});
	}

	// בתוך order-history.component.ts

	// הוסף computed property לזיהוי מצבים לא תקינים
	chartTypeOptionsComputed = computed(() => {
		const isSplitView = this.splitChartByProp();

		return this.chartTypeOptions.map(option => ({
			...option,
			disabled: option.value === 'doughnut' && isSplitView,
			tooltip: option.value === 'doughnut' && isSplitView
				? 'עוגת דונאטס זמינה רק בתצוגה כללית'
				: undefined
		}));
	});

	// הוסף computed property לבדיקת תקינות הבחירה הנוכחית
	isCurrentSelectionValid = computed(() => {
		const currentType = this.selectedChartType();
		const isSplitView = this.splitChartByProp();

		return !(currentType === 'doughnut' && isSplitView);
	});

	// הוסף את הפונקציה הזו בתוך OrderHistoryComponent

	onChartTypeChange(newType: ChartType): void {
		const isSplitView = this.splitChartByProp();

		// בדוק אם הבחירה תקינה
		if (newType === 'doughnut' && isSplitView) {
			// הצג הודעת שגיאה ולא תאפשר את השינוי
			this.notificationService.toast({
				severity: 'warn',
				summary: 'בחירה לא זמינה',
				detail: 'עוגת דונאטס זמינה רק בתצוגה כללית. החלף תחילה לתצוגה כללית.',
				life: 4000
			});
			return; // לא מבצע את השינוי
		}

		// אם הבחירה תקינה - בצע את השינוי
		this.selectedChartType.set(newType);

		// אם עברנו לדונאטס - אוטומטית עבור לתצוגה כללית אם צריך
		if (newType === 'doughnut' && isSplitView) {
			this.splitChartByProp.set(false);
			this.notificationService.toast({
				severity: 'info',
				summary: 'התצוגה שונתה',
				detail: 'עבר לתצוגה כללית עבור עוגת הדונאטס',
				life: 3000
			});
		}
	}

	ngOnInit() {
		console.log('ngOnInit: Initializing component');
		this.baseChartOptionsInternal = this.getBaseChartOptions();
		if (this.supplierStore.suppliers().length === 0) {
			console.log('ngOnInit: No suppliers in store, dispatching loadSuppliers.');
			this.supplierStore.loadSuppliers({});
		}
	}

	private loadSupplierProducts(supplierId: number): void {
		console.log(`API_CALL: Fetching products for supplier ${supplierId}`);
		this.apiService.getProductsBySupplier(supplierId).subscribe({
			next: (response) => {
				if (response.success && response.result) {
					console.log(`API_SUCCESS: Received ${response.result.length} products for supplier ${supplierId}`);
					this.supplierProducts.set(response.result);
				} else {
					console.warn(`API_FAIL: Failed to get products for supplier ${supplierId}. Message: ${response.message}`);
					this.supplierProducts.set([]);
				}
			},
			error: (err) => {
				console.error(`API_ERROR: Error fetching products for supplier ${supplierId}`, err);
				this.supplierProducts.set([]);
			}
		});
	}


	ngAfterViewInit() {
		this.isViewInitialized.set(true);
		this.updateDynamicChartOptions(this.selectedChartType());
		this.updateChartData();
	}


	public refreshData(): void {
		this.supplierStore.loadSuppliers({ force: true });
		this.fetchOrders();
	}



	setInitialDateRange() {
		// השתמש ב-startDate הקיים כבסיס, או ב"היום" אם הוא ריק (בטעינה ראשונה)
		const baseDate = this.startDate() ? new Date(this.startDate()) : new Date();
		baseDate.setHours(0, 0, 0, 0);

		let start: Date, end: Date;

		if (this.viewMode() === 'weekly') {
			// מצא את יום ראשון של השבוע שמכיל את ה-baseDate
			start = new Date(baseDate);
			start.setDate(baseDate.getDate() - baseDate.getDay());
			end = new Date(start);
			end.setDate(start.getDate() + 6);
		} else { // 'monthly'
			// מצא את תחילת וסוף החודש שמכיל את ה-baseDate
			start = new Date(baseDate.getFullYear(), baseDate.getMonth(), 1);
			end = new Date(baseDate.getFullYear(), baseDate.getMonth() + 1, 0);
		}

		this.startDate.set(formatDateToYYYYMMDD(start));
		this.endDate.set(formatDateToYYYYMMDD(end));
	}

	formatDate(date: Date): string { return formatDateToYYYYMMDD(date); }

	formatDisplayDate(dateStr: string): string {
		if (!dateStr) return '';
		const d = new Date(dateStr);
		return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getFullYear()).slice(2)}`;
	}

	scheduleFetchOrders() {
		if (this.fetchTimeout) clearTimeout(this.fetchTimeout);
		this.fetchTimeout = setTimeout(() => this.fetchOrders(), 300);
	}

	fetchOrders() {
		const currentSupplierIdVal = this.supplierId();
		if (!currentSupplierIdVal || this.isFetching()) return;
		this.isFetching.set(true);
		const currentStartDateVal = this.startDate();
		const currentEndDateVal = this.endDate();
		this.apiService.findOrdersBySuppliersAndDateRange({
			supplierIds: [currentSupplierIdVal],
			startDate: currentStartDateVal,
			endDate: currentEndDateVal,
		}).subscribe({
			next: (response) => {
				if (response.success && response.result) { this.rawOrders.set(response.result); }
				else { this.rawOrders.set([]); }
			},
			error: () => {
				this.rawOrders.set([]);
				this.notificationService.toast({ severity: 'error', detail: 'שגיאה בטעינת היסטוריית הזמנות.' });
			},
			complete: () => { this.finishFetch(currentSupplierIdVal, currentStartDateVal, currentEndDateVal); },
		});
	}

	private processOrderDetails(orders: Order[]) {
		if (!orders) {
			this.products.set([]);
			return;
		}

		const viewProps = this.viewProps();
		const chartMetric = this.selectedChartMetric();
		const productMap = new Map<number, Product>(this.supplierProducts().map(p => [p.id, p]));
		console.log('Processing orders for view:', viewProps, 'with metric:', chartMetric);
		console.log('Product map:', productMap);


		if (viewProps === 'product') {
			const productSummaryMap: { [productId: number]: ProductSummary } = {};
			orders.forEach(order => {
				if (order.status === OrderStatus.Sent && order.orderProducts) {
					order.orderProducts.forEach(product => {
						if (!productSummaryMap[product.productId]) {
							productSummaryMap[product.productId] = {
								productId: product.productId, name: product.name, cost: product.cost, values: {},
								categoryName: productMap.get(product.productId)?.categoryName || 'ללא קטגוריה',
							};
						}
						let value: number;
						if (chartMetric === 'cost') {
							value = product.quantity * (product.cost || 0);
						} else if (chartMetric === 'price') {
							value = product.quantity * (product.price || 0);
						} else { // quantity
							value = product.quantity;
						}
						productSummaryMap[product.productId].values[order.date] = (productSummaryMap[product.productId].values[order.date] || 0) + value;
					});
				}
			});
			this.products.set(Object.values(productSummaryMap));
		}
		else {
			// Category View
			const categoryMap: { [categoryId: number]: ProductSummary } = {};
			orders.forEach(order => {
				if (order.status === OrderStatus.Sent && order.orderProducts) {
					order.orderProducts.forEach(product => {
						const supplierProduct = productMap.get(product.productId);
						const categoryId = supplierProduct?.categoryId || 0;
						const categoryName = supplierProduct?.categoryName || 'ללא קטגוריה';
						if (!categoryMap[categoryId]) {
							categoryMap[categoryId] = { categoryId, name: categoryName, values: {} };
						}
						let value: number;
						if (chartMetric === 'cost') {
							value = product.quantity * (product.cost || 0);
						} else if (chartMetric === 'price') {
							value = product.quantity * (product.price || 0);
						} else { // quantity
							value = product.quantity;
						}
						categoryMap[categoryId].values[order.date] = (categoryMap[categoryId].values[order.date] || 0) + value;
					});
				}
			});
			this.products.set(Object.values(categoryMap));
		}
		// After processing, update the date display
		this.updateDateDisplay(this.startDate(), this.endDate());
	}

	private finishFetch(supplierId: number, startDate: string, endDate: string) {
		this.lastFetchedRange.set({ startDate, endDate });
		this.lastFetchedSupplierId.set(supplierId);
		this.isFetching.set(false);
	}

	private getBaseChartOptions(): any {
		const documentStyle = typeof window !== 'undefined' ? getComputedStyle(document.documentElement) : null;
		const textColor = documentStyle?.getPropertyValue('--text-color') || '#495057';
		const textColorSecondary = documentStyle?.getPropertyValue('--text-color-secondary') || '#6c757d';
		const surfaceBorder = documentStyle?.getPropertyValue('--surface-border') || '#dfe7ef';
		console.log(this.selectedChartMetric());

		return {
			...ChartDefaultSettings, animation: { ...BaseChartAnimation },
			plugins: {
				legend: {
					display: true, position: 'top', rtl: true, align: 'start', labels: {
						boxWidth: 4,
						boxHeight: 4,
						padding: 16,
						usePointStyle: true
					},
				},
				title: { display: true, text: 'היסטורית הזמנות', color: textColor, padding: { top: 10, bottom: 10 }, font: { size: 16, weight: '600' } },
				tooltip: { ...TooltipChart },
			},
			scales: {
				x: {
					stacked: true, reverse: true, offset: true, grid: { color: surfaceBorder, drawBorder: false },
					ticks: { color: textColorSecondary, font: { size: 12 }, padding: 10 },
					title: { display: true, text: 'תאריך', color: textColor, font: { size: 14, weight: '500' }, padding: { top: 12 } },
				},
				y: {
					stacked: true, beginAtZero: true, grid: { color: surfaceBorder, drawBorder: false },
					ticks: { color: textColorSecondary, precision: 0, font: { size: 12 }, padding: 10 },
					title: { display: true, text: 'כמות', color: textColor, font: { size: 14, weight: '500' }, padding: { bottom: 12 } },
				},
			},
		};
	}

	private updateDynamicChartOptions(type: ChartType, chartMetric: ChartMetric = this.selectedChartMetric()) {
		if (!this.baseChartOptionsInternal) return;
		const newOptions = JSON.parse(JSON.stringify(this.baseChartOptionsInternal)); // Deep copy
		const currentMetricOption = this.chartMetricOptions.find(option => option.value === chartMetric);
		const yAxisTitle = currentMetricOption?.yAxis || 'ערך';

		const titleMap: Record<ChartType, string> = {
			line: 'היסטורית הזמנות', bar: 'היסטורית הזמנות',
			doughnut: 'התפלגות כוללת',
		};
		newOptions.plugins.title.text = titleMap[type] || 'היסטורית הזמנות';

		// תיקון ה-tooltip callback
		newOptions.plugins.tooltip = {
			...TooltipChart,
			callbacks: {
				label: (context: any) => {
					// וודא שהלייבל הוא מחרוזת
					const label = String(context.dataset.label || '');
					const rawValue = context.parsed.y !== undefined ? context.parsed.y : context.parsed;
					// וודא שהערך הוא מספר תקין
					const value = typeof rawValue === 'number' && !isNaN(rawValue) ? rawValue : 0;
					const metric = this.selectedChartMetric();
					const formattedValue = (metric === 'cost' || metric === 'price') ? `${value.toFixed(2)} ₪` : value.toString();
					return `${label}: ${formattedValue}`;
				},
				title: (context: any) => {
					// וודא שגם הכותרת היא מחרוזת
					if (context && context.length > 0) {
						return String(context[0].label || '');
					}
					return '';
				}
			},
		}

		if (newOptions.scales) {
			newOptions.scales.y.title.text = yAxisTitle;
			newOptions.scales.x.stacked = type === 'bar' && this.splitChartByProp();
			newOptions.scales.y.stacked = type === 'bar' && this.splitChartByProp();
		}

		if (type === 'doughnut') {
			newOptions.scales = undefined; // No axes for doughnut chart
			newOptions.plugins.legend.position = 'right';
			newOptions.plugins.tooltip.mode = 'point';
		} else {
			newOptions.plugins.legend.position = 'top';
			newOptions.plugins.tooltip.mode = 'index';
		}
		this.chartOptions.set(newOptions);
	}
	private updateChartData() {
		const currentProducts = this.products();
		const currentDates = this.dates();
		const type = this.selectedChartType();
		if (currentProducts.length === 0 || currentDates.length === 0) {
			this.chartData.set(null);
			return;
		}

		const labels = currentDates.map(date => `${this.formatDisplayDate(date.date).slice(0, 5)} (${date.hebrewDay})`);
		let newChartData;

		if (type === 'doughnut') {
			const doughnutLabels = currentProducts.map(p => p.name);
			const doughnutData = currentProducts.map(p => Object.values(p.values).reduce((sum, val) => sum + val, 0));
			const backgroundColors = currentProducts.map((_, i) => LightChartColors[i % LightChartColors.length]);
			newChartData = {
				labels: doughnutLabels,
				datasets: [{ data: doughnutData, backgroundColor: backgroundColors }],
			};
		} else if (this.splitChartByProp()) {
			newChartData = {
				labels,
				datasets: currentProducts.map((product, index) => ({
					label: product.name,
					data: currentDates.map(date => product.values[date.date] || 0),
					borderColor: LightChartColors[index % LightChartColors.length],
					backgroundColor: LightChartColors[index % LightChartColors.length],
					fill: false,
					tension: 0.4,
					borderWidth: 2,
					pointRadius: 2,
				})),
			};
		} else {
			const totalValues = currentDates.map(date =>
				currentProducts.reduce((sum, product) => sum + (product.values[date.date] || 0), 0)
			);
			newChartData = {
				labels,
				datasets: [{
					label: 'סה"כ',
					data: totalValues,
					borderColor: LightChartColors[0],
					backgroundColor: LightChartColors[0],
					fill: false,
					tension: 0.4,
					borderWidth: 2,
				}],
			};
		}
		this.chartData.set(newChartData);
	}

	private updateDateDisplay(startDateStr: string, endDateStr: string) {
		const datesArray: DateDisplay[] = [];
		const today = new Date();
		today.setHours(0, 0, 0, 0);
		const todayTime = today.getTime();
		let current = new Date(startDateStr);
		const end = new Date(endDateStr);

		const orderDates = new Set(this.rawOrders().map(order => order.date));

		while (current <= end) {
			const dateStr = this.formatDate(current);
			if (orderDates.has(dateStr)) {
				const firstDayOfYear = new Date(current.getFullYear(), 0, 1);
				const pastDaysOfYear = (current.getTime() - firstDayOfYear.getTime()) / 86400000;
				const weekNumber = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
				datesArray.push({
					date: dateStr,
					formatted: dateStr,
					hebrewDay: this.hebrewDayPipe.transform(current.getDay()),
					isToday: current.getTime() === todayTime,
					weekNumber: weekNumber,
					isPastOrToday: current.getTime() <= todayTime,
				});
			}
			current.setDate(current.getDate() + 1);
		}
		this.dates.set(datesArray.sort((a, b) => a.date.localeCompare(b.date)));
	}

	getTableCellValue(product: ProductSummary, date: DateDisplay): string | number {
		const value = product.values[date.date] || 0;
		if (value === 0) {
			return date.isPastOrToday ? '-' : '';
		}
		if (this.selectedChartMetric() === 'cost' || this.selectedChartMetric() === 'price') {
			return `${value.toFixed(2)} ₪`;
		}
		return value;
	}

	prevPeriod() {
		if (this.isFetching()) return;
		const start = new Date(this.startDate());
		if (this.viewMode() === 'weekly') start.setDate(start.getDate() - 7);
		else { start.setMonth(start.getMonth() - 1); start.setDate(1); }
		const end = new Date(start);
		if (this.viewMode() === 'weekly') end.setDate(start.getDate() + 6);
		else end.setMonth(start.getMonth() + 1, 0);
		this.startDate.set(this.formatDate(start));
		this.endDate.set(this.formatDate(end));
	}

	nextPeriod() {
		if (this.isFetching()) return;
		const start = new Date(this.startDate());
		let newStart = new Date(start);
		if (this.viewMode() === 'weekly') newStart.setDate(start.getDate() + 7);
		else { newStart.setMonth(start.getMonth() + 1); newStart.setDate(1); }
		const today = new Date();
		today.setHours(0, 0, 0, 0);
		if (newStart > today) return;
		let newEnd = new Date(newStart);
		if (this.viewMode() === 'weekly') newEnd.setDate(newStart.getDate() + 6);
		else newEnd = new Date(newStart.getFullYear(), newStart.getMonth() + 1, 0);
		this.startDate.set(this.formatDate(newStart));
		this.endDate.set(this.formatDate(newEnd));
	}

	getTotalForDate(date: DateDisplay): string | number {
		const total = this.products().reduce((sum, product) => {
			const value = product.values[date.date] || 0;
			return sum + value;
		}, 0);
		return this.getTableCellValue({ name: 'Total', values: { [date.date]: total } } as ProductSummary, date);
	}


	// --- Signals for UI state ---
	isUploading = signal(false);
	isDraggingOver = signal(false);

	// --- Drag & Drop Handlers ---
	onDragOver(event: DragEvent): void {
		event.preventDefault();
		this.isDraggingOver.set(true);
	}

	onDragLeave(event: DragEvent): void {
		event.preventDefault();
		this.isDraggingOver.set(false);
	}

	onDrop(event: DragEvent, supplierId: number): void {
		event.preventDefault();
		this.isDraggingOver.set(false);
		const file = event.dataTransfer?.files[0];
		if (file) {
			this.uploadFile(file, supplierId);
		}
	}

	onFileSelect(event: Event, supplierId: number): void {
		const input = event.target as HTMLInputElement;
		const file = input.files?.[0];
		if (file) {
			this.uploadFile(file, supplierId);
		}
		input.value = ''; // Reset input to allow re-selecting the same file
	}

	// --- Core Logic ---
	private uploadFile(file: File, supplierId: number): void {
		if (!file.name.endsWith('.txt')) {
			this.notificationService.toast({
				severity: 'warn',
				summary: 'קובץ לא נתמך',
				detail: 'יש לבחור קובץ מסוג .txt בלבד.',
			});
			return;
		}

		this.isUploading.set(true);

		this.apiService.uploadTxtFile(file, supplierId).subscribe({
			next: (response) => {
				if (response.success) {
					this.notificationService.toast({
						severity: 'success',
						detail: `הקובץ עובד בהצלחה.`,
						life: 5000,
					});
					this.refreshData();
				} else {
					this.notificationService.toast({
						severity: 'error',
						detail: response.message || 'אירעה שגיאה לא צפויה.',
					});
				}
			},
			error: (error) => {
				this.notificationService.toast({
					severity: 'error',
					detail: error.error?.message || error.message || 'לא ניתן היה להעלות את הקובץ.',
				});
			},
			complete: () => {
				this.isUploading.set(false);
			}
		});
	}

	deleteAllOrders(supplierId: number): void {
		const supplierName = this.suppliers().find(s => s.id === supplierId)?.name || `ספק ${supplierId}`;

		this.notificationService.confirm({
			header: 'אישור מחיקה מלאה',
			message: `האם אתה בטוח שברצונך למחוק את **כל** ההזמנות של הספק **${supplierName}**? פעולה זו הינה סופית ולא ניתנת לשחזור.`,
			icon: 'pi pi-exclamation-triangle',
			acceptLabel: 'כן, מחק הכל',
		}).subscribe((accepted) => {
			if (!accepted) return;

			this.apiService.deleteSupplierOrders(supplierId).subscribe({
				next: (response) => {
					this.notificationService.toast({
						severity: 'success',
						detail: `כל ההזמנות של ${supplierName} נמחקו בהצלחה.`,
					});
					this.refreshData(); // רענן את הנתונים
				},
				error: (error) => {
					this.notificationService.toast({
						severity: 'error',
						detail: error.error?.message || 'לא ניתן היה למחוק את ההזמנות.',
					});
				}
			});
		});
	}

	// Ensure you have this method in your component
	refreshOrders(): void {
		// Implement the logic to refresh the order list, for example:
		this.fetchOrders();
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\shared\badge\badge.component.css ---
.badge {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: 0.4em;
	border-radius: 999px;
	font-weight: 500;
	line-height: 1.3;;
	letter-spacing: 0.025em;
	white-space: nowrap;
	text-align: center;

	background-color: var(--grey-70);
	color: #495057;

	/* box-shadow:
		0 1px 2px 0 rgba(0, 0, 0, 0.06),
		0 1px 3px 0 rgba(0, 0, 0, 0.04); */
	transition:
		transform 0.15s ease-out,
		box-shadow 0.15s ease-out,
		background-color 0.15s ease-out,
		color 0.15s ease-out;

	outline: 2px solid transparent;
	outline-offset: 1px;
}

.badge:hover {
	/* transform: translateY(-1px);
	box-shadow:
		0 3px 6px -1px rgba(0, 0, 0, 0.08),
		0 2px 4px -2px rgba(0, 0, 0, 0.05); */
}

.badge:focus-visible {
	outline-color: var(--primary-color, #007bff);
	box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.badge i,
      .badge .pi, /* PrimeIcons */
      .badge [class^="bi-"], /* Bootstrap Icons */
      .badge [class*="bi-"],
      .badge .material-symbols-outlined, /* Material Symbols */
      .badge .material-symbols-rounded,
      .badge .material-symbols-sharp {
	font-size: 1em; /* Icon scales with the badge's font size */
	line-height: 1; /* Helps with vertical alignment */
	/* 'gap' property on .badge handles spacing */
}

/* Sizing Variants - using 'em' for padding to scale with font-size */
.badge-sm {
	padding: 0.3em 0.8em; /* Slightly more vertical padding */
	font-size: 9px;
}
.badge-sm > [class*='pi-'],
.badge-sm > i,
.badge-sm > [class^='material-symbols'] {
	font-size: 0.9em;
} /* Slightly smaller icon for the smallest badge */

.badge-md {
	padding: 0.3em 0.85em;
	font-size: 10px;
}
.badge-md > [class*='pi-'],
.badge-md > i,
.badge-md > [class^='material-symbols'] {
	font-size: 0.95em;
}

.badge-lg {
	padding: 0.4em 1em;
	font-size: 11px;
}
/* For -lg and -xl, icon size of 1em (parent font-size) is usually fine */

.badge-xl {
	padding: 0.5em 1.2em;
	font-size: 13px;
}

/* RTL adjustments are generally handled well by flexbox 'gap'. 
         If specific icon margin is needed in RTL, it can be added back.
         The original RTL rules were:
         [dir='rtl'] .badge i,
         [dir='rtl'] .badge [class^='pi-'] {
           margin-left: 0;
           margin-right: 1px; // Or a small 'em' value like 0.1em
         }
         For now, relying on 'gap'.
      */

--- END OF FILE ---
--- START OF FILE src\app\components\shared\badge\badge.component.html ---
<p>badge works!</p>

--- END OF FILE ---
--- START OF FILE src\app\components\shared\badge\badge.component.ts ---
import { Component, computed, input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { TooltipModule } from 'primeng/tooltip';
import { EnumData } from '../../../common/models/enumData';


@Component({
	selector: 'app-badge',
	standalone: true,
	imports: [CommonModule, TooltipModule],
	template: `
		<span
			[class]="'badge' + (size() ? ' badge-' + size() : '')"
			[ngClass]="selectedData()?.tailwind || defaultTailwind()"
			tabindex="0"
			>

			<span class="{{ selectedData()?.icon || defaultIcon() }}"></span>
			{{ label() ? label() : selectedData()?.label || 'הזמנה' }}
		</span>
	`,
	styleUrls: ['./badge.component.css'],

})
export class BadgeComponent {
	enumValue = input<number | string | null>((null));
	dataArray = input<EnumData[]>([]);
	data = input<EnumData | undefined>(undefined);
	defaultTailwind = input<string>('bg-gray-60 text-gray-800 hover bg-gray-80');
	label = input<string>('');
	defaultIcon = input<string>('pi pi-tag');
	size = input<'sm' | 'md' | 'lg' | 'xl'>('md');

	selectedData = computed(() => {
		if (this.data()) {
			return this.data();
		}

		if (this.enumValue() !== null && this.enumValue() !== undefined && this.dataArray()) {
			return this.dataArray().find(
				(d) =>
					d.enumValue === this.enumValue() ||
					(typeof this.enumValue() === 'string' && d.enumValue.toString() === this.enumValue())
			);
		}

		return undefined;
	});

}

--- END OF FILE ---
--- START OF FILE src\app\components\shared\count-up\count-up.component.css ---
.count-up {
	display: inline-block;
	font-variant-numeric: tabular-nums;
	font-feature-settings: 'tnum';
	transition: all 0.3s ease;
	position: relative;
	font-weight: 600;
	white-space: nowrap;
}

/* אנימציית כניסה - רק בטעינה ראשונה */
.count-up.first-load {
	animation: fadeInUp 0.5s ease-out;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* גדלים שונים */
.count-up[data-size='small'] {
	font-size: 0.875rem;
	line-height: 1.25rem;
}

.count-up[data-size='medium'] {
	font-size: 1.5rem;
	line-height: 2rem;
}

.count-up[data-size='large'] {
	font-size: 2.25rem;
	line-height: 2.5rem;
}

.count-up[data-size='xl'] {
	font-size: 3rem;
	line-height: 1;
}

/* נושאים/תמות */
.count-up[data-theme='default'] {
	color: #1f2937;
}

.count-up[data-theme='primary'] {
	color: #3b82f6;
	text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
}

.count-up[data-theme='success'] {
	color: #10b981;
	text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}

.count-up[data-theme='warning'] {
	color: #f59e0b;
	text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
}

.count-up[data-theme='danger'] {
	color: #ef4444;
	text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
}

.count-up[data-theme='gradient'] {
	background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
	background-clip: text;
}

.count-up[data-theme='neon'] {
	color: #00ffff;
	text-shadow:
		0 0 5px #00ffff,
		0 0 10px #00ffff,
		0 0 15px #00ffff,
		0 0 20px #00ffff;
	animation: neon-pulse 2s infinite alternate;
}

@keyframes neon-pulse {
	from {
		text-shadow:
			0 0 5px #00ffff,
			0 0 10px #00ffff,
			0 0 15px #00ffff,
			0 0 20px #00ffff;
	}
	to {
		text-shadow:
			0 0 2px #00ffff,
			0 0 5px #00ffff,
			0 0 8px #00ffff,
			0 0 12px #00ffff;
	}
}

/* אנימציות במהלך הספירה */
.count-up.counting {
	transform: scale(1.05);
}

.count-up.counting[data-theme='primary'] {
	animation: counting-pulse 0.5s ease-in-out infinite alternate;
}

.count-up.counting[data-theme='success'] {
	animation: counting-glow 0.8s ease-in-out infinite alternate;
}

@keyframes counting-pulse {
	from {
		transform: scale(1.05);
		opacity: 0.9;
	}
	to {
		transform: scale(1.1);
		opacity: 1;
	}
}

@keyframes counting-glow {
	from {
		filter: brightness(1);
	}
	to {
		filter: brightness(1.2);
	}
}

/* אנימציה כשהספירה מסתיימת */
.count-up.completed {
	animation: completion-bounce 0.6s ease-out;
}

@keyframes completion-bounce {
	0% {
		transform: scale(1);
	}
	50% {
		transform: scale(1.15);
	}
	100% {
		transform: scale(1);
	}
}

/* הוספת אפקט צל */
.count-up[data-theme='shadow'] {
	color: #1f2937;
	text-shadow:
		0 1px 0 #ccc,
		0 2px 0 #c9c9c9,
		0 3px 0 #bbb,
		0 4px 0 #b9b9b9,
		0 5px 0 #aaa,
		0 6px 1px rgba(0, 0, 0, 0.1),
		0 0 5px rgba(0, 0, 0, 0.1),
		0 1px 3px rgba(0, 0, 0, 0.3),
		0 3px 5px rgba(0, 0, 0, 0.2),
		0 5px 10px rgba(0, 0, 0, 0.25);
}

/* מצב כהה */
.count-up[data-theme='dark'] {
	color: #f8fafc;
	text-shadow: 0 0 10px rgba(248, 250, 252, 0.5);
}

/* אפקט מטריקס */
.count-up[data-theme='matrix'] {
	color: #00ff00;
	font-family: 'Courier New', monospace;
	text-shadow: 0 0 10px #00ff00;
	animation: matrix-flicker 0.15s infinite linear;
}

@keyframes matrix-flicker {
	0%,
	100% {
		opacity: 1;
	}
	50% {
		opacity: 0.8;
	}
}

/* responsive */
@media (max-width: 768px) {
	.count-up[data-size='large'] {
		font-size: 1.875rem;
		line-height: 2.25rem;
	}

	.count-up[data-size='xl'] {
		font-size: 2.25rem;
		line-height: 2.5rem;
	}
}

/* אפקט loading */
.count-up.loading {
	opacity: 0.6;
	animation: loading-pulse 1s infinite;
}

@keyframes loading-pulse {
	0%,
	100% {
		opacity: 0.6;
	}
	50% {
		opacity: 1;
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\shared\count-up\count-up.component.html ---
<p>count-up works!</p>

--- END OF FILE ---
--- START OF FILE src\app\components\shared\count-up\count-up.component.ts ---
import { Component, OnDestroy, signal, computed, OnInit, effect, untracked, input } from '@angular/core';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'count-up',
  standalone: true,
  imports: [CommonModule],
  styleUrl: './count-up.component.css',
  template: `
    <span
      class="count-up"
      [class.counting]="isAnimating()"
      [class.completed]="isCompleted()"
      [class.first-load]="isFirstLoad()"
      [attr.data-theme]="theme()"
      [attr.data-size]="size()"
    >
      {{ formatted() }}
    </span>
  `,
})
export class CountUpComponent implements OnInit, OnDestroy {
  readonly to = input.required<number>();
  readonly from = input<number | null>(null);
  readonly duration = input(1000);
  readonly type = input<'number' | 'percent' | 'currency'>('number');
  readonly decimals = input(0);
  readonly separator = input(',');
  readonly decimalSeparator = input('.');
  readonly prefix = input('');
  readonly suffix = input('');
  readonly easing = input<'linear' | 'easeOut' | 'easeInOut' | 'bounce'>('easeOut');
  readonly theme = input<'default' | 'primary' | 'success' | 'warning' | 'danger' | 'gradient' | 'neon' | 'shadow' | 'dark' | 'matrix'>('default');
  readonly size = input<'small' | 'medium' | 'large' | 'xl'>('medium');
  readonly resetOnChange = input(false);
  readonly withAnimation = input(true);

  private current = signal(0);
  private animationId: number | null = null;

  isAnimating = signal(false);
  isCompleted = signal(false);
  isFirstLoad = signal(true);

  formatted = computed(() => this.format(this.current()));

  ngOnInit(): void {
    setTimeout(() => {
      this.isFirstLoad.set(false);
    }, 500);
  }

  constructor() {
    // The effect now automatically re-runs when `this.to()`'s value changes
    effect(() => {
      // Access the signal value by calling it
      const newTo = this.to();

      if (this.withAnimation()) {
        // Using untracked to prevent the animation logic from creating an unwanted dependency
        untracked(() => {
          const from = this.resetOnChange() ? 0 : this.current();
          this.animate(from, newTo, this.duration());
        });
      } else {
        // If animation is off, just set the final value immediately
        this.current.set(newTo);
      }
    });
  }

  ngOnDestroy(): void {
    if (this.animationId) {
      cancelAnimationFrame(this.animationId);
    }
  }

  restart(): void {
    this.animate(0, this.to(), this.duration());
  }

  stop(): void {
    if (this.animationId) {
      cancelAnimationFrame(this.animationId);
      this.animationId = null;
      this.isAnimating.set(false);
    }
  }

  private animate(from: number, to: number, duration: number): void {
    if (this.animationId) {
      cancelAnimationFrame(this.animationId);
    }

    this.isAnimating.set(true);
    this.isCompleted.set(false);

    const start = performance.now();
    const step = (now: number) => {
      const progress = Math.min((now - start) / duration, 1);
      const eased = this.applyEasing(progress);
      const value = from + (to - from) * eased;

      this.current.set(value);

      if (progress < 1) {
        this.animationId = requestAnimationFrame(step);
      } else {
        this.animationId = null;
        this.isAnimating.set(false);
        this.isCompleted.set(true);
      }
    };

    this.animationId = requestAnimationFrame(step);
  }

  private applyEasing(progress: number): number {
    // Access the easing signal value
    switch (this.easing()) {
      case 'linear':
        return progress;
      case 'easeOut':
        return 1 - Math.pow(1 - progress, 3);
      case 'easeInOut':
        return progress < 0.5
          ? 2 * progress * progress
          : 1 - Math.pow(-2 * progress + 2, 3) / 2;
      case 'bounce':
        return this.bounceEasing(progress);
      default:
        return 1 - Math.pow(1 - progress, 3);
    }
  }

  private bounceEasing(t: number): number {
    const n1 = 7.5625;
    const d1 = 2.75;

    if (t < 1 / d1) {
      return n1 * t * t;
    } else if (t < 2 / d1) {
      return n1 * (t -= 1.5 / d1) * t + 0.75;
    } else if (t < 2.5 / d1) {
      return n1 * (t -= 2.25 / d1) * t + 0.9375;
    } else {
      return n1 * (t -= 2.625 / d1) * t + 0.984375;
    }
  }

  private format(value: number): string {
    // Access the decimals, separator, decimalSeparator, type, prefix, and suffix signal values
    const rounded = this.decimals() > 0 ?
      value.toFixed(this.decimals()) :
      Math.floor(value).toString();

    let formatted = rounded;

    if (this.separator()) {
      const parts = formatted.split('.');
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, this.separator());
      formatted = parts.join(this.decimalSeparator());
    }

    switch (this.type()) {
      case 'percent':
        return `${this.prefix()}${formatted}%${this.suffix()}`;
      case 'currency':
        return `${this.prefix()}${formatted}${this.suffix()}`;
      default:
        return `${this.prefix()}${formatted}${this.suffix()}`;
    }
  }
}

--- END OF FILE ---
--- START OF FILE src\app\components\shared\header\header.component.css ---
/* in header.component.css */

.header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 0 1.5rem;
	height: var(--header-height);
	background-color: var(--frame-bg);
	/* border-bottom: 1px solid var(--grey-100); */

	.header-left,
	.header-right {
		flex: 1 1 0%;
	}

	.header-center {
		flex: 2 1 0%;
		display: flex;
		justify-content: center;
	}

	.header-right {
		display: flex;
		justify-content: flex-end;
		align-items: center;
		gap: 12px;
	}

	/* --- Insights Bell --- */
	.today-orders,
	.insights-bell {
		cursor: pointer;
		position: relative;

		.pi-sparkles,
		.pi-bell {
			font-size: 1.5rem;
			color: var(--grey-600);
			transition: color 0.2s;
		}
		p-badge.custom-badge.p-badge.p-badge-circle.p-component.ng-star-inserted {
			background: var(--secondary-400);
			border: 2px solid var(--frame-bg);
			padding: 4px;
			color: var(--secondary-900);
			top: 4px;
		}

		&:hover {
			.pi-sparkles,
			.pi-bell {
				color: var(--secondary-400);
			}
			p-badge.p-badge {
				scale: 1.1;
			}
		}

		p-badge.p-badge {
			transition: 0.2s all ease-in-out;
			font-family: Fredoka;
			min-width: 16px !important;
			height: 17px !important;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 9px;
			border-radius: 50px;

			&::after {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%); /* ✅ מרכז את האפקט */
				border-radius: 50%;
				border: 1px solid var(--secondary-300); /* ✅ משתמש במשתנה צבע */
				/* animation: ripple-effect 1.25s infinite; */
				pointer-events: none; /* ✅ למנוע הפרעה לקליקים */
			}
			&::before {
				content: '';
				position: absolute;
				top: -5px;
				left: -5px;
				right: -5px;
				bottom: -5px;
				border: 2px solid var(--secondary-300);
				border-radius: 50%;
				/* animation: ripple 3.75s infinite; */
				opacity: 0;
			}
		}
	}

	/* --- User Info Dropdown --- */
	.user-info {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.25rem 0.5rem;
		border-radius: 20px;
		cursor: pointer;
		transition: background-color 0.2s;

		&:hover {
			background-color: var(--grey-100);
		}

		.user-avatar {
			width: 24px;
			height: 24px;
			border-radius: 50%;
			background-color: var(--secondary-300);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 600;
			font-size: 0.9rem;
		}

		.username {
			color: var(--grey-800);
			font-weight: 500;
		}

		.pi-chevron-down {
			font-size: 0.8rem;
			color: var(--grey-500);
		}
	}
}

/* in header.component.css */
.account-info {
	text-align: center;
	padding: 6px 12px ;
	border-bottom: 1px solid var(--grey-100);

	.account-name {
		display: block;
		font-weight: 600;
		font-size: 14px;
		color: var(--grey-800);
	}
	.account-role {
		font-size: 0.75rem;
		color: var(--grey-500);
	}
}

/* --- Popover Global Styles (Scoped to this component) --- */
::ng-deep .p-popover {
	/* background: linear-gradient(white, rgba(255, 255, 255, 0.6)) !important; */
	/* backdrop-filter: blur(8px); */
	background-color: white;
}
::ng-deep .p-popover .p-popover-content {
	padding: 0 0 4px 0 !important;
	position: relative;
}
/* ::ng-deep .p-popover .p-popover-content::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	width: 100%;
	height: 24px;
	border-radius: 0 0 12px 12px;
	background: linear-gradient(
		to top,
		rgba(255, 255, 255, 1) 0%,
		rgba(255, 255, 255, 0.8) 50%,
		rgba(255, 255, 255, 0) 100%
	);
	background-color: white;

	pointer-events: none;
	z-index: 2;
} */

/* --- Insights Panel --- */
.insights-panel {
	display: flex;
	flex-direction: column;
	max-width: 400px;
	position: relative;

	.pi-sparkles.gradient-icon {
		background: linear-gradient(135deg, #e5e5e58c 0%, #edeaea30 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		font-size: 160px; /* יותר גדול */
		line-height: 1;
		z-index: -1; /* מאחורי התוכן */
		pointer-events: none; /* שלא יתפוס קליקים */
	}

	.panel-header {
		padding: 0.5rem;
		border-bottom: 1px solid var(--grey-100);
		display: flex;
		width: 100%;
		justify-content: space-between;
		align-items: center;
		position: relative;

		h3 {
			margin: 0;
			font-size: 1rem;
			font-weight: 600;
			color: var(--grey-800);
		}

		/* &::after {
			content: '';
			position: absolute;
			bottom: -25px;
			left: 0;
			width: calc(100% - 12px);
			transform: translateX(6px);
			height: 20px;
			border-radius: 0 0 12px 12px;
			background: linear-gradient(
				to top,
				rgba(255, 255, 255, 0) 0%,
				rgba(255, 255, 255, 0.8) 50%,
				rgba(255, 255, 255, 1) 100%
			);

			pointer-events: none;
			z-index: 12;
		} */
	}

	.panel-content {
		padding: 0.5rem;
		max-height: 400px;
		overflow-y: auto;

		.insight-wrapper {
			display: flex;
			flex-direction: column;
			gap: 0.5rem;
		}
		.insight-item {
			display: flex;
			flex-direction: column;
			margin: 6px 0;
			padding: 4px 0;
			position: relative;

			.hover-wrapper {
				display: flex;
				flex-direction: column;
				border-radius: 12px;
				padding: 8px;
				border: 1px solid transparent;
				transition: 0.15s all ease-in-out;

				&:hover {
					background-color: hsl(210deg 8% 98% / 41%);
					border: 1px solid hsl(210deg 8% 98% / 41%);
				}
			}

			&:after {
				content: '';
				width: 100%;
				height: 1px;
				background-color: var(--grey-40);
				position: absolute;
				bottom: -3px;
				left: 0;
			}

			.item-icon {
				color: var(--primary-400);
				font-size: 1.2rem;
				margin-top: 2px;
			}
			.item-emoji {
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.2rem;
				margin-top: 2px;
				width: 24px; /* ✅ קובע רוחב אחיד */
				height: 24px; /* ✅ קובע גובה אחיד */
				line-height: 1; /* ✅ מבטיח שהאימוג'י יהיה ממורכז אנכית */
			}

			.item-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				width: 100%;
				.item-title {
					display: block;
					font-weight: 600;
					color: var(--grey-700);
					line-height: 15px;
				}
			}
			.item-text {
				margin: 0;
				color: var(--grey-500);
				font-size: 12px;
			}
		}
	}
}

/* --- User Panel --- */
.user-panel {
	padding: 0;

	.action-item {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		cursor: pointer;
		transition: background-color 0.2s;
		color: var(--grey-700);
		padding:  4px 12px;
		font-size: 14px;
		border-radius: 6px;

		&:hover {
			background-color: var(--grey-50);
		}

		.pi {
			font-size: 14px;
		}

		&.logout {
			color: var(--red-500);

			&:hover {
				background-color: var(--red-500);
				color: var(--red-50);
			}
		}
	}

	.separator {
		height: 1px;
		background-color: var(--grey-100);
		/* margin: 4px 0; */
	}
}

@keyframes ripple-effect {
	0% {
		width: 100%;
		height: 100%;
		opacity: 1;
	}
	100% {
		width: 300%; /* ✅ פחות קיצוני מ-2000% */
		height: 300%;
		opacity: 0;
	}
}

@keyframes ripple {
	0% {
		transform: scale(0.8);
		opacity: 1;
	}
	100% {
		transform: scale(2.5);
		opacity: 0;
	}
}

--- END OF FILE ---
--- START OF FILE src\app\components\shared\header\header.component.html ---
<!-- in header.component.html -->

<div class="header">
  <div class="header-left">
    <div [class.active]="isMobileMenuOpen()" (click)="toggleMobileMenu()" [ngClass]="{ opened: isMobileMenuOpen() }"
      aria-label="פתח/סגור תפריט" class="menu-btn">
      <span></span><span></span><span></span>
    </div>
  </div>

  <!-- <div class="header-center">
    <a routerLink="/" class="logo-link">
      <img src="assets/images/sapakit-logo-2.png" alt="Sapakit Logo" class="header-logo">
    </a>
  </div> -->

  <div class="header-right">

    <div class="flex gap-6">
      <!-- AI Insight -->
      <div class="flex items-center gap-3">
        <div class="insights-bell" (click)="insightsPopover.toggle($event)">
          <i class="pi pi-sparkles p-overlay-badge !text-base">
            @if (insightStore.hasUnread()) {
            <p-badge size="small" [value]="insightStore.unreadCount().toString()" styleClass="custom-badge"></p-badge>
            }
          </i>
        </div>
        <!-- ALARM - NOTIFICATIONS - TODAY ORDERS -->
        <div class="today-orders" (click)="todayOrdersPopup.toggle($event)">
          <i class="pi pi-bell p-overlay-badge !text-base">
            @if (stats().dueToday > 0) {
            <p-badge size="small" [value]="stats().dueToday.toString()" styleClass="custom-badge"></p-badge>
            }
          </i>
        </div>
      </div>
    </div>

    <!-- USER PROFILE  -->
    @if (!isGuest() && username()) {
    <div class="user-info" (click)="userPopover.toggle($event)">
      <div class="user-avatar">{{ username() ? username()![0].toUpperCase() : '' }}</div>
      <span class="username hide-max-sm">{{ username() }}</span>
      <i class="pi pi-chevron-down"></i>
    </div>

    }
  </div>
</div>



<!-- INSIGHT POPOVER -->
<p-popover #insightsPopover appendTo="body" styleClass="insights-popover">
  <ng-template pTemplate="content">
    <div class="insights-panel">
      <i class="pi pi-sparkles gradient-icon"></i>
      <div class="panel-header">
        <h3>תובנות AI חדשות</h3>
        <p-button class="material-symbols-rounded" size="small" [rounded]="true" severity="secondary"
          (click)="generateInsights()" pTooltip="צור תובנות">add_chart</p-button>
      </div>
      <div class="panel-content">
        @if (insightStore.hasUnread()) {
        @for (insight of insightStore.insights(); track insight.id) {
        <div class="insight-item">
          <div class="hover-wrapper">
            <div class="item-header">
              <div class="flex items-center gap-2">
                <!-- <i class="item-icon pi pi-info-circle"></i> -->
                <span class="item-emoji">{{ insight.emoji }}</span>
                <strong class="item-title">{{ insight.title }}</strong>
              </div>
              <p-button icon="pi pi-check" size="small" [rounded]="true" severity="secondary"
                (click)="markAsRead(insight)" pTooltip="סמן כנקרא"></p-button>
            </div>
            <p class="item-text">{{ insight.content }}</p>
          </div>
        </div>
        }
        } @else {
        <div class="empty-message">
          <i class="pi pi-check-circle"></i>
          <p>הכל מעודכן!</p>
          <span>אין תובנות חדשות כרגע.</span>
        </div>
        }
      </div>
    </div>
  </ng-template>
</p-popover>

<!--  TODAY ORDERS POPOVER-->
<p-popover #todayOrdersPopup appendTo="body" styleClass="today-orders-popover">
  <ng-template pTemplate="content">
    <div class="insights-panel">
      <div class="panel-header">
        <h3>הזמנות לביצוע היום</h3>
      </div>
      <div class="panel-content">
        @if (stats().dueToday && stats().dueToday > 0) {
        <p-table [value]="orders()" [scrollable]="true" scrollHeight="400px" size="small">
          <ng-template pTemplate="header">
            <tr>
              <th>ספק</th>
              <th>תאריך הזמנה</th>
              <th>סטטוס</th>
              <th></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-order>
            <tr [class.virtual-order]="order.status === OrderStatus.Today">
              <td>{{ order.supplierName }}</td>
              <td>{{ order.date | hebrewDate }}</td>
              <td>
                <app-badge [enumValue]="order.status" [dataArray]="orderStatusData"
                  [label]="order.status | orderStatusLabel">
                </app-badge>
              </td>
              <td>
                <div class="actions-cell">
                  <p-button [pTooltip]="order.id ? 'צפייה / עריכה' : 'צור הזמנה'" tooltipPosition="top"
                    [icon]="order.id ? 'pi pi-pen-to-square' : 'pi pi-expand'"
                    (click)="viewOrder(order, todayOrdersPopup)" size="small" [rounded]="true" severity="secondary">
                  </p-button>

                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
        } @else {
        <div class="empty-message">
          <i class="pi pi-check-circle"></i>
          <p>אין הזמנות לביצוע להיום!</p>
        </div>
        }
      </div>
    </div>
  </ng-template>
</p-popover>

<!-- USER POPOVER -->
<p-popover #userPopover appendTo="body" styleClass="user-popover">
  <ng-template pTemplate="content">
    <div class="user-panel">
      <div class="account-info">
        <span class="account-name">{{ user()?.account?.name }}</span>
        <!-- <span class="account-role">{{ user()?.role | userRole }}</span>  -->
      </div>
      <div class="flex flex-col gap-1 p-1">
        <div class="action-item" (click)="userPopover.hide()">
          <i class="pi pi-user"></i>
          <span>פרופיל</span>
        </div>

        <div class="action-item" (click)="userPopover.hide()">
          <i class="pi pi-cog"></i>
          <span>הגדרות</span>
        </div>

        <div class="separator"></div>

        <div class="action-item logout" (click)="logout(); userPopover.hide()">
          <i class="pi pi-sign-out"></i>
          <span>יציאה</span>
        </div>


      </div>
    </div>
  </ng-template>
</p-popover>
--- END OF FILE ---
--- START OF FILE src\app\components\shared\header\header.component.ts ---
import { UserStore } from './../../../store/user.store';
import { CommonModule } from '@angular/common';
import { Component, inject, computed } from '@angular/core';
import { RouterModule } from '@angular/router';
import { MenuService } from '../../../services/menu.service';
import { AuthStore } from '../../../store/auth.store';
import { InsightStore } from '../../../store/insight.store';
import { ApiService } from '../../../services/api.service';
import { StatsStore } from '../../../store/stats.store';
import { OrderFlowService } from '../../../services/order-flow.service';
import { SupplierStore } from '../../../store/supplier.store';
import { Insight } from '../../../common/models/insight';
import { BadgeComponent } from "../badge/badge.component";
import { HebrewDatePipe } from "../../../pipes/hebrew-date.pipe";
import { OrderStatusPipe } from "../../../pipes/orderStatus.pipe";
import { OrderStatus, orderStatusData } from '../../../common/enums/order-status.enum';
import { Order } from '../../../common/models/order';
import { OrderStore } from '../../../store/order.store';
import { parseDateStringAsLocal } from '../../../common/utils/date.utils';
import { NotificationService } from '../../../services/notification.service';

import { BadgeModule } from 'primeng/badge';
import { PopoverModule } from 'primeng/popover'; // ✅ ייבוא הרכיב החדש
import { ButtonModule } from 'primeng/button';
import { TableModule } from "primeng/table";
import { TooltipModule } from 'primeng/tooltip';
import { DialogService, DynamicDialogRef } from 'primeng/dynamicdialog';
import { userRolePipe } from "../../../pipes/userRole.pipe";
import { UserRole } from '../../../common/enums/userRole.enum';


@Component({
	selector: 'app-header',
	standalone: true,
	imports: [CommonModule, RouterModule, BadgeModule, PopoverModule, ButtonModule, TooltipModule, TableModule, BadgeComponent, HebrewDatePipe, OrderStatusPipe, userRolePipe], // ✅ עדכון ה-imports
	providers: [DialogService],
	templateUrl: './header.component.html',
	styleUrl: './header.component.css',
})
export class HeaderComponent {
	private readonly authStore = inject(AuthStore);
	private readonly statsStore = inject(StatsStore);
	private readonly supplierStore = inject(SupplierStore);
	private readonly orderStore = inject(OrderStore);
	public readonly insightStore = inject(InsightStore);

	// --- Services ---
	private readonly menuService = inject(MenuService);
	private readonly orderFlowService = inject(OrderFlowService);
	private readonly apiService = inject(ApiService);
	private readonly notificationService = inject(NotificationService);

	// Signals מה-Store נשארים
	public readonly user = this.authStore.user;
	public readonly isGuest = this.authStore.isGuest;
	public readonly isLoading = this.authStore.isLoading;
	public readonly username = computed(() => this.user()?.username || this.user()?.email);
	public readonly userRole = this.authStore.userRole;
	public readonly stats = this.statsStore.stats;

	public isMobileMenuOpen = this.menuService.isMobileMenuOpen;
	// private isUserPopoverOpen = this.menuService.isUserPopoverOpen;
	public readonly OrderStatus = OrderStatus;
	public readonly orderStatusData = orderStatusData;

	readonly orders = computed(() => {
		return this.orderStore.todayOrdersComputed();

	});

	ngOnInit() {
		if (this.userRole() != UserRole.SysAdmin) {
			this.insightStore.loadInsights();
		}
	}


	generateInsights() {
		this.apiService.getInsights().subscribe({
			next: (res) => {
				if (res.success) {
					console.log(res.result);

					this.insightStore.loadInsights();
				} else {
					console.error('Failed to load insights:', res.message);
				}
			},
			error: (err) => console.error('Error loading insights:', err)
		});
	}

	toggleMobileMenu(): void {
		this.menuService.toggleMobileMenu();
	}

	toggleUserPopover(): void {
		this.menuService.toggleUserPopover();
	}

	closeUserPopover(): void {
		this.menuService.closeUserPopover();
	}

	logout(): void {
		this.authStore.logout();
		this.closeUserPopover();
	}

	markAsRead(insight: Insight): void {
		this.insightStore.markAsRead(insight.id);
	}

	openOrderForSupplier(supplierId: number) {
		const supplier = this.supplierStore.suppliersById()[supplierId];
		if (supplier) {
			this.orderFlowService.openOrderDialog({
				supplier,
				date: new Date(),
				existingOrder: null
			});
		}
	}

	viewOrder(order: Order, popup: any): void {
		popup.hide()
		const supplier = this.supplierStore.getSupplierById(order.supplierId);
		if (!supplier) {
			this.notificationService.toast({ severity: 'warn', detail: 'הספק המשויך להזמנה לא נמצא.' });
			return;
		}
		const correctDate = parseDateStringAsLocal(order.date);
		this.orderFlowService.openOrderDialog({
			supplier: supplier,
			date: correctDate,
			existingOrder: order,
		});
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\shared\loader\loader.component.ts ---
import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';

@Component({
	selector: 'app-loader',
	imports: [CommonModule],
	standalone: true,
	template: `
		<div class="flex justify-center items-center">
			<div class="loader"></div>
		</div>
	`,
	styles: [
		`
			.loader {
				width: 48px;
				height: 48px;
				border: 3px dotted var(--primary-600);
				border-style: solid solid dotted dotted;
				border-radius: 50%;
				display: inline-block;
				position: relative;
				box-sizing: border-box;
				animation: rotation 2s linear infinite;
			}
			.loader::after {
				content: '';
				box-sizing: border-box;
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
				margin: auto;
				border: 3px dotted var(--primary-400);
				border-style: solid solid dotted;
				width: 24px;
				height: 24px;
				border-radius: 50%;
				animation: rotationBack 1s linear infinite;
				transform-origin: center center;
			}

			@keyframes rotation {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			@keyframes rotationBack {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(-360deg);
				}
			}
		`,
	],
})
export class LoaderComponent implements OnInit {
	constructor() {}

	ngOnInit() {}
}

--- END OF FILE ---
--- START OF FILE src\app\components\shared\password-input\password-input.component.ts ---
import { Component, input, effect, forwardRef } from '@angular/core';
import { ControlValueAccessor, FormControl, NG_VALUE_ACCESSOR, ReactiveFormsModule, ValidatorFn, Validators } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { PasswordModule } from 'primeng/password';
import { DividerModule } from 'primeng/divider';
import { detailedPasswordValidator } from '../../../common/const/custom-validators';

@Component({
  selector: 'app-password-input',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    PasswordModule,
    DividerModule
  ],
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => PasswordInputComponent),
      multi: true
    }
  ],
  template: `
    <div class="password-field">
      <p-password
        [id]="inputId()"
        [formControl]="passwordControl"
        [feedback]="showFeedback()"
        [toggleMask]="toggleMask()"
        [placeholder]="placeholder()"
        [promptLabel]="promptLabel()"
        [weakLabel]="weakLabel()"
        [mediumLabel]="mediumLabel()"
        [strongLabel]="strongLabel()"
        [autocomplete]="autocomplete()"
        [styleClass]="styleClass()">
        
        <ng-template #footer *ngIf="showRules()">
          <p-divider></p-divider>
          <ul class="password-rules">
            <li [class.valid]="passwordControl.value && !hasError('noLowerCase')">
              <i class="pi" [ngClass]="passwordControl.value && !hasError('noLowerCase') ? 'pi-check' : 'pi-times'"></i>
              <span>לפחות אות קטנה אחת</span>
            </li>
            <li [class.valid]="passwordControl.value && !hasError('noUpperCase')">
              <i class="pi" [ngClass]="passwordControl.value && !hasError('noUpperCase') ? 'pi-check' : 'pi-times'"></i>
              <span>לפחות אות גדולה אחת</span>
            </li>
            <li [class.valid]="passwordControl.value && !hasError('noNumeric')">
              <i class="pi" [ngClass]="passwordControl.value && !hasError('noNumeric') ? 'pi-check' : 'pi-times'"></i>
              <span>לפחות ספרה אחת</span>
            </li>
            <li [class.valid]="passwordControl.value && !hasError('minLength')">
              <i class="pi" [ngClass]="passwordControl.value && !hasError('minLength') ? 'pi-check' : 'pi-times'"></i>
              <span>מינימום {{ minLength() }} תווים</span>
            </li>
          </ul>
        </ng-template>
      </p-password>
      
      @if (showErrorMessage() && passwordControl.touched && passwordControl.invalid) {
        <span class="error-message">
          @if (passwordControl.hasError('required')) { יש להזין סיסמה }
          @if (passwordControl.hasError('minlength')) { הסיסמה חייבת להכיל לפחות {{ minLength() }} תווים }
          @if (passwordControl.hasError('weakPassword')) { הסיסמה חייבת להכיל אות גדולה, קטנה ומספר }
        </span>
      }
    </div>
  `,
  styles: [`
    :host {
      --p-password-strength-weak-background: linear-gradient(135deg, var(--red-500) 0%, var(--red-600) 50%, var(--red-700) 100%);
      --p-password-strength-medium-background: linear-gradient(135deg, var(--yellow-500) 0%, var(--yellow-600) 50%, var(--yellow-700) 100%);
      --p-password-strength-strong-background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 50%, var(--primary-700) 100%);
    }

    ::ng-deep .p-password-meter-text{
      font-size: 12px;
      padding: 0;
      margin: auto 0;
    }

    /* Password rules styling */
    .password-rules {
      list-style-type: none;
      padding: 0 1rem;
      margin: 0;
      font-size: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      
      li {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--grey-500); 
        transition: color 0.3s ease;
      }
      
      li .pi {
        font-size: 0.8rem;
        transition: color 0.3s ease;
        color: var(--red-400); 
      }
      
      li.valid span {
        color: var(--green-600); 
        text-decoration: line-through; 
      }
      
      li.valid .pi {
        color: var(--green-500); 
      }
    }


    .password-field {
      width: 100%;
    }
  `]
})
export class PasswordInputComponent implements ControlValueAccessor {
  // ✅ Using signal inputs
  inputId = input<string>('password');
  showFeedback = input<boolean>(true);
  toggleMask = input<boolean>(true);
  placeholder = input<string>('לפחות 8 תווים');
  promptLabel = input<string>('הזן סיסמה');
  weakLabel = input<string>('חלשה מדי');
  mediumLabel = input<string>('סבירה');
  strongLabel = input<string>('סיסמה חזקה');
  autocomplete = input<string>('new-password');
  styleClass = input<string>('');
  showRules = input<boolean>(true);
  showErrorMessage = input<boolean>(true);
  minLength = input<number>(8);
  useCustomValidator = input<boolean>(true);

  passwordControl = new FormControl('');

  constructor() {
    // ✅ Using effect to react to input changes
    effect(() => {
      this.updateValidators();
    });
    
    // Subscribe to password control changes
    this.passwordControl.valueChanges.subscribe(value => {
      this.onChange(value || '');
    });

    this.passwordControl.statusChanges.subscribe(() => {
        if (this.passwordControl.touched) {
            this.onTouched();
        }
    });
  }

  private updateValidators() {
    const validators: ValidatorFn[] = [Validators.required];
    
    if (this.useCustomValidator()) {
      validators.push(detailedPasswordValidator());
    } else {
      validators.push(Validators.minLength(this.minLength()));
    }
    
    this.passwordControl.setValidators(validators);
    this.passwordControl.updateValueAndValidity();
  }

  private onChange = (value: string) => {};
  private onTouched = () => {};

  // ControlValueAccessor methods
  writeValue(value: string): void {
    this.passwordControl.setValue(value || '', { emitEvent: false });
  }

  registerOnChange(fn: (value: string) => void): void {
    this.onChange = fn;
  }

  registerOnTouched(fn: () => void): void {
    this.onTouched = fn;
    // this.passwordControl.valueChanges.subscribe(() => {
    //   if (!this.passwordControl.touched) {
    //     this.passwordControl.markAsTouched();
    //     this.onTouched();
    //   }
    // });
  }

  setDisabledState(isDisabled: boolean): void {
    if (isDisabled) {
      this.passwordControl.disable();
    } else {
      this.passwordControl.enable();
    }
  }

  // Helper method to check for specific errors
  hasError(errorKey: string): boolean {
    return this.passwordControl.hasError(errorKey);
  }

  // Method to set errors from parent form
  setErrors(errors: any): void {
    this.passwordControl.setErrors(errors);
  }

  // Method to mark as touched
  markAsTouched(): void {
    this.passwordControl.markAsTouched();
    this.onTouched()
  }

  // Getter for validation state
  get isValid(): boolean {
    return this.passwordControl.valid;
  }

  get isInvalid(): boolean {
    return this.passwordControl.invalid;
  }

  get isTouched(): boolean {
    return this.passwordControl.touched;
  }
}
--- END OF FILE ---
--- START OF FILE src\app\components\shared\side-menu\side-menu.component.html ---
@if(isMenuExpanded !== undefined) {
<div class="menu-content" [ngClass]="{'shrink': !isMenuExpanded()}" role="navigation">


    <p-panelmenu [model]="items()" styleClass="w-full" [multiple]="false" (onItemToggle)="onMenuItemToggle($event)">
        <ng-template #item let-item>
            @if (item.separator) {
            <div class="menu-separator" aria-hidden="true"></div>
            }
            @else{
            <div [ngClass]="item.styleClass" [routerLinkActive]="'active-link'"
                [routerLink]="item.routerLink || undefined" [queryParams]="item.queryParams || {}"
                [routerLinkActiveOptions]="{exact: item.routerLinkActiveOptions}"
                [queryParamsHandling]="item.queryParams ? 'merge' : undefined"
                [pTooltip]="isMenuExpanded() ? '' : item.matTooltip" tooltipPosition="left">

                <div class="flex items-center justify-between gap-2 w-full">
                    <div class="flex items-center gap-2 w-full px-2 py-2.5">
                        <span class="material-symbols-rounded icon"
                            [ngClass]="{'rotatable': item.key === 'shrinkExpand', 'flip': isMenuExpanded()}">{{item.icon}}</span>
                        <span class="label">{{ item.label }}</span>
                    </div>
                    @if (item.items?.length > 0) {
                    <span class="material-symbols-rounded submenu-toggle">keyboard_arrow_down</span>
                    }
                </div>
            </div>
            }



        </ng-template>
    </p-panelmenu>

    <div class="sapakit-logo-wrapper">
        <a routerLink="/" class="logo-content">
            <img src="../../../../app/assets/images/sapakit-logo-2.png" alt="Sapakit Logo" class="header-logo">
        </a>
    </div>

    <!-- 
    <div
        class="bg-white rounded-xl shadow-sm p-6 mb-4 relative overflow-hidden transition-all duration-300 hover:shadow-md hover:-translate-y-0.5">

        <div class="flex flex-col gap-2 items-center w-full text-center py-4 absolute inset-0 transform transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
            [ngClass]="{
                'opacity-0 scale-90 -translate-y-4 rotate-[2deg] pointer-events-none': !isMenuExpanded(),
                'opacity-100 scale-100 translate-y-0 rotate-0': isMenuExpanded()
            }">
            <span
                class="font-semibold text-lg tracking-tight text-gray-900 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                Porat Amrami
            </span>
            <div class="flex items-center justify-center gap-2 mt-1">
                <span class="material-symbols-rounded text-indigo-500 text-lg animate-pulse">
                    terminal
                </span>
                <span
                    class="text-gray-600 text-sm font-medium whitespace-nowrap transition-colors duration-300 hover:text-indigo-700">
                    Web Developer
                </span>
            </div>

            <div class="absolute -bottom-2 -right-2 w-16 h-16 rounded-full bg-indigo-100 opacity-30 transform scale-0 transition-transform duration-700"
                [ngClass]="{'scale-100': isMenuExpanded()}">
            </div>
        </div>

        <div class="flex flex-col gap-1 items-center w-full text-center py-4 transform transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
            [ngClass]="{
                'opacity-0 scale-110 translate-y-4 rotate-[-2deg] pointer-events-none': isMenuExpanded(),
                'opacity-100 scale-100 translate-y-0 rotate-0': !isMenuExpanded()
            }">
            <div class="relative">
                <span class="font-semibold text-lg tracking-tight text-gray-900">
                    P.A
                </span>
                <span class="absolute -top-1 -right-2 w-2 h-2 rounded-full bg-green-400 animate-ping opacity-75"></span>
            </div>
            <div class="flex items-center justify-center gap-1 mt-1" [ngClass]="{'flex-col': !isMenuExpanded()}">
                <span class="material-symbols-rounded text-indigo-500 text-lg">
                    code
                </span>
                <span class="text-gray-500 text-xs font-medium transition-colors duration-300 hover:text-indigo-600">
                    Dev
                </span>
            </div>

            <div class="absolute bottom-2 w-6 h-1 rounded-full bg-indigo-300 opacity-0 transition-opacity duration-300"
                [ngClass]="{'opacity-100': !isMenuExpanded()}"></div>
        </div>

    </div> -->

</div>
}











<!-- <img [src]="(user$ | async)?.logoUrl ?? '../../../assets/images/quickdev_q_logo.png'" alt="client's logo" class="logo"> -->
<!-- <span class="label font-semibold ">{{ (user$ | async)?.client?.name}}</span> -->
<!-- <span class="label text-sm leading-3">{{ (user$ | async)?.email}}</span> -->
--- END OF FILE ---
--- START OF FILE src\app\components\shared\side-menu\side-menu.component.ts ---
import { PanelMenu, PanelMenuModule } from 'primeng/panelmenu';
import { Component, computed, effect, inject, OnInit, signal } from '@angular/core';
import { MenuItem } from 'primeng/api';
import { Router, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { TooltipModule } from 'primeng/tooltip';
import { MenuService } from '../../../services/menu.service';
import { AuthStore } from '../../../store/auth.store';
import { UserRole } from '../../../common/enums/userRole.enum';

@Component({
	selector: 'app-side-menu',
	standalone: true,
	imports: [CommonModule, FormsModule, RouterModule, PanelMenu, TooltipModule],
	templateUrl: './side-menu.component.html',
	styleUrl: './side-menu.component.scss',
	animations: [],
})
export class SideMenuComponent implements OnInit {
	items = signal<MenuItem[]>([]);

	private router = inject(Router);
	private menuService = inject(MenuService);
	private authStore = inject(AuthStore);

	readonly isGuest = this.authStore.isGuest;
	readonly isLoading = this.authStore.isLoading;
	readonly username = computed(() => this.authStore.user()?.username || this.authStore.user()?.email);

	public isMenuExpanded = this.menuService.isMenuExpanded;


	constructor() {
		effect(() => {
			this.isMenuExpanded();
			this.restoreSubmenuState();
		});

		effect(() => {
			const role = this.authStore.userRole();
			this.buildMenu(role);
		});

	}

	ngOnInit() {
		this.authStore.loadUser();

		const url = this.router.url.split('?')[0];
		const isSettingsPage = url.includes('settings');
		if (isSettingsPage) {
			this.expandSettings(true);
		}
	}

	private expandSettings(state: boolean) {
		const settingsItem = this.items().find((item) => item['key'] === 'settings');
		if (settingsItem) {
			settingsItem.expanded = state;
			this.menuService.saveSubmenuState('settings', state);
		}
	}

	private restoreSubmenuState() {
		this.items().forEach((item) => {
			if (item['key']) {
				item.expanded = this.menuService.getSubmenuState(item['key']);
			}
		});
	}

	public onMenuItemToggle(event: any) {
		const item = event.item as MenuItem;
		if (item['key']) {
			this.menuService.saveSubmenuState(item['key'], !!item.expanded);
		}
	}

	public toggleMobileMenu() {
		this.menuService.toggleMobileMenu();
	}



	public signOut() {
		this.authStore.logout();
	}


	private buildMenu(role: UserRole): void {
		const commonItems: MenuItem[] = [
			{
				separator: true,
				key: 'separator',
			},

			{
				isChild: false,
				key: 'shrinkExpand',
				label: 'מזער תפריט',
				icon: 'keyboard_double_arrow_left',
				styleClass: 'menu-item',
				command: () => {
					this.items().forEach((item) => {
						if (item['key'] && item.expanded !== undefined) {
							this.menuService.saveSubmenuState(item['key'], item.expanded);
						}
					});

					this.menuService.toggleMenuExpand();
				},
			},
		];

		if (role === UserRole.SysAdmin) {
			this.items.set([
				{
					label: 'מערכת',
					icon: 'monitoring',
					key: 'dashboard',
					routerLink: '/admin',
					routerLinkActiveOptions: true,
					styleClass: 'menu-item',
					matTooltip: 'דשבורד מערכת',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				{
					label: 'ניהול חשבונות',
					icon: 'group',
					key: 'accounts',
					routerLink: '/admin/accounts',
					routerLinkActiveOptions: true,
					styleClass: 'menu-item',
					matTooltip: 'ניהול חשבונות',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				...commonItems
			]);
		} else {
			this.items.set([
				{
					label: 'דשבורד',
					icon: 'home',
					key: 'dashboard',
					routerLink: '/',
					routerLinkActiveOptions: true,
					styleClass: 'menu-item',
					matTooltip: 'דשבורד',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				{
					label: 'משתמשים',
					icon: 'group',
					key: 'users',
					routerLink: 'users',
					routerLinkActiveOptions: true,
					styleClass: 'menu-item',
					matTooltip: 'משתמשים',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				{
					label: 'ספקים',
					icon: 'two_pager_store',
					key: 'suppliers',
					routerLink: 'suppliers',
					routerLinkActiveOptions: false,
					styleClass: 'menu-item',
					matTooltip: 'ספקים',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				{
					label: 'הזמנות',
					icon: 'shopping_cart',
					key: 'orders',
					routerLink: 'orders',
					routerLinkActiveOptions: true,
					styleClass: 'menu-item',
					matTooltip: 'הזמנות',
					command: () => {
						this.menuService.closeMobileMenu();
					},
				},
				...commonItems

			])
		}



	}

}
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\supplier\supplier.component.css ---
@import './../../../assets/styles/_variables.css';

/* ---------------------------------- */
/*      Main Layout & Grid            */
/* ---------------------------------- */
.categories-grid {
	width: 100%;
	display: flex;

	.category-list-container {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 1rem;
		width: 100%;
		flex-grow: 1;

		@media (max-width: 800px) {
			grid-template-columns: 1fr;
		}

		&.single-category {
			max-width: 1200px;
			margin: 0 auto;
		}

		.category-drag-container {
			display: flex;
			flex-direction: column;
			/* border: 1px solid var(--grey-100); */
			border-radius: var(--border-radius);
			background-color: var(--grey-10);
			min-height: 240px; /* Ensure empty categories have a drop zone */

			.category-wrapper {
				padding: 0.75rem;
				height: 100%;
				width: 100%;
				display: flex;
				flex-direction: column;
				border: 1px solid transparent;

				.category-header {
					display: flex;
					align-items: center;
					justify-content: space-between;
					gap: 0.5rem;
					margin-bottom: 0.75rem;
					border-bottom: 1px solid var(--grey-100);
					font-size: 14px;
					font-weight: 600;
					color: var(--text-color);
				}
			}
		}
	}
}

/* ---------------------------------- */
/*      Products List & Rows          */
/* ---------------------------------- */

/* Header for the product "table" */
.products-header {
	display: grid;
	grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr;
	gap: 0.5rem;
	align-items: center;
	padding: 0 0.5rem;
	font-size: 0.75rem;
	font-weight: 500;
	color: var(--grey-500);
	container-type: inline-size;
	>* {
		place-content: end;
	}
}

.products-container {
	display: flex;
	flex-direction: column;
	gap: 0.1rem;
	flex-grow: 1; /* Make it fill the available space */

	.product-row {
		border: 1px solid transparent;
		border-radius: var(--border-radius);
		background: #ffffff;
		transition: 0.3s all ease-in-out;
		&:hover {
			background-color: var(--grey-20);
			
		color: var(--primary-700)
		}
		&:has(.delete-btn:hover) {
			transition: 0.3s all ease-in-out;
			background-color: var(--red-50) !important;
			/* border: 1px solid var(--red-200) !important; */
		}
		position: relative;

		&::after {
			transition:
				height 0.2s cubic-bezier(0.4, 0, 0.2, 1),
				background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			content: '';
			position: absolute;
			left: 6px;
			top: 50%;
			transform: translateY(-50%);
			height: 0%;
			width: 2px;
			background-color: var(--red-200);
			border-radius: 50px;
		}
	}
}

.cdk-drag-preview .product-content,
.product-content {
	display: grid;
	grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; /* Same as header */
	gap: 0.5rem;
	align-items: center;
	padding: 0.5rem;
	font-size: 13px;
	color: var(--text-color);
	text-align: center;
	border: 1px solid transparent;
	container-type: inline-size;

	.product-cell-name {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		text-align: right;
		font-weight: 400;
		color: var(--text-color);
	}
	.product-cell-actions {
		display: flex;
		justify-content: flex-end;
		gap: 0.25rem;
	}
}

/* ---------------------------------- */
/*      Drag & Drop (CDK) Styling     */
/* ---------------------------------- */
.cdk-drag {
	/* cursor: grab; */
}
.cdk-drag:active {
	/* cursor: grabbing; */
}



.handle-icon {
	color: var(--grey-500);
	font-size: 0.8rem;
}

.cdk-drag-animating {
	transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

.cdk-drag-preview {
	opacity: 0.9;
	box-shadow:
		0 4px 6px -1px rgb(0 0 0 / 0.1),
		0 2px 4px -2px rgb(0 0 0 / 0.1);
	border-radius: var(--border-radius);
	z-index: 1000;
	direction: rtl;
	overflow: hidden;
	border: 1px solid var(--primary-100);
	background-color: var(--primary-10);

	.category-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 0.5rem;
		margin-bottom: 0.75rem;
		border-bottom: 1px solid var(--grey-100);
		font-size: 14px;
		font-weight: 600;
		color: var(--text-color);
	}
}

.cdk-drag-placeholder {
	opacity: 0.3;
	background: var(--primary-100);
	border: 2px dashed var(--primary-300);
	border-radius: var(--border-radius);
}

.cdk-drag-dragging .category-wrapper,
.cdk-drag-dragging .product-wrapper {
	visibility: hidden;
}

.category-placeholder {
	min-height: 150px;
	background: var(--grey-50);
	border: 2px dashed var(--grey-300);
	border-radius: var(--border-radius);
	transition: all 0.3s ease-in-out;
	box-sizing: border-box;
}

.cdk-drop-list-dragging .category-placeholder {
	border-color: var(--primary-500);
	background: var(--primary-50);
}

.empty-category-placeholder {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 12px;
	height: 100%;
	border: 2px dashed var(--grey-200);
	border-radius: 8px;
	background: var(--grey-50);
	color: var(--grey-500);
	transition: all 0.3s ease-in-out;
}

.cdk-drop-list-receiving .empty-category-placeholder {
	border-color: var(--primary-500);
	background: var(--primary-50);
}

.handle-icon {
	cursor: grab;
	color: var(--grey-400);
	font-size: 1rem;
	opacity: 1;
	transition:
		color 0.2s ease,
		opacity 0.2s ease;

	&:active {
		cursor: grabbing;
	}

	&:hover {
		color: var(--grey-500);
	}
}

.cdk-drag-disabled {
	.handle-icon {
		cursor: default;
		opacity: 0;
		&:active {
			cursor: default;
		}
	}
}



--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\supplier\supplier.component.html ---
<div class="page-height p-responsive overflow-scroll" #dragZone>
  @switch (pageState()) {
  @case(PageStates.Loading) {
  <app-loader></app-loader>
  }
  @case(PageStates.Error) {
  <div @fadeIn400 class="error-card-container">
    <div class="error-card">
      <div class="error-icon-wrapper">
        <span class="material-symbols-rounded">cloud_off</span>
      </div>
      <h3 class="error-title">אופס, משהו השתבש</h3>
      <!-- <button (click)="refreshData()" class="primary md retry-button">
        <span class="material-symbols-rounded">refresh</span>
        <span>נסה שוב</span>
      </button> -->
    </div>
  </div>
  }
  @case(PageStates.Ready) {
  <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
    <!-- Header -->
    <div class="flex gap-2 items-center">
      <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-arrow-right" [routerLink]="['/suppliers']"
        size="small" [rounded]="true" severity="secondary"></p-button>
      <span class="main-title">ניהול מוצרים | {{ supplier()?.name }}</span>
      <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square" (click)="editSupplier()" size="small"
        [rounded]="true" severity="secondary"></p-button>
    </div>

    @if (hasProducts()) {
    <!-- Actions Bar -->
    <div @fadeIn400 class="actions-bar">
      <span class="search-box">
        <i class="pi pi-search"></i>
        <input pInputText type="text" placeholder="חיפוש מוצרים..." class="w-full" [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event)" />
      </span>
      <!-- <p-button label="הוסף מוצר" icon="pi pi-plus" severity="primary" size="small" (onClick)="addProduct()"></p-button> -->
      <button class="primary md" (click)="addProduct()">
        <span class="material-symbols-rounded">add</span>
        <span>הוספת מוצר</span>
      </button>

    </div>

    <!-- Main Drag & Drop Container -->
    <div @fadeIn400 class="categories-grid">
      <div class="category-list-container" cdkDropList cdkDropListGroup cdkDropListOrientation="mixed"
        [cdkDropListData]="groupedProducts()" (cdkDropListDropped)="dropCategory($event)"
        [class.single-category]="groupedProducts().length === 1">

        @for (group of groupedProducts(); track group.categoryName; let i = $index) {

        @if(group.products.length){
        <div class="category-drag-container" cdkDrag [cdkDragData]="group" (cdkDragMoved)="onDragMoved($event)"
          (cdkDragReleased)="onDragReleased()" [cdkDragDisabled]="categories().length <= 1">
          <!-- Actual Category Content -->
          <div class="category-wrapper">
            <div class="category-header">
              <div class="flex gap-2 items-center">
                <button class="material-symbols-rounded handle-icon" cdkDragHandle>drag_indicator</button>
                <span>{{ group.categoryName }}</span>
              </div>
              <p-button icon="pi pi-plus" styleClass="p-button-sm" [rounded]="true" [text]="true" severity="secondary"
                (click)="addProductToCategory(group.categoryId, group.categoryName)" pTooltip="הוסף מוצר לקטגוריה"
                tooltipPosition="top">
              </p-button>


            </div>

            <!-- Table-like header for products -->
            <div class="products-header">
              <span class="text-responsive-sm header-name pr-2">שם המוצר</span>
              <span class="text-responsive-sm header-package">אריזה</span>
              <span class="text-responsive-sm header-cost leading-2.5"> מחיר קניה</span>
              <span class="text-responsive-sm header-price leading-2.5"> מחיר מכירה</span>
              <span class="text-responsive-sm header-status">סטטוס</span>
              <span class="header-actions w-16"></span>
            </div>

            <!-- Products Drop List for this category -->
            <div class="products-container" cdkDropList [id]="group.id" [cdkDropListData]="group.products"
              [cdkDropListConnectedTo]="productListIds()" (cdkDropListDropped)="dropProduct($event)">

              @for (product of group.products; track product.id) {
              <div class="product-row" cdkDrag [cdkDragData]="product" (cdkDragMoved)="onDragMoved($event)"
                (cdkDragReleased)="onDragReleased()">
                <!-- Product Content -->

                <div class="product-content" [ngClass]="{'item-to-delete' : itemToDelete() == product.id}"
                  [ngClass]="{'item-to-delete' : itemToDelete() == product.id}">
                  <div class="product-cell-name">
                    <button class="material-symbols-rounded handle-icon" cdkDragHandle>drag_indicator</button>
                    <span class="text-responsive-sm leading-2.5">{{ product.name }}</span>
                    @if (product.imageUrl) {
                    <img [src]="product.imageUrl" [alt]="product.name" class="table-image" />
                    }
                  </div>
                  <!-- <div class="product-cell-package">
                   <app-badge [enumValue]="product.package" [dataArray]="packageData" size="sm"></app-badge>
                  </div> -->
                  <span class="text-responsive-sm text-right">{{product.package | packageLabel}}</span>
                  <div class="text-responsive-sm text-right">
                    {{ product.cost ? (product.cost | currency: 'ILS') : '-' }}
                  </div>
                  <div class="text-responsive-sm text-right" [class.pr-4]="product.price == 0">
                    {{ product.price > 0 ? (product.price | currency: 'ILS') : '-' }}
                  </div>
                  <div class="product-cell-status text-right">
                    <app-badge [enumValue]="product.status" [dataArray]="statusData" size="sm"></app-badge>
                  </div>
                  <div class="product-cell-actions">
                    <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square"
                      (click)="editProduct(product)" size="small" [rounded]="true" severity="secondary"></p-button>
                    <p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash" class="delete-btn"
                      (click)="confirmDelete(product)" size="small" [rounded]="true" severity="danger"></p-button>
                  </div>
                </div>
              </div>
              }
              <!-- Placeholder for empty category -->
              @if (group.products.length === 0) {
              <div class="empty-category-placeholder">
                גרור מוצרים לכאן
              </div>
              }
            </div>
          </div>
        </div>
        }

        }
        <div *cdkDragPlaceholder class="product-placeholder"></div>
        <div *cdkDragPlaceholder class="category-placeholder"></div>
      </div>
    </div>
    } @else {
    <!-- Empty State for Supplier with no products -->
    <div class="empty-state">
      <i class="pi pi-box"></i>
      <p>אין מוצרים זמינים עבור ספק זה.</p>
      <p-button label="הוסף מוצר ראשון" (onClick)="addProduct()"></p-button>
    </div>
    }
  </div>
  }
  }

</div>
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\supplier\supplier.component.spec.ts ---
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { SupplierComponent, CategoryGroup } from './supplier.component';
import { CdkDragDrop } from '@angular/cdk/drag-drop';
import { Product } from '../../../models/product';
import { ApiService } from '../../../services/api.service';
import { NotificationService } from '../../../services/notification.service';
import { Package } from '../../../common/enums/package';
import { Status } from '../../../common/enums/status.enum';
import { RouterTestingModule } from '@angular/router/testing';
import { of } from 'rxjs';
import { ServiceResultContainer } from '../../../models/serviceResultContainer';
import { ActivatedRoute } from '@angular/router';

const mockActivatedRoute = {
	paramMap: of({
		get: (key: string) => '1'
	})
}; function createMockProduct(
	overrides: Partial<Product> = {}
): Product {
	const base: Product = {
		id: 1,
		name: 'Mock',
		categoryId: 10,
		categoryName: 'Cat1',
		position: 0,
		package: Package.Unit,
		cost: 1,
		quantity: 1,
		status: Status.Active,
		imageUrl: '',
		supplierId: 1,
		comment: '',
		isDeleted: false,
		createdAt: new Date(),
		updatedAt: new Date()
	};
	return { ...base, ...overrides };
}

describe('SupplierComponent', () => {
	let component: SupplierComponent;
	let fixture: ComponentFixture<SupplierComponent>;
	let apiServiceSpy: jasmine.SpyObj<ApiService>;

	beforeEach(async () => {
		const mockProduct = createMockProduct({ id: 99 });
		const response: ServiceResultContainer<Product> = {
			success: true,
			message: 'OK',
			result: mockProduct
		};


		apiServiceSpy = jasmine.createSpyObj('ApiService', ['updateProduct']);
		apiServiceSpy.updateProduct.and.returnValue(of(response));

		await TestBed.configureTestingModule({
			imports: [
				SupplierComponent,
			],
			providers: [
				{ provide: ApiService, useValue: apiServiceSpy },
				{ provide: NotificationService, useValue: jasmine.createSpyObj('NotificationService', ['toast']) },
				{ provide: ActivatedRoute, useValue: mockActivatedRoute }
			]
		}).compileComponents();

		fixture = TestBed.createComponent(SupplierComponent);
		component = fixture.componentInstance;
		fixture.detectChanges();
	});

	it('dropCategory → batchUpdateProducts עם מיקומים חדשים', () => {
		// Arrange
		const a = createMockProduct({ id: 1, position: 0, categoryId: 10, categoryName: 'Cat1' });
		const b = createMockProduct({ id: 2, position: 0, categoryId: 20, categoryName: 'Cat2' });
		component['rawProducts'].set([a, b]);
		component['categories'].set([a, b]);

		spyOn(component as any, 'batchUpdateProducts');

		const event: CdkDragDrop<CategoryGroup[], CategoryGroup[], CategoryGroup> = {
			previousIndex: 0,
			currentIndex: 1,
			previousContainer: { id: 'catList', data: component.groupedProducts(), element: {} as any } as any,
			container: { id: 'catList', data: component.groupedProducts(), element: {} as any } as any,
			item: {} as any,
			isPointerOverContainer: true,
			distance: { x: 0, y: 0 },
			dropPoint: { x: 100, y: 100 },
			event: new MouseEvent('drop'),
		};

		// Act
		component.dropCategory(event);

		// Assert
		const spy = (component as any).batchUpdateProducts;
		expect(spy).toHaveBeenCalled();
		const map: Map<number, Partial<Product>> = spy.calls.mostRecent().args[0];
		expect(map.get(1)).toEqual({ position: 1 }); // moved למטה
		expect(map.get(2)).toEqual({ position: 0 }); // moved למעלה
	});

	it('dropProduct → batchUpdateProducts עם שינוי קטגוריה + מיקומים', () => {
		// Arrange
		const a = createMockProduct({ id: 1, position: 0, categoryId: 10, categoryName: 'Cat1' });
		const b = createMockProduct({ id: 2, position: 0, categoryId: 20, categoryName: 'Cat2' });

		component['rawProducts'].set([a, b]);
		component['categories'].set([a, b]);

		spyOn(component as any, 'batchUpdateProducts');

		// המצב הראשוני:
		// previousContainer.data = [a] (Cat1)
		// container.data = [b] (Cat2)
		// אחרי transferArrayItem(previousContainer.data, container.data, 0, 1):
		// previousContainer.data = [] (a הוצא)
		// container.data = [b, a] (a נכנס למיקום 1)

		const previousContainer = { id: 'cat1', data: [a], element: {} as any } as any;
		const container = { id: 'cat2', data: [b], element: {} as any } as any;

		const event: CdkDragDrop<Product[], Product[], Product> = {
			previousIndex: 0,
			currentIndex: 1,
			previousContainer: previousContainer,
			container: container,
			item: {} as any,
			isPointerOverContainer: true,
			distance: { x: 0, y: 0 },
			dropPoint: { x: 100, y: 100 },
			event: new MouseEvent('drop'),
		};

		// Act
		component.dropProduct(event);

		// console.log('After drop:');
		// console.log('previousContainer.data:', previousContainer.data);
		// console.log('container.data:', container.data);

		// Assert
		const map: Map<number, Partial<Product>> =
			(component as any).batchUpdateProducts.calls.mostRecent().args[0];

		// console.log('Updates map:');
		// console.log('Product 1 update:', map.get(1));
		// console.log('Product 2 update:', map.get(2));

		expect(map.get(1)).toEqual(jasmine.objectContaining({
			categoryId: 20,
			categoryName: 'Cat2',
			position: 1
		}));

		expect(map.get(2)).toEqual(jasmine.objectContaining({ position: 0 }));
	});
});

function createMockDragDropEvent<T>(config: Partial<CdkDragDrop<T[]>>): CdkDragDrop<T[]> {
	const baseEvent: CdkDragDrop<T[]> = {
		previousIndex: 0,
		currentIndex: 0,
		container: {} as any,
		previousContainer: {} as any,
		item: {} as any,
		isPointerOverContainer: true,
		distance: { x: 0, y: 0 },
		dropPoint: { x: 0, y: 0 },
		event: new MouseEvent('drop'),
	};
	return { ...baseEvent, ...config };
}
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\supplier\supplier.component.ts ---
import { CdkDragDrop, CdkDragMove, DragDropModule, moveItemInArray, transferArrayItem } from '@angular/cdk/drag-drop';
import { CommonModule } from '@angular/common';
import { Component, computed, ElementRef, inject, signal, ViewChild } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { ActivatedRoute, RouterModule } from '@angular/router';
import { ConfirmationService, MessageService } from 'primeng/api';
import { ButtonModule } from 'primeng/button';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { DialogModule } from 'primeng/dialog';
import { DialogService } from 'primeng/dynamicdialog';
import { InputTextModule } from 'primeng/inputtext';
import { MessageModule } from 'primeng/message';
import { TooltipModule } from 'primeng/tooltip';
import { fadeIn400 } from '../../../common/const/animations';
import { DialogConfig } from '../../../common/const/dialog-config';
import { PackageData } from '../../../common/enums/package';
import { statusData } from '../../../common/enums/status.enum';

import { ApiService } from '../../../services/api.service';
import { NotificationService } from '../../../services/notification.service';
import { BadgeComponent } from '../../shared/badge/badge.component';
import { LoaderComponent } from '../../shared/loader/loader.component';
import { ProductDialogComponent } from '../../dialogs/product-dialog/product-dialog.component';
import { TableModule } from 'primeng/table';
import { ScrollService } from '../../../services/scroll.service';
import { ReminderTypePipe } from "../../../pipes/package.pipe";
import { SupplierDialogComponent } from '../../dialogs/supplier-dialog/supplier-dialog.component';
import { SupplierStore } from '../../../store/supplier.store';
import { Category } from '../../../common/models/category';
import { PageStates } from '../../../common/models/pageStates';
import { Product } from '../../../common/models/product';
import { Supplier } from '../../../common/models/supplier';
import { AuthStore } from '../../../store/auth.store';
import { FileUploadModule } from 'primeng/fileupload';

export interface CategoryGroup {
	categoryId: number;
	categoryName: string;
	products: Product[];
	id: string;
}

@Component({
	selector: 'app-supplier',
	standalone: true,
	imports: [
		CommonModule, ButtonModule, DialogModule, ConfirmDialogModule, RouterModule, TooltipModule,
		InputTextModule, LoaderComponent, MessageModule, FormsModule, BadgeComponent, DragDropModule, TableModule,
		ReminderTypePipe, FileUploadModule
	],
	templateUrl: './supplier.component.html',
	styleUrls: ['./supplier.component.css'],
	providers: [DialogService, ConfirmationService, MessageService],
	animations: [fadeIn400],
})
export class SupplierComponent {
	// --- Stores & Services ---
	private readonly supplierStore = inject(SupplierStore);
	private readonly apiService = inject(ApiService);
	private readonly dialogService = inject(DialogService);
	private readonly route = inject(ActivatedRoute);
	private readonly notificationService = inject(NotificationService);
	private readonly scrollService = inject(ScrollService);

	@ViewChild('dragZone', { static: false }) dragZone!: ElementRef;

	// --- Static Data ---
	readonly PageStates = PageStates;
	readonly packageData = PackageData;
	readonly statusData = statusData;

	// --- Core State ---
	pageState = signal(PageStates.Loading);
	supplier = signal<Supplier | undefined>(undefined);
	searchQuery = signal('');

	private readonly rawProducts = signal<Product[]>([]);
	public readonly categories = signal<Category[]>([]);
	public itemToDelete = signal<number | undefined>(undefined);

	// --- Derived View State ---
	readonly groupedProducts = computed<CategoryGroup[]>(() => {
		const products = this.rawProducts();
		const categories = this.categories();
		const query = this.searchQuery().toLowerCase();

		const productsByCat = new Map<number, Product[]>();
		products.forEach(p => {
			const catId = p.categoryId ?? -1;
			if (!productsByCat.has(catId)) productsByCat.set(catId, []);
			productsByCat.get(catId)!.push(p);
		});

		productsByCat.forEach(prods => prods.sort((a, b) => a.position - b.position));

		return categories.map(category => {
			const groupProducts = productsByCat.get(category.id) || [];
			const filteredProducts = query ? groupProducts.filter(p => p.name.toLowerCase().includes(query)) : groupProducts;
			return {
				categoryId: category.id,
				categoryName: category.name,
				products: filteredProducts,
				id: `category-${category.id}`
			};
		}).filter(group => (query ? group.products.length > 0 : true));
	});

	readonly hasProducts = computed(() => this.rawProducts().length > 0);
	readonly productListIds = computed<string[]>(() => this.groupedProducts().map(g => g.id));

	constructor() {
		this.route.paramMap.subscribe((params) => {
			const id = Number(params.get('supplierId'));
			if (id > 0) this.loadInitialData(id);
			else this.handleLoadError('מזהה ספק לא תקין.');
		});
	}

	private loadInitialData(id: number): void {
		this.pageState.set(PageStates.Loading);
		this.apiService.getSupplierById(id, true).subscribe({
			next: (response) => {
				if (response.success && response.result) {
					const supplier = response.result;
					const products = supplier.products || [];
					const categories = supplier.categories || [];
					categories.sort((a, b) => a.position - b.position);
					console.log(products);

					this.rawProducts.set(products);
					this.categories.set(categories);
					this.supplier.set(supplier);
					this.pageState.set(PageStates.Ready);
				} else {
					this.handleLoadError(response.message || 'הספק לא נמצא.');
				}
			},
			error: () => this.handleLoadError('אירעה שגיאה בעת טעינת פרטי הספק.'),
		});
	}

	private handleLoadError(message: string): void {
		this.rawProducts.set([]);
		this.categories.set([]);
		this.supplier.set(undefined);
		this.pageState.set(PageStates.Error);
		this.notificationService.toast({ severity: 'error', detail: message });
	}

	addProduct(): void {
		const supplierId = this.supplier()?.id;
		if (!supplierId) return;

		this.dialogService.open(ProductDialogComponent, {
			...DialogConfig,
			header: 'הוספת מוצר חדש',
			data: { supplierId, products: this.rawProducts(), categories: this.categories() },
		}).onClose.subscribe((newProduct: Product | undefined) => {
			if (newProduct) {
				this.rawProducts.update(current => [...current, newProduct]);
			}
		});
	}

	addProductToCategory(categoryId: number, categoryName: string): void {
		const supplierId = this.supplier()?.id;
		if (!supplierId) return;

		this.dialogService.open(ProductDialogComponent, {
			...DialogConfig,
			header: `הוספת מוצר חדש | ${categoryName}`,
			data: { supplierId, categoryId, categoryName, products: this.rawProducts(), categories: this.categories() },
		}).onClose.subscribe((newProduct: Product | undefined) => {
			if (newProduct) {
				this.rawProducts.update(current => [...current, newProduct]);
			}
		});
	}

	editProduct(product: Product): void {
		this.dialogService.open(ProductDialogComponent, {
			...DialogConfig, header: `עריכת מוצר | ${product.name}`,
			data: { product, products: this.rawProducts(), categories: this.categories() },
		}).onClose.subscribe((updatedProduct: Product | undefined) => {
			if (updatedProduct) {
				this.rawProducts.update(products => {
					const index = products.findIndex(p => p.id === updatedProduct.id);
					const newProducts = [...products];
					if (index > -1) newProducts[index] = updatedProduct;
					return newProducts;
				});
			}
		});
	}

	confirmDelete(product: Product): void {
		this.itemToDelete.set(product.id);
		this.notificationService.confirm({
			message: `האם למחוק את המוצר "${product.name}"?`,
			header: 'מחיקת מוצר',
			icon: 'pi pi-trash',
		}).subscribe((accepted) => {
			if (accepted) this.deleteProduct(product.id);
			this.itemToDelete.set(undefined);
		});
	}

	private deleteProduct(id: number): void {
		this.apiService.deleteProduct(id).subscribe({
			next: (response) => {
				if (response.success) {
					this.rawProducts.update(products => products.filter(p => p.id !== id));
					this.notificationService.toast({ severity: 'success', detail: 'המוצר נמחק בהצלחה.' });
				} else {
					this.notificationService.toast({ severity: 'error', detail: response.message });
				}
			},
		});
	}

	editSupplier(): void {
		const ref = this.dialogService.open(SupplierDialogComponent, {
			...DialogConfig,
			header: `עריכת ספק | ${this.supplier()?.name}`,
			data: { supplier: this.supplier(), suppliers: this.supplierStore.suppliers() },
		});
		ref.onClose.subscribe((updatedSupplier: Supplier | undefined) => {
			if (updatedSupplier) {
				this.supplierStore.updateSupplier(updatedSupplier);
				this.supplier.set(updatedSupplier);
			}
		});
	}

	dropProduct(event: CdkDragDrop<Product[]>): void {
		if (event.previousContainer === event.container) {
			moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);
		} else {
			transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);
		}

		const updates = new Map<number, Partial<Product>>();
		this.groupedProducts().forEach(group => {
			group.products.forEach((product, index) => {
				if (product.position !== index || product.categoryId !== group.categoryId) {
					updates.set(product.id, {
						position: index,
						categoryId: group.categoryId,
						categoryName: group.categoryName,
					});
				}
			});
		});

		if (updates.size === 0) return;

		this.rawProducts.update(currentProducts => {
			return currentProducts.map(p => {
				const update = updates.get(p.id);
				return update ? { ...p, ...update } : p;
			});
		});

		this.batchUpdateProducts(updates);
	}

	private batchUpdateProducts(updates: Map<number, Partial<Product>>): void {
		const payload = Array.from(updates.keys()).map(productId => {
			const update = updates.get(productId)!;
			return { id: productId, position: update.position!, categoryId: update.categoryId! };
		});

		this.apiService.updateProductsBatch(payload).subscribe({
			next: (response) => {
				if (!response.success) {
					this.notificationService.toast({ severity: 'error', detail: response.message });
					this.loadInitialData(this.supplier()!.id);
				} else {
					this.notificationService.toast({ severity: 'success', detail: response.message });
				}
			},
			error: (err) => {
				this.notificationService.toast({ severity: 'error', detail: err.error?.message });
				this.loadInitialData(this.supplier()!.id);
			}
		});
	}

	dropCategory(event: CdkDragDrop<CategoryGroup[]>): void {
		if (event.previousIndex === event.currentIndex) return;

		const supplierId = this.supplier()?.id;
		if (!supplierId) return;

		const previousOrder = this.categories();
		const newOrder = [...previousOrder];
		moveItemInArray(newOrder, event.previousIndex, event.currentIndex);

		this.categories.set(newOrder);

		const payload = newOrder.map((category, index) => ({
			categoryId: category.id,
			position: index,
			supplierId: supplierId,
		}));

		this.apiService.updateCategoriesBatch(payload).subscribe({
			next: (response) => {
				if (response.success && response.result) {
					this.notificationService.toast({ severity: 'success', detail: response.message });
					this.categories.set(response.result);
				} else {
					this.notificationService.toast({ severity: 'error', detail: response.message });
					this.categories.set(previousOrder);
				}
			},
			error: (err) => {
				this.notificationService.toast({ severity: 'error', detail: err.error?.message });
				this.categories.set(previousOrder);
			}
		});
	}


	onDragMoved(event: CdkDragMove): void { this.scrollService.onDragMoved(event, this.dragZone); }
	onDragReleased(): void { this.scrollService.stopAutoScroll(); }
	
}
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\suppliers.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\suppliers.component.html ---
<div class="p-responsive">
    @switch (pageState()) {
    @case(PageStates().Loading) {
    <app-loader></app-loader>
    }

    @case(PageStates().Error) {
    <div @fadeIn400 class="error-card-container">
        <div class="error-card">
            <div class="error-icon-wrapper">
                <span class="material-symbols-rounded">cloud_off</span>
            </div>
            <h3 class="error-title">אופס, משהו השתבש</h3>
            <button (click)="refreshData()" class="primary md retry-button">
                <span class="material-symbols-rounded">refresh</span>
                <span>נסה שוב</span>
            </button>
        </div>
    </div>
    }
    @case(PageStates().Empty) {
    <div @fadeIn400 class="empty-state">
        <i class="pi pi-box"></i>
        <p>עדיין לא הוספת ספקים.</p>
        <p-button label="הוסף ספק ראשון" icon="pi pi-plus" (onClick)="addSupplier()"></p-button>
    </div>
    }
    @case(PageStates().Ready) {
    <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
        <h1 class="main-title">ניהול ספקים</h1>


        <div class="actions-bar">
            <span class="search-box">
                <i class="pi pi-search"></i>
                <input pInputText type="text" placeholder="חיפוש ספקים..." [(ngModel)]="searchQuery">
            </span>
            <div class="flex gap-2">
                <button type="button" (click)="exportSuppliers()" class="empty md"
                    [disabled]="filteredSuppliers().length === 0" pTooltip="ייצוא רשימת הספקים לקובץ אקסל"
                    tooltipPosition="top">
                    <span class="material-symbols-rounded">download</span>
                    <span>ייצוא לאקסל</span>
                </button>

                <button type="button" (click)="addSupplier()" class="primary md">
                    <span class="material-symbols-rounded">add</span>
                    <span>הוסף ספק</span>
                </button>
            </div>
        </div>
        <p-table @fadeIn400 [value]="filteredSuppliers()" responsiveLayout="stack" [breakpoint]="'768px'"
            [rowHover]="true">
            <ng-template #header>
                <tr>
                    <th pSortableColumn="name">שם <p-sortIcon field="name"></p-sortIcon></th>
                    <th pSortableColumn="status">סטטוס <p-sortIcon field="status"></p-sortIcon></th>
                    <th pSortableColumn="phone">טלפון <p-sortIcon field="phone"></p-sortIcon></th>
                    <th pSortableColumn="orderType">סוג הזמנה <p-sortIcon field="orderType"></p-sortIcon></th>
                    <th>מועדי הזמנה</th>
                    <th pSortableColumn="reminderType">תזכורת <p-sortIcon field="reminderType"></p-sortIcon></th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template #body let-supplier>
                <tr [routerLink]="['/suppliers', supplier.id]">
                    <td class="name" data-label="שם">{{ supplier.name }}</td>
                    <td data-label="סטטוס">
                        <app-badge [enumValue]="supplier.status" [dataArray]="statusData"></app-badge>
                    </td>
                    <td data-label="טלפון">{{ supplier.phone }}</td>
                    <td data-label="סוג הזמנה">
                        <app-badge [enumValue]="supplier.orderType" [dataArray]="orderTypeData"></app-badge>
                    </td>
                    <td data-label="מועדי הזמנה">
                        @for (day of supplier.orderDays; track day) {
                        <span class="day-chip">{{ day | hebrewDay }}</span>
                        }
                        @for (day of supplier.orderDates; track day) {
                        <span class="day-chip">{{ day | number : '2.0' }}</span>
                        }
                    </td>
                    <td data-label="תזכורת">
                        <app-badge [enumValue]="supplier.reminderType" [dataArray]="reminderTypeData"></app-badge>
                    </td>
                    <td data-label="">
                        <div class="actions-cell">
                            <p-button tooltipPosition="top" pTooltip="לדף הספק" icon="pi pi-external-link"
                                [routerLink]="['/suppliers', supplier.id]" size="small" [rounded]="true"
                                severity="secondary"></p-button>
                            <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square"
                                (click)="editSupplier(supplier, $event)" size="small" [rounded]="true"
                                severity="secondary"></p-button>
                            <p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash" class="delete-btn"
                                (click)="confirmDelete(supplier, $event)" size="small" [rounded]="true"
                                severity="danger"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template #emptymessage>
                <tr>
                    <td colspan="7" class="text-center p-4">
                        <div class="flex flex-col items-center gap-2 text-gray-500">
                            <i class="pi pi-search-minus text-3xl"></i>
                            <span>לא נמצאו ספקים התואמים לחיפוש.</span>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    }
    }

</div>




<!-- @else {
<div class="empty-state">
    <i class="pi pi-box"></i>
    <p>אין ספקים זמינים</p>
    <p-button label="הוסף ספק חדש" (onClick)="addSupplier()"></p-button>
</div>
} -->
--- END OF FILE ---
--- START OF FILE src\app\components\suppliers\suppliers.component.ts ---
import { Component, computed, inject, signal, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { RouterLink } from '@angular/router';

// PrimeNG Modules
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { BadgeComponent } from '../shared/badge/badge.component';
import { TooltipModule } from 'primeng/tooltip';
import { MessageModule } from 'primeng/message';
import { ChipModule } from 'primeng/chip';
import { DialogService } from 'primeng/dynamicdialog';

// App Components
import { LoaderComponent } from '../shared/loader/loader.component';
import { SupplierDialogComponent } from '../dialogs/supplier-dialog/supplier-dialog.component';

// App Services & Stores
import { ApiService } from '../../services/api.service';
import { NotificationService } from '../../services/notification.service';
import { ExcelExportService, ExportColumn } from '../../services/excel-export.service';
import { SupplierStore } from '../../store/supplier.store';

// Models, Enums, Consts & Pipes

import { statusData } from '../../common/enums/status.enum';
import { orderTypeData } from '../../common/enums/order-type';
import { reminderTypeData } from '../../common/enums/reminderType';
import { HebrewDayPipe } from '../../pipes/hebrewDay.pipe';
import { fadeIn400, crossFade } from '../../common/const/animations';
import { DialogConfig } from '../../common/const/dialog-config';
import { PageStates } from '../../common/models/pageStates';
import { Supplier } from '../../common/models/supplier';

@Component({
	selector: 'app-suppliers',
	standalone: true,
	imports: [
		CommonModule,
		RouterLink,
		FormsModule,
		TableModule,
		ButtonModule,
		InputTextModule,
		ConfirmDialogModule,
		BadgeComponent,
		TooltipModule,
		MessageModule,
		LoaderComponent,
		ChipModule,
		HebrewDayPipe,
	],
	templateUrl: './suppliers.component.html',
	styleUrls: ['./suppliers.component.css'],
	providers: [DialogService], // DialogService נדרש ל-SupplierDialogComponent
	animations: [fadeIn400, crossFade],
})
export class SuppliersComponent implements OnInit {
	// --- Services & Stores ---
	// private readonly apiService = inject(ApiService);
	private readonly notificationService = inject(NotificationService);
	private readonly dialogService = inject(DialogService);
	private readonly excelExportService = inject(ExcelExportService);
	private readonly supplierStore = inject(SupplierStore);

	// --- Page State ---
	readonly PageStates = signal(PageStates);
	readonly pageState = computed(() => {
		if (this.supplierStore.isLoading()) return PageStates.Loading;
		if (this.supplierStore.error()) return PageStates.Error;
		if (this.suppliers().length === 0) return PageStates.Empty;
		return PageStates.Ready;
	});

	// --- Enum data for template ---
	readonly statusData = statusData;
	readonly orderTypeData = orderTypeData;
	readonly reminderTypeData = reminderTypeData;

	// --- Data Signals ---
	readonly suppliers = this.supplierStore.suppliers;
	readonly searchQuery = signal('');

	// --- Computed Signals ---
	readonly filteredSuppliers = computed(() => {
		const allSuppliers = this.suppliers();
		const query = this.searchQuery().toLowerCase();

		if (!query) {
			return allSuppliers;
		}
		return allSuppliers.filter((s) =>
			s.name.toLowerCase().includes(query) ||
			s.phone.toLowerCase().includes(query) ||
			s.email?.toLowerCase().includes(query)
		);
	});

	// --- Lifecycle ---
	ngOnInit() {
		this.supplierStore.loadSuppliers({});
	}

	public refreshData(): void {
		this.supplierStore.loadSuppliers({ force: true });
	}
	// --- User Actions ---
	addSupplier(): void {
		const ref = this.dialogService.open(SupplierDialogComponent, {
			...DialogConfig,
			header: 'הוספת ספק חדש',
			data: { suppliers: this.suppliers() },
		});

		ref.onClose.subscribe((newSupplier: Supplier | undefined) => {
			if (newSupplier) {
				// קריאה ל-API מתבצעת בתוך הדיאלוג, כאן רק נעדכן את ה-Store
				this.supplierStore.addSupplier(newSupplier);
				// this.notificationService.toast({ severity: 'success', detail: 'הספק נוסף בהצלחה' });
			}
		});
	}

	editSupplier(supplier: Supplier, event: MouseEvent): void {
		event.stopPropagation()
		const ref = this.dialogService.open(SupplierDialogComponent, {
			...DialogConfig,
			header: `עריכת ספק | ${supplier.name}`,
			data: { supplier, suppliers: this.suppliers() },
		});

		ref.onClose.subscribe((updatedSupplier: Supplier | undefined) => {
			if (updatedSupplier) {
				this.supplierStore.updateSupplier(updatedSupplier);
				// this.notificationService.toast({ severity: 'success', detail: 'הספק עודכן בהצלחה' });
			}
		});
	}

	confirmDelete(supplier: Supplier, event: MouseEvent): void {
		event.stopPropagation()
		this.notificationService.confirm({
			message: `האם אתה בטוח שברצונך למחוק את הספק "${supplier.name}"?`,
			header: ' מחיקת ספק',
			icon: 'pi pi-exclamation-triangle',
			acceptLabel: 'מחק',
		}).subscribe((accepted) => {
			if (accepted) {
				this.deleteSupplier(supplier);
			}
		});
	}

	// private deleteSupplier(supplier: Supplier): void {
	// 	this.apiService.deleteSupplier(supplier.id).subscribe({
	// 		next: () => {
	// 			this.supplierStore.removeSupplier(supplier.id);
	// 			this.notificationService.toast({ severity: 'success', detail: 'הספק נמחק בהצלחה.' });
	// 		},
	// 		error: () => {
	// 			this.notificationService.toast({ severity: 'error', detail: 'לא ניתן למחוק ספק.' });
	// 		},
	// 	});
	// }

	private deleteSupplier(supplier: Supplier): void {
		this.supplierStore.deleteSupplier(supplier.id);
	}

	// --- Export to Excel ---
	exportSuppliers(): void {
		const columns = this.getSupplierExportColumns();
		const dataToExport = this.filteredSuppliers();
		this.excelExportService.exportToExcel(dataToExport, columns, {
			fileName: 'רשימת_ספקים',
			sheetName: 'ספקים',
			includeTimestamp: true,
		});
	}

	private getSupplierExportColumns(): ExportColumn[] {
		return [
			{ key: 'name', header: 'שם' },
			{ key: 'phone', header: 'טלפון' },
			{ key: 'status', header: 'סטטוס', transform: ExcelExportService.transformers.enumToText(this.statusData) },
			{ key: 'orderType', header: 'סוג הזמנה', transform: ExcelExportService.transformers.enumToText(this.orderTypeData) },
			{
				key: 'orderDays',
				header: 'מועדי הזמנה',
				transform: (row: Supplier) => {
					const hebrewDays = ['א׳', 'ב׳', 'ג׳', 'ד׳', 'ה׳', 'ו׳', 'ש׳'];
					const days = (row.orderDays || []).map((day: number) => hebrewDays[day] || '').join(', ');
					const dates = (row.orderDates || []).map(d => d.toString()).join(', ');
					return [days, dates].filter(Boolean).join(' | ');
				},
			},
			{ key: 'reminderType', header: 'סוג תזכורת', transform: ExcelExportService.transformers.enumToText(this.reminderTypeData) },
			{ key: 'createdAt', header: 'תאריך יצירה', transform: ExcelExportService.transformers.dateFormat('short') },
		];
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\users\users.component.css ---
.rotatable-icon{
	transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	
}


.actions-cell {
	overflow: visible;
	position: relative;
}

.action-buttons {
	display: flex;
	gap: 8px;
	transition: transform 0.3s ease;
}

.delete-confirmation {
	position: absolute;
	top: 50%;
	left: 0;
	right: 0;
	transform: translateY(-50%) translateX(100%);
	background: #fff;
	border: 1px solid #e0e0e0;
	border-radius: 4px;
	padding: 8px 12px;
	white-space: nowrap;
	font-size: 12px;
	color: #666;
	transition: transform 0.3s ease;
	box-shadow: 0 2px 4px rgba(0,0,0,0.1);
	z-index: 10;
}

.delete-confirmation.show {
	transform: translateY(-50%) translateX(0);
}

.delete-confirmation.show ~ .action-buttons {
	transform: translateX(100%);
}

.confirmation-actions {
	display: flex;
	gap: 8px;
	margin-top: 8px;
}

.confirm-btn, .cancel-btn {
	padding: 4px 8px;
	border: none;
	border-radius: 3px;
	cursor: pointer;
	font-size: 11px;
	transition: background-color 0.2s ease;
}

.confirm-btn {
	background: #dc3545;
	color: white;
}

.confirm-btn:hover {
	background: #c82333;
}

.cancel-btn {
	background: #6c757d;
	color: white;
}

.cancel-btn:hover {
	background: #5a6268;
}

/* Expandable rows styling */
.table-image {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	object-fit: cover;
}

.no-image {
	width: 32px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	background-color: #f0f0f0;
	border-radius: 50%;
	color: #666;
}

.badge {
	display: inline-flex;
	align-items: center;
	padding: 4px 8px;
	background-color: #e3f2fd;
	color: #1976d2;
	border-radius: 12px;
	font-size: 12px;
	font-weight: 500;
}

/* Row expansion animation */
::ng-deep .p-datatable .p-datatable-tbody > tr.p-row-expanded {
	background-color: #f8f9fa;
}

/* Expanded content styling */
.expanded-content {
	background-color: #f8f9fa;
	border-left: 4px solid var(--primary-color);
	padding: 1rem;
}

.user-card {
	background: white;
	border-radius: 8px;
	padding: 1rem;
	box-shadow: 0 1px 3px rgba(0,0,0,0.1);
	transition: box-shadow 0.2s ease;
}

.user-card:hover {
	box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

/* Item to delete animation */
.item-to-delete {
	background-color: #ffebee !important;
	animation: pulse-red 1s ease-in-out;
}

@keyframes pulse-red {
	0% { background-color: #ffebee; }
	50% { background-color: #ffcdd2; }
	100% { background-color: #ffebee; }
}

/* Responsive design */
@media (max-width: 768px) {
	.actions-cell {
		display: flex;
		gap: 8px;
		justify-content: center;
		margin-top: 8px;
	}
	
	.expanded-content {
		padding: 0.5rem;
	}
	
	.user-card {
		padding: 0.75rem;
	}
}

/* Grid layout for expanded users */
.grid {
	display: grid;
}

.grid-cols-1 {
	grid-template-columns: repeat(1, minmax(0, 1fr));
}

@media (min-width: 768px) {
	.md\:grid-cols-2 {
		grid-template-columns: repeat(2, minmax(0, 1fr));
	}
}

@media (min-width: 1024px) {
	.lg\:grid-cols-3 {
		grid-template-columns: repeat(3, minmax(0, 1fr));
	}
}
--- END OF FILE ---
--- START OF FILE src\app\components\users\users.component.html ---
<div class="p-responsive">
    @switch (pageState()) {
        @case(PageStates.Loading) { <app-loader></app-loader> }
        @case(PageStates.Error) {
            <div @fadeIn400 class="error-card-container">
                <div class="error-card">
                    <div class="error-icon-wrapper"><span class="material-symbols-rounded">cloud_off</span></div>
                    <h3 class="error-title">אופס, משהו השתבש</h3>
                    <button (click)="refreshData()" class="primary md retry-button">
                        <span class="material-symbols-rounded">refresh</span>
                        <span>נסה שוב</span>
                    </button>
                </div>
            </div>
        }
        @case(PageStates.Empty) {
            <div @fadeIn400 class="empty-state">
                <i class="pi pi-users"></i>
                <p>אין משתמשים בחשבון זה.</p>
                <p-button label="הוסף משתמש חדש" (onClick)="addUser()"></p-button>
            </div>
        }
        @case(PageStates.Ready) {
            <div @fadeIn400 class="flex flex-col gap-4 w-full h-full">
                <h1 class="main-title">ניהול משתמשים</h1>
                <div class="actions-bar">
                    <span class="search-box">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" placeholder="חיפוש משתמשים..." [(ngModel)]="searchQuery">
                    </span>
                    <div class="flex gap-2">
                        <button type="button" (click)="addUser()" class="primary md">
                            <span class="material-symbols-rounded">add</span>
                            <span>הוסף משתמש</span>
                        </button>
                    </div>
                </div>
                <p-table [value]="filteredUsers()" responsiveLayout="stack" [breakpoint]="'768px'" [rowHover]="true">
                    <ng-template #header>
                        <tr>
                            <th>שם</th>
                            <th>אימייל</th>
                            <th>תפקיד</th>
                            <th>טלפון</th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-user>
                        <tr>
                            <td data-label="שם">
                                <div class="flex gap-1 items-center">
                                    @if(user.image) {
                                        <img [src]="getImageUrl(user.image)" class="table-image" />
                                    } @else {
                                        <div class="no-image"><i class="material-symbols-rounded">account_circle</i></div>
                                    }
                                    {{ user.username }}
                                </div>
                            </td>
                            <td data-label="אימייל">{{ user.email }}</td>
                            <td data-label="תפקיד"><app-badge [enumValue]="user.role" [dataArray]="userRoleData"></app-badge></td>
                            <td data-label="טלפון">{{ user.phone }}</td>
                            <td data-label="">
                                <div class="actions-cell">
                                    <p-button tooltipPosition="top" pTooltip="עריכה" icon="pi pi-pen-to-square" (click)="editUser(user)" size="small" [rounded]="true" severity="secondary"></p-button>
                                    <p-button tooltipPosition="top" pTooltip="מחיקה" icon="pi pi-trash" (click)="confirmDelete(user)" size="small" [rounded]="true" severity="danger"></p-button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
					<ng-template pTemplate="emptymessage">
						<tr>
							<td colspan="5" class="text-center p-4">
								<div class="flex flex-col items-center gap-2 text-gray-500">
									<i class="pi pi-search-minus text-3xl"></i>
									<span>לא נמצאו משתמשים התואמים לחיפוש.</span>
								</div>
							</td>
						</tr>
					</ng-template>
                </p-table>
            </div>
        }
    }
    <p-confirmdialog header="אישור מחיקה" icon="pi pi-exclamation-triangle" acceptLabel="מחק" rejectLabel="ביטול" acceptButtonStyleClass="p-button-danger" rejectButtonStyleClass="p-button-text"></p-confirmdialog>
</div>
--- END OF FILE ---
--- START OF FILE src\app\components\users\users.component.ts ---
import { Component, computed, inject, signal, OnInit, effect } from '@angular/core';
import { CommonModule } from '@angular/common';
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { FormsModule } from '@angular/forms';
import { ConfirmationService } from 'primeng/api';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { BadgeComponent } from '../shared/badge/badge.component';
import { TooltipModule } from 'primeng/tooltip';
import { DialogService } from 'primeng/dynamicdialog';
import { LoaderComponent } from '../shared/loader/loader.component';
import { NotificationService } from '../../services/notification.service';
import { userRoleData } from '../../common/enums/userRole.enum';
import { DialogConfig } from '../../common/const/dialog-config';
import { UserDialogComponent } from '../dialogs/user-dialog/user-dialog.component';
import { environment } from '../../../environments/environment';
import { fadeIn400 } from '../../common/const/animations';
import { PageStates } from '../../common/models/pageStates';
import { User } from '../../common/models/user';
import { UserStore } from '../../store/user.store';

@Component({
	selector: 'app-users',
	standalone: true,
	imports: [
		CommonModule, TableModule, ButtonModule, ConfirmDialogModule, InputTextModule,
		FormsModule, BadgeComponent, TooltipModule, LoaderComponent,
	],
	templateUrl: './users.component.html',
	styleUrls: ['./users.component.css'],
	providers: [ConfirmationService, DialogService],
	animations: [fadeIn400],
})
export class UsersComponent implements OnInit {
	private readonly notificationService = inject(NotificationService);
	private readonly dialogService = inject(DialogService);
	private readonly userStore = inject(UserStore);
	
	readonly PageStates = PageStates;
	readonly pageState = signal(PageStates.Loading);
	readonly userRoleData = userRoleData;
	readonly searchQuery = signal('');
	
	readonly users = this.userStore.activeUsers;

	readonly filteredUsers = computed(() => {
		const allUsers = this.users();
		const query = this.searchQuery().toLowerCase();
		if (!query) return allUsers;
		return allUsers.filter((u) =>
			u.username?.toLowerCase().includes(query) ||
			u.email?.toLowerCase().includes(query)
		);
	});

	constructor() {
		effect(() => {
            const isLoading = this.userStore.isLoading();
            const error = this.userStore.error();
            const users = this.userStore.users();
            
            if (isLoading) this.pageState.set(PageStates.Loading);
            else if (error && users.length === 0) this.pageState.set(PageStates.Error);
            else if (users.length > 0) this.pageState.set(PageStates.Ready);
            else this.pageState.set(PageStates.Empty);
		});
	}

	ngOnInit() {
		this.userStore.loadUsers({});
	}

    public refreshData(): void {
        this.userStore.loadUsers({ force: true });
    }

	public addUser(): void {
		const ref = this.dialogService.open(UserDialogComponent, {
			...DialogConfig,
			header: 'הוספת משתמש חדש',
		});
		ref.onClose.subscribe((newUser: User | undefined) => {
			if (newUser) {
				this.userStore.addUser(newUser);
				this.notificationService.toast({ severity: 'success', detail: 'המשתמש נוצר בהצלחה' });
			}
		});
	}

	public editUser(user: User): void {
		const ref = this.dialogService.open(UserDialogComponent, {
			...DialogConfig,
			header: `עריכת משתמש | ${user.email}`,
			data: { user },
		});
		ref.onClose.subscribe((updatedUser: User | undefined) => {
			if (updatedUser) {
				this.userStore.updateUser(updatedUser);
				this.notificationService.toast({ severity: 'success', detail: 'המשתמש עודכן בהצלחה' });
			}
		});
	}

	public confirmDelete(user: User): void {
		this.notificationService.confirm({
			header: 'מחיקת משתמש',
			message: `האם למחוק את המשתמש "${user.username}"?`,
			icon: 'pi pi-user-minus',
		}).subscribe((accepted) => {
			if (accepted) this.deleteUser(user);
		});
	}

	private deleteUser(user: User): void {
		this.userStore.deleteUser(user.id);
	}

	public getImageUrl(image: string | null | undefined): string {
		if (!image) return 'assets/images/avatar.png';
		return image.startsWith('http') ? image : `${environment.apiUrl}/${image}`;
	}
}
--- END OF FILE ---
--- START OF FILE src\app\guards\auth.guard.ts ---
import { inject } from '@angular/core';
import { CanActivateFn, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

export const authGuard: CanActivateFn = (route, state) => {
	const authService = inject(AuthService);
	const router = inject(Router);

	if (authService.isLoggedIn()) {
		return true;
	}

	// Redirect to login page with return URL
	router.navigate(['/login'], { queryParams: { returnUrl: state.url } });
	return false;
};

--- END OF FILE ---
--- START OF FILE src\app\guards\sys-admin.guard.ts ---
import { inject } from '@angular/core';
import { CanActivateFn, Router } from '@angular/router';
import { AuthStore } from '../store/auth.store';
import { UserRole } from '../common/enums/userRole.enum';

export const sysAdminGuard: CanActivateFn = () => {
  const authStore = inject(AuthStore);
  const router = inject(Router);

  if (authStore.userRole() === UserRole.SysAdmin) {
    return true; // מורשה
  }

  // לא מורשה, שלח אותו לדף הבית הרגיל שלו
  return router.parseUrl('/'); 
};
--- END OF FILE ---
--- START OF FILE src\app\interceptors\auth-interceptor.ts ---
import {
	HttpInterceptor,
	HttpRequest,
	HttpHandler,
	HttpEvent,
	HttpErrorResponse,
} from '@angular/common/http';
import { Injectable, inject } from '@angular/core';
import { Observable, throwError, BehaviorSubject, filter, take, switchMap } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { AuthService } from '../services/auth.service';
import { NotificationService } from '../services/notification.service';

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
	private authService = inject(AuthService);
	private notificationService = inject(NotificationService)
	private isRefreshing = false;
	private refreshTokenSubject: BehaviorSubject<string | null> = new BehaviorSubject<
		string | null
	>(null);

	intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
		// הוסף את הטוקן אם הוא קיים בזיכרון
		const authReq = this.addTokenHeader(request);

		return next.handle(authReq).pipe(
			catchError((error) => {
				if (error.status === 0) {
					const customError = { message: 'לא ניתן להתחבר לשרת. אנא בדוק את חיבור האינטרנט או נסה שוב מאוחר יותר.' };

					// ❌ אל תציג הודעה כאן
					// this.notificationService.toast(...);

					// ✅ רק תזרוק את השגיאה הנקייה
					return throwError(() => customError);
				}
				if (
					error instanceof HttpErrorResponse &&
					error.status === 401 &&
					!request.url.includes('/auth/login') &&
					!request.url.includes('/auth/refresh')
				) {
					return this.handle401Error(request, next);
				}

				return throwError(() => error);
			}),
		);
	}

	private handle401Error(
		request: HttpRequest<any>,
		next: HttpHandler,
	): Observable<HttpEvent<any>> {
		if (!this.isRefreshing) {
			this.isRefreshing = true;
			this.refreshTokenSubject.next(null);

			return this.authService.refreshToken().pipe(
				switchMap((response) => {
					this.isRefreshing = false;
					const newAccessToken = response.result?.accessToken;
					if (!newAccessToken) {
						return throwError(() => new Error('Refresh failed, no new token.'));
					}
					this.refreshTokenSubject.next(newAccessToken);
					return next.handle(this.addTokenHeader(request));
				}),
				catchError((refreshError) => {
					this.isRefreshing = false;
					// ה-Interceptor לא מבצע לוגאאוט. הוא רק מדווח על כישלון.
					// ה-Store יחליט מה לעשות.
					return throwError(() => refreshError);
				}),
			);
		} else {
			return this.refreshTokenSubject.pipe(
				filter((token) => token !== null),
				take(1),
				switchMap(() => next.handle(this.addTokenHeader(request))),
			);
		}
	}

	private addTokenHeader(request: HttpRequest<any>): HttpRequest<any> {
		const token = this.authService.getAccessToken();
		// הוסף את ה-header רק אם יש טוקן וזו לא בקשת לוגין
		if (token && !request.url.includes('/auth/login')) {
			return request.clone({
				withCredentials: true,
				setHeaders: {
					Authorization: `Bearer ${token}`,
				},
			});
		}
		// עבור בקשות ללא טוקן, רק תוסיף withCredentials
		return request.clone({
			withCredentials: true,
		});
	}
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\has-holiday.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { DayDisplay } from '../components/calendar/advanced-calendar/advanced-calendar.component';

@Pipe({
  name: 'hasHoliday',
  standalone: true
})
export class HasHolidayPipe implements PipeTransform {
  transform(days: DayDisplay[]): boolean {
    return days.some(day => day.holiday && !day.fast && !day.shabbat);
  }
}

@Pipe({
  name: 'findHoliday',
  standalone: true
})
export class FindHolidayPipe implements PipeTransform {
  transform(days: DayDisplay[]): string {
    const holidayDay = days.find(day => day.holiday && !day.fast && !day.shabbat);
    return holidayDay?.holiday || '';
  }
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\hebrew-date.pipe.ts ---
// src/app/pipes/hebrew-date.pipe.ts
import { Pipe, PipeTransform } from '@angular/core';
import { parseDateStringAsLocal } from '../common/utils/date.utils';

@Pipe({
  name: 'hebrewDate',
  standalone: true,
})
export class HebrewDatePipe implements PipeTransform {
  transform(value: string | null | undefined): string {
    if (!value || !/^\d{4}-\d{2}-\d{2}$/.test(value)) {
      return value ?? '';
    }
    try {
      const date = parseDateStringAsLocal(value);
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    } catch (error) {
      console.error('Error formatting date:', error);
      return value;
    }
  }
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\hebrewDay.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
	name: 'hebrewDay',
	standalone: true,
})
export class HebrewDayPipe implements PipeTransform {
	private hebrewDays: string[] = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ש'];

	transform(dayIndex: number): string {
		if (dayIndex < 0 || dayIndex > 6) {
			return 'לא ידוע';
		}
		return `${this.hebrewDays[dayIndex]}׳`;
	}
}

export function getHebrewDayName(date: Date | null): string {
	if (!date) return 'יום לא ידוע';

	const hebrewDays = [
		'א׳',    // Sunday - 0
		'ב׳',      // Monday - 1  
		'ג׳',    // Tuesday - 2
		'ד׳',    // Wednesday - 3
		'ה׳',    // Thursday - 4
		'ו׳',     // Friday - 5
		'שבת'       // Saturday - 6
	];

	return hebrewDays[date.getDay()];
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\markdown-to-html.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';

@Pipe({
	name: 'markdownToHtml',
	standalone: true
})
export class MarkdownToHtmlPipe implements PipeTransform {

	constructor(private sanitizer: DomSanitizer) { }

	transform(value: string | undefined | null): SafeHtml {
		if (!value) {
			return '';
		}

		// החלף **טקסט** ב-<strong class="highlight">טקסט</strong>
		const html = value.replace(/\*\*(.*?)\*\*/g, '<strong class="highlight">$1</strong>');

		// השתמש ב-DomSanitizer כדי לסמן את ה-HTML כבטוח
		return this.sanitizer.bypassSecurityTrustHtml(html);
	}
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\orderStatus.pipe.ts ---
import { OrderStatus, orderStatusData } from '../common/enums/order-status.enum';

import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
	name: 'orderStatusLabel',
	standalone: true,
})
export class OrderStatusPipe implements PipeTransform {
	transform(OrderStatus: OrderStatus): string {
		const foundData = orderStatusData.find((data) => data.enumValue === OrderStatus);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'orderStatusIcon',
	standalone: true,
})
export class OrderStatusIconPipe implements PipeTransform {
	transform(orderStatus: OrderStatus): string {
		const foundData = orderStatusData.find((data) => data.enumValue === orderStatus);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'orderStatusColor',
	standalone: true,
})
export class OrderStatusColorPipe implements PipeTransform {
	transform(orderStatus: OrderStatus): string {
		const foundData = orderStatusData.find((data) => data.enumValue === orderStatus);
		return foundData && foundData.tailwind ? foundData.tailwind : '';
	}
}


--- END OF FILE ---
--- START OF FILE src\app\pipes\orderType.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { OrderType, orderTypeData } from '../common/enums/order-type';

@Pipe({
	name: 'orderType',
	standalone: true,
})
export class OrderTypePipe implements PipeTransform {
	transform(orderType: OrderType): string {
		const foundData = orderTypeData.find((data) => data.enumValue === orderType);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'orderTypeIcon',
	standalone: true,
})
export class OrderTypeIconPipe implements PipeTransform {
	transform(orderType: OrderType): string {
		const foundData = orderTypeData.find((data) => data.enumValue === orderType);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'orderTypeColor',
	standalone: true,
})
export class OrderTypeColorPipe implements PipeTransform {
	transform(orderType: OrderType): string {
		const foundData = orderTypeData.find((data) => data.enumValue === orderType);
		return foundData && foundData.tailwind ? foundData.tailwind : '';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\orderViewStatus.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { OrderViewStatus, orderViewStatusData } from '../common/enums/order-status.enum';

@Pipe({
	name: 'orderViewStatusLabel',
	standalone: true,
})
export class OrderViewStatusPipe implements PipeTransform {
	transform(orderViewStatus: OrderViewStatus | null): string {
		if (!orderViewStatus) return 'לא נבחר';
		const foundData = orderViewStatusData.find((data) => data.enumValue === orderViewStatus);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'orderViewStatusIcon',
	standalone: true,
})
export class OrderViewStatusIconPipe implements PipeTransform {
	transform(orderViewStatus: OrderViewStatus | null): string {
		if (!orderViewStatus) return 'pi pi-question';
		const foundData = orderViewStatusData.find((data) => data.enumValue === orderViewStatus);
		return foundData && foundData.icon ? foundData.icon : 'pi pi-question';
	}
}

@Pipe({
	name: 'orderViewStatusColor',
	standalone: true,
})
export class OrderViewStatusColorPipe implements PipeTransform {
	transform(orderViewStatus: OrderViewStatus | null): string {
		if (!orderViewStatus) return 'bg-gray-50';
		const foundData = orderViewStatusData.find((data) => data.enumValue === orderViewStatus);
		return foundData && foundData.background ? foundData.background : 'bg-gray-50';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\package.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { PackageData, Package } from '../common/enums/package';

@Pipe({
	name: 'packageLabel',
	standalone: true,
})
export class ReminderTypePipe implements PipeTransform {
	transform(pack: Package): string {
		const foundData = PackageData.find((data) => data.enumValue === pack);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'packageIcon',
	standalone: true,
})
export class ReminderTypeIconPipe implements PipeTransform {
	transform(pack: Package): string {
		const foundData = PackageData.find((data) => data.enumValue === pack);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'packageColor',
	standalone: true,
})
export class ReminderTypeColorPipe implements PipeTransform {
	transform(pack: Package): string {
		const foundData = PackageData.find((data) => data.enumValue === pack);
		return foundData && foundData.tailwind ? foundData.tailwind : '';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\pluralize-package.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { Package, PackageData } from '../common/enums/package';

@Pipe({
	name: 'pluralizePackage',
	standalone: true,
})
export class PluralizePackagePipe implements PipeTransform {
	transform(quantity: number, packageEnumValue: Package): string {
		if (quantity === null || quantity === undefined) {
			return '';
		}

		const packageInfo = PackageData.find(p => p.enumValue === packageEnumValue);
		if (!packageInfo) {
			return `${quantity}`; // Fallback
		}

		// חוקי הריבוי בעברית
		if (quantity === 1) {
			return `${quantity} ${packageInfo.label}`; // 1 יחידה
		}

		// עבור 2 ומעלה, נשתמש בצורת הרבים
		return `${quantity} ${packageInfo.labelPlural || packageInfo.label}`;
	}
}
--- END OF FILE ---
--- START OF FILE src\app\pipes\reminderType.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { ReminderType, reminderTypeData } from '../common/enums/reminderType';

@Pipe({
	name: 'reminderTypeLabel',
	standalone: true,
})
export class ReminderTypePipe implements PipeTransform {
	transform(ReminderType: ReminderType): string {
		const foundData = reminderTypeData.find((data) => data.enumValue === ReminderType);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'reminderTypeIcon',
	standalone: true,
})
export class ReminderTypeIconPipe implements PipeTransform {
	transform(reminderType: ReminderType): string {
		const foundData = reminderTypeData.find((data) => data.enumValue === reminderType);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'reminderTypeColor',
	standalone: true,
})
export class ReminderTypeColorPipe implements PipeTransform {
	transform(reminderType: ReminderType): string {
		const foundData = reminderTypeData.find((data) => data.enumValue === reminderType);
		return foundData && foundData.background ? foundData.background : '';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\slice-from-colon.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
	name: 'sliceFromColon',
	standalone: true,
})
export class SliceFromColonPipe implements PipeTransform {
	transform(value: string): string {
		if (!value || typeof value !== 'string') {
			return value;
		}

		const index = value.indexOf(':');
		if (index === -1) {
			return value;
		}

		return value.substring(index + 1).trim();
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\split.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
	name: 'textSplit',
	standalone: true
})
export class TextSplitPipe implements PipeTransform {
	transform(value: string | undefined): string[] | null {
		if (!value) return null;

		// חלוקה לפי רווחים או סימני פיסוק נפוצים (רווח, נקודה, נקודה-פסיק, קו-מקף)
		const parts = value.trim().split(/[ \.-]+/);

		// מסנן חלקים ריקים ומחזיר רק חלקים עם תוכן
		return parts.filter(part => part.length > 0);
	}
}

// import { Pipe, PipeTransform } from '@angular/core';

// @Pipe({
// 	name: 'split',
// 	standalone: true,
// })
// export class SplitPipe implements PipeTransform {
// 	transform(value: string, separator: string): string[] {
// 		return value.split(separator);
// 	}
// }

--- END OF FILE ---
--- START OF FILE src\app\pipes\status.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { Status, statusData } from '../common/enums/status.enum';

@Pipe({
	name: 'statusLabel',
	standalone: true,
})
export class StatusLabelPipe implements PipeTransform {
	transform(status: Status): string {
		const foundData = statusData.find((data) => data.enumValue === status);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'statusIcon',
	standalone: true,
})
export class StatusIconPipe implements PipeTransform {
	transform(status: Status): string {
		const foundData = statusData.find((data) => data.enumValue === status);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'statusColor',
	standalone: true,
})
export class StatusColorPipe implements PipeTransform {
	transform(status: Status): string {
		const foundData = statusData.find((data) => data.enumValue === status);
		return foundData && foundData.background ? foundData.background : '';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\pipes\userRole.pipe.ts ---
import { Pipe, PipeTransform } from '@angular/core';
import { UserRole, userRoleData } from '../common/enums/userRole.enum';

@Pipe({
	name: 'userRole',
	standalone: true,
})
export class userRolePipe implements PipeTransform {
	transform(userRole: UserRole | undefined): string {
		const foundData = userRoleData.find((data) => data.enumValue === userRole);
		return foundData ? foundData.label : 'לא מוגדר';
	}
}

@Pipe({
	name: 'userRoleIcon',
	standalone: true,
})
export class userRoleIconPipe implements PipeTransform {
	transform(userRole: UserRole): string {
		const foundData = userRoleData.find((data) => data.enumValue === userRole);
		return foundData && foundData.icon ? foundData.icon : '';
	}
}

@Pipe({
	name: 'userRoleColor',
	standalone: true,
})
export class userRoleColorPipe implements PipeTransform {
	transform(userRole: UserRole): string {
		const foundData = userRoleData.find((data) => data.enumValue === userRole);
		return foundData && foundData.tailwind ? foundData.tailwind : '';
	}
}

--- END OF FILE ---
--- START OF FILE src\app\public\login\login.component.css ---
/* <img src="../../../app/assets/images/sapakit-logo-2.png" alt="Sapakit Logo" class="logo-image"> */
/* הגדרות כלליות לדף */
.login-page {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: var(--grey-50);
  overflow: hidden;
  position: relative;
  font-family: 'Fredoka', sans-serif;
  direction: rtl;
}

/* רקע דינמי עם צורות מונפשות */
.background-shapes {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.shape {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-200), var(--primary-400));
  opacity: 0.1;
  animation: float 20s infinite ease-in-out alternate;
}

.shape1 {
  width: 400px;
  height: 400px;
  top: -150px;
  left: -100px;
  animation-duration: 25s;
}

.shape2 {
  width: 300px;
  height: 300px;
  bottom: -100px;
  right: -120px;
  animation-duration: 22s;
  animation-delay: -5s;
}

.shape3 {
  width: 150px;
  height: 150px;
  bottom: 20%;
  left: 15%;
  animation-duration: 18s;
  animation-delay: -10s;
}

@keyframes float {
  0% { transform: translateY(0px) translateX(0px) rotate(0deg); }
  100% { transform: translateY(40px) translateX(-30px) rotate(180deg); }
}

/* כרטיס הלוגין המרכזי */
.login-card {
  position: relative;
  z-index: 2;
  width: 100%;
  max-width: 400px;
  padding: 2.5rem 2rem;
  background-color: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
  animation: fadeInDown 0.6s ease-out;
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* כותרת הכרטיס */
.card-header {
  text-align: center;
  margin-bottom: 2rem;
}

.logo-image {
  width: 80px;
  height: 80px;
  margin: 0 auto 1rem;
  animation: subtle-pop 0.5s ease-out 0.3s backwards;
}

.title {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--grey-800);
}

.subtitle {
  font-size: 0.9rem;
  color: var(--grey-500);
  margin-top: 0.5rem;
}

/* תוכן הטופס */
.form-content {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}


/* כפתור השליחה */
:host ::ng-deep .p-button {
  padding: 0.8rem !important;
  font-weight: 600 !important;
  background: linear-gradient(135deg, var(--primary-400), var(--primary-600)) !important;
  border: none !important;
  transition: all 0.3s ease !important;
}
:host ::ng-deep .p-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 122, 230, 0.3) !important;
}

/* פוטר הכרטיס */
.card-footer {
  text-align: center;
  margin-top: 2rem;
  font-size: 0.85rem;
  color: var(--grey-500);
}

.card-footer a {
  color: var(--primary-500);
  font-weight: 600;
  text-decoration: none;
  transition: color 0.2s;
}
.card-footer a:hover {
  text-decoration: underline;
  color: var(--primary-600);
}

/* טקסט תחתון בדף */
.footer-text {
  position: absolute;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  color: var(--grey-400);
  z-index: 2;
}
--- END OF FILE ---
--- START OF FILE src\app\public\login\login.component.html ---
<div class="login-page">
    <!-- רקע דינמי -->
    <div class="background-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- כרטיס הלוגין -->
    <div class="card login-card">
        <div class="card-header">
            <img src="../../../app/assets/images/sapakit-logo-2.png" alt="Sapakit Logo" class="logo-image">
            <h1 class="title">ברוכים הבאים ל-Sapakit</h1>
            <p class="subtitle">הזן את פרטיך כדי להיכנס למערכת הניהול החכמה</p>
        </div>

        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
            <div class="flex-wrap-wrapper">
                <div class="flex-wrap-item">
                    <label for="email">כתובת אימייל*</label>
                    <p-iconfield>
                        <input pInputText id="email" formControlName="email" placeholder="you@example.com" />
                        <p-inputicon styleClass="pi pi-envelope" />
                    </p-iconfield>
                    @if (email.touched && email.invalid) {
                    <small class="error-message">
                        @if (email.hasError('required')) { יש להזין כתובת אימייל }
                        @if (email.hasError('email')) { כתובת האימייל אינה תקינה }
                    </small>
                    }
                </div>

                <div class="flex-wrap-item">
                    <label for="password">סיסמה*</label>
                    <p-password id="password" formControlName="password" [feedback]="false" [toggleMask]="true"
                        placeholder="הקלד סיסמה"></p-password>
                    @if (password.touched && password.hasError('required')) {
                    <small class="error-message">יש להזין סיסמה</small>
                    }
                </div>

                <button pButton type="submit" [loading]="loading()" class="w-full justify-center mt-10">
                    <span class="p-button-label">התחברות</span>
                </button>
            </div>
        </form>

        <div class="card-footer">
            <p>אין לך חשבון? <a routerLink="/register">הירשם עכשיו</a></p>
        </div>
    </div>

    <div class="footer-text" dir="ltr">
        &copy; {{ currentYear }} Sapakit. All rights reserved.
    </div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\public\login\login.component.ts ---
import { Component, effect, inject, signal } from '@angular/core';
import {
	AbstractControl,
	FormBuilder,
	FormGroup,
	ReactiveFormsModule,
	Validators,
} from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ActivatedRoute, Router, RouterModule } from '@angular/router';
import { NotificationService } from '../../services/notification.service';
import { markFormGroupTouched } from '../../common/const/custom-validators';
import { AuthService } from '../../services/auth.service';
import { AuthStore } from '../../store/auth.store';

import { InputTextModule } from 'primeng/inputtext';
import { ButtonModule } from 'primeng/button';
import { PasswordModule } from 'primeng/password';
import { CheckboxModule } from 'primeng/checkbox';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { UserRole } from '../../common/enums/userRole.enum';


@Component({
	selector: 'app-login',
	standalone: true,
	imports: [
		CommonModule,
		ReactiveFormsModule,
		InputTextModule,
		PasswordModule,
		ButtonModule,
		CheckboxModule,
		RouterModule,
		IconFieldModule,
		InputIconModule,
	],
	templateUrl: './login.component.html',
	styleUrl: './login.component.css',
})
export class LoginComponent {
	private fb = inject(FormBuilder);
	private authStore = inject(AuthStore);
	private notificationService = inject(NotificationService);
	private router = inject(Router);
	private readonly route = inject(ActivatedRoute);

	formSubmitted = signal<boolean>(false);
	loading = signal<boolean>(false);
	readonly currentYear = new Date().getFullYear();

	loginForm: FormGroup = this.fb.group({
		email: ['porat@mail.com', [Validators.required, Validators.email]],
		password: ['password', Validators.required],
		rememberMe: [false],
	});

	get email(): AbstractControl {
		return this.loginForm.get('email') as AbstractControl<string>;
	}
	get password(): AbstractControl {
		return this.loginForm.get('password') as AbstractControl<string>;
	}
	// get rememberMe(): AbstractControl {
	// 	return this.loginForm.get('rememberMe') as AbstractControl<boolean>;
	// }

   constructor() {
        effect(() => {
            if (this.authStore.isAuthenticated()) {
                // קבל את ה-URL לחזרה מה-Query Params
                const returnUrl = this.route.snapshot.queryParams['returnUrl'] || this.getDefaultUrlForUser();
                this.router.navigateByUrl(returnUrl);
            }
        });
    }

    private getDefaultUrlForUser(): string {
        const user = this.authStore.user();
        if (user?.role === UserRole.SysAdmin) {
            return '/admin';
        }
        return '/';
    }

	onSubmit() {
		markFormGroupTouched(this.loginForm);

		if (this.loginForm.invalid) {
			this.notificationService.toast({ detail: 'אנא מלא את כל השדות הנדרשים' });
			return;
		}

		// ✅ קרא למתודת ה-login ב-Store
		this.authStore.login(this.loginForm.getRawValue());
	}

}
--- END OF FILE ---
--- START OF FILE src\app\public\register\register.component.css ---
/* ייבא את הסגנון המשותף מדף הלוגין */
@import '../login/login.component.css';

/* כאן נוסיף רק את הדריסות הקטנות והייחודיות לדף ההרשמה, אם צריך */

.register-card {
  /* אם נרצה שהכרטיס יהיה קצת יותר רחב, למשל */
  max-width: 420px; 
  z-index: 2;
}

/* אפשר להוסיף אנימציה קצת שונה אם רוצים */
.register-card {
    animation: fadeInUp 0.7s ease-out;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* הפוך את תוכן הטופס לקצת יותר מרווח */
.form-content {
    gap: 1.25rem;
}
--- END OF FILE ---
--- START OF FILE src\app\public\register\register.component.html ---
<div class="login-page">
    <!-- רקע דינמי זהה -->
    <div class="background-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- כרטיס הרשמה -->
    <div class="card register-card">
        <div class="card-header">
            <img src="../../../app/assets/images/sapakit-logo-2.png" alt="Sapakit Logo" class="logo-image">
            <h1 class="title">יצירת חשבון חדש</h1>
            <p class="subtitle">הצטרף ל-Sapakit והתחל לנהל את ההזמנות שלך בחכמה</p>
        </div>

        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
            <div class="flex-wrap-wrapper">
                <div class="flex-wrap-item">
                    <label for="accountName">שם העסק*</label>
                    <p-iconfield>
                        <input pInputText id="accountName" formControlName="accountName" placeholder="העסק שלי" />
                        <p-inputicon styleClass="pi pi-briefcase" />
                    </p-iconfield>
                    @if (accountName.touched && accountName.hasError('required')) {
                    <small class="error-message">שדה חובה</small>
                    }
                </div>
                <div class="flex-wrap-item">
                    <label for="username">שם משתמש*</label>
                    <p-iconfield>
                        <input pInputText id="username" formControlName="username" placeholder="הקלד את שמך" />
                        <p-inputicon styleClass="pi pi-user" />
                    </p-iconfield>
                    @if (username.touched && username.hasError('required')) {
                    <small class="error-message">שדה חובה</small>
                    }
                </div>

                <div class="flex-wrap-item">
                    <label for="email">כתובת אימייל*</label>
                    <p-iconfield>
                        <input pInputText id="email" formControlName="email" placeholder="you@example.com" />
                        <p-inputicon styleClass="pi pi-envelope" />
                    </p-iconfield>
                    @if (email.touched && email.invalid) {
                    <small class="error-message">
                        @if (email.hasError('required')) { יש להזין כתובת אימייל }
                        @if (email.hasError('email')) { כתובת האימייל אינה תקינה }
                    </small>
                    }
                </div>

                <div class="flex-wrap-item">
                    <label for="password">סיסמה* {{`(מינימום ${passwordLength()} תווים)`}}</label>
                    <app-password-input
                        #passwordInputComp
                        inputId="password"
                        formControlName="password"
                        [minLength]="8"
                        [useCustomValidator]="true"
                        autocomplete="new-password">
                    </app-password-input>
                </div>

                <div class="flex-wrap-item">
                    <label for="confirmPassword">אימות סיסמה*</label>
                    <p-password id="confirmPassword" formControlName="confirmPassword" [feedback]="false"
                        [toggleMask]="true" placeholder="הקלד שוב את הסיסמה"></p-password>
                    @if (registerForm.hasError('mismatch') && confirmPassword.touched) {
                    <small class="error-message">הסיסמאות אינן תואמות</small>
                    }
                </div>

                <button pButton type="submit" [loading]="loading()" class="w-full justify-center mt-10">
                    <span class="p-button-label">יצירת חשבון</span>
                </button>
            </div>
        </form>

        <div class="card-footer">
            <p>כבר יש לך חשבון? <a routerLink="/login">התחבר</a></p>
        </div>
    </div>

    <div class="footer-text" dir="ltr">
        &copy; {{ currentYear }} Sapakit. All rights reserved.
    </div>
</div>
--- END OF FILE ---
--- START OF FILE src\app\public\register\register.component.ts ---
import { Component, inject, signal, ViewChild } from '@angular/core';
import {
	FormBuilder,
	FormGroup,
	ReactiveFormsModule,
	Validators,
	AbstractControl,
	ValidationErrors,
} from '@angular/forms';
import { CommonModule } from '@angular/common';
import { Router, RouterModule } from '@angular/router';
import { NotificationService } from '../../services/notification.service';
import { detailedPasswordValidator, markFormGroupTouched } from '../../common/const/custom-validators';
import { AuthService } from '../../services/auth.service';
import { ApiService } from '../../services/api.service';
import { HttpErrorResponse } from '@angular/common/http';
import { CreateUserDto } from '../../common/dto/user-create.dto';
import { AuthStore } from '../../store/auth.store';

import { InputTextModule } from 'primeng/inputtext';
import { ButtonModule } from 'primeng/button';
import { PasswordModule } from 'primeng/password';
import { CardModule } from 'primeng/card';
import { DialogService } from 'primeng/dynamicdialog';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { PasswordInputComponent } from '../../components/shared/password-input/password-input.component';


@Component({
	selector: 'app-register',
	standalone: true,
	imports: [
		CommonModule,
		ReactiveFormsModule,
		InputTextModule,
		PasswordModule,
		ButtonModule,
		RouterModule,
		CardModule,
		IconFieldModule,
		InputIconModule,
		PasswordInputComponent,
	],
	templateUrl: './register.component.html',
	styleUrl: './register.component.css',
	providers: [DialogService],
})
export class RegisterComponent {
	private fb = inject(FormBuilder);
	private authService = inject(AuthService);
	private apiService = inject(ApiService);
	private notificationService = inject(NotificationService);
	private router = inject(Router);

	private authStore = inject(AuthStore);
	public readonly passwordLength = signal(8);

	@ViewChild('passwordInputComp') passwordInputComp!: PasswordInputComponent;


	formSubmitted = signal<boolean>(false);
	loading = signal<boolean>(false);
	readonly currentYear = new Date().getFullYear();
	registerForm: FormGroup = this.fb.group(
		{
			username: ['', Validators.required],
			accountName: ['', Validators.required],
			email: ['', [Validators.required, Validators.email]],
			password: ['', [Validators.required, detailedPasswordValidator()]],
			confirmPassword: ['', Validators.required],
		},
		{
			validators: this.passwordMatchValidator,
		},
	);

	get username(): AbstractControl { return this.registerForm.get('username') as AbstractControl<string> }
	get accountName(): AbstractControl { return this.registerForm.get('accountName') as AbstractControl<string> }
	get email(): AbstractControl { return this.registerForm.get('email') as AbstractControl<string> }
	get password(): AbstractControl { return this.registerForm.get('password') as AbstractControl<string> }
	get confirmPassword(): AbstractControl { return this.registerForm.get('confirmPassword') as AbstractControl<string> }

	private passwordMatchValidator(control: AbstractControl): ValidationErrors | null {
		const password = control.get('password')?.value;
		const confirmPassword = control.get('confirmPassword')?.value;
		return password === confirmPassword ? null : { mismatch: true };
	}


	onSubmit() {
		this.formSubmitted.set(true);
		markFormGroupTouched(this.registerForm);

		if (this.password && this.passwordInputComp) {
			this.passwordInputComp.markAsTouched();
		}

		if (this.registerForm.invalid) {
			this.notificationService.toast({
				severity: 'error',
				detail: 'יש למלא את כל השדות המסומנים באדום',
			});
			return;
		}

		this.loading.set(true);
		const formValue = this.registerForm.value;
		const registrationPayload: CreateUserDto = {
			email: formValue.email,
			username: formValue.username,
			password: formValue.password,
			accountName: formValue.accountName,
		};



		this.apiService.register(registrationPayload).subscribe({
			next: () => {
				this.notificationService.toast({
					severity: 'success',
					detail: 'ההרשמה בוצעה בהצלחה!',
				});
				this.authStore.login({
					email: formValue.email,
					password: formValue.password
				});
			},
			error: (err: HttpErrorResponse) => {
				this.loading.set(false);
				this.notificationService.toast({
					severity: 'error',
					detail: err.error?.message || 'Registration failed. Please try again.',
				});
			},
		});
	}
}

--- END OF FILE ---
--- START OF FILE src\app\services\api.service.ts ---
import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable } from 'rxjs';
import { environment } from '../../environments/environment';
import { CreateOrderDto } from '../common/dto/order-create.dto';
import { OrderStatus } from '../common/enums/order-status.enum';
import { OrderBySupplierDateParams } from '../common/dto/order-by-supplier-date.dto';
import { OrdersByRangeParams } from '../common/dto/orders-by-range.dto';
import { Category } from '../common/models/category';
import { Insight } from '../common/models/insight';
import { Order } from '../common/models/order';
import { Product } from '../common/models/product';
import { ServiceResultContainer } from '../common/models/serviceResultContainer';
import { DashboardStats } from '../common/models/statistics';
import { Supplier } from '../common/models/supplier';
import { User } from '../common/models/user';
import { CreateUserDto } from '../common/dto/user-create.dto';
import { Account } from '../common/models/account';
import { SystemKpis } from '../components/admin/admin-dashboard-component/admin-dashboard-component.component';

export interface OrderSuggestion {
	productId: number;
	averageQuantity: number;
}

@Injectable({ providedIn: 'root' })
export class ApiService {
	private http = inject(HttpClient);
	private apiUrl = environment.apiUrl;

	//Accounts
	getAllAccountsWithUsers(): Observable<ServiceResultContainer<Account[]>> {
		return this.http.get<ServiceResultContainer<Account[]>>(`${this.apiUrl}/accounts/with-users`);
	}

	deleteAccount(accountId: number): Observable<ServiceResultContainer<void>> {
		return this.http.delete<ServiceResultContainer<void>>(`${this.apiUrl}/accounts/${accountId}`);
	}

	// Users
	getUsers(): Observable<ServiceResultContainer<User[]>> {
		return this.http.get<ServiceResultContainer<User[]>>(`${this.apiUrl}/users`);
	}

	//New Account
	register(newUser: CreateUserDto): Observable<ServiceResultContainer<User>> {
		return this.http.post<ServiceResultContainer<User>>(`${this.apiUrl}/auth/register`, newUser);
	}

	// New User
	addUser(formData: FormData): Observable<ServiceResultContainer<User>> {
		return this.http.post<ServiceResultContainer<User>>(`${this.apiUrl}/users/add`, formData);
	}

	updateUser(id: number, formData: FormData): Observable<ServiceResultContainer<User>> {
		return this.http.put<ServiceResultContainer<User>>(`${this.apiUrl}/users/${id}`, formData);
	}

	deleteUser(id: number): Observable<ServiceResultContainer<void>> {
		return this.http.delete<ServiceResultContainer<void>>(`${this.apiUrl}/users/${id}`);
	}


	// Suppliers
	getSuppliers(): Observable<ServiceResultContainer<Supplier[]>> {
		return this.http.get<ServiceResultContainer<Supplier[]>>(`${this.apiUrl}/suppliers`, {});
	}

	getSupplierById(id: number, includeProducts: boolean = false): Observable<ServiceResultContainer<Supplier>> {
		const params = new URLSearchParams({ includeProducts: includeProducts.toString() });
		return this.http.get<ServiceResultContainer<Supplier>>(`${this.apiUrl}/suppliers/${id}?${params}`);
	}

	addSupplier(supplier: Partial<Supplier>): Observable<ServiceResultContainer<Supplier>> {
		return this.http.post<ServiceResultContainer<Supplier>>(`${this.apiUrl}/suppliers`, supplier);
	}

	updateSupplier(id: number, updatedSupplier: Partial<Supplier>): Observable<ServiceResultContainer<Supplier>> {
		return this.http.put<ServiceResultContainer<Supplier>>(`${this.apiUrl}/suppliers/${id}`, updatedSupplier);
	}

	deleteSupplier(id: number): Observable<ServiceResultContainer<void>> {
		return this.http.delete<ServiceResultContainer<void>>(`${this.apiUrl}/suppliers/${id}`);
	}

	// Products
	getProductsBySupplier(supplierId: number): Observable<ServiceResultContainer<(Product & { categoryName?: string })[]>> {
		return this.http.get<ServiceResultContainer<(Product & { categoryName?: string })[]>>(`${this.apiUrl}/products?supplierId=${supplierId}`);

	}

	addProduct(
		product: Partial<Product>): Observable<ServiceResultContainer<Product & { categoryName?: string }>> {
		return this.http.post<ServiceResultContainer<Product & { categoryName?: string }>>(`${this.apiUrl}/products`, product);
	}

	updateProduct(id: number, updatedProduct: Partial<Product>): Observable<ServiceResultContainer<Product>> {
		return this.http.put<ServiceResultContainer<Product>>(`${this.apiUrl}/products/${id}`, updatedProduct);
	}

	deleteProduct(id: number): Observable<ServiceResultContainer<void>> {
		return this.http.delete<ServiceResultContainer<void>>(`${this.apiUrl}/products/${id}`);
	}


	// Categories
	getCategoriesBySupplier(supplierId: number): Observable<ServiceResultContainer<Category[]>> {
		return this.http.get<ServiceResultContainer<Category[]>>(`${this.apiUrl}/categories?supplierId=${supplierId}`);
	}

	createCategory(category: Partial<Category>): Observable<ServiceResultContainer<Category>> {
		return this.http.post<ServiceResultContainer<Category>>(`${this.apiUrl}/categories`, category);
	}

	updateCategory(id: number, category: Partial<Category>): Observable<ServiceResultContainer<Category>> {
		return this.http.put<ServiceResultContainer<Category>>(`${this.apiUrl}/categories/${id}`, category);
	}

	deleteCategory(id: number): Observable<ServiceResultContainer<void>> {
		return this.http.delete<ServiceResultContainer<void>>(`${this.apiUrl}/categories/${id}`);
	}

	updateProductsBatch(updates: { id: number; position: number; categoryId: number }[]): Observable<ServiceResultContainer<Product[]>> {
		return this.http.put<ServiceResultContainer<Product[]>>(`${this.apiUrl}/products/batch`, updates);
	}
	updateCategoriesBatch(updates: { categoryId: number; position: number; supplierId: number }[]): Observable<ServiceResultContainer<Category[]>> {
		return this.http.put<ServiceResultContainer<Category[]>>(`${this.apiUrl}/categories/batch`, updates);
	}


	// --- Orders ---
	createOrUpdateOrder(orderDto: CreateOrderDto): Observable<ServiceResultContainer<Order | null>> {
		return this.http.post<ServiceResultContainer<Order | null>>(`${this.apiUrl}/orders`, orderDto);
	}

	findOrdersByStatus(statuses: OrderStatus[]): Observable<ServiceResultContainer<Order[]>> {
		const statusString = statuses.join(',');
		return this.http.get<ServiceResultContainer<Order[]>>(`${this.apiUrl}/orders/by-status?statuses=${statusString}`
		);
	}

	/*** Finds a single order by supplier ID and date. */
	findOrderBySupplierAndDate(params: OrderBySupplierDateParams): Observable<ServiceResultContainer<Order | null>> {
		const httpParams = new HttpParams()
			.set('supplierId', params.supplierId.toString())
			.set('date', params.date);
		return this.http.get<ServiceResultContainer<Order | null>>(`${this.apiUrl}/orders/find`, { params: httpParams });
	}

	/*** Retrieves a list of orders for multiple suppliers within a date range. */
	findOrdersBySuppliersAndDateRange(params: OrdersByRangeParams): Observable<ServiceResultContainer<Order[]>> {
		const httpParams = new HttpParams()
			.set('supplierIds', params.supplierIds.join(','))
			.set('startDate', params.startDate)
			.set('endDate', params.endDate);
		return this.http.get<ServiceResultContainer<Order[]>>(`${this.apiUrl}/orders/in-date-range`, { params: httpParams });
	}

	/*** Gets the order schedule status for multiple suppliers over a date range. Used by the calendar component. */
	getOrderSchedules(params: OrdersByRangeParams): Observable<ServiceResultContainer<any>> {
		const httpParams = new HttpParams()
			.set('supplierIds', params.supplierIds.join(','))
			.set('startDate', params.startDate)
			.set('endDate', params.endDate);
		return this.http.get<ServiceResultContainer<any>>(`${this.apiUrl}/orders/schedules`, { params: httpParams });
	}

	getOrderSuggestions(
		supplierId: number,
		date: Date,
		mode: 'general' | 'daySpecific'
	): Observable<ServiceResultContainer<OrderSuggestion[]>> {
		const params = new HttpParams()
			.set('supplierId', supplierId.toString())
			.set('date', date.toISOString().split('T')[0])
			.set('mode', mode)
			.set('limit', '10'); // The limit is now on the server side

		return this.http.get<ServiceResultContainer<OrderSuggestion[]>>(
			`${this.apiUrl}/orders/suggestions`, { params }
		);
	}

	uploadTxtFile(file: File, supplierId: number): Observable<ServiceResultContainer<any>> {
		console.log('🚀 Uploading file:', file.name, 'for supplier:', supplierId);

		const formData = new FormData();
		formData.append('txtFile', file);

		const params = new HttpParams()
			.set('supplierId', supplierId.toString())
			.set('minMatchThreshold', '70') // אופציונלי
			.set('minMatchedRatio', '0.6');  // אופציונלי

		return this.http.post<ServiceResultContainer<any>>(`${this.apiUrl}/orders/upload-txt`, formData, { params })

	}

	// API Service
	deleteSupplierOrders(supplierId: number): Observable<any> {
		console.log(`🗑️ API: Deleting orders for supplier: ${supplierId}`);

		return this.http.delete(`${this.apiUrl}/orders/supplier/${supplierId}`);
	}

	// --- Stats ---
	getDashboardKpis(): Observable<ServiceResultContainer<DashboardStats>> {
		return this.http.get<ServiceResultContainer<DashboardStats>>(`${this.apiUrl}/statistics/dashboard-kpis`);
	}
	getSystemKpis(): Observable<ServiceResultContainer<SystemKpis>> {
    return this.http.get<ServiceResultContainer<SystemKpis>>(`${this.apiUrl}/admin/kpis`);
}



	// --- Insight ---
	getInsights(): Observable<ServiceResultContainer<null>> {
		return this.http.get<ServiceResultContainer<null>>(`${this.apiUrl}/insights/trigger-daily`);
	}

	getUnreadInsights(): Observable<ServiceResultContainer<Insight[]>> {
		return this.http.get<ServiceResultContainer<Insight[]>>(`${this.apiUrl}/insights`);
	}

	markInsightAsRead(id: number): Observable<ServiceResultContainer<null>> {
		return this.http.post<ServiceResultContainer<null>>(`${this.apiUrl}/insights/${id}/mark-as-read`, {});
	}


}

// public handleResponse<T>(
// 	response: ServiceResultContainer<T>,
// 	successAction: (result: T) => void,
// 	errorSeverity: 'error' | 'warn' = 'error',
// 	defaultErrorMessage: string,
// ) {
// 	if (response.success && response.result !== null) {
// 		successAction(response.result);
// 	} else {
// 		this.notificationService.toast({
// 			severity: errorSeverity,
// 			summary: 'שגיאה',
// 			detail: response.message || defaultErrorMessage,
// 		});
// 	}
// }
--- END OF FILE ---
--- START OF FILE src\app\services\auth.service.ts ---
import { Injectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';
import { Observable, catchError, map, of, tap, throwError } from 'rxjs';
import { NotificationService } from './notification.service';
import { environment } from '../../environments/environment';
import { ServiceResultContainer } from '../common/models/serviceResultContainer';
import { User } from '../common/models/user';

@Injectable({
	providedIn: 'root',
})
export class AuthService {
	private http = inject(HttpClient);
	private router = inject(Router);
	private notificationService = inject(NotificationService);

	private readonly apiUrl = environment.apiUrl;
	private accessToken: string | null = null;

	setAccessToken(token: string): void {
		this.accessToken = token;
		console.log('Access token set:', token);
	}

	getAccessToken(): string | null {
		return this.accessToken;
	}

	getCurrentUser(): Observable<User | null> {
		return this.http.get<ServiceResultContainer<User>>(`${this.apiUrl}/auth/user`, {
				withCredentials: true,
			})
			.pipe(
				tap((response) => console.log('Get current user response:', response)),
				map((response) => (response.success ? response.result : null)),
				catchError((error) => {
					const errorMessage = error.message || 'Error restoring session.';
					console.error('Get current user failed:', errorMessage);
					this.notificationService.toast({ severity: 'error', detail: errorMessage });
					if (errorMessage.includes('לא ניתן להתחבר לשרת')) {
                        }
					return of(null);
				}),
			);
	}

	login(credentials: { email: string, password: string }): Observable<ServiceResultContainer<{ accessToken: string, refreshToken: string }>> {
		return this.http.post<ServiceResultContainer<{ accessToken: string, refreshToken: string }>>(
			`${this.apiUrl}/auth/login`,
			credentials
		);
	}

	logout(): Observable<any> {
		return this.http.post(`${this.apiUrl}/auth/logout`, {});
	}

	isLoggedIn(): Observable<boolean> {
		return this.getCurrentUser().pipe(
			map((user) => !!user),
			catchError(() => of(false)),
		);
	}

	authenticatedRequest<T>(url: string, body?: any): Observable<T> {
		return this.http.post<T>(`${this.apiUrl}${url}`, body, {
			withCredentials: true,
		});
	}

	refreshToken(): Observable<any> {
		return this.http
			.post<
				ServiceResultContainer<any>
			>(`${this.apiUrl}/auth/refresh`, {}, { withCredentials: true })
			.pipe(
				tap((response) => {
					console.log('Refresh token response:', response);
					if (response.success && response.result?.accessToken) {
						this.setAccessToken(response.result.accessToken);
					} else {
						throw new Error('No access token returned from refresh');
					}
				}),
				catchError((err) => {
					console.error('Refresh token error:', err);
					this.accessToken = null;
					return throwError(() => new Error('Failed to refresh token'));
				}),
			);
	}
}

--- END OF FILE ---
--- START OF FILE src\app\services\drag-drop.service.ts ---
// import { Injectable, inject } from '@angular/core';
// import { CdkDragDrop, moveItemInArray, transferArrayItem } from '@angular/cdk/drag-drop';
// import { Observable, of } from 'rxjs';
// import { catchError, tap } from 'rxjs/operators';
// import { ApiService } from './api.service';
// import { NotificationService } from './notification.service';
// import { Product } from '../models/product';
// import { Category } from '../models/category';

// export interface CategoryGroup {
// 	categoryId: number;
// 	categoryName: string;
// 	products: Product[];
// 	id: string;
// }

// export interface ProductUpdatePayload {
// 	id: number;
// 	position: number;
// 	categoryId: number;
// }

// export interface CategoryUpdatePayload {
// 	categoryId: number;
// 	position: number;
// 	supplierId: number;
// }

// @Injectable({
// 	providedIn: 'root'
// })
// export class DragDropService {
// 	private readonly apiService = inject(ApiService);
// 	private readonly notificationService = inject(NotificationService);

// 	/**
// 	 * מטפל בגרירת מוצר בין קטגוריות או בתוך קטגוריה
// 	 * @param event אירוע הגרירה
// 	 * @param groupedProducts מערך הקטגוריות המקובצות
// 	 * @param rawProducts מערך כל המוצרים הגולמי
// 	 * @param categoryOrder סדר הקטגוריות
// 	 * @returns Observable עם המוצרים המעודכנים או null במקרה של שגיאה
// 	 */
// 	dropProduct(
// 		event: CdkDragDrop<Product[]>,
// 		groupedProducts: CategoryGroup[],
// 		rawProducts: Product[],
// 		categories: Category[]
// 	): Observable<Product[] | null> {
// 		const isSameContainer = event.previousContainer === event.container;

// 		// אם לא היה שינוי במיקום, לא צריך לעשות כלום
// 		if (isSameContainer && event.previousIndex === event.currentIndex) {
// 			return of(null);
// 		}

// 		// בצע את השינוי הויזואלי במערכים הזמניים
// 		if (isSameContainer) {
// 			moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);
// 		} else {
// 			transferArrayItem(
// 				event.previousContainer.data,
// 				event.container.data,
// 				event.previousIndex,
// 				event.currentIndex
// 			);
// 		}

// 		// בנה את העדכונים הנדרשים
// 		const updates = this.buildProductUpdates(event, groupedProducts, isSameContainer);

// 		if (updates.size === 0) {
// 			return of(null);
// 		}

// 		// עדכן את מקור האמת באופן אופטימי
// 		const updatedProducts = this.updateProductsOptimistically(rawProducts, updates, categories);

// 		// שלח עדכונים לשרת
// 		this.batchUpdateProducts(updates, updatedProducts).subscribe();

// 		return of(updatedProducts);
// 	}

// 	/**
// 	 * מטפל בגרירת קטגוריה ושינוי סדר הקטגוריות
// 	 * @param event אירוע הגרירה
// 	 * @param categoryOrder סדר הקטגוריות הנוכחי
// 	 * @param rawProducts מערך כל המוצרים
// 	 * @param supplierId מזהה הספק
// 	 * @returns Observable עם הנתונים המעודכנים או null במקרה של שגיאה
// 	 */
// // in drag-drop.service.ts

// public dropCategory(
//     event: CdkDragDrop<CategoryGroup[]>,
//     categoryOrder: { id: number; name: string }[], // הטיפוס הנכון
//     rawProducts: Product[],
//     supplierId: number
// ): Observable<{ categoryOrder: { id: number; name: string }[], products: Product[] } | null> {
//     if (event.previousIndex === event.currentIndex) {
//         return of(null);
//     }

//     const newCategoryOrder = [...categoryOrder];
//     moveItemInArray(newCategoryOrder, event.previousIndex, event.currentIndex);

//     const sortedProducts = [...rawProducts].sort((a, b) => {
//         // ✅ שימוש ב-findIndex עם המבנה הנכון
//         const indexA = newCategoryOrder.findIndex(cat => cat.name === a.categoryName);
//         const indexB = newCategoryOrder.findIndex(cat => cat.name === b.categoryName);
//         return indexA - indexB || a.position - b.position;
//     });

//     // הערה: שינוי סדר הקטגוריות לא אמור לשנות את ה-position של המוצרים עצמם,
//     // אלא רק את הסדר שבו הקטגוריות מוצגות.
//     // הלוגיקה לעדכון position של מוצרים שייכת ל-dropProduct.
//     // לכן, נשאיר את ה-positions של המוצרים כפי שהם.

//     const categoryUpdates: CategoryUpdatePayload[] = newCategoryOrder.map((category, index) => ({
//         categoryId: category.id, // ✅ שימוש ב-id מהאובייקט
//         position: index,
//         supplierId,
//     }));

//     // ... (הקריאה ל-API נשארת זהה)
//     this.updateCategoriesBatch(categoryUpdates).subscribe();

//     // ✅ החזרת הטיפוסים הנכונים
//     return of({
//         categoryOrder: newCategoryOrder,
//         products: rawProducts // אין צורך לעדכן את המוצרים כאן
//     });
// }

// 	/**
// 	 * שולח עדכון באצווה של מוצרים לשרת
// 	 * @param updates מפה של עדכונים למוצרים
// 	 * @param allProducts כל המוצרים עם המידע המעודכן
// 	 * @returns Observable של התגובה
// 	 */
// 	public batchUpdateProducts(
// 		updates: Map<number, Partial<Product>>,
// 		allProducts: Product[]
// 	): Observable<any> {
// 		if (updates.size === 0) {
// 			return of(null);
// 		}

// 		const updatePayload: ProductUpdatePayload[] = Array.from(updates.keys())
// 			.map(productId => {
// 				const updatedProduct = allProducts.find(p => p.id === productId);

// 				if (!updatedProduct || updatedProduct.categoryId == null || updatedProduct.position == null) {
// 					return null;
// 				}

// 				return {
// 					id: updatedProduct.id,
// 					position: updatedProduct.position,
// 					categoryId: updatedProduct.categoryId,
// 				};
// 			})
// 			.filter((p): p is ProductUpdatePayload => p !== null);

// 		if (updatePayload.length === 0) {
// 			console.warn('Batch update for products was triggered, but no valid payload was generated.');
// 			return of(null);
// 		}

// 		console.log('Sending product batch update with payload:', JSON.stringify(updatePayload, null, 2));

// 		return this.apiService.updateProductsBatch(updatePayload).pipe(
// 			tap((response) => {
// 				if (response.success) {
// 					this.notificationService.toast({
// 						severity: 'success',
// 						detail: 'סדר המוצרים עודכן בהצלחה.'
// 					});
// 				} else {
// 					this.notificationService.toast({
// 						severity: 'error',
// 						detail: response.message || 'שגיאה בעדכון סדר המוצרים.'
// 					});
// 				}
// 			}),
// 			catchError((err) => {
// 				this.notificationService.toast({
// 					severity: 'error',
// 					detail: 'שגיאה בשרת: ' + (err.error?.message || 'לא ידוע')
// 				});
// 				return of(null);
// 			})
// 		);
// 	}

// 	/**
// 	 * שולח עדכון באצווה של קטגוריות לשרת
// 	 * @param categoryUpdates מערך עדכוני הקטגוריות
// 	 * @returns Observable של התגובה
// 	 */
// 	private updateCategoriesBatch(categoryUpdates: CategoryUpdatePayload[]): Observable<any> {
// 		return this.apiService.updateCategoriesBatch(categoryUpdates).pipe(
// 			tap((response) => {
// 				if (response.success) {
// 					this.notificationService.toast({
// 						severity: 'success',
// 						detail: 'סדר הקטגוריות עודכן בהצלחה.'
// 					});
// 				} else {
// 					this.notificationService.toast({
// 						severity: 'error',
// 						detail: response.message || 'שגיאה בעדכון סדר הקטגוריות.'
// 					});
// 				}
// 			}),
// 			catchError((err) => {
// 				this.notificationService.toast({
// 					severity: 'error',
// 					detail: 'שגיאה בשרת: ' + (err.message || 'לא ידוע')
// 				});
// 				return of(null);
// 			})
// 		);
// 	}

// 	/**
// 	 * בונה את מפת העדכונים הנדרשים למוצרים
// 	 * @param event אירוע הגרירה
// 	 * @param groupedProducts קטגוריות מקובצות
// 	 * @param isSameContainer האם הגרירה הייתה באותו קונטיינר
// 	 * @returns מפה של עדכונים למוצרים
// 	 */
// 	public buildProductUpdates(
// 		event: CdkDragDrop<Product[]>,
// 		groupedProducts: CategoryGroup[],
// 		isSameContainer: boolean
// 	): Map<number, Partial<Product>> {
// 		const updates = new Map<number, Partial<Product>>();

// 		// פונקציית עזר לעדכון מוצרים בקונטיינר נתון
// 		const processContainer = (containerData: Product[], categoryId: number, categoryName: string) => {
// 			containerData.forEach((product, index) => {
// 				const hasChangedPosition = product.position !== index;
// 				const hasChangedCategory = product.categoryId !== categoryId;

// 				if (hasChangedPosition || hasChangedCategory) {
// 					const update: Partial<Product> = updates.get(product.id) || {};
// 					if (hasChangedPosition) update.position = index;
// 					if (hasChangedCategory) {
// 						update.categoryId = categoryId;
// 						update.categoryName = categoryName;
// 					}
// 					updates.set(product.id, update);
// 				}
// 			});
// 		};

// 		// עדכון קונטיינר היעד
// 		const targetGroup = groupedProducts.find(g => g.id === event.container.id);
// 		if (targetGroup) {
// 			processContainer(event.container.data, targetGroup.categoryId, targetGroup.categoryName);
// 		}

// 		// אם עברנו מקונטיינר אחר, עדכן גם את קונטיינר המקור
// 		if (!isSameContainer) {
// 			const sourceGroup = groupedProducts.find(g => g.id === event.previousContainer.id);
// 			if (sourceGroup) {
// 				processContainer(event.previousContainer.data, sourceGroup.categoryId, sourceGroup.categoryName);
// 			}
// 		}

// 		return updates;
// 	}

// 	/**
// 	 * מעדכן את המוצרים באופן אופטימי במקור האמת
// 	 * @param currentProducts המוצרים הנוכחיים
// 	 * @param updates מפת העדכונים
// 	 * @param categoryOrder סדר הקטגוריות
// 	 * @returns מערך המוצרים המעודכן
// 	 */
// 	private updateProductsOptimistically(
// 		currentProducts: Product[],
// 		updates: Map<number, Partial<Product>>,
// 		categoryOrder: Category[]
// 	): Product[] {
// 		const newProducts = currentProducts.map(p => {
// 			const update = updates.get(p.id);
// 			return update ? { ...p, ...update } : p;
// 		});

// 		// מיין את כל המערך מחדש לפי קטגוריה ומיקום
// 		return newProducts.sort((a, b) => {
// 			const catIndexA = categoryOrder.indexOf(a);
// 			const catIndexB = categoryOrder.indexOf(b);
// 			if (catIndexA !== catIndexB) {
// 				return catIndexA - catIndexB;
// 			}
// 			return a.position - b.position;
// 		});
// 	}



	
// }
--- END OF FILE ---
--- START OF FILE src\app\services\excel-export.service.ts ---
import { Injectable } from '@angular/core';
import * as XLSX from 'xlsx';

export interface ExportColumn {
	key: string;
	header: string;
	transform?: (value: any) => string;
}

export interface ExportOptions {
	fileName?: string;
	sheetName?: string;
	includeTimestamp?: boolean;
}

@Injectable({
	providedIn: 'root',
})
export class ExcelExportService {
	/**
	 * Export data to an Excel file
	 * @param data - The array of data to export
	 * @param columns - Column definitions
	 * @param options - Additional export options
	 */
	exportToExcel<T>(data: T[], columns: ExportColumn[], options: ExportOptions = {}): void {
		if (!data || data.length === 0) {
			console.warn('No data to export');
			return;
		}

		try {
			// Prepare data for export
			const exportData = this.prepareDataForExport(data, columns);

			// Create worksheet
			const worksheet = XLSX.utils.json_to_sheet(exportData);

			// Set column widths
			this.setColumnWidths(worksheet, columns);

			// Create workbook
			const workbook = XLSX.utils.book_new();
			const sheetName = options.sheetName || 'Data';
			XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);

			// Generate file name
			const fileName = this.generateFileName(options.fileName, options.includeTimestamp);

			// Save the file
			XLSX.writeFile(workbook, fileName);
		} catch (error) {
			console.error('Error exporting to Excel:', error);
			throw new Error('Failed to export data');
		}
	}

	/**
	 * Quick export using default column settings
	 * @param data - Data to export
	 * @param fileName - File name
	 */
	quickExport<T>(data: T[], fileName?: string): void {
		if (!data || data.length === 0) return;

		const columns = this.generateColumnsFromData(data[0]);
		this.exportToExcel(data, columns, { fileName });
	}

	private prepareDataForExport<T>(data: T[], columns: ExportColumn[]): any[] {
		return data.map((item) => {
			const exportItem: any = {};

			columns.forEach((column) => {
				const value = this.getNestedValue(item, column.key);
				exportItem[column.header] = column.transform
					? column.transform(value)
					: this.formatValue(value);
			});

			return exportItem;
		});
	}

	private getNestedValue(obj: any, path: string): any {
		return path.split('.').reduce((current, key) => current?.[key], obj);
	}

	private formatValue(value: any): string {
		if (value === null || value === undefined) return '';
		if (typeof value === 'boolean') return value ? 'Yes' : 'No';
		if (value instanceof Date) return value.toLocaleDateString('he-IL');
		return String(value);
	}

	private setColumnWidths(worksheet: XLSX.WorkSheet, columns: ExportColumn[]): void {
		const colWidths = columns.map((col) => ({
			wch: Math.max(col.header.length, 15),
		}));
		worksheet['!cols'] = colWidths;
	}

	private generateColumnsFromData<T>(sampleData: T): ExportColumn[] {
		if (!sampleData) return [];

		return Object.keys(sampleData as object).map((key) => ({
			key,
			header: key,
		}));
	}

	private generateFileName(customName?: string, includeTimestamp?: boolean): string {
		const baseName = customName || 'export';
		const timestamp = includeTimestamp
			? `_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}`
			: '';
		return `${baseName}${timestamp}.xlsx`;
	}

	/**
	 * Common transformation helpers
	 */
	static transformers = {
		// For enum values
		enumToText: (enumData: any[]) => (value: any) => {
			const item = enumData.find((e) => e.enumValue === value);
			return item?.label || value;
		},

		// For dates
		dateFormat:
			(format: 'short' | 'long' = 'short') =>
			(value: Date | string) => {
				if (!value) return '';
				const date = new Date(value);
				return format === 'short'
					? date.toLocaleDateString('he-IL')
					: date.toLocaleString('he-IL');
			},

		// For numbers
		numberFormat:
			(decimals: number = 2) =>
			(value: number) => {
				if (typeof value !== 'number') return value;
				return value.toFixed(decimals);
			},

		// For booleans
		booleanToHebrew: (value: boolean) => (value ? 'כן' : 'לא'),

		// For arrays
		arrayToString:
			(separator: string = ', ') =>
			(value: any[]) => {
				if (!Array.isArray(value)) return value;
				return value.join(separator);
			},
	};
}

--- END OF FILE ---
--- START OF FILE src\app\services\jewish-calendar.service.ts ---
import { Injectable } from '@angular/core';
import { GeoLocation, HDate, Locale, Zmanim, gematriya } from '@hebcal/core';
import { HebrewCalendar, Location } from '@hebcal/core';


@Injectable({ providedIn: 'root' })
export class JewishCalendarService {
  private readonly location = new GeoLocation('Tel Aviv', 32.0853, 34.7818, 34, 'Asia/Jerusalem');
  private calendarEvents: IEventInfo[] = [];

  constructor() {
      // אתחול האירועים פעם אחת בקונסטרקטור יכול לחסוך חישובים חוזרים
      this.generateEvents();
  }

  setLocation() {
    this.location; // Already set in initialization
  }

  getHebrewDate(year: number, month: number, day: number): string {
    const hebrewDate = new HDate(new Date(year, month - 1, day)); // month is 0-based in JS Date
    return hebrewDate.renderGematriya();
  }

  getHebMonth(year: number, month: number, day: number): string {
    const hebrewDate = new HDate(new Date(year, month - 1, day));
    return hebrewDate.render('he', false);
  }

  getMonthName(month: number): string {
    return hebrewMonthsNamesLeap.find(m => m.index === month)?.he ?? '';
  }

  getHebYear(fullDate: Date): string {
    return gematriya(new HDate(fullDate).getFullYear());
  }

  translate(str: string, locale: string = 'he'): string {
    return Locale.lookupTranslation(str, locale) || str;
  }

  gematriya(n: number): string {
    return gematriya(n);
  }

  generateEvents(year: number = new Date().getFullYear(), latitude?: number, longitude?: number): IHebcalEventInfo[] {


const location = new Location( 31.7683, 35.2137, true, 'Asia/Jerusalem');

const calenderSettings = {
  year: 2025,
  isHebrewYear: false,
  candlelighting: true,
  il: true,
  sedrot: true,
  omer: true,
  locale: 'he',
  shabbatMevarchim: true,
  yomKippurKatan: true,
  noModern: true,
  molad: true,
  location: location
};

this.calendarEvents = [];
const events = HebrewCalendar.calendar(calenderSettings);



    this.calendarEvents = events.map(ev => ({
      dateStr: new HDate(ev.getDate()).greg().toLocaleDateString('he-IL'),
      hebDate: new HDate(ev.getDate()).renderGematriya(),
      hebName: ev.render('he'),
      hebNoNikud: ev.render('he-x-NoNikud'),
      event: ev,
      emoji: !ev.render('he').includes('פֶּסַח') ? ev.getEmoji() : null,
      mask: ev.getFlags(),
      flags: ev.getFlags(),
      categories: ev.getCategories(),
      desc: ev.getDesc(),
    }));

    // console.log(this.calendarEvents);

    return this.calendarEvents;
  }

createDayObject(fullDate: Date): IDayObject {
    const hDate = new HDate(fullDate);
    
    // שלב 1: קבל את כל הזמנים ההלכתיים הבסיסיים
    const zmanim: IZmanim = this.getZmanim(fullDate);
    
    // שלב 2: סנן את כל אירועי השנה ומצא רק את אלו של היום
    const dayEvents = this.calendarEvents.filter(ev => ev.dateStr === fullDate.toLocaleDateString('he-IL'));
    
    // שלב 3: חפש אירועים מיוחדים והוסף אותם לאובייקט הזמנים
    const candleLightingEvent = dayEvents.find(ev => ev.categories.includes('candles'));
    const havdalahEvent = dayEvents.find(ev => ev.categories.includes('havdalah'));

    const candleLightingTime = this.formatEventTime(candleLightingEvent?.event.eventTime);
    const havdalahTime = this.formatEventTime(havdalahEvent?.event.eventTime);

    if (candleLightingTime) {
      zmanim.candleLighting = { name: 'Candle Lighting', hebName: 'הדלקת נרות', time: candleLightingTime };
    }
    if (havdalahTime) {
      zmanim.havdalah = { name: 'Havdalah', hebName: 'הבדלה', time: havdalahTime };
    }

    const dayObj: IDayObject = {
      ge: { fullDate, day: fullDate.getDay(), date: fullDate.getDate(), month: fullDate.getMonth(), year: fullDate.getFullYear() },
      he: { fullDate: hDate.renderGematriya(false), day: hDate.getDay(), date: hDate.getDate(), month: hDate.getMonth(), year: hDate.getFullYear() },
      zmanim: zmanim,
      hallel: HebrewCalendar.hallel(hDate, true) === 1 ? 'חצי הלל' : HebrewCalendar.hallel(hDate, true) === 2 ? 'הלל שלם' : undefined,
      events: dayEvents.length > 0 ? dayEvents : undefined,
      dailyLearn: {},
    };

    if (!dayObj.hallel) delete dayObj.hallel;

    return dayObj;
  }

    private formatEventTime(eventTime: Date | undefined): string | null {
    if (!eventTime) return null;
    return new Intl.DateTimeFormat('he-IL', {
        hour: '2-digit', minute: '2-digit', hour12: false,
    }).format(eventTime);
  }
getZmanim(date: Date): IZmanim {
    const zmanimInstance = new Zmanim(this.location, date, true);
    const dateTimeFormat = new Intl.DateTimeFormat('he-IL', {
      hour: '2-digit', minute: '2-digit', hour12: false,
    });

    
    return {
      date: date.toLocaleDateString('he-IL'),
      hebDate: new HDate(date).renderGematriya(),
      sunrise: { name: 'Sunrise', hebName: 'זריחה', time: Zmanim.formatTime(zmanimInstance.sunrise(), dateTimeFormat) ?? '' },
      sunset: { name: 'Sunset', hebName: 'שקיעה', time: Zmanim.formatTime(zmanimInstance.sunset(), dateTimeFormat) ?? '' },
      dawn: { name: 'Dawn', hebName: 'אפלולית', time: Zmanim.formatTime(zmanimInstance.dawn(), dateTimeFormat) ?? '' },
      dusk: { name: 'Dusk', hebName: 'השקפת החמה', time: Zmanim.formatTime(zmanimInstance.dusk(), dateTimeFormat) ?? '' },
      eveningTime: { name: 'Evening Time', hebName: 'זמן הערב', time: Zmanim.formatTime(zmanimInstance.gregEve(), dateTimeFormat) ?? '' },
      chatzot: { name: 'Chatzot', hebName: 'חצות היום', time: Zmanim.formatTime(zmanimInstance.chatzot(), dateTimeFormat) ?? '' },
      chatzotNightTime: { name: 'Chatzot Night Time', hebName: 'חצות הלילה', time: Zmanim.formatTime(zmanimInstance.chatzotNight(), dateTimeFormat) ?? '' },
      alotHaShachar: { name: 'Alot HaShachar', hebName: 'עלות השחר', time: Zmanim.formatTime(zmanimInstance.alotHaShachar(), dateTimeFormat) ?? '' },
      misheyakir: { name: 'Misheyakir', hebName: 'מִשֶּׁיַּכִּיר', time: Zmanim.formatTime(zmanimInstance.misheyakir(), dateTimeFormat) ?? '' },
      misheyakirMachmir: { name: 'Misheyakir Machmir', hebName: 'מִשֶּׁיַּכִּיר מחמיר', time: Zmanim.formatTime(zmanimInstance.misheyakirMachmir(), dateTimeFormat) ?? '' },
      sofZmanShma: { name: 'Sof Zman Shma', hebName: 'סוף זמן קריאת שמע', time: Zmanim.formatTime(zmanimInstance.sofZmanShma(), dateTimeFormat) ?? '' },
      sofZmanTfilla: { name: 'Sof Zman Tfilla', hebName: 'סוף זמן תפילה', time: Zmanim.formatTime(zmanimInstance.sofZmanTfilla(), dateTimeFormat) ?? '' },
      minchaGedola: { name: 'Mincha Gedola', hebName: 'מנחה גדולה', time: Zmanim.formatTime(zmanimInstance.minchaGedola(), dateTimeFormat) ?? '' },
      minchaKetana: { name: 'Mincha Ketana', hebName: 'מנחה קטנה', time: Zmanim.formatTime(zmanimInstance.minchaKetana(), dateTimeFormat) ?? '' },
      plagHaMincha: { name: 'Plag HaMincha', hebName: 'פלג המנחה', time: Zmanim.formatTime(zmanimInstance.plagHaMincha(), dateTimeFormat) ?? '' },
      tzeitHaKochavim: { name: 'Tzeit HaKochavim', hebName: 'צאת הכוכבים', time: Zmanim.formatTime(zmanimInstance.tzeit(), dateTimeFormat) ?? '' },
      neitzHaChama: { name: 'Neitz HaChama', hebName: 'נץ החמה', time: Zmanim.formatTime(zmanimInstance.neitzHaChama(), dateTimeFormat) ?? '' },
      shkiah: { name: 'Shkiah', hebName: 'שקיעה', time: Zmanim.formatTime(zmanimInstance.shkiah(), dateTimeFormat) ?? '' },
        // candleLighting: { name: 'Candle Lighting', hebName: 'הדלקת נרות', time: Zmanim.formatTime(zmanimInstance.candleLighting(), dateTimeFormat) ?? '' },
        // havdalah: { name: 'Havdalah', hebName: 'הבדלה', time: Zmanim.formatTime(zmanimInstance.havdalah(), dateTimeFormat) ?? '' },
    };
  }
}

export interface IEventInfo {
  dateStr: string;
  hebDate: string;
  hebName: string;
  hebNoNikud: string;
  event: any;
  emoji: string | null;
  mask: number;
  flags: number;
  categories: string[];
  desc: string;
}

export interface IHebcalEventInfo { 
  dateStr: string;
  hebDate: string;
  hebName: string;
  hebNoNikud: string;
  event: Event; // שימוש בטייפ המדויק
  emoji: string | null;
  mask: number;
  flags: number;
  categories: string[];
  desc: string;
}

export interface IZman {
  name: string;
  hebName: string;
  time: string;
}

export interface IZmanim {
  date: string;
  hebDate: string;
  sunrise: IZman;
  sunset: IZman;
  dawn: IZman;
  dusk: IZman;
  eveningTime: IZman;
  chatzot: IZman;
  chatzotNightTime: IZman;
  alotHaShachar: IZman;
  misheyakir: IZman;
  misheyakirMachmir: IZman;
  sofZmanShma: IZman;
  sofZmanTfilla: IZman;
  minchaGedola: IZman;
  minchaKetana: IZman;
  plagHaMincha: IZman;
  tzeitHaKochavim: IZman;
  neitzHaChama: IZman;
  shkiah: IZman;
  candleLighting?: IZman;
  havdalah?: IZman;
}

export interface IDayObject {
  ge: {
    fullDate: Date;
    day: number;
    date: number;
    month: number;
    year: number;
  };
  he: {
    fullDate: string;
    day: number;
    date: number;
    month: number;
    year: number;
  };
  zmanim: IZmanim;
  hallel?: string;
  events?: IEventInfo[];
  dailyLearn: { [key: string]: any };
}

export enum HebrewMonths {
  Nisan = 1,
  Iyyar = 2,
  Sivan = 3,
  Tamuz = 4,
  Av = 5,
  Elul = 6,
  Tishrei = 7,
  Cheshvan = 8,
  Kislev = 9,
  Tevet = 10,
  Shvat = 11,
  AdarI = 12,
  AdarII = 13,
}

export interface NameInfo {
  index: number;
  name: string;
  he: string;
  letter?: string;
  short?: string;
}

export const daysNames: NameInfo[] = [
  { index: 0, name: 'Sunday', he: 'ראשון', letter: 'א׳' },
  { index: 1, name: 'Monday', he: 'שני', letter: 'ב׳' },
  { index: 2, name: 'Tuesday', he: 'שלישי', letter: 'ג׳' },
  { index: 3, name: 'Wednesday', he: 'רביעי', letter: 'ד׳' },
  { index: 4, name: 'Thursday', he: 'חמישי', letter: 'ה׳' },
  { index: 5, name: 'Friday', he: 'שישי', letter: 'ו׳' },
  { index: 6, name: 'Saturday', he: 'שבת', letter: 'ש׳' },
];

export const monthsNames: NameInfo[] = [
  { index: 0, name: 'January', short: 'Jan', he: 'ינואר' },
  { index: 1, name: 'February', short: 'Feb', he: 'פברואר' },
  { index: 2, name: 'March', short: 'Mar', he: 'מרץ' },
  { index: 3, name: 'April', short: 'Apr', he: 'אפריל' },
  { index: 4, name: 'May', short: 'May', he: 'מאי' },
  { index: 5, name: 'June', short: 'Jun', he: 'יוני' },
  { index: 6, name: 'July', short: 'Jul', he: 'יולי' },
  { index: 7, name: 'August', short: 'Aug', he: 'אוגוסט' },
  { index: 8, name: 'September', short: 'Sep', he: 'ספטמבר' },
  { index: 9, name: 'October', short: 'Oct', he: 'אוקטובר' },
  { index: 10, name: 'November', short: 'Nov', he: 'נובמבר' },
  { index: 11, name: 'December', short: 'Dec', he: 'דצמבר' },
];

export const hebrewMonthsNamesLeap: NameInfo[] = [
  { index: HebrewMonths.Nisan, name: 'Nisan', he: 'נִיסָן' },
  { index: HebrewMonths.Iyyar, name: 'Iyyar', he: 'אִיָיר' },
  { index: HebrewMonths.Sivan, name: 'Sivan', he: 'סִיוָן' },
  { index: HebrewMonths.Tamuz, name: 'Tamuz', he: 'תַּמּוּז' },
  { index: HebrewMonths.Av, name: 'Av', he: 'אָב' },
  { index: HebrewMonths.Elul, name: 'Elul', he: 'אֱלוּל' },
  { index: HebrewMonths.Tishrei, name: 'Tishrei', he: 'תִּשְׁרֵי' },
  { index: HebrewMonths.Cheshvan, name: 'Cheshvan', he: 'חֶשְׁוָן' },
  { index: HebrewMonths.Kislev, name: 'Kislev', he: 'כִּסְלֵו' },
  { index: HebrewMonths.Tevet, name: 'Tevet', he: 'טֵבֵת' },
  { index: HebrewMonths.Shvat, name: 'Shvat', he: 'שְׁבָט' },
  { index: HebrewMonths.AdarI, name: 'Adar I', he: 'אַדָר א׳' },
  { index: HebrewMonths.AdarII, name: 'Adar II', he: 'אַדָר ב׳' },
];

export const hebrewMonthsNamesNoLeap: NameInfo[] = [
  { index: HebrewMonths.Nisan, name: 'Nisan', he: 'נִיסָן' },
  { index: HebrewMonths.Iyyar, name: 'Iyyar', he: 'אִיָיר' },
  { index: HebrewMonths.Sivan, name: 'Sivan', he: 'סִיוָן' },
  { index: HebrewMonths.Tamuz, name: 'Tamuz', he: 'תַּמּוּז' },
  { index: HebrewMonths.Av, name: 'Av', he: 'אָב' },
  { index: HebrewMonths.Elul, name: 'Elul', he: 'אֱלוּל' },
  { index: HebrewMonths.Tishrei, name: 'Tishrei', he: 'תִּשְׁרֵי' },
  { index: HebrewMonths.Cheshvan, name: 'Cheshvan', he: 'חֶשְׁוָן' },
  { index: HebrewMonths.Kislev, name: 'Kislev', he: 'כִּסְלֵו' },
  { index: HebrewMonths.Tevet, name: 'Tevet', he: 'טֵבֵת' },
  { index: HebrewMonths.Shvat, name: 'Shvat', he: 'שְׁבָט' },
  { index: HebrewMonths.AdarI, name: 'Adar', he: 'אַדָר' },
];
--- END OF FILE ---
--- START OF FILE src\app\services\menu.service.ts ---
import { Injectable, signal } from '@angular/core';

@Injectable({
	providedIn: 'root',
})
export class MenuService {
	public isMobileMenuOpen = signal<boolean>(false);
	public isMenuExpanded = signal<boolean>(true);
	public isUserPopoverOpen = signal(false);
	expandedSubmenuItems = signal<{ [key: string]: boolean }>({});

	constructor() {
		const storedExpanded = localStorage.getItem('isMenuExpanded');
		if (storedExpanded) {
			this.isMenuExpanded.set(JSON.parse(storedExpanded));
		}
	}

	toggleMobileMenu() {
		this.isMobileMenuOpen.set(!this.isMobileMenuOpen());
		console.log(this.isMobileMenuOpen());
	}

	closeMobileMenu() {
		this.isMobileMenuOpen.set(false);
	}

	toggleMenuExpand() {
		this.isMenuExpanded.set(!this.isMenuExpanded());
		localStorage.setItem('isMenuExpanded', JSON.stringify(this.isMenuExpanded()));
	}

		public toggleUserPopover() {		
		this.isUserPopoverOpen.update(value => !value);
	}

	public closeUserPopover() {		
		this.isUserPopoverOpen.set(false);
	}
	
	saveSubmenuState(key: string, expanded: boolean) {
		this.expandedSubmenuItems.set({
			...this.expandedSubmenuItems(),
			[key]: expanded,
		});
	}

	getSubmenuState(key: string): boolean {
		return this.expandedSubmenuItems()[key] ?? false;
	}
}

--- END OF FILE ---
--- START OF FILE src\app\services\notification.service.ts ---
import { Injectable, inject } from '@angular/core';
import { signal } from '@angular/core';
import { MessageService } from 'primeng/api';
import { Observable, map, throwError } from 'rxjs';
import { ConfirmationData, ConfirmationDialogComponent } from '../components/dialogs/confirmation-dialog/confirmation-dialog.component';
import { DialogService } from 'primeng/dynamicdialog';
import { DialogConfig } from '../common/const/dialog-config';
import { HttpErrorResponse } from '@angular/common/http';

@Injectable({
	providedIn: 'root',
})
export class NotificationService {
	private messageService = inject(MessageService);
	private notifyTimeout?: ReturnType<typeof setTimeout>;
	private dialogService = inject(DialogService);
	private _notify = signal<notificationMessage | undefined>(undefined);

	private iconsMap: Record<string, string> = {
		success: 'pi pi-check',
		error: 'pi pi-times-circle',
		warn: 'pi pi-exclamation-triangle',
		info: 'pi pi-info-circle',
	};

	constructor() { }

	public handleError(error: HttpErrorResponse): Observable<never> {
        let displayMessage = 'אירעה שגיאה. אנא נסה שוב מאוחר יותר.';

        if (error.status === 0) {
            // This is a client-side or network error.
            displayMessage = 'לא ניתן להתחבר לשרת. אנא בדוק את חיבור האינטרנט שלך.';
        } else if (error.status >= 400 && error.status < 500) {
            // Client-side errors (e.g., 401, 404) - often have a specific message.
            displayMessage = error.error?.message || `שגיאת לקוח (${error.status})`;
        } else if (error.status >= 500) {
            // Server-side errors
            displayMessage = `שגיאת שרת (${error.status}). נסה שוב מאוחר יותר.`;
        }

        this.toast({
            severity: 'error',
            // summary: 'שגיאת תקשורת',
            detail: displayMessage,
            life: 5000
        });

        console.error('HTTP error intercepted:', error);
        return throwError(() => new Error(displayMessage));
    }

	
	toast(message: Message | Message[]) {
		if (Array.isArray(message)) {
			message = message.map((msg) => this.setDefaultIcon(msg));
			this.messageService.addAll(message);
		} else {
			message = this.setDefaultIcon(message);
			this.messageService.add(message);
		}
	}

	private setDefaultIcon(message: Message): Message {
		if (!message.icon && message.severity) {
			message.icon = this.iconsMap[message.severity] || 'pi pi-info-circle';
		}
		return message;
	}

	get notification() {
		return this._notify;
	}

	notify(notification: notificationMessage, timeout: number = 4000) {
		clearTimeout(this.notifyTimeout);

		if (Array.isArray(notification.message)) {
			notification.message = notification.message.join('<br>');
		}
		this._notify.set(notification);
		this.notifyTimeout = setTimeout(() => {
			this.dismiss();
		}, timeout);
	}

	dismiss() {
		this._notify.set(undefined);
	}


	public confirm(data: ConfirmationData): Observable<boolean> {
		const ref = this.dialogService.open(ConfirmationDialogComponent, {
			header: data.header || 'אישור פעולה',
			...DialogConfig,
			width: 'clamp(320px, 40%, 450px)',
			data: data,
		});

		return ref.onClose.pipe(
			// ודא שאנחנו תמיד מחזירים בוליאני
			map(result => !!result)
		);
	}
}

export type notificationMessage = {
	message?: string | string[];
	type: 'error' | 'success' | 'warning' | 'info';
};

export type Message = {
	severity?: string;
	summary?: string;
	detail?: string;
	id?: any;
	key?: string;
	life?: number;
	sticky?: boolean;
	closable?: boolean;
	data?: any;
	icon?: string;
	contentStyleClass?: string;
	styleClass?: string;
	closeIcon?: string;
	header?: string;
};

// import { inject, Injectable, input, signal } from '@angular/core';
// import { MessageService } from 'primeng/api';

// @Injectable({
//   providedIn: 'root'
// })
// export class NotificationService {
//    static messageService = inject(MessageService);
//   constructor() { }

//   private static notifyTimeout?: ReturnType<typeof setTimeout>;

//   private static _notify = signal<notificationMessage | undefined>(undefined);
//   public static message = signal<Message | Message[] | undefined>(undefined);

//   private static iconsMap: Record<string, string> = {
//     success: 'check_circle',
//     error: 'error',
//     warn: 'warning',
//     info: 'info'
//   };

//   public static get notification() {
//     return NotificationService._notify;
//   }

//   public static toast(message: Message | Message[]) {
//     if (Array.isArray(message)) {
//       message = message.map(msg => this.setDefaultIcon(msg));
//     } else {
//       message = this.setDefaultIcon(message);
//     }
//     this.message.set(message);
//   }

//   private static setDefaultIcon(message: Message): Message {
//     if (!message.icon && message.severity) {
//       message.icon = this.iconsMap[message.severity] || 'info';
//     }
//     return message;
//   }

//   public static notify(notification: notificationMessage, timeout: number = 4000) {
//     clearTimeout(this.notifyTimeout)

//     // if array, join with <br> to display in multiple lines
//     if (Array.isArray(notification.message)) {
//       notification.message = notification.message.join('<br>');
//     }
//     NotificationService._notify.set(notification);
//     this.notifyTimeout = setTimeout(() => {
//       NotificationService.dismiss();
//     }, timeout);
//   }

//   public static dismiss() {
//     NotificationService._notify.set(undefined);
//   }

// }

// export type notificationMessage = {
//   message?: string | string[];
//   type: 'error' | 'success' | 'warning' | 'info';
// }

// export type Message = {
//   severity?: string;
//   summary?: string;
//   detail?: string;
//   id?: any;
//   key?: string;
//   life?: number;
//   sticky?: boolean;
//   closable?: boolean;
//   data?: any;
//   icon?: string;
//   contentStyleClass?: string;
//   styleClass?: string;
//   closeIcon?: string;
//   header?: string;
// }

--- END OF FILE ---
--- START OF FILE src\app\services\order-flow.service.ts ---
import { inject, Injectable } from '@angular/core';
import { DialogService } from 'primeng/dynamicdialog';
import { OrderDialogComponent } from '../components/dialogs/order-dialog/order-dialog.component';
import { WhatsAppInstructionDialogComponent, InstructionConfig } from '../components/dialogs/whatsapp-instruction-dialog/whatsapp-instruction-dialog.component'; // עדכון הנתיב
import { OrderStore } from '../store/order.store';

import { CreateOrderDto } from '../common/dto/order-create.dto';
import { OrderStatus } from '../common/enums/order-status.enum';
import { DialogConfigWide, DialogConfig } from '../common/const/dialog-config';
import { Order } from '../common/models/order';
import { Supplier } from '../common/models/supplier';

export interface OpenOrderDialogData {
	supplier: Supplier;
	date: Date;
	existingOrder?: Order | null;
}

@Injectable({
	providedIn: 'root'
})
export class OrderFlowService {
	private readonly dialogService = inject(DialogService);
	private readonly orderStore = inject(OrderStore);

	public openOrderDialog(data: OpenOrderDialogData): void {
		const { supplier, date, existingOrder } = data;
		console.log(date);
		
		const ref = this.dialogService.open(OrderDialogComponent, {
			...DialogConfigWide,
			styleClass: 'no-header bottom-overlay',
			data: { supplier, date, existingOrder },
			
		});

		ref.onClose.subscribe((result: any | null) => {
			if (!result) return;

			if (result.action === 'SEND_WHATSAPP') {
				this.handleWhatsAppAction(result.payload, supplier.name, result.whatsAppResult);
			} else {
				this.handleStandardAction(result, supplier, date);
			}
		});
	}

	private handleWhatsAppAction(payload: CreateOrderDto, supplierName: string, whatsAppResult: any) {
		this.orderStore.saveOrder(payload);

		const instructionConfig: InstructionConfig = {
			supplierName: supplierName,
			method: whatsAppResult.method,
			autoHide: whatsAppResult.method === 'whatsapp',
			autoHideDelay: 5000
		};

		this.showInstructionDialog(instructionConfig, payload);
	}

	private showInstructionDialog(config: InstructionConfig, originalPayload: CreateOrderDto) {
		const dialogRef = this.dialogService.open(WhatsAppInstructionDialogComponent, {
			...DialogConfig,
			styleClass: 'no-header no-padding', // קלאסים לעיצוב הדיאלוג ללא header
			data: config
		});

		dialogRef.onClose.subscribe((action: 'retry' | 'close' | undefined) => {
			if (action === 'retry') {
				// אם המשתמש רוצה לנסות שוב, נפעיל את הלוגיקה מחדש
				this.handleWhatsAppAction(originalPayload, config.supplierName || '', { method: 'whatsapp' }); // נניח ניסיון חוזר לוואטסאפ
			}
		});
	}

	private handleStandardAction(result: any, supplier: Supplier, date: Date) {
		let orderPayload: CreateOrderDto | null = null;
		const formattedDate = this.formatDate(date);

		if ('delete' in result && result.delete) {
			orderPayload = { id: result.orderId, supplierId: supplier.id, date: formattedDate, status: OrderStatus.Empty, products: [] };
		} else if ('payload' in result) {
			orderPayload = result.payload;
		} else if ('supplierId' in result) {
			orderPayload = result;
		}

		if (orderPayload) {
			this.orderStore.saveOrder(orderPayload);
		}
	}

	private formatDate(date: Date): string {
		return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
	}
}
--- END OF FILE ---
--- START OF FILE src\app\services\print.service.ts ---
import { Injectable } from '@angular/core';

export interface PrintConfig {
	title?: string;
	direction?: 'rtl' | 'ltr';
	styles?: string;
	pageMargin?: string;
}

export interface PrintTemplate {
	generateHtml(data: any): string;
}

@Injectable({
	providedIn: 'root'
})
export class PrintService {

	/**
	 * Print any content with custom HTML template
	 */
	printContent(htmlContent: string, config?: PrintConfig): void {
		const fullHtml = this.wrapInHtml(htmlContent, config);
		this.executePrint(fullHtml);
	}

	/**
	 * Print using a template pattern
	 */
	printWithTemplate<T>(data: T, template: PrintTemplate, config?: PrintConfig): void {
		const htmlContent = template.generateHtml(data);
		this.printContent(htmlContent, config);
	}

	/**
	 * Print simple text content
	 */
	printText(content: string, config?: PrintConfig): void {
		const htmlContent = `<div class="text-content">${content.replace(/\n/g, '<br>')}</div>`;
		this.printContent(htmlContent, config);
	}

	/**
	 * Print table data
	 */
	printTable<T extends Record<string, any>>(
		data: T[],
		columns: Array<{ key: keyof T; header: string; formatter?: (value: any) => string }>,
		config?: PrintConfig
	): void {
		const tableHtml = this.generateTable(data, columns);
		this.printContent(tableHtml, config);
	}

	private wrapInHtml(content: string, config?: PrintConfig): string {
		const direction = config?.direction || 'ltr';
		const title = config?.title || 'Print Document';
		const margin = config?.pageMargin || '20px';

		return `
      <!DOCTYPE html>
      <html lang="${direction === 'rtl' ? 'he' : 'en'}" dir="${direction}">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>${title}</title>
          <style>
            ${this.getBaseStyles(direction, margin)}
            ${config?.styles || ''}
          </style>
        </head>
        <body>
          ${content}
        </body>
      </html>
    `;
	}

	private getBaseStyles(direction: 'rtl' | 'ltr', margin: string): string {
		const textAlign = direction === 'rtl' ? 'right' : 'left';

		return `
      * {
        box-sizing: border-box;
      }
      body { 
        font-family: 'Segoe UI', Tahoma, Arial, sans-serif; 
        direction: ${direction}; 
        text-align: ${textAlign};
        margin: ${margin};
        line-height: 1.6;
        color: #333;
        font-size: 14px;
      }
      h1, h2, h3, h4, h5, h6 { 
        color: #2c3e50;
        margin: 1em 0 0.5em 0;
      }
      h1 { font-size: 24px; }
      h2 { font-size: 20px; }
      h3 { font-size: 18px; }
      h4 { font-size: 16px; }
      h5 { font-size: 14px; }
      h6 { font-size: 12px; }
      p { margin: 0.5em 0; }
      ul, ol { 
        padding-${direction === 'rtl' ? 'right' : 'left'}: 20px;
        margin: 1em 0;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1em 0;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: ${textAlign};
      }
      th {
        background-color: #f8f9fa;
        font-weight: bold;
      }
      tr:nth-child(even) {
        background-color: #f8f9fa;
      }
      .text-content {
        white-space: pre-wrap;
      }
      .page-break {
        page-break-before: always;
      }
      @media print {
        body { 
          margin: 0;
          color: #000;
        }
        .no-print {
          display: none !important;
        }
        .page-break {
          page-break-before: always;
        }
      }
    `;
	}

	private generateTable<T extends Record<string, any>>(
		data: T[],
		columns: Array<{ key: keyof T; header: string; formatter?: (value: any) => string }>
	): string {
		if (!data.length) return '<p>No data to display</p>';

		const headerRow = columns
			.map(col => `<th>${col.header}</th>`)
			.join('');

		const bodyRows = data
			.map(row => {
				const cells = columns
					.map(col => {
						const value = row[col.key];
						const formattedValue = col.formatter ? col.formatter(value) : String(value || '');
						return `<td>${formattedValue}</td>`;
					})
					.join('');
				return `<tr>${cells}</tr>`;
			})
			.join('');

		return `
      <table>
        <thead>
          <tr>${headerRow}</tr>
        </thead>
        <tbody>
          ${bodyRows}
        </tbody>
      </table>
    `;
	}

	private executePrint(printContent: string): void {
		const printFrame = document.createElement('iframe');
		printFrame.style.position = 'absolute';
		printFrame.style.top = '-9999px';
		printFrame.style.left = '-9999px';
		printFrame.style.width = '0';
		printFrame.style.height = '0';
		printFrame.style.border = 'none';

		document.body.appendChild(printFrame);

		const frameDoc = printFrame.contentDocument || printFrame.contentWindow?.document;
		if (frameDoc) {
			frameDoc.open();
			frameDoc.write(printContent);
			frameDoc.close();

			printFrame.onload = () => {
				setTimeout(() => {
					printFrame.contentWindow?.focus();
					printFrame.contentWindow?.print();

					setTimeout(() => {
						if (document.body.contains(printFrame)) {
							document.body.removeChild(printFrame);
						}
					}, 1000);
				}, 100);
			};
		}
	}
}

// Order-specific template implementation
export class OrderPrintTemplate implements PrintTemplate {
	generateHtml(data: any): string {
		const { supplier, date, products, notes } = data;

		const productsList = products
			?.filter((p: any) => p.quantity > 0)
			?.map((p: any) => `
        <tr>
          <td class="product-name">${p.name}</td>
          <td class="quantity">${p.quantity}</td>
        </tr>
      `)
			.join('') || '';

		const notesContent = notes?.trim() ? `
      <div class="notes-section">
        <h3>הערות:</h3>
        <div class="notes-content">${notes.replace(/\n/g, '<br>')}</div>
      </div>
    ` : '';

		return `
      <div class="order-header">
        <h1>${supplier?.name || 'ספק לא צוין'}</h1>
        <h2>תאריך הזמנה: ${date?.toLocaleDateString('he-IL') || new Date().toLocaleDateString('he-IL')}</h2>
      </div>
      
      ${productsList ? `
        <div class="products-section">
          <h3>רשימת מוצרים:</h3>
          <table class="products-table">
            <thead>
              <tr>
                <th>מוצר</th>
                <th>כמות</th>
              </tr>
            </thead>
            <tbody>
              ${productsList}
            </tbody>
          </table>
        </div>
      ` : `
        <div class="empty-order">לא נבחרו מוצרים להזמנה</div>
      `}
      
      ${notesContent}
      
    <style>
          body { 
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif; 
            direction: rtl; 
            text-align: right;
            margin: 20px;
            line-height: 1.6;
            color: #333;
          }
          h1 { 
            color: #2c3e50; 
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 28px;
          }
          h2 { 
            color: #34495e; 
            font-size: 18px;
            margin: 15px 0;
          }
          h3 { 
            color: #2c3e50; 
            font-size: 16px;
            margin: 20px 0 10px 0;
          }
          ul { 
            list-style-type: none; 
            padding: 0; 
            margin: 20px 0;
            overflow: hidden;
          }
          li { 
            padding: 12px 15px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
          }
          li:nth-child(even) {
            background-color: #f8f9fa;
          }
          li:last-child {
          }
          .product-name {
            font-weight: 600;
            color: #2c3e50;
          }
          .quantity {
            font-weight: bold;
            background-color: #ffeaa7;
            padding: 4px 8px;
            font-size: 14px;
          }
          .notes { 
            margin-top: 30px; 
            padding: 20px;
            background-color: #f8f9fa;
          }
          .notes h3 {
            margin-top: 0;
            color: #856404;
          }
          .notes p {
            margin-bottom: 0;
            color: #6c757d;
          }
          .empty-order {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
          }
          @media print {
            body { 
              margin: 0;
              color: #000;
            }
            h1 { 
              color: #000;
            }
            .quantity {
              background-color: transparent !important;
            }
            .notes { 
              background-color: transparent;
            }
          }
        </style>
    `;
	}
}




--- END OF FILE ---
--- START OF FILE src\app\services\printer-use.helper.ts ---
// import { PrintService, OrderPrintTemplate, PrintConfig } from './print.service';

// export class ExampleComponent {
  
//   constructor(private printService: PrintService) {}

//   // 1. הדפסת הזמנה עם template מותאם אישית
//   printOrder(): void {
//     const orderData = {
//       supplier: this.supplier,
//       date: this.date,
//       products: this.availableProducts()
//         .filter(p => this.getProductQuantity(p.id) > 0)
//         .map(p => ({
//           id: p.id,
//           name: p.name,
//           quantity: this.getProductQuantity(p.id)
//         })),
//       notes: this.notes()
//     };

//     const config: PrintConfig = {
//       title: `הזמנה - ${this.supplier?.name}`,
//       direction: 'rtl'
//     };

//     this.printService.printWithTemplate(orderData, new OrderPrintTemplate(), config);
//   }

//   // 2. הדפסת טבלה גנרית
//   printProductsTable(): void {
//     const products = this.availableProducts();
//     const columns = [
//       { key: 'name' as keyof typeof products[0], header: 'שם מוצר' },
//       { key: 'cost' as keyof typeof products[0], header: 'מחיר', formatter: (cost: number) => `₪${cost}` },
//       { key: 'category' as keyof typeof products[0], header: 'קטגוריה' }
//     ];

//     this.printService.printTable(products, columns, {
//       title: 'רשימת מוצרים',
//       direction: 'rtl'
//     });
//   }

//   // 3. הדפסת טקסט פשוט
//   printNotes(): void {
//     this.printService.printText(this.notes(), {
//       title: 'הערות',
//       direction: 'rtl',
//       styles: `
//         .text-content {
//           background-color: #f8f9fa;
//           padding: 20px;
//           border-radius: 8px;
//           border-right: 4px solid #007bff;
//         }
//       `
//     });
//   }

//   // 4. הדפסת HTML מותאם אישית
//   printCustomContent(): void {
//     const customHtml = `
//       <div class="custom-report">
//         <h1>דו"ח יומי</h1>
//         <div class="stats">
//           <div class="stat-item">
//             <h3>סה"כ הזמנות</h3>
//             <span class="number">${this.getTotalOrders()}</span>
//           </div>
//           <div class="stat-item">
//             <h3>סה"כ מוצרים</h3>
//             <span class="number">${this.getTotalProducts()}</span>
//           </div>
//         </div>
//       </div>
//     `;

//     const customStyles = `
//       .custom-report {
//         text-align: center;
//       }
//       .stats {
//         display: flex;
//         justify-content: space-around;
//         margin: 20px 0;
//       }
//       .stat-item {
//         background: #f8f9fa;
//         padding: 20px;
//         border-radius: 8px;
//         box-shadow: 0 2px 4px rgba(0,0,0,0.1);
//       }
//       .number {
//         font-size: 2em;
//         font-weight: bold;
//         color: #007bff;
//       }
//     `;

//     this.printService.printContent(customHtml, {
//       title: 'דו"ח יומי',
//       direction: 'rtl',
//       styles: customStyles
//     });
//   }

//   // Helper methods (example)
//   private getTotalOrders(): number { return 42; }
//   private getTotalProducts(): number { return 150; }
// }

// // דוגמה ל-template נוסף
// export class InvoicePrintTemplate implements PrintTemplate {
//   generateHtml(data: any): string {
//     const { customer, items, total, invoiceNumber, date } = data;
    
//     return `
//       <div class="invoice">
//         <header class="invoice-header">
//           <h1>חשבונית מס' ${invoiceNumber}</h1>
//           <div class="date">תאריך: ${date}</div>
//         </header>
        
//         <div class="customer-info">
//           <h2>פרטי לקוח:</h2>
//           <p>${customer.name}</p>
//           <p>${customer.address}</p>
//         </div>
        
//         <table class="items-table">
//           <thead>
//             <tr>
//               <th>תיאור</th>
//               <th>כמות</th>
//               <th>מחיר יחידה</th>
//               <th>סה"כ</th>
//             </tr>
//           </thead>
//           <tbody>
//             ${items.map((item: any) => `
//               <tr>
//                 <td>${item.description}</td>
//                 <td>${item.quantity}</td>
//                 <td>₪${item.cost}</td>
//                 <td>₪${item.quantity * item.cost}</td>
//               </tr>
//             `).join('')}
//           </tbody>
//         </table>
        
//         <div class="total-section">
//           <h3>סה"כ לתשלום: ₪${total}</h3>
//         </div>
//       </div>
      
//       <style>
//         .invoice {
//           max-width: 800px;
//           margin: 0 auto;
//         }
//         .invoice-header {
//           text-align: center;
//           border-bottom: 2px solid #333;
//           padding-bottom: 20px;
//           margin-bottom: 30px;
//         }
//         .customer-info {
//           background: #f8f9fa;
//           padding: 15px;
//           border-radius: 5px;
//           margin-bottom: 30px;
//         }
//         .items-table {
//           margin-bottom: 30px;
//         }
//         .total-section {
//           text-align: left;
//           font-size: 1.2em;
//           border-top: 2px solid #333;
//           padding-top: 20px;
//         }
//       </style>
//     `;
//   }
// }
--- END OF FILE ---
--- START OF FILE src\app\services\scroll.service.ts ---
import { CdkDragMove } from '@angular/cdk/drag-drop';
import { ElementRef, Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class ScrollService {

  constructor() { }

  private scrollInterval: any = null;
  private scrollSpeed = 10;
  private scrollThreshold = 50;

  onDragMoved(event: CdkDragMove, content: ElementRef) {
    if (!content) return;

    console.log(content);
    
    const dialogElement = content.nativeElement;
    const rect = dialogElement.getBoundingClientRect();
    const mouseY = event.pointerPosition.y;

    if (mouseY < rect.top + this.scrollThreshold) {
      this.startAutoScroll(-this.scrollSpeed, content);
    } else if (mouseY > rect.bottom - this.scrollThreshold) {
      this.startAutoScroll(this.scrollSpeed, content);
    } else {
      this.stopAutoScroll();
    }
  }

  private startAutoScroll(speed: number, content: ElementRef) {
    this.stopAutoScroll();
    this.scrollInterval = setInterval(() => {
      if (content) {
        content.nativeElement.scrollTop += speed;
      }
    }, 16);
  }

  public stopAutoScroll() {
    if (this.scrollInterval) {
      clearInterval(this.scrollInterval);
      this.scrollInterval = null;
    }
  }


}

--- END OF FILE ---
--- START OF FILE src\app\services\supplier-data.service.ts ---
// // src/app/services/supplier-data.service.ts
// import { Injectable, inject } from '@angular/core';
// import { Observable } from 'rxjs';
// import { MockDataService } from './apiservice';
// import { NotificationService } from './notification.service';
// import { Supplier } from '../models/supplier';
// import { PageStates } from '../models/pageStates';
// import { ServiceResultContainer } from '../models/serviceResultContainer';

// @Injectable({ providedIn: 'root' })
// export class SupplierDataService {
// 	private mockDataService = inject(MockDataService);
// 	private notificationService = inject(NotificationService);

// 	getData(
// 		setSuppliers: (suppliers: Supplier[]) => void,
// 		setPageState: (state: PageStates) => void,
// 	): void {
// 		setPageState(PageStates.Loading);
// 		this.mockDataService.getSuppliers().subscribe({
// 			next: (response: ServiceResultContainer<Supplier[]>) => {
// 				if (response.success && response.result) {
// 					setSuppliers(response.result);
// 					setPageState(PageStates.Ready);
// 				} else {
// 					setSuppliers([]);
// 					setPageState(PageStates.Ready);
// 					this.notificationService.toast({
// 						severity: 'error',
// 						summary: 'שגיאה',
// 						detail: response.message || 'אירעה שגיאה בעת טעינת הספקים.',
// 					});
// 				}
// 			},
// 			error: () => {
// 				setSuppliers([]);
// 				setPageState(PageStates.Error);
// 				this.notificationService.toast({
// 					severity: 'error',
// 					summary: 'שגיאה',
// 					detail: 'אירעה שגיאה בעת טעינת הנתונים.',
// 				});
// 			},
// 		});
// 	}

// 	saveSupplier(
// 		supplier: Supplier,
// 		setSuppliers: (suppliers: Supplier[]) => void,
// 		suppliers: Supplier[],
// 		setPageState: (state: PageStates) => void,
// 	): void {
// 		// בדיקת ייחודיות שם בפרונט
// 		const isNameTaken = suppliers.some((s) => s.name === supplier.name && s.id !== supplier.id);
// 		if (isNameTaken) {
// 			this.notificationService.toast({
// 				severity: 'error',
// 				// summary: 'שגיאה',
// 				detail: 'שם הספק כבר קיים',
// 			});
// 			return;
// 		}

// 		if (supplier.id) {
// 			this.mockDataService.updateSupplier(supplier.id, supplier).subscribe({
// 				next: (response: ServiceResultContainer<Supplier>) => {
// 					if (response.success && response.result) {
// 						this.notificationService.toast({
// 							severity: 'success',
// 							summary: 'עודכן',
// 							detail: response.message || 'הספק עודכן בהצלחה.',
// 						});
// 						setSuppliers(
// 							suppliers.map((s) => (s.id === supplier.id ? response.result : s)),
// 						);
// 					} else {
// 						this.notificationService.toast({
// 							severity: 'error',
// 							// summary: 'שגיאה',
// 							detail: response.message || 'לא ניתן לעדכן ספק.',
// 						});
// 					}
// 				},
// 				error: () => {
// 					// טופל ב-MockDataService
// 				},
// 			});
// 		} else {
// 			this.mockDataService.addSupplier(supplier).subscribe({
// 				next: (response: ServiceResultContainer<Supplier>) => {
// 					if (response.success && response.result) {
// 						this.notificationService.toast({
// 							severity: 'success',
// 							summary: 'נוסף',
// 							detail: response.message || 'הספק נוסף בהצלחה.',
// 						});
// 						setSuppliers([...suppliers, response.result]);
// 						setPageState(PageStates.Ready);
// 					} else {
// 						this.notificationService.toast({
// 							severity: 'error',
// 							// summary: 'שגיאה',
// 							detail: response.message || 'לא ניתן להוסיף ספק.',
// 						});
// 					}
// 				},
// 				error: () => {
// 					// טופל ב-MockDataService
// 				},
// 			});
// 		}
// 	}
// }

// // private getData() {
// //     this.supplierDataService.getData(
// //       (suppliers) => this.suppliers.set(suppliers),
// //       (state) => this.pageState.set(state),
// //     );
// //   }

// //   saveSupplier(supplier: Supplier) {
// //     this.supplierDataService.saveSupplier(
// //       supplier,
// //       (suppliers) => this.suppliers.set(suppliers),
// //       this.suppliers(),
// //       (state) => this.pageState.set(state),
// //     );
// //   }

// //   private getData() {
// //     this.pageState.set(PageStates.Loading);
// //     this.mockDataService.getSuppliers().subscribe({
// //       next: (response: ServiceResultContainer<Supplier[]>) => {
// //         if (response.success && response.result) {
// //           this.suppliers.set(response.result);
// //           this.pageState.set(PageStates.Ready);
// //           console.log('Filtered suppliers:', this.filteredSuppliers());
// //         } else {
// //           this.suppliers.set([]);
// //           this.pageState.set(PageStates.Empty);
// //           this.notificationService.toast({
// //             severity: 'error',
// //             summary: 'שגיאה',
// //             detail: response.message || 'אירעה שגיאה בעת טעינת הנתונים.',
// //           });
// //         }
// //       },
// //       error: () => {
// //         this.pageState.set(PageStates.Error);
// //         this.suppliers.set([]);
// //         this.notificationService.toast({
// //           severity: 'error',
// //           summary: 'שגיאה',
// //           detail: 'אירעה שגיאה בעת טעינת הנתונים.',
// //         });
// //       },
// //     });
// //   }

// //   saveSupplier(supplier: Supplier) {
// //     if (supplier.id) {
// //       this.mockDataService.updateSupplier(supplier.id, supplier).subscribe({
// //         next: (response: ServiceResultContainer<Supplier>) => {
// //           if (response.success && response.result) {
// //             this.notificationService.toast({
// //               severity: 'success',
// //               summary: 'עודכן',
// //               detail: response.message || 'הספק עודכן בהצלחה.',
// //             });
// //             this.suppliers.set(
// //               this.suppliers().map((s) => (s.id === supplier.id ? response.result : s)),
// //             );
// //           } else {
// //             this.notificationService.toast({
// //               severity: 'error',
// //               summary: 'שגיאה',
// //               detail: response.message || 'לא ניתן לעדכן ספק.',
// //             });
// //           }
// //         },
// //         error: () => {
// //           // טופל ב-MockDataService
// //         },
// //       });
// //     } else {
// //       this.mockDataService.addSupplier(supplier).subscribe({
// //         next: (response: ServiceResultContainer<Supplier>) => {
// //           if (response.success && response.result) {
// //             this.notificationService.toast({
// //               severity: 'success',
// //               summary: 'נוסף',
// //               detail: response.message || 'הספק נוסף בהצלחה.',
// //             });
// //             this.suppliers.set([...this.suppliers(), response.result]);
// //             this.pageState.set(PageStates.Ready);
// //           } else {
// //             this.notificationService.toast({
// //               severity: 'error',
// //               summary: 'שגיאה',
// //               detail: response.message || 'לא ניתן להוסיף ספק.',
// //             });
// //           }
// //         },
// //         error: () => {
// //           // טופל ב-MockDataService
// //         },
// //       });
// //     }
// //   }

--- END OF FILE ---
--- START OF FILE src\app\services\whatsapp.service.ts ---
// whatsapp.service.ts
import { Injectable } from '@angular/core';

export interface WhatsAppMessageOptions {
  phone: string;
  message: string;
  countryCode?: string;
}

@Injectable({
  providedIn: 'root'
})
export class WhatsAppService {
  private readonly DEFAULT_COUNTRY_CODE = '972'; // ישראל
  private readonly APP_DETECTION_TIMEOUT = 1200;
  private readonly DOUBLE_CLICK_PROTECTION_TIMEOUT = 3000;
  
  private sendingStates = new Map<string, boolean>();

  /**
   * שליחת הודעה דרך WhatsApp (פותח את האפליקציה עם הודעה מוכנה)
   * הערה: WhatsApp דורש לחיצה ידנית על "שלח" מסיבות אבטחה
   * @param options אפשרויות ההודעה
   * @returns Promise<boolean> - האם החלון נפתח בהצלחה
   */
  async sendMessage(options: WhatsAppMessageOptions): Promise<boolean> {
    const { phone, message, countryCode = this.DEFAULT_COUNTRY_CODE } = options;
    
    // הגנה מפני לחיצות כפולות
    const protectionKey = `${phone}_${Date.now()}`;
    if (this.sendingStates.get(protectionKey)) {
      console.warn('WhatsApp message already being sent');
      return false;
    }
    
    this.sendingStates.set(protectionKey, true);
    
    try {
      const cleanPhone = this.cleanPhoneNumber(phone);
      const fullPhone = `${countryCode}${cleanPhone}`;
      const encodedMessage = encodeURIComponent(message);
      const phoneParam = `phone=${fullPhone}&text=${encodedMessage}`;
      
      const isMobile = this.isMobileDevice();
      
      if (isMobile) {
        this.openMobileWhatsApp(phoneParam);
        return true;
      } else {
        return await this.tryDesktopWhatsApp(phoneParam);
      }
    } catch (error) {
      console.error('Error sending WhatsApp message:', error);
      return false;
    } finally {
      // איפוס ההגנה אחרי זמן קצוב
      setTimeout(() => {
        this.sendingStates.delete(protectionKey);
      }, this.DOUBLE_CLICK_PROTECTION_TIMEOUT);
    }
  }

  private cleanPhoneNumber(phone: string): string {
    return phone.replace(/\D/g, '');
  }

  private isMobileDevice(): boolean {
    return /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  private openMobileWhatsApp(phoneParam: string): void {
    window.location.href = `whatsapp://send?${phoneParam}`;
  }

  private async tryDesktopWhatsApp(phoneParam: string): Promise<boolean> {
    try {
      const appOpened = await this.checkDesktopAppAvailability(`whatsapp://send?${phoneParam}`);
      
      if (!appOpened) {
        this.openWhatsAppWeb(phoneParam);
      }
      
      return true;
    } catch (error) {
      console.error('Error trying desktop WhatsApp:', error);
      this.openWhatsAppWeb(phoneParam);
      return false;
    }
  }

  private checkDesktopAppAvailability(url: string): Promise<boolean> {
    return new Promise((resolve) => {
      let appOpened = false;
      let timeoutId: number;
      
      const handleVisibilityChange = () => {
        if (document.hidden) {
          appOpened = true;
          cleanup();
          resolve(true);
        }
      };
      
      const handleBlur = () => {
        appOpened = true;
        cleanup();
        resolve(true);
      };
      
      const cleanup = () => {
        document.removeEventListener('visibilitychange', handleVisibilityChange);
        window.removeEventListener('blur', handleBlur);
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
      };
      
      // הוספת מאזינים
      document.addEventListener('visibilitychange', handleVisibilityChange);
      window.addEventListener('blur', handleBlur);
      
      // ניסיון פתיחת האפליקציה
      try {
        window.location.href = url;
      } catch (error) {
        console.error('Error opening WhatsApp app:', error);
        cleanup();
        resolve(false);
        return;
      }
      
      // טיימאאוט - אם תוך זמן קצר לא נפתחה האפליקציה
      timeoutId = window.setTimeout(() => {
        cleanup();
        resolve(appOpened);
      }, this.APP_DETECTION_TIMEOUT);
    });
  }

  /**
   * העתקת הודעה ללוח (כחלופה לWhatsApp)
   */
  async copyMessageToClipboard(message: string): Promise<boolean> {
    try {
      await navigator.clipboard.writeText(message);
      return true;
    } catch (error) {
      console.error('Failed to copy to clipboard:', error);
      return false;
    }
  }

   private openWhatsAppWeb(phoneParam: string): void {
    const webUrl = `https://web.whatsapp.com/send?${phoneParam}`;
    window.open(webUrl, '_blank', 'width=600,height=800,scrollbars=yes,resizable=yes');
  }

  /**
   * פתיחת WhatsApp עם אפשרות גיבוי להעתקה
   */
  async sendMessageWithFallback(options: WhatsAppMessageOptions): Promise<{success: boolean, method: 'whatsapp' | 'clipboard' | 'failed'}> {
    const whatsappSuccess = await this.sendMessage(options);
    
    if (whatsappSuccess) {
      return { success: true, method: 'whatsapp' };
    }
    
    // אם WhatsApp נכשל - נציע העתקה
    const clipboardSuccess = await this.copyMessageToClipboard(options.message);
    
    if (clipboardSuccess) {
      return { success: true, method: 'clipboard' };
    }
    
    return { success: false, method: 'failed' };
  }
  
  

}
--- END OF FILE ---
--- START OF FILE src\app\store\auth.store.ts ---
import { InsightStore } from './insight.store';
import { ProductStore } from './product.store';
import { CategoryStore } from './category.store';
// src/app/store/auth.store.ts
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { AuthService } from '../services/auth.service';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { catchError, firstValueFrom, of, pipe, switchMap, tap } from 'rxjs';
import { UserRole } from '../common/enums/userRole.enum';
import { NotificationService } from '../services/notification.service'; // ✅ ייבוא חסר
import { User } from '../common/models/user';
import { OrderStore } from './order.store';
import { SupplierStore } from './supplier.store';
import { UserStore } from './user.store';
import { StatsStore } from './stats.store';
import { Router } from '@angular/router';

// ✅ הגדרת ה-interface החסר
interface LoginCredentials {
	email: string;
	password: string;
}

interface AuthState {
	user: User | null;
	isLoading: boolean;
	error: string | null;
}

const initialState: AuthState = {
	user: null,
	isLoading: false,
	error: null,
};

export const AuthStore = signalStore(
	{ providedIn: 'root' },
	withState(initialState),
	withComputed(({ user }) => ({
		isAuthenticated: computed(() => !!user()),
		isGuest: computed(() => !user()),
		userRole: computed(() => user()?.role ?? UserRole.User),
		isAdmin: computed(() => user()?.role == UserRole.Admin),
	})),
	withMethods(
		(
			store,
			router = inject(Router),
			authService = inject(AuthService),
			notificationService = inject(NotificationService),
			supplierStore = inject(SupplierStore),
			userStore = inject(UserStore),
			orderStore = inject(OrderStore),
			categoryStore = inject(CategoryStore),
			productStore = inject(ProductStore),
			statsStore = inject(StatsStore),
			insightStore = inject(InsightStore),
		) => {

			
			const loadUser = rxMethod<void>(
				pipe(
					tap(() => patchState(store, { isLoading: true, error: null })),
					switchMap(() =>
						authService.getCurrentUser().pipe(
							tap({
								next: (user: User | null) => {
									patchState(store, { user, isLoading: false });
									// if (user) {
									// 	if (user.role === UserRole.SysAdmin) {
									// 		router.navigate(['/admin/dashboard']);
									// 	} else {
									// 		router.navigate(['/']);
									// 	}
									// }
								},
								error: (err) => {
									patchState(store, { user: null, isLoading: false, error: err.message });
								},
							}),
						),
					),
				),
			);

			return {
				async initialize(): Promise<void> {
					patchState(store, { isLoading: true });
					try {
						const user = await firstValueFrom(authService.getCurrentUser());
						patchState(store, { user: user || null, isLoading: false });
					} catch (error: any) {
						// ✅ הוסף הצגת הודעה כאן
						const errorMessage = error.message || 'Error restoring session.';
						patchState(store, { user: null, isLoading: false, error: errorMessage });
						// הצג הודעה רק אם זו שגיאת רשת
						if (error.message.includes('לא ניתן להתחבר לשרת')) {
							notificationService.toast({ severity: 'error', detail: errorMessage });
						}
					}
				},

				loadUser: loadUser, // חשיפת המתודה החוצה

				logout: rxMethod<void>(
					pipe(
						tap(() => patchState(store, { isLoading: true })),
						switchMap(() =>
							authService.logout().pipe(
								tap({
									next: () => {
										supplierStore.reset(),
											userStore.reset(),
											orderStore.reset(),
											categoryStore.reset(),
											productStore.reset(),
											statsStore.reset(),
											insightStore.reset(),
											patchState(store, initialState);
									},
									error: (err) => {
										patchState(store, { isLoading: false, error: err.message });
									},
								}),
							),
						),
					),
				),

				login: rxMethod<LoginCredentials>(
					pipe(
						tap(() => patchState(store, { isLoading: true, error: null })),
						switchMap((credentials) =>
							authService.login(credentials).pipe(
								tap({
									next: (response) => {
										if (response.success && response.result) {
											// ✅ קוראים למתודה המקומית
											loadUser();
											// router.navigate(['/']);
										} else {
											throw new Error(response.message || 'Login failed');
										}
									},
								}),
								catchError((err) => {
									const errorMessage = err.error?.message || err.message || 'Invalid credentials';
									patchState(store, { isLoading: false, error: errorMessage });
									// ✅ עכשיו notificationService זמין
									notificationService.toast({ severity: 'error', detail: errorMessage });
									return of();
								}),
							),
						),
					),
				),
			};
		},
	),
);
--- END OF FILE ---
--- START OF FILE src\app\store\category.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { pipe, switchMap, tap, filter, catchError, of } from 'rxjs';
import { ApiService } from '../services/api.service';
import { NotificationService } from '../services/notification.service';
import { Category } from '../common/models/category';

interface CategoryState {
	categories: Category[];
	isLoading: boolean;
	error: string | null;
	supplierId: number | null;
}

const initialState: CategoryState = {
	categories: [],
	isLoading: false,
	error: null,
	supplierId: null,
};

export const CategoryStore = signalStore(
	{ providedIn: 'root' },

	withState(initialState),

	withComputed(({ categories }) => ({
		categoryCount: computed(() => categories().length),
	})),

	withMethods((store, apiService = inject(ApiService), notification = inject(NotificationService)) => ({

		// --- מתודות סינכרוניות לעדכון המצב ---
		addCategory(category: Category): void {
			patchState(store, (state) => ({
				categories: [...state.categories, category]
			}));
		},
		updateCategory(updatedCategory: Category): void {
			patchState(store, (state) => ({
				categories: state.categories.map(c => c.id === updatedCategory.id ? updatedCategory : c)
			}));
		},

		reset(): void {
			patchState(store, initialState);
		},

		// --- הוספנו בחזרה את loadCategories ---
		loadCategories: rxMethod<number>(
			pipe(
				// טען רק אם המזהה חדש, או שהמערך ריק
				filter(supplierId => supplierId !== store.supplierId() || store.categories().length === 0),
				tap((supplierId) => patchState(store, { isLoading: true, supplierId, error: null })),
				switchMap((supplierId) =>
					apiService.getCategoriesBySupplier(supplierId).pipe(
						tap({
							next: (response) => {
								patchState(store, {
									categories: response.success ? (response.result || []) : [],
									isLoading: false,
									error: response.success ? null : (response.message || 'Failed to load categories')
								});
							},
							error: (err) => patchState(store, { isLoading: false, error: err.message }),
						})
					)
				)
			)
		),

		deleteCategory: rxMethod<number>(
			pipe(
				// אין צורך ב-isLoading כאן, כי המחיקה מהירה
				switchMap(categoryId =>
					apiService.deleteCategory(categoryId).pipe(
						tap(response => {
							if (response.success) {
								// אם המחיקה בשרת הצליחה, הסר מהמצב הלוקאלי
								patchState(store, (state) => ({
									categories: state.categories.filter(c => c.id !== categoryId)
								}));
								notification.toast({ severity: 'success', detail: 'קטגוריה נמחקה בהצלחה' });
							} else {
								// אם השרת החזיר שגיאה עסקית (למשל, "לא ניתן למחוק קטגוריה עם מוצרים")
								notification.toast({ severity: 'error', detail: response.message || 'שגיאה במחיקת קטגוריה' });
							}
						}),
						// catchError(err => {
						// 	// אם הייתה שגיאת רשת
						// 	// notification.toast({ severity: 'error', detail: 'אירעה שגיאה קריטית במחיקה' });
						// 	return of(null); // החזר Observable ריק כדי למנוע קריסה
						// })
					)
				)
			)
		),






	}))
);
--- END OF FILE ---
--- START OF FILE src\app\store\insight.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { pipe, switchMap, tap } from 'rxjs';
import { computed, inject } from '@angular/core';
import { ApiService } from '../services/api.service';
import { Insight } from '../common/models/insight';

interface InsightState {
    insights: Insight[];
    isLoading: boolean;
}

const initialState: InsightState = { insights: [], isLoading: false };

export const InsightStore = signalStore(
    { providedIn: 'root' },
    withState(initialState),
    withComputed(({ insights }) => ({
        unreadCount: computed(() => insights().length),
        hasUnread: computed(() => insights().length > 0),
    })),
    withMethods((store, api = inject(ApiService)) => ({
        loadInsights: rxMethod<void>(
            pipe(
                tap(() => patchState(store, { isLoading: true })),
                switchMap(() => api.getUnreadInsights().pipe(
                    tap(res => patchState(store, { insights: res.result || [], isLoading: false }))
                ))
            )
        ),
        markAsRead: rxMethod<number>(
            pipe(
                switchMap(id => api.markInsightAsRead(id).pipe(
                    tap(() => {
                        // הסר את התובנה מהמצב המקומי
                        patchState(store, (state) => ({
                            insights: state.insights.filter(i => i.id !== id)
                        }));
                    })
                ))
            )
        ),
        reset(): void {
            patchState(store, initialState);
        },
    }))
);
--- END OF FILE ---
--- START OF FILE src\app\store\order.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { ApiService } from '../services/api.service';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { pipe, switchMap, tap, catchError, of } from 'rxjs';
import { NotificationService } from '../services/notification.service';
import { StatsStore } from './stats.store';
import { SupplierStore } from './supplier.store';
import { HttpErrorResponse } from '@angular/common/http';
import { CreateOrderDto } from '../common/dto/order-create.dto';
import { OrderStatus } from '../common/enums/order-status.enum';
import { OrderType } from '../common/enums/order-type';
import { ReminderType } from '../common/enums/reminderType';
import { Order } from '../common/models/order';
import { Supplier } from '../common/models/supplier';
import { formatDateToYYYYMMDD, parseDateStringAsLocal } from '../common/utils/date.utils';
import { Status } from '../common/enums/status.enum';


// --- Helper Functions (Module-level for reusability) ---
function _isOrderDayForSupplier(supplier: Supplier, date: Date): boolean {
	if (supplier.orderType === OrderType.ByDay) return supplier.orderDays?.includes(date.getDay()) ?? false;
	if (supplier.orderType === OrderType.ByDate) return supplier.orderDates?.includes(date.getDate()) ?? false;
	return false;
}

function _getStartOfWeek(date: Date): Date {
	const newDate = new Date(date);
	newDate.setHours(0, 0, 0, 0);
	newDate.setDate(newDate.getDate() - newDate.getDay());
	return newDate;
}

// --- State Shape ---
interface OrderState {
	orders: Order[]; // For calendar date range
	openOrders: Order[]; // For draft orders list
	isLoading: boolean;
	error: string | null;
	currentDateRange: LoadOrdersParams | null;
}

const initialState: OrderState = {
	orders: [],
	openOrders: [],
	isLoading: false,
	error: null,
	currentDateRange: null,
};

interface LoadOrdersParams {
	supplierIds: number[];
	startDate: string;
	endDate: string;
}

// --- The Store ---
export const OrderStore = signalStore(
	{ providedIn: 'root' },
	withState(initialState),
	withComputed(({ orders }, supplierStore = inject(SupplierStore)) => ({
		ordersCount: computed(() => orders().length),
		sentOrders: computed(() => orders().filter(o => o.status === OrderStatus.Sent)),
		draftOrdersList: computed(() => orders().filter(s => s.status === OrderStatus.Draft)),

		todayOrdersComputed: computed(() => {
			const today = new Date();
			today.setHours(0, 0, 0, 0);
			const todayString = formatDateToYYYYMMDD(today);

			// ✅ שלב 1: סנן את הספקים *קודם*
			const activeSuppliers = supplierStore.suppliers().filter(s => s.status === Status.Active);

			const allOrders = orders();
			const ordersMap = new Map<string, Order>(
				allOrders.map((o) => [`${o.supplierId}-${o.date}`, o])
			);

			const dueToday: Order[] = [];

			// ✅ שלב 2: עכשיו הלולאה רצה רק על הספקים הפעילים
			for (const supplier of activeSuppliers) {
				if (_isOrderDayForSupplier(supplier, today)) {
					const orderKey = `${supplier.id}-${todayString}`;
					const existingOrder = ordersMap.get(orderKey);

					if (existingOrder) {
						// רק אם זו טיוטה. אם ההזמנה כבר נשלחה, לא צריך להציג אותה כ"הזמנה להיום".
						if (existingOrder.status === OrderStatus.Draft) {
							dueToday.push({
								...existingOrder,
								supplierName: supplier.name,
							});
						}
					} else {
						// כל הלוגיקה של reminderType נשארת זהה
						if (supplier.reminderType === ReminderType.UntilOrderDone) {
							const weekStart = _getStartOfWeek(today);
							const weekEnd = new Date(weekStart);
							weekEnd.setDate(weekStart.getDate() + 6);

							let hasSentOrderThisWeek = false;
							for (const order of allOrders) {
								if (order.supplierId === supplier.id && order.status === OrderStatus.Sent) {
									const orderDate = parseDateStringAsLocal(order.date);
									if (orderDate >= weekStart && orderDate <= weekEnd) {
										hasSentOrderThisWeek = true;
										break;
									}
								}
							}
							if (!hasSentOrderThisWeek) {
								dueToday.push({
									supplierId: supplier.id,
									date: todayString,
									status: OrderStatus.Today,
									supplierName: supplier.name,
								} as Order);
							}
						} else { // ReminderType.EachTime
							dueToday.push({
								supplierId: supplier.id,
								date: todayString,
								status: OrderStatus.Today,
								supplierName: supplier.name,
							} as Order);
						}
					}
				}
			}
			// הסינון בסוף כבר לא נחוץ, כי טיפלנו בזה קודם
			return dueToday;
		})
	})),

	withMethods((
		store,
		apiService = inject(ApiService),
		notificationService = inject(NotificationService),
		statsStore = inject(StatsStore),
		supplierStore = inject(SupplierStore)
	) => {
		const methods = {
			reset(): void {
				patchState(store, initialState);
			},
			loadDraftOrders: rxMethod<void>(
				pipe(
					tap(() => patchState(store, { isLoading: true })),
					switchMap(() =>
						apiService.findOrdersByStatus([OrderStatus.Draft]).pipe(
							tap(response => {
								if (response.success && response.result) {
									console.log('Draft orders:', response.result);

									patchState(store, { openOrders: response.result, isLoading: false });
								}
							}),
							catchError((err: HttpErrorResponse) => {
								patchState(store, { error: err.message, isLoading: false });
								return of();
							})
						)
					)
				)
			),
			loadOrdersByDateRange: rxMethod<LoadOrdersParams>(
				pipe(
					tap((params) => patchState(store, { isLoading: true, error: null, currentDateRange: params })),
					switchMap((params) =>
						apiService.findOrdersBySuppliersAndDateRange(params).pipe(
							tap({
								next: (response) => {
									if (response.success && response.result) {
										patchState(store, { orders: response.result, isLoading: false });
									} else {
										patchState(store, { error: response.message || 'Failed to load orders', isLoading: false });
									}
								},
							}),
							catchError((err: HttpErrorResponse) => {
								patchState(store, { error: err.message, isLoading: false });
								notificationService.toast({ severity: 'error', detail: 'שגיאה בטעינת הזמנות' });
								return of();
							})
						)
					)
				)
			),
			saveOrder: rxMethod<CreateOrderDto>(
				pipe(
					switchMap((orderPayload) =>
						apiService.createOrUpdateOrder(orderPayload).pipe(
							tap({
								next: (response) => {
									if (response.success) {
										notificationService.toast({ severity: 'success', detail: response.message || 'ההזמנה נשמרה בהצלחה' });

										statsStore.loadStats({ force: true });

										methods.loadDraftOrders();

										const range = store.currentDateRange();
										if (range) {
											methods.loadOrdersByDateRange(range);
										}
									} else {
										notificationService.toast({ severity: 'error', detail: response.message || 'שגיאה בשמירת ההזמנה' });
									}
								},
							}),
							catchError((err: HttpErrorResponse) => {
								notificationService.toast({ severity: 'error', detail: err.message || 'שגיאה קריטית בשמירת ההזמנה' });
								return of();
							})
						)
					)
				)
			),
		};
		return methods;
	})
);
--- END OF FILE ---
--- START OF FILE src\app\store\product.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { catchError, filter, of, pipe, switchMap, tap } from 'rxjs';
import { HttpErrorResponse } from '@angular/common/http';
import { ApiService } from '../services/api.service';
import { NotificationService } from '../services/notification.service';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { Product } from '../common/models/product';
import { ServiceResultContainer } from '../common/models/serviceResultContainer';

// Interface לעדכון אצווה, כדאי שיהיה מוגדר במקום מרכזי
export interface ProductBatchUpdatePayload {
	id: number;
	position: number;
	categoryId: number;
}

// 1. הגדרת ה-State
interface ProductState {
	products: Product[];
	isLoading: boolean;
	isMutating: boolean; // לפעולות עדכון/מחיקה
	error: string | null;
}

const initialState: ProductState = {
	products: [],
	isLoading: false,
	isMutating: false,
	error: null,
};

// 2. יצירת ה-SignalStore
export const ProductStore = signalStore(
	{ providedIn: 'root' },
	withState(initialState),
	withComputed(({ products }) => ({
		// מחזיר Map של מוצרים לפי ID לגישה מהירה
		productsById: computed(() => {
			const map: { [id: number]: Product } = {};
			for (const product of products()) {
				map[product.id] = product;
			}
			return map;
		}),
	})),
	withMethods(
		(
			store,
			apiService = inject(ApiService),
			notificationService = inject(NotificationService),
		) => {
			// --- מתודות סינכרוניות (Updaters) ---
			const syncMethods = {
				setProducts(products: Product[]): void {
					patchState(store, { products });
				},
				addProduct(product: Product): void {
					patchState(store, (state) => ({
						products: [...state.products, product],
					}));
				},
				updateProduct(updatedProduct: Product): void {
					patchState(store, (state) => ({
						products: state.products.map((p) =>
							p.id === updatedProduct.id ? updatedProduct : p,
						),
					}));
				},
				removeProduct(productId: number): void {
					patchState(store, (state) => ({
						products: state.products.filter((p) => p.id !== productId),
					}));
				},
				reset(): void {
					patchState(store, initialState);
				},
			};

			// --- מתודות אסינכרוניות (Effects) ---
			const asyncMethods = {
				loadProducts: rxMethod<number>( // מקבל supplierId
					pipe(
						tap(() => patchState(store, { isLoading: true, error: null })),
						switchMap((supplierId) =>
							apiService.getProductsBySupplier(supplierId).pipe(
								tap({
									next: (response: ServiceResultContainer<Product[]>) => {
										if (response.success && response.result) {
											patchState(store, { products: response.result, isLoading: false });
										} else {
											throw new Error(response.message || 'Failed to load products');
										}
									},
								}),
								catchError((err: HttpErrorResponse | Error) => {
									const errorMsg = err.message || 'A server error occurred';
									patchState(store, { products: [], error: errorMsg, isLoading: false });
									return of();
								}),
							),
						),
					),
				),

				deleteProduct: rxMethod<number>( // מקבל productId
					pipe(
						tap(() => patchState(store, { isMutating: true })),
						switchMap((productId) =>
							apiService.deleteProduct(productId).pipe(
								tap({
									next: () => {
										syncMethods.removeProduct(productId);
										patchState(store, { isMutating: false });
										notificationService.toast({
											severity: 'success',
											detail: 'המוצר נמחק בהצלחה.',
										});
									},
								}),
								catchError((err) => {
									patchState(store, { isMutating: false, error: err.message });
									notificationService.toast({
										severity: 'error',
										detail: 'שגיאה במחיקת המוצר.',
									});

									return of();
								}),
							),
						),
					),
				),

				updateProductsBatch: rxMethod<ProductBatchUpdatePayload[]>(
					pipe(
						tap(() => patchState(store, { isMutating: true })),
						switchMap((payload) =>
							apiService.updateProductsBatch(payload).pipe(
								tap({
									next: (response) => {
										// אין צורך לעדכן את המצב המקומי, כי העדכון האופטימי כבר קרה.
										// רק צריך להציג הודעה ולאפס את מצב ה-mutating.
										patchState(store, { isMutating: false });
										if (response.success) {
											notificationService.toast({
												severity: 'success',
												detail: 'סדר המוצרים עודכן בהצלחה.',
											});
										} else {
											// אם השרת נכשל, נרצה אולי לרענן את הנתונים
											// כדי לבטל את העדכון האופטימי.
											// this.loadProducts(supplierId); //  צריך להעביר את supplierId
										}
									},
								}),
								catchError((err) => {
									patchState(store, { isMutating: false, error: err.message });
									notificationService.toast({
										severity: 'error',
										detail: 'שגיאה בעדכון סדר המוצרים.',
									});
									return of();
								}),
							),
						),
					),
				),
			};

			// --- חשיפת כל המתודות ---
			return {
				...syncMethods,
				...asyncMethods,
			};
		},
	),
);
--- END OF FILE ---
--- START OF FILE src\app\store\stats.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { ApiService } from '../services/api.service';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { catchError, filter, of, pipe, switchMap, tap } from 'rxjs';
import { HttpErrorResponse } from '@angular/common/http';
import { NotificationService } from '../services/notification.service';
import { DashboardStats } from '../common/models/statistics';

interface StatsState {
	stats: DashboardStats;
	isLoading: boolean;
	error: string | null;
}

const initialState: StatsState = {
	stats: {
		openOrders: 0,
		dueToday: 0,
		monthlyCost: 0,
		prevMonthlyCost: 0,
		costChangePercentage: 0,
		activeSuppliers: 0,
	},
	isLoading: false,
	error: null,
};

export const StatsStore = signalStore(
	{ providedIn: 'root' },

	withState(initialState),

	withMethods((store, apiService = inject(ApiService), notificationService = inject(NotificationService)) => ({
		loadStats: rxMethod<{ force?: boolean }>(
			pipe(
				filter(({ force }) => force || store.stats().openOrders === 0),
				tap(() => patchState(store, { isLoading: true, error: null })),
				switchMap(() =>
					apiService.getDashboardKpis().pipe(
						tap((response) => {
							// console.log('Loading stats...')	
							if (response.success && response.result) {
								patchState(store, { stats: response.result, isLoading: false });
							} else {
								throw new Error(response.message || 'Failed to load stats');
							}
						}),
						catchError((err: HttpErrorResponse | Error) => {
							const errorMsg = err.message || 'A server error occurred';
							patchState(store, { error: errorMsg, isLoading: false });
							// notificationService.toast({ severity: 'error', detail: errorMsg });
							return of();
						})
					)
				)
			)
		),
		reset(): void {
			patchState(store, initialState);
		},
	}))
);
--- END OF FILE ---
--- START OF FILE src\app\store\supplier.store.ts ---
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { ApiService } from '../services/api.service';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { catchError, filter, of, pipe, switchMap, tap } from 'rxjs';
import { Status } from '../common/enums/status.enum';
import { NotificationService } from '../services/notification.service';
import { HttpErrorResponse } from '@angular/common/http';
import { Supplier } from '../common/models/supplier';

// 1. Define the state shape
interface SupplierState {
	suppliers: Supplier[];
	isLoading: boolean;
	error: string | null;
}

const initialState: SupplierState = {
	suppliers: [],
	isLoading: false,
	error: null,
};

// 2. Create the SignalStore
export const SupplierStore = signalStore(
	{ providedIn: 'root' },
	withState(initialState),
	withComputed(({ suppliers }) => ({
		suppliersCount: computed(() => suppliers().length),
		activeSuppliers: computed(() => suppliers().filter(s => s.status === Status.Active).length),

		suppliersById: computed(() => {
			const map: { [id: number]: Supplier } = {};
			for (const supplier of suppliers()) {
				map[supplier.id] = supplier;
			}
			return map;
		})

	})),

	withMethods((
		store,
		apiService = inject(ApiService),
		notificationService = inject(NotificationService),
	) => {
		const syncMethods = {

			setError(error: string): void {
				patchState(store, { error, isLoading: false });
				notificationService.toast({ severity: 'error', detail: error });
			},

			addSupplier(supplier: Supplier): void {
				patchState(store, (state) => ({
					suppliers: [...state.suppliers, supplier],
				}));
				console.log(store.suppliers())
				console.log(store.activeSuppliers())
			},

			updateSupplier(updatedSupplier: Supplier): void {
				console.log('%cSupplierStore: Updating supplier in state:', 'color: green;', updatedSupplier); // DEBUG LOG

				patchState(store, (state) => ({
					suppliers: state.suppliers.map(s => s.id === updatedSupplier.id ? updatedSupplier : s),
				}));
			},

			removeSupplier(supplierId: number): void {
				patchState(store, (state) => ({
					suppliers: state.suppliers.filter(s => s.id !== supplierId),
				}));
			},

			getSupplierById(id: number): Supplier | undefined {
				return store.suppliers().length > 0 ? store.suppliers().find(s => s.id === id) : undefined;
			},
			reset(): void {
				patchState(store, initialState);
			},
		};
		const asyncMethods = {
			loadSuppliers: rxMethod<{ force?: boolean }>(
				pipe(
					filter(({ force }) => force || store.suppliers().length === 0),
					tap((res) => {

						patchState(store, { isLoading: true, error: null })
					}),
					switchMap(() =>
						apiService.getSuppliers().pipe(
							tap((response) => {
								if (response.success && response.result) {
									patchState(store, { suppliers: response.result, isLoading: false });
								} else {
									throw new Error(response.message || 'Failed to load suppliers');
								}
							}),
							catchError((err: HttpErrorResponse | Error) => {
								const errorMsg = err.message || 'A server error occurred';
								patchState(store, { error: errorMsg, isLoading: false });
								// notificationService.toast({ severity: 'error', detail: errorMsg });
								return of();
							})
						)
					)
				)
			),
			deleteSupplier: rxMethod<number>(
				pipe(
					// tap(() => patchState(store, { isLoading: true })),
					switchMap((supplierId) =>
						apiService.deleteSupplier(supplierId).pipe(
							tap({
								next: () => {
									// ✅ עכשיו קוראים למתודה הסינכרונית
									syncMethods.removeSupplier(supplierId);
									patchState(store, { isLoading: false });
									notificationService.toast({
										severity: 'success',
										detail: 'הספק נמחק בהצלחה',
									});
								},
							}),
							catchError((err) => {
								patchState(store, { isLoading: false, error: err.message });
								notificationService.toast({
									severity: 'error',
									detail: 'שגיאה במחיקת הספק',
								});
								return of();
							}),
						),
					),
				),
			),
			loadSupplierById: rxMethod<{ supplierId: number; force?: boolean }>( // ✅ שינוי
				pipe(
					// כאן הלוגיקה של filter קצת יותר מורכבת, כי אנחנו לא רוצים לטעון
					// אם הספק כבר קיים עם כל הפרטים. אפשר לדלג על filter כאן אם רוצים.
					tap(() => patchState(store, { isLoading: true, error: null })),
					switchMap(({ supplierId }) => // ✅ שינוי
						apiService.getSupplierById(supplierId, true).pipe(
							tap({
								next: (response) => {
									if (response.success && response.result) {
										// קוראים למתודה הסינכרונית כדי לעדכן את הספק ברשימה
										syncMethods.updateSupplier(response.result);
									} else {
										// אם השרת החזיר שגיאה לוגית, נזרוק אותה
										throw new Error(response.message || `Failed to load supplier ${supplierId}`);
									}
								}
							}),
							catchError((err) => {
								// תופסים שגיאות רשת או שגיאות שנזרקו מה-tap
								const errorMsg = err.message || 'A server error occurred';
								// מעדכנים את מצב השגיאה ב-Store. 
								// ה-Interceptor כבר הציג הודעה, אז אין צורך כאן.
								patchState(store, { error: errorMsg });
								return of(); // סיים את הזרם
							})
						)
					)
				)
			),
		};
		// --- שלב 3: החזר את כל המתודות מאוחדות ---
		return {
			...syncMethods,
			...asyncMethods,
		};
	}),
);
--- END OF FILE ---
--- START OF FILE src\app\store\user.store.ts ---
// src/app/store/user.store.ts
import { patchState, signalStore, withComputed, withMethods, withState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { catchError, filter, of, pipe, switchMap, tap } from 'rxjs';
import { HttpErrorResponse } from '@angular/common/http';
import { ApiService } from '../services/api.service';
import { NotificationService } from '../services/notification.service'; import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { ServiceResultContainer } from '../common/models/serviceResultContainer';
import { User } from '../common/models/user';

interface UserState {
	users: User[];
	isLoading: boolean;
	error: string | null;
}

const initialState: UserState = {
	users: [],
	isLoading: false,
	error: null,
};

export const UserStore = signalStore(
	{ providedIn: 'root' },
	withState(initialState),
	withComputed(({ users }) => ({
		usersCount: computed(() => users().length),
		activeUsers: computed(() => users().filter((u) => !u.isDeleted)),
	})),
	withMethods((
		store,
		apiService = inject(ApiService),
		notificationService = inject(NotificationService),
	) => {
		// --- שלב 1: הגדר את כל המתודות הסינכרוניות כאן ---
		const syncMethods = {
			addUser(user: User): void {
				patchState(store, (state) => ({
					users: [...state.users, user],
				}));
			},
			updateUser(updatedUser: Partial<User>): void {
				patchState(store, (state) => ({
					users: state.users.map(u => {
						if (u.id === updatedUser.id) {
							return { ...u, ...updatedUser };
						}
						return u;
					}),
				}));

			},
			removeUser(userId: number): void {
				patchState(store, (state) => ({
					users: state.users.filter((u) => u.id !== userId),
				}));
			},
			reset(): void {
				patchState(store, initialState);
			},
		};

		// --- שלב 2: הגדר את המתודות האסינכרוניות והשתמש במתודות הסינכרוניות ---
		const asyncMethods = {
			loadUsers: rxMethod<{ force?: boolean }>(
				pipe(
					filter(({ force }) => force || store.users().length === 0),
					tap(() => patchState(store, { isLoading: true, error: null })),
					switchMap(() =>
						apiService.getUsers().pipe(
							tap({
								next: (response: ServiceResultContainer<User[]>) => {
									if (response.success && response.result) {
										patchState(store, { users: response.result, isLoading: false });
									} else {
										throw new Error(response.message || 'Failed to load users');
									}
								},
							}),
							catchError((err: HttpErrorResponse | Error) => {
								const errorMsg = err.message || 'A server error occurred';
								patchState(store, { error: errorMsg, isLoading: false });
								return of();
							}),
						),
					),
				),
			),
			// in user.store.ts -> withMethods

			deleteUser: rxMethod<number>(
    pipe(
        // אל תעדכן את ה-error state הגלובלי בכלל
        switchMap((userId) => 
            apiService.deleteUser(userId).pipe(
                tap({
                    next: () => {
                        patchState(store, (state) => ({
                            users: state.users.filter(u => u.id !== userId),
                        }));
                        notificationService.toast({ severity: 'success', detail: 'המשתמש נמחק בהצלחה' });
                    },
                    error: (err: HttpErrorResponse) => {
                        // טפל בשגיאה באופן מקומי - רק הצג הודעה
                        const errorMessage = err.error?.message || 'שגיאה במחיקת המשתמש';
                        notificationService.toast({ severity: 'error', detail: errorMessage });
                    }
                }),
                // ה-catchError רק מונע קריסה
                catchError(() => of(null)) 
            )
        )
    )
),
		};


		// --- שלב 3: החזר את כל המתודות מאוחדות ---
		return {
			...syncMethods,
			...asyncMethods,
		};
	}),
);
--- END OF FILE ---
--- START OF FILE src\app\app.component.css ---
--- END OF FILE ---
--- START OF FILE src\app\app.component.html ---
<div class="text-right" dir="rtl">
  <router-outlet></router-outlet>
</div>

<p-toast position="bottom-left" ></p-toast> 

--- END OF FILE ---
--- START OF FILE src\app\app.component.ts ---
import { Component, effect, inject } from '@angular/core';
import { Router, RouterOutlet } from '@angular/router';
import { AuthStore } from './store/auth.store';
import { ToastModule } from 'primeng/toast';

@Component({
	selector: 'app-root',
	imports: [RouterOutlet, ToastModule],
	templateUrl: './app.component.html',
	styleUrl: './app.component.css',
})
export class AppComponent {

	private authStore = inject(AuthStore);
	private router = inject(Router);

	constructor() {
		effect(() => {
			if (!this.authStore.isAuthenticated()) {
				console.log('User is not authenticated, redirecting to login.');
				this.router.navigate(['/login']);
			}
		});
	}
}

--- END OF FILE ---
--- START OF FILE src\app\app.config.ts ---
import { ApplicationConfig, inject, provideAppInitializer, provideZoneChangeDetection } from '@angular/core';
import { provideRouter } from '@angular/router';
import { provideAnimationsAsync } from '@angular/platform-browser/animations/async';
import { routes } from './app.routes';
import {
	HTTP_INTERCEPTORS,
	provideHttpClient,
	withInterceptors,
	withInterceptorsFromDi,
} from '@angular/common/http';
import { providePrimeNG } from 'primeng/config';
import Aura from '@primeng/themes/aura';
import Nora from '@primeng/themes/nora';
import Lara from '@primeng/themes/lara';
import Material from '@primeng/themes/material';
import { definePreset } from '@primeng/themes';
import { MessageService } from 'primeng/api';
import { DynamicDialogModule } from 'primeng/dynamicdialog';
import { DialogService } from 'primeng/dynamicdialog';
import { AuthInterceptor } from './interceptors/auth-interceptor';
import { AuthStore } from './store/auth.store';

const MyCustomPreset = definePreset(Aura, {
	semantic: {
		primary: {
			50: 'hsl(208 100% 95% / 1)',
			100: ' hsl(208 100% 85% / 1)',
			200: ' hsl(208 100% 75% / 1)',
			300: ' hsl(208 100% 65% / 1)',
			400: ' hsl(208 100% 55% / 1)',
			500: ' hsl(208 100% 45% / 1)',
			600: ' hsl(208 100% 35% / 1)',
			700: ' hsl(208 100% 25% / 1)',
			800: ' hsl(208 100% 15% / 1)',
			900: ' hsl(208 100% 5% / 1)',
		},
		colorScheme: {
			light: {
				primary: {
					color: '{primary.500}',
					hoverColor: '{primary.600}',
					activeColor: '{primary.700}',
				},
			},
			dark: {
				primary: {
					color: '{primary.200}',
					hoverColor: '{primary.300}',
					activeColor: '{primary.400}',
				},
			},
		},
	},
});

export const appConfig: ApplicationConfig = {
	providers: [
		provideZoneChangeDetection({ eventCoalescing: true }),
		provideRouter(routes),

		provideAnimationsAsync(),
		providePrimeNG({
			theme: {
				preset: MyCustomPreset,
				options: {
					darkModeSelector: false || 'none',
				},
			},
		}),

		provideHttpClient(withInterceptorsFromDi()),
		MessageService,
		DialogService,
		// DynamicDialogModule,
		{ provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true },
		provideAppInitializer((authStore = inject(AuthStore)) => {
			return authStore.initialize();
		}),
	],
};

--- END OF FILE ---
--- START OF FILE src\app\app.routes.ts ---
import { Routes } from '@angular/router';
import { DashboardComponent } from './components/dashboard/dashboard.component';
import { authGuard } from './guards/auth.guard';
import { sysAdminGuard } from './guards/sys-admin.guard';

export const routes: Routes = [
	{
		path: 'login',
		loadComponent: () => import('./public/login/login.component').then((m) => m.LoginComponent),
	},
	{
		path: 'register',
		loadComponent: () => import('./public/register/register.component').then((m) => m.RegisterComponent),
	},

	// --- נתיבים למשתמש רגיל / Admin ---
	{
		path: '',
		component: DashboardComponent, // Layout ראשי
		canActivate: [authGuard],
		children: [
			{ path: '', loadComponent: () => import('./components/home/home.component').then((m) => m.HomeComponent) },
			{ path: 'suppliers', loadComponent: () => import('./components/suppliers/suppliers.component').then((m) => m.SuppliersComponent) },
			{ path: 'suppliers/:supplierId', loadComponent: () => import('./components/suppliers/supplier/supplier.component').then((m) => m.SupplierComponent) },
			{ path: 'users', loadComponent: () => import('./components/users/users.component').then((m) => m.UsersComponent) },
			{ path: 'orders', loadComponent: () => import('./components/order-history/order-history.component').then((m) => m.OrderHistoryComponent) },
		],
	},

	// --- ✅ נתיבים ייעודיים ל-SysAdmin (קבוצה נפרדת באותה רמה) ---
	{
		path: 'admin',
		component: DashboardComponent, // משתמש באותו Layout
		canActivate: [authGuard, sysAdminGuard],
		children: [
			{ 
                path: '', 
                redirectTo: 'dashboard',
                pathMatch: 'full' 
            },
			{ 
                path: 'dashboard', 
                loadComponent: () => import('./components/admin/admin-dashboard-component/admin-dashboard-component.component').then(m => m.AdminDashboardComponentComponent) 
            },
            { 
                path: 'accounts', // נתיב: /admin/accounts
                loadComponent: () => import('./components/admin/accounts/accounts.component').then(m => m.AccountsComponent) 
            },
		]
	},

	// תופס את כל שאר הנתיבים שלא נמצאו
	{ path: '**', redirectTo: '', pathMatch: 'full' },
];
--- END OF FILE ---
--- START OF FILE src\environments\environment.ts ---
// environment.ts
export const environment = {
	production: false,
	apiUrl: 'http://localhost:3000', // Adjust to your API URL
};

--- END OF FILE ---
--- START OF FILE src\index.html ---
<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>Sapakit-V2</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- פונטים -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- אייקונים -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
  <app-root></app-root>
</body>
</html>
--- END OF FILE ---
--- START OF FILE src\main.ts ---
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig).catch((err) => console.error(err));

--- END OF FILE ---
--- START OF FILE src\styles.css ---
@import 'tailwindcss';

@config "../tailwind.config.ts";
@import 'primeicons/primeicons.css';

@import './app/assets/styles/_reset.css';
@import './app/assets/styles/_loader.css';
@import './app/assets/styles/_buttons.css';
@import './app/assets/styles/_variables.css';
@import './app/assets/styles/_responsive.css';
@import './app/assets/styles/_menu.css';
@import './app/assets/styles/_forms.css';

.page {
	height: var(--page-height);
	width: 100%;
	display: flex;
	width: 100%;
	background-color: var(--frame-bg);
}

.page-height {
	height: var(--page-height);
}

.page-container {
	display: flex;
	flex-direction: column;
	/* align-items: center; */
	scroll-margin: 4px;
	height: 100%;
	width: 100%;
	/* padding: 24px; */
	overflow-y: auto;
	overflow-x: hidden;
	background-color: var(--grey-10);
	/* border-radius: 8px; */
	transition: all 0.3s ease;
	background: linear-gradient(235deg, var(--grey-20) 0%, var(--grey-40) 100%);
	border-radius: 0 12px 0 0;

	@media (max-width: 1000px) {
		border-radius: 0 0 0 0;
	}
}

.card {
	background: white;
	padding: 2rem;
	border-radius: 8px;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	width: 100%;
	/* max-width: 400px; */
}

.main-title {
	font-size: 1.25rem;
	font-weight: 500;
	padding-bottom: 4px;
	color: var(--grey-900);
}

.actions-bar {
	display: flex;
	flex-wrap: wrap; /* Allow wrapping on smaller screens */
	justify-content: space-between;
	align-items: center;
	gap: 1rem;
	/* margin-bottom: 1.5rem; Increased margin */
	padding: 1rem;
	background-color: var(--surface-card, #ffffff);
	border-radius: var(--border-radius, 6px);
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.overlay {
	position: fixed;
	inset: 0;
	background-color: rgba(0, 0, 0, 0.3);
	z-index: 20;
	backdrop-filter: blur(1px);
}

.divider {
	width: 1px;
	height: 24px;
	background-color: var(--grey-300);
	margin: 0 4px;
}

/* --- Error State Styling --- */
.error-card-container {
	display: flex;
	align-items: center;
	justify-content: center;
	min-height: 400px; /* Give it some space */
	width: 100%;

	.error-card {
		background: white;
		border-radius: 16px;
		padding: 2.5rem;
		text-align: center;
		max-width: 450px;
		width: 100%;
		box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
		border: 1px solid var(--red-100);
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 1rem;

		.error-icon-wrapper {
			width: 64px;
			height: 64px;
			border-radius: 50%;
			background-color: var(--red-50);
			display: flex;
			align-items: center;
			justify-content: center;
			margin-bottom: 0.5rem;
			.material-symbols-rounded {
				font-size: 36px;
				color: var(--red-500);
			}
		}
	}
	.error-title {
		font-size: 1.5rem;
		font-weight: 600;
		color: var(--grey-800);
		margin: 0;
	}

	.error-message {
		font-size: 1rem;
		color: var(--grey-500);
		line-height: 1.6;
		max-width: 320px;
		margin: 0;
	}

	.retry-button {
		margin-top: 1rem;
	}
}


.upload-section {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 150px; /* גובה מינימלי כדי למנוע קפיצות */
}

.loader-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    text-align: center;
}

.upload-status-text {
    font-size: 14px;
    font-weight: 500;
    color: var(--grey-700);
}

.upload-status-subtext {
    font-size: 0.8rem;
    color: var(--grey-500);
}

.file-dropzone {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	padding: 1rem;
	border: 1px dashed var(--grey-300);
	border-radius: var(--border-radius);
	background-color: var(--grey-50);
	cursor: pointer;
	transition: all 0.2s ease-in-out;
	position: relative;
	min-height: 100px;
	max-width: 200px;
	margin: 0 auto;

	&:hover {
		border-color: var(--primary-300);
		background-color: var(--primary-50);
	}

	&.dragging-over {
		border-color: var(--primary-500);
		background-color: var(--primary-100);
		transform: scale(1.01);
	}

	.upload-icon {
		color: var(--grey-500);
		font-size: 1.25rem;
		margin-bottom: 0.25rem;
	}

	.upload-text {
		color: var(--grey-600);
		font-size: 0.75rem;
		margin-bottom: 0.25rem;
		text-align: center;
		font-weight: 500;
	}

	.upload-hint {
		color: var(--grey-400);
		font-size: 0.7rem;
		text-align: center;
		margin: 0.1rem 0;
	}

	.file-input {
		position: absolute;
		width: 100%;
		height: 100%;
		top: 0;
		left: 0;
		opacity: 0;
		cursor: pointer;
	}
}

/* Day chips */

.day-chip {
	display: inline;
	margin: 0 1px;
	background: var(--grey-50);
	/* border: 1px solid var(--grey-100); */
	border-radius: 1rem;
	padding: 0.15rem 0.35rem;
	font-size: 0.65rem;
	transition: all 0.2s ease;
	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
	transition: 0.2s all ease-in-out;
	&:hover {
		background: var(--grey-80);
	}
}

.day-chips {
	display: flex;
	gap: 4px;
}

.text-grey-xs {
	font-size: 0.75rem;
	color: var(--grey-400);
	margin: 0;
}

.expandable {
	max-height: 0;
	overflow: hidden;
	opacity: 0;
	transform: translateY(-8px);
	transition: all 0.3s ease-out;
	pointer-events: none;

	&.expanded {
		max-height: 800px;
		opacity: 1;
		transform: translateY(0);
		pointer-events: all;
		transition: all 0.3s ease-in-out;
	}
}

.chip {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding: 6px 12px;
	font-size: 13px;
	color: var(--grey-800);
	background: var(--grey-50);
	border: 1px solid var(--grey-200);
	border-radius: 20px;
	cursor: pointer;
	transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
	height: 28px;
	width: 28px;
	position: relative;
	user-select: none;
	white-space: nowrap;

	&:hover {
		background: var(--secondary-100);
		border-color: var(--secondary-300);
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
		transform: translateY(-1px);
	}

	&:active {
		background: var(--secondary-300);
		box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
		transform: none;
	}

	&.chip-selected {
		color: var(--white);
		background: var(--secondary-200);
		border-color: var(--secondary-300);
		position: relative;

		&:hover {
			background: var(--secondary-300);
			border-color: var(--secondary-400);

			&::after {
				color: var(--secondary-500);
			}
		}

		&:active {
			background: var(--secondary-400);
		}

		&::after {
			content: '\e5ca';
			position: absolute;
			right: -2px;
			top: -4px;
			width: 12px;
			height: 12px;
			font-family: 'Material Symbols Rounded';
			color: var(--secondary-400);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px;
			background-color: var(--secondary-100);
			border: 1px solid var(--secondary-400);
			animation: chip-check-appear 0.4s ease-in-out;
		}
	}

	&.chip-sm {
		height: 1.75rem;
		padding: 0.25rem 0.75rem;
		font-size: 0.75rem;
	}
}

@keyframes chip-check-appear {
	from {
		transform: translateY(8px) scale(0.5);
		opacity: 0;
	}

	to {
		transform: translateY(0px) scale(1);
		opacity: 1;
	}
}

/* Empty state */
.empty-state {
	text-align: center;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	padding: 1.5rem 0.5rem;
	background: var(--grey-10);
	border-radius: var(--border-radius);
	box-shadow: var(--box-shadow);
	max-width: 800px;
	min-width: 360px;
	margin: 0 auto;
}

.empty-state i {
	font-size: 2rem;
	color: var(--grey-500);
	margin-bottom: 0.5rem;
}

.empty-state p {
	margin-bottom: 1rem;
	color: var(--grey-500);
	font-size: 0.8rem;
}

.empty-message {
	text-align: center;
	padding: 1rem;
	color: var(--grey-500);
	font-size: 0.8rem;
}

/* .p-dialog {
    container-type: inline-size;
}

@container (max-width: 400px) {
    .p-dialog .p-dialog-header {
      padding: 0.75rem;
      font-size: 1rem;
    }
    
    .p-dialog .p-dialog-content {
      padding: 0.75rem;
    }
    
    .p-dialog .p-dialog-footer {
      padding: 0.75rem;
    }
  }
  
   */
/* .main-wrapper {
    padding: 32px calc(var(--menu-width) + 4px) 24px 24px;
    height: 100%;
    width: 100%;
    overflow-y: auto;
    position: relative;
    transition: padding 0.4s ease-in-out;
    background-color: lightblue;

    &::after {
        content: '';
        display: block;
        height: 32px;
        width: 100%;
        position: fixed;
        top: var(--header-height);
        left: 20px;
        right: var(--menu-width);
        z-index: 1;
        background: linear-gradient(to bottom, var(--primary-10) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none;
    }

    @media (max-width:800px) {
        padding: 32px 28px 24px 24px;
    }
} */

@keyframes subtle-pop {
	0% {
		transform: scale(0.95);
	}

	50% {
		transform: scale(1.05);
	}

	100% {
		transform: scale(1);
	}
}

--- END OF FILE ---
--- START OF FILE angular.json ---
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "sapakit_ng20": {
      "projectType": "application",
      "schematics": {
        "@schematics/angular:class": {
          "skipTests": true
        },
        "@schematics/angular:component": {
          "skipTests": true
        },
        "@schematics/angular:directive": {
          "skipTests": true
        },
        "@schematics/angular:guard": {
          "skipTests": true
        },
        "@schematics/angular:interceptor": {
          "skipTests": true
        },
        "@schematics/angular:pipe": {
          "skipTests": true
        },
        "@schematics/angular:resolver": {
          "skipTests": true
        },
        "@schematics/angular:service": {
          "skipTests": true
        }
      },
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@angular/build:application",
          "options": {
            "outputPath": "dist/sapakit_ng20",
            "index": "src/index.html",
            "browser": "src/main.ts",
            "polyfills": [
              "zone.js"
            ],
            "tsConfig": "tsconfig.app.json",
            "assets": [
              {
                "glob": "**/*",
                "input": "public"
              },
              "src/app/assets"
            ],
            "styles": [
              "src/app/assets/styles/custom-theme.scss",
              "src/styles.css"
            ],
            "scripts": [],
            "allowedCommonJsDependencies": [

            ]
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2MB",
                  "maximumError": "5MB"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "10kB",
                  "maximumError": "15kB"
                }
              ],
              "outputHashing": "all"
            },
            "development": {
              "optimization": false,
              "extractLicenses": false,
              "sourceMap": true
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@angular/build:dev-server",
          "configurations": {
            "production": {
              "buildTarget": "sapakit_ng20:build:production"
            },
            "development": {
              "buildTarget": "sapakit_ng20:build:development"
            }
          },
          "defaultConfiguration": "development"
        },
        "extract-i18n": {
          "builder": "@angular/build:extract-i18n"
        },
        "test": {
          "builder": "@angular/build:karma",
          "options": {
            "polyfills": [
              "zone.js",
              "zone.js/testing"
            ],
            "tsConfig": "tsconfig.spec.json",
            "assets": [
              {
                "glob": "**/*",
                "input": "public"
              }
            ],
            "styles": [
              "src/styles.css"
            ],
            "scripts": []
          }
        }
      }
    }
  },
  "schematics": {
    "@schematics/angular:component": {
      "type": "component"
    },
    "@schematics/angular:directive": {
      "type": "directive"
    },
    "@schematics/angular:service": {
      "type": "service"
    },
    "@schematics/angular:guard": {
      "typeSeparator": "."
    },
    "@schematics/angular:interceptor": {
      "typeSeparator": "."
    },
    "@schematics/angular:module": {
      "typeSeparator": "."
    },
    "@schematics/angular:pipe": {
      "typeSeparator": "."
    },
    "@schematics/angular:resolver": {
      "typeSeparator": "."
    }
  }
}
--- END OF FILE ---
--- START OF FILE package.json ---
{
  "name": "sapakit-front-ng19",
  "version": "0.0.0",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "watch": "ng build --watch --configuration development",
    "test": "ng test"
  },
  "private": true,
"dependencies": {
    "@angular/cdk": "^19.2.19",
    "@angular/common": "^19.2.0",
    "@angular/compiler": "^19.2.0",
    "@angular/core": "^19.2.0",
    "@angular/forms": "^19.2.0",
    "@angular/material": "^19.2.19",
    "@angular/platform-browser": "^19.2.0",
    "@angular/platform-browser-dynamic": "^19.2.0",
    "@angular/router": "^19.2.0",
    "@hebcal/core": "^5.9.3",
    "@ngrx/signals": "^19.2.1",
    "@primeng/themes": "^19.1.3",
    "@primeuix/themes": "^1.2.1",
    "@tailwindcss/postcss": "^4.1.11",
    "postcss": "^8.5.6",
    "primeicons": "^7.0.0",
    "primeng": "^19.1.3",
    "rxjs": "~7.8.0",
    "tailwindcss": "^4.1.11",
    "tslib": "^2.3.0",
    "xlsx": "^0.18.5",
    "chart.js": "^4.4.9",
    "zone.js": "~0.15.0"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "^19.2.6",
    "@angular/cli": "^19.2.6",
    "@angular/compiler-cli": "^19.2.0",
    "@types/jasmine": "~5.1.0",
    "jasmine-core": "~5.6.0",
    "karma": "~6.4.0",
    "karma-chrome-launcher": "~3.2.0",
    "karma-coverage": "~2.2.0",
    "karma-jasmine": "~5.1.0",
    "karma-jasmine-html-reporter": "~2.1.0",
    "typescript": "~5.7.2"
  }
}
--- END OF FILE ---
--- START OF FILE tailwind.config.ts ---
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./src/**/*.{html,ts}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          10: 'hsl(208 100% 99%)',
          20: 'hsl(208 100% 98%)',
          30: 'hsl(208 100% 97%)',
          40: 'hsl(208 100% 96%)',
          50: 'hsl(208 100% 95%)',
          60: 'hsl(208 100% 93%)',
          70: 'hsl(208 100% 91%)',
          80: 'hsl(208 100% 89%)',
          90: 'hsl(208 100% 87%)',
          100: 'hsl(208 100% 85%)',
          200: 'hsl(208 100% 75%)',
          300: 'hsl(208 100% 65%)',
          400: 'hsl(208 100% 55%)',
          500: '#007ae6',
          600: 'hsl(208 100% 35%)',
          700: 'hsl(208 100% 25%)',
          800: 'hsl(208 100% 15%)',
          900: 'hsl(208 100% 5%)',
        },
        secondary: {
          50: 'hsl(300 20% 99%)',
          80: 'hsl(300 20% 97%)',
          90: 'hsl(300 20% 96%)',
          100: 'hsl(300 20% 95%)',
          200: 'hsl(300 20% 85%)',
          300: 'hsl(300 20% 75%)',
          400: 'hsl(300 20% 65%)',
          500: '#a375a3',
          600: 'hsl(300 20% 45%)',
          700: 'hsl(300 20% 35%)',
          800: 'hsl(300 20% 25%)',
          900: 'hsl(300 20% 15%)',
        },
        grey: {
          10: 'hsl(30 4% 99%)',
          20: 'hsl(30 4% 98%)',
          30: 'hsl(30 4% 97%)',
          40: 'hsl(30 4% 96%)',
          50: 'hsl(30 4% 95%)',
          60: 'hsl(30 4% 94%)',
          70: '#eeedec',
          80: 'hsl(30 4% 92%)',
          90: 'hsl(30 4% 91%)',
          100: 'hsl(30 5% 90%)',
          200: 'hsl(25 5% 80%)',
          300: '#b7b2ae',
          400: 'hsl(25 6% 60%)',
          500: '#887e77',
          600: 'hsl(20 7% 40%)',
          700: 'hsl(20 8% 30%)',
          800: 'hsl(20 8% 20%)',
          900: 'hsl(20 10% 10%)',
        },
        red: {
          50: 'hsl(0 71% 98%)',
          100: 'hsl(0 71% 95%)',
          200: 'hsl(0 71% 85%)',
          300: 'hsl(0 71% 75%)',
          400: 'hsl(0 71% 65%)',
          500: 'hsl(0 71% 55%)',
          600: 'hsl(0 71% 45%)',
          700: 'hsl(0 71% 35%)',
          800: 'hsl(0 71% 25%)',
          900: 'hsl(0 71% 15%)',
        },
        green: {
          50: 'hsl(142.56 71% 98%)',
          100: 'hsl(142.56 71% 95%)',
          200: 'hsl(142.56 71% 85%)',
          300: 'hsl(142.56 71% 75%)',
          400: 'hsl(142.56 71% 65%)',
          500: 'hsl(142.56 71% 55%)',
          600: 'hsl(142.56 71% 45%)',
          700: 'hsl(142.56 71% 35%)',
          800: 'hsl(142.56 71% 25%)',
          900: 'hsl(142.56 71% 15%)',
        },
        yellow: {
          50: 'hsl(48.28 71% 98%)',
          100: 'hsl(48.28 71% 95%)',
          200: 'hsl(48.28 71% 85%)',
          300: 'hsl(48.28 71% 75%)',
          400: 'hsl(48.28 71% 65%)',
          500: 'hsl(48.28 71% 55%)',
          600: 'hsl(48.28 71% 45%)',
          700: 'hsl(48.28 71% 35%)',
          800: 'hsl(48.28 71% 25%)',
          900: 'hsl(48.28 71% 15%)',
        }
      },
      fontSize: {
        'responsive-sm': 'clamp(10px, 1.75cqw, 14px)',
        'responsive-lg': 'clamp(16px, 4cqw, 24px)',
      },
      padding: {
        'responsive': 'clamp(4px, 1.25vw, 24px)',
      },
      width: {
        '17': '4.25rem',
        '18': '4.5rem', 
        '19': '4.75rem',
      },
    },
  },
  plugins: [],
}



--- END OF FILE ---
--- START OF FILE tsconfig.json ---
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
  "compileOnSave": false,
  "compilerOptions": {
    "outDir": "./dist/out-tsc",
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "skipLibCheck": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "experimentalDecorators": true,
    "moduleResolution": "bundler",
    "importHelpers": true,
    "target": "ES2022",
    "module": "ES2022"
  },
  "angularCompilerOptions": {
    "enableI18nLegacyMessageIdFormat": false,
    "strictInjectionParameters": true,
    "strictInputAccessModifiers": true,
    "strictTemplates": true
  }
}

--- END OF FILE ---
